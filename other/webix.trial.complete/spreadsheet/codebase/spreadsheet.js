/**
 * @license
 * Webix SpreadSheet v.8.4.5
 * This software is covered by Webix Trial License.
 * Usage without proper license is prohibited.
 * (c) XB Software Ltd.
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(0,function(){"use strict";webix.i18n.spreadsheet={labels:{common:"Common",currency:"Currency",number:"Number",percent:"Percent",date:"Date",string:"Text","custom-format":"Custom","decimal-places":"Decimal places",separator:"Group separator",negative:"Negative number","currency-symbol":"Сurrency","date-format":"Date format","format-docs":"How to create a format","undo-redo":"Undo/Redo",font:"Font",text:"Text",cell:"Cell",align:"Align",format:"Number",column:"Column",borders:"Borders",px:"px",apply:"Apply",cancel:"Cancel",save:"Save",sheet:"Sheet","conditional-format":"Conditional Format",condition:"Condition","conditional-style":"Style","conditional-operator":"Operator","conditional-between":"between","conditional-not-equal":"not equal",range:"Range","range-title":"Named ranges","range-name":"Name","range-cells":"Range","range-scope":"Scope","range-global":"Book","image-or":"or","image-title":"Add image","image-upload":"Select file for upload","image-url":"URL (e.g. http://*)","sparkline-title":"Add sparkline","sparkline-type":"Type","sparkline-range":"Range","sparkline-color":"Color","sparkline-positive":"Positive","sparkline-negative":"Negative","format-title":"Set format","format-pattern":"Format pattern","dropdown-empty":"Empty cells","dropdown-title":"Add dropdown","dropdown-range":"Range",ok:"OK","import-title":"Import","import-not-support":"Sorry, your browser does not support import","export-title":"Export","export-name":"Name of xslx file","export-all-sheets":"Export all sheets","link-title":"Add Link","link-name":"Text","link-url":"URL",image:"Image","add-image-cell":"Add to cell","add-image-top":"Add above cells",graph:"Graph","add-sparkline":"Add to cell","add-chart":"Add above cells",display:"Display",value:"Value","range-remove-confirm":"Are you sure you want to remove the range permanently?","sheet-remove-confirm":"Are you sure you want to remove the sheet permanently?","merge-cell-confirm":"Only the left top value will remain after merging. Continue?","error-range":"The range is incorrect!",print:"Print","print-title":"Before you print..","print-settings":"General settings","print-paper":"Paper size","print-layout":"Layout","current-sheet":"Current sheet","all-sheets":"All sheets",selection:"Selected cells",borderless:"Hide gridlines","sheet-names":"Show sheet names","skip-rows":"Skip empty rows",margin:"Hide margins","page-letter":"Letter","page-a4":"A4 (210x297mm)","page-a3":"A3 (297x420mm)","page-width":"Page width","page-actual":"Actual Size","page-portrait":"Portrait","page-landscape":"Landscape",comment:"Comment",width:"Width",height:"Height","fit-content":"Fit to content","default-size":"Reset to default","edit-view":"Edit","remove-view":"Remove","chart-edit":"Edit chart","chart-common":"Common","chart-series":"Series","chart-extras":"Extras","export-view":"Download","export-view-pdf":"PDF document","export-view-png":"PNG image","export-view-excel":"Excel file","line-chart":"Line","area-chart":"Area","bar-chart":"Bar","donut-chart":"Donut","pie-chart":"Pie","radar-chart":"Radar","spline-chart":"Spline","splinearea-chart":"Spline Area","chart-scale":"Scale","chart-x-axis":"X axis","chart-y-axis":"Y axis","chart-lines":"Lines","chart-scale-color":"Scale color","chart-xAxis-title":"Title","chart-yAxis-title":"Title","chart-col-xAxis":"Use left column as xAxis","chart-row-xAxis":"Use top row as xAxis","chart-xAxis-range":"Range","chart-yAxis-origin":"Origin","chart-yAxis-start":"Start","chart-yAxis-end":"End","chart-yAxis-step":"Step","chart-yAxis-note":"* Set all the following parameters to see the effect","chart-legend":"Legend","chart-row-legend":"Use top row as legend","chart-col-legend":"Use left column as legend","chart-legend-range":"Legend range","chart-legend-align":"Align","chart-legend-left":"Left","chart-legend-right":"Right","chart-legend-center":"Center","chart-legend-valign":"Vertical align","chart-legend-top":"Top","chart-legend-middle":"Middle",
"chart-legend-bottom":"Bottom","chart-item":"Data","stacked-chart":"Stacked","chart-range":"Range","chart-series-color":"Color","add-line":"Add line","chart-type":"Type","chart-tooltip":"Tooltips","chart-label":"Labels","chart-data-from":"Data series from","chart-columns":"columns","chart-rows":"rows","chart-markers":"Markers","chart-markers-square":"Square","chart-markers-triangle":"Triangle","chart-markers-diamond":"Diamond","chart-markers-round":"Round","chart-pie-text":"Show values inside","chart-pie-3d":"3D","chart-radar-circle":"Circled lines"},tooltips:{color:"Font color",background:"Background color","font-family":"Font family","font-size":"Font size","text-align":"Horizontal align","vertical-align":"Vertical align",borders:"Borders","borders-no":"Clear borders","borders-left":"Left border","borders-top":"Top border","borders-right":"Right border","borders-bottom":"Bottom border","borders-all":"All borders","borders-outer":"Outer borders","borders-top-bottom":"Top and bottom borders","borders-color":"Border color","align-left":"Left align","align-center":"Center align","align-right":"Right align","align-top":"Top align","align-middle":"Middle align","align-bottom":"Bottom align",span:"Merge",wrap:"Text wrap",undo:"Undo",redo:"Redo",format:"Number format","increase-decimals":"Increase decimal places","decrease-decimals":"Decrease decimal places","font-weight":"Bold","font-style":"Italic","text-decoration":"Underline","hide-gridlines":"Hide/show gridlines","hide-headers":"Hide/show headers","create-filter":"Create/remove filters","freeze-columns":"Freeze/unfreeze columns","add-range":"Set name for the selected range",conditional:"Conditional formatting","add-sheet":"Add Sheet","lock-cell":"Lock/unlock cell",clear:"Clear","add-link":"Add link",row:"Rows",column:"Columns",sheet:"Sheet","add-image":"Image","add-sparkline":"Graph","add-comment":"Comment"},menus:{"remove-sheet":"Remove sheet","rename-sheet":"Rename sheet",file:"File","new":"New","new-sheet":"New sheet","excel-import":"Import from Excel","excel-export":"Export to Excel",sheet:"Sheets","copy-sheet":"Copy to new sheet",edit:"Edit",undo:"Undo",redo:"Redo",columns:"Columns","insert-column":"Insert column","delete-column":"Delete column","show-column":"Show column","hide-column":"Hide column","resize-column":"Resize column",rows:"Rows","insert-row":"Insert row","delete-row":"Delete row","show-row":"Show row","hide-row":"Hide row","resize-row":"Resize row",insert:"Insert","conditional-format":"Conditional format",common:"common",text:"text",clear:"Clear","clear-value":"Values","clear-style":"Styles","clear-conditional-formats":"Conditional formats","clear-dropdown-editors":"Dropdowns and filters","clear-comments":"Comments","clear-all":"All",image:"Image","add-image-cell":"Add to cell","add-image-top":"Add above cells",graph:"Graph","add-sparkline":"Add to cell","add-chart":"Add above cells",data:"Data","add-link":"Add link","add-range":"Named ranges",sort:"Sort","sort-asc":"Sort A to Z","sort-desc":"Sort Z to A",view:"View","freeze-columns":"Freeze/unfreeze columns","freeze-rows":"Freeze/unfreeze rows","hide-gridlines":"Hide/show gridlines","hide-headers":"Hide/show headers","create-filter":"Create/remove filters","add-dropdown":"Add dropdown","lock-cell":"Lock/unlock cell",print:"Print","add-comment":"Comment"},table:{"math-error":"#ERROR!","math-ref-error":"#REF!","format-error":"INCORRECT FORMAT"},liveEditor:{edit:"Edit:"},formats:{dateFormat:"mm/dd/yyyy",timeFormat:"hh:mm AM/PM",longDateFormat:"dd mmmm yyyy",fullDateFormat:"mm/dd/yyyy hh:mm AM/PM",parseDateTime:"%m/%d/%Y %G:%i:%s",parseDate:"%m/%d/%Y",currencies:["{obj} €","¥{obj}","R$ {obj}","{obj} rub."]}},webix.protoUI({name:"ssheet-align",$cssName:"richselect",$init:function(e){e.options={view:"datasuggest",body:{view:"ssheet-icons",tooltip:{template:"#tooltip#"},xCount:3,yCount:1},data:e.data}}},webix.ui.richselect),webix.protoUI({name:"ssheet-borders-suggest",defaults:{width:300},$init:function(e){e.body={margin:6,cols:[{view:"ssheet-icons",scroll:!1,select:!0,xCount:4,yCount:2,tooltip:{
template:function(e){return webix.i18n.spreadsheet.tooltips["borders-"+e.id]}},on:{onAfterSelect:function(){this.getParentView().getParentView().updateMasterValue(!0)}},template:function(e){return"<span class='"+("webix_ssheet_button_icon webix_ssheet_icon ssi-borders-"+e.value)+"'></span>"},data:e.data},{view:"ssheet-separator"},{rows:[{view:"ssheet-color",css:e.css,name:e.name,width:68,value:"contrast"==webix.skin.$name?"#ffffff":"#000000",tooltip:webix.i18n.spreadsheet.tooltips["borders-color"],title:"<span class='webix_icon wxi-pencil'></span>",on:{onChange:function(){this.getParentView().getParentView().getParentView().updateMasterValue(!1)}}},{view:"richselect",css:"webix_ssheet_border_type",value:"thin",suggest:{fitMaster:!1,width:130,css:"webix_ssheet_suggest",body:{template:"<div class='webix_ssheet_border webix_ssheet_border_#id#'></div>"},data:[{id:"thin"},{id:"medium"},{id:"thick"},{id:"dashed"},{id:"dotted"},{id:"double"}]}},{}]}]}},updateMasterValue:function(e){var t=this.getValue();webix.$$(this.config.master).setValue(t),e&&this.hide()},setValue:function(e){e[0]&&this.getList().select(e[0]),e[1]&&this.getColorView().setValue(e[1]),e[2]&&this.getTypeView().setValue(e[2])},getValue:function(){return[this.getList().getSelectedId(),this.getColorView().getValue()||"",this.getTypeView().getValue()||""]},getList:function(){return this.getBody().getChildViews()[0]},getColorView:function(){return this.getBody().getChildViews()[2].getChildViews()[0]},getTypeView:function(){return this.getBody().getChildViews()[2].getChildViews()[1]},getItemText:function(){return"<span class='webix_ssheet_button_icon webix_ssheet_icon ssi-borders-all'>"}},webix.ui.suggest),webix.protoUI({name:"ssheet-borders",$cssName:"richselect",$init:function(e){e.options={view:"ssheet-borders-suggest",fitMaster:!1,data:e.data},this.$ready.push(webix.bind(function(){this.getPopup().config.master=this.config.id},this))},setValue:function(e){return webix.isArray(e)&&(this.config.value&&e[0]==this.config.value[0]&&e[1]==this.config.value[1]||this.getPopup().setValue(e),(this.config.value=e)[0]&&this.callEvent("onChange")),e},getValue:function(){return this.getPopup().getValue().join(",")},getList:function(){return this.getPopup().getBody().getChildViews()[0]},getColorView:function(){return this.getPopup().getBody().getChildViews()[1].getChildViews()[0]}},webix.ui.richselect),webix.protoUI({$cssName:"colorboard",name:"ssheet-colorboard",defaults:{height:202,width:220,css:"webix_ssheet_colorboard",type:"classic",palette:[["#000000","#434343","#666666","#999999","#b7b7b7","#cccccc","#d9d9d9","#efefef","#f3f3f3","#ffffff"],["#980000","#ff0000","#ff9900","#ffff00","#00ff00","#00ffff","#4a86e8","#0000ff","#9900ff","#ff00ff"],["#e6b8af","#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#c9daf8","#cfe2f3","#d9d2e9","#ead1dc"],["#dd7e6b","#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#a4c2f4","#9fc5e8","#b4a7d6","#d5a6bd"],["#cc4125","#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6d9eeb","#6fa8dc","#8e7cc3","#c27ba0"],["#a61c00","#cc0000","#e69138","#f1c232","#6aa84f","#45818e","#3c78d8","#3d85c6","#674ea7","#a64d79"],["#85200c","#990000","#b45f06","#bf9000","#38761d","#134f5c","#1155cc","#0b5394","#351c75","#741b47"],["#5b0f00","#660000","#783f04","#7f6000","#274e13","#0c343d","#1c4587","#073763","#20124d","#4c1130"]]},$init:function(){this.attachEvent("onSelect",function(e){this.getParentView().setMasterValue({value:e})})}},webix.ui.colorboard),webix.protoUI({$cssName:"richselect",name:"ssheet-color",defaults:{css:"webix_ssheet_color",icon:"wxi-menu-down",suggest:{borderless:!0,body:{view:"ssheet-colorboard"}}},$init:function(){this.$view.className+=" webix_ssheet_color"},$renderInput:function(r,e,t){var o=this.renderColor.call(this);return e=e.replace(/([^>]>)(.*)(<\/div)/,function(e,t,n,i){return t+r.title+o+i}),webix.ui.colorpicker.prototype.$renderInput.call(this,r,e,t)},$setValue:function(e){e=e||"",webix.$$(this.config.popup.toString()).getBody().setValue(e),this.config.value=e,this.getColorNode().style.backgroundColor=e},
renderColor:function(){return"<div class='webix_ssheet_cp_color' style='background-color:"+this.config.value+";'> </div>"},getColorNode:function(){return this.$view.firstChild.firstChild.childNodes[1]},$renderIcon:function(){return webix.ui.text.prototype.$renderIcon.apply(this,arguments)}},webix.ui.colorpicker);var e=function jo(e,t){return e(t={exports:{}},t.exports),t.exports}(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var E,n={1:"#ERROR",2:"#ERROR",3:"#REF!"},h=function(){return(h=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function $(e,t,n){return n+64*t+64*e*4096}function S(e){return[e<2147483648?e>>18:e/262144&16777215,e>>6&4095,63&e]}function V(e){return e<2147483648?e>>18:e/262144&16777215}function m(e){return 63&e}function a(e,t,n){for(var i=S(e),r=i[0],o=i[1],a=S(t),l=a[0]-r,s=a[1]-o,c=0;c<=l;c++)for(var u=0;u<=s;u++)n(e+64*u+4096*c*64)}function A(e,t){for(var n,i,r,o,a,l,s,c,u=e.code,h=e.source,d="",f=u.length,g=0;g<f;g+=3)switch(u[g]){case 5:var v=void 0;9===u[g+6]&&(v=t.pageName(m(u[g+7]))),d+=(-1!==(c=v||e.source.substr(u[g+1],u[g+2])).indexOf(" ")?"'"+c+"'":c)+"!";break;case 7:d+=p(o=(n=S(u[g+4]))[0],l=n[1],u[g+5]);break;case 4:d+=h.substr(u[g+1],u[g+2]).toUpperCase();break;case 8:o=(i=S(u[g+4]))[0],l=i[1],a=(r=S(u[g+7]))[0],s=r[1],d+=p(o,l,u[g+5]),d+=":",d+=p(a,s,u[g+8]);break;case 9:break;case 2:d+="{{"+h.substr(u[g+1],u[g+2])+"}}";break;case 3:d+="#REF!";break;case 1:d+='"'+h.substr(u[g+1],u[g+2])+'"';break;default:d+=h.substr(u[g+1],u[g+2])}return d}function p(e,t,n){var i="";2&n&&(i+="$");var r="";for(t+=1;0<t;){var o=t%26;0===o&&(o=26),r=String.fromCharCode(64+o)+r,t=(t-o)/26}return i+=r,1&n&&(i+="$"),i+(e+1)}function z(e){return e<=122?65<=e||35===e||36===e:191<e}function I(e){var t=e.charCodeAt(0);return 48<=t&&t<=57}function R(e,t){for(var n;t++,48<=(n=e.charCodeAt(t))&&n<=57;);return t}function D(e){return" "===e||"\t"===e||"\n"===e||"\r"===e}function O(e,t){for(;D(e[++t]););return t}function M(e,t){if("<"===e[t]){var n=e[t+1];">"!==n&&"="!==n||t++}else">"===e[t]&&"="===e[t+1]&&t++;return t+1}function T(e,t,n){for(var i=e.length,r=!0,o=t,a=!1,l=!1,s=!1,c=0;o<i;o++){var u=e[o];if("'"!==u){if(!a){s=!0;var h=u.charCodeAt(0);if(z(h)){h<=122?97<=h&&(l=!0):r=!1,1==c&&c++;continue}if(I(u)){0==c&&c++;continue}break}}else{if(s)break;if(a){o++;break}a=!0}}var d,f,g,v=e[o],m=t,p=o-t;return a&&((p-=1+("'"===e[o-1]?1:0))<0&&(p=0),m++,n=5),0===n&&(":"===v&&r?(n=8,l&&(E=!0)):"!"===v?n="#"===e[m]?3:5:"("===v?(d=m,f=p,(g=e.substr(d,f)).toUpperCase()!==g&&(E=!0),n=4):"}"===v?n=2:1===c&&r?(n=7,l&&(E=!0)):n=6),[m,p,o,n]}function F(e,t,n){for(var i=0,r=0,o=1,a=1,l=0,s=!1,c=t.length-1;0<=c;c--){var u=t[c].charCodeAt(0);36!==u?u<58?(r+=(u-48)*o,o*=10):(s||(i=r,s=!(r=0),a+=o=1),r+=(u-(96<u?96:64))*o,o*=26):l+=a}e.push(9,$(i-1,r-1,n),l)}function r(e,t){var n,i,r=[];E=!1;for(var o,a=-1,l=0;l<e.length;l++){var s=e[l];if('"'!=s){if(!(-1<a))if("{"!=s||"{"!=e[l+1])if("'"==s||z(s.charCodeAt(0))){var c=T(e,l,0),u=(C=c[0],$=c[1],c[2]),h=c[3],d=r.length;if(7!==h&&8!==h||5!==r[r.length-3])o=t.z,r.push(h,C,$);else{var f="'"===e[C-2]?1:0,g=r[d-2],v=r[d-1];void 0===(o=t.page(e.substr(g,v)))&&(r.push(3,0,0),o=0),r.push(h,C-v-2*f-1,$+v+2*f+1)}if(l=u-1,6===h)t.name(r,e,t);else if(8===h){var m=r.length;if(F(r,e.substr(C,$),o),C=(n=T(e,l+2,0))[0],$=n[1],u=n[2],5===(h=n[3])&&(C=(i=T(e,u+1,0))[0],$=i[1],u=i[2],h=i[3]),7!==h){r[m-3]=7;continue}F(r,e.substr(C,$),o);var p=r[m+1],w=r[m+4];(w<p||V(p)>V(w))&&(r[m+1]=w,r[m+4]=p),r[m-1]+=$+1,l=u-1}else 7===h?F(r,e.substr(C,$),o):3!==h&&5!==h||l++}else if(D(s)){var b=O(e,l);r.push(12,l,b-l),l=b-1}else if(I(s)){var x=R(e,l);r.push(11,l,x-l),l=x-1}else{var _=M(e,l);r.push(10,l,_-l),l=_-1}else{var y=T(e,l+2,2),C=y[0],$=y[1],S=y[2];r.push(2,C,$),l=S+2-1}}else a=-1<a?(r.push(1,a+1,l-a-1),-1):l}var k={code:r,source:e,exec:null,broken:0,triggers:null};return E&&(k.source=A(k,t)),k}var d=[">","<","=","+"];function o(e){var t=function(e){for(
var t=e.code,n=e.source,i="",r=t.length,o=0;o<r;o+=3)switch(t[o]){case 4:i+="ctx.m."+n.substr(t[o+1],t[o+2]).toUpperCase();break;case 1:i+='"'+n.substr(t[o+1],t[o+2])+'"';break;case 2:i+='ctx.p("'+n.substr(t[o+1],t[o+2])+'")';break;case 6:case 7:var a=void 0,l=void 0;if(10===t[o-3]?a=o-3:12===t[o-3]&&10===t[o-6]&&(a=o-6),10===t[o+6]?l=o+6:12===t[o+6]&&10===t[o+9]&&(l=o+9),a||l){var s=a?n[t[a+1]]:null,c=l?n[t[l+1]]:null;if("&"==s||"&"==c){i+="(ctx.v("+t[o+4]+') === null ? "" : ctx.v('+t[o+4]+"))";break}if(-1!=d.indexOf(s)||-1!=d.indexOf(c)){i+="(ctx.v("+t[o+4]+") === null ? 0 : ctx.v("+t[o+4]+"))";break}}i+="ctx.v("+t[o+4]+")";break;case 8:i+="ctx.r("+t[o+4]+", "+t[o+7]+")";break;case 10:if(1===t[o+2]){var u=n[t[o+1]];i+="&"===u?'+""+':"="===u?"==":";"===u?",":u}else 2===t[o+2]?i+="<>"===(u=n.substr(t[o+1],t[o+2]))?"!=":u:i+=n.substr(t[o+1],t[o+2]);break;case 11:i+=n.substr(t[o+1],t[o+2]);break;case 3:return""}return i}(e);if(!t)return e.broken=3,void(e.exec=null);try{e.exec=new Function("ctx","return "+t)}catch(t){e.broken=1,e.exec=null}}function s(e){var t=new Date(e.getFullYear(),0,0),n=e.valueOf()-t.valueOf()+60*(t.getTimezoneOffset()-e.getTimezoneOffset())*1e3;return Math.floor(n/864e5)}function c(e){var t=new Date(Math.round(86400*(e-25569)*1e3));return new Date(t.getTime()+6e4*t.getTimezoneOffset())}function i(e){return 25569+(e.getTime()-6e4*e.getTimezoneOffset())/864e5}function u(e){return!(!e&&0!==e||(e*=1,isNaN(e)))&&e}function f(e){for(var t=[],n=0;n<e.length;n++)t=t.concat(e[n]);return t}function l(e){return!e&&0!==e}function g(e){return 0<e?Math.floor(e):Math.ceil(e)}function v(e){return e<0?Math.floor(e):Math.ceil(e)}var w=Object.freeze({__proto__:null,SUM:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0,i=f(e),r=0;r<i.length;r++){var o=u(i[r]);"number"==typeof o&&(n+=o)}return n},AVERAGE:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0,i=0,r=f(e),o=0;o<r.length;o++){var a=u(r[o]);"number"==typeof a&&(n+=a,i++)}return n/i},COUNT:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0,i=f(e),r=0;r<i.length;r++){"number"==typeof u(i[r])&&n++}return n},COUNTA:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0,i=f(e),r=0;r<i.length;r++)i[r]&&1*i[r]!=0&&n++;return n},COUNTBLANK:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0,i=f(e),r=0;r<i.length;r++)0===i[r]||i[r]||n++;return n},MAX:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=-1/0,i=f(e),r=0;r<i.length;r++){var o=u(i[r]);"number"==typeof o&&n<o&&(n=o)}return n===-1/0?0:n},MIN:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=1/0,i=f(e),r=0;r<i.length;r++){var o=u(i[r]);"number"==typeof o&&o<n&&(n=o)}return n===1/0?0:n},PRODUCT:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=!1,i=1,r=f(e),o=0;o<r.length;o++){var a=u(r[o]);"number"==typeof a&&(n=!0,i*=a)}return n?i:null},SUMPRODUCT:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[0].length;for(var i in e)if(e[i].length!==n)return;var r=0;for(i=0;i<e[0].length;i++){var o=!1,a=1;for(var l in e){var s=u(e[l][i]);"number"==typeof s&&(a*=s,o=!0)}o&&(r+=a)}return r},SUMSQ:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0,i=f(e),r=0;r<i.length;r++){var o=u(i[r]);"number"==typeof o&&(n+=Math.pow(o,2))}return n},VARP:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=f(e),i=this.COUNT(n),r=this.AVERAGE(n),o=0,a=0;a<n.length;a++){var l=u(n[a]);"number"==typeof l&&(o+=Math.pow(l-r,2))}return o/i},STDEVP:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=f(e);return Math.sqrt(this.VARP(n))},POWER:function(e,t){var n=u(e),i=u(t);if("number"==typeof n&&"number"==typeof i)return Math.pow(n,i)},QUOTIENT:function(e,t){var n=u(e),i=u(t);if("number"==typeof n&&"number"==typeof i)return g(n/i)},SQRT:function(e){var t=u(e);if("number"==typeof t&&0<=t)return Math.sqrt(t)},
ABS:function(e){var t=u(e);if("number"==typeof t)return Math.abs(t)},RAND:function(){return Math.random()},PI:function(){return Math.PI},INT:function(e){var t=u(e);if("number"==typeof t)return Math.floor(t)},ROUND:function(e,t){var n=u(e),i=u(t)||0;if("number"==typeof n&&"number"==typeof i)return parseFloat(n.toFixed(i))},ROUNDDOWN:function(e,t){var n=u(e),i=u(t)||0;if("number"==typeof n&&"number"==typeof i)return Math.floor(n*Math.pow(10,i))/Math.pow(10,i)},ROUNDUP:function(e,t){var n=u(e),i=u(t)||0;if("number"==typeof n&&"number"==typeof i)return Math.ceil(n*Math.pow(10,i))/Math.pow(10,i)},TRUNC:function(e){var t=u(e);if("number"==typeof t)return g(t)},EVEN:function(e){var t=u(e);if("number"==typeof t){var n=v(t);return n%2?n+Math.sign(t):n}},ODD:function(e){var t=u(e);if("number"==typeof t){var n=v(t);return n%2?n:n+Math.sign(t)}}}),b=Object.freeze({__proto__:null,CONCATENATE:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return f(e).join("")},LEFT:function(e,t){return l(e)?"":e.toString().substring(0,t)},MID:function(e,t,n){return l(e)?"":e.toString().substring(t,t+n)},RIGHT:function(e,t){return l(e)?"":e.toString().substring(e.length-t)},LOWER:function(e){return l(e)?"":e.toString().toLowerCase()},UPPER:function(e){return l(e)?"":e.toString().toUpperCase()},PROPER:function(e){if(l(e))return"";var t=e.toString().toLowerCase().split(" ");for(var n in e="",t)e+=(e?" ":"")+t[n].substring(0,1).toUpperCase()+t[n].substring(1);return e},TRIM:function(e){return l(e)?"":e.toString().trim()},LEN:function(e){return l(e)?0:e.toString().length}}),x=Object.freeze({__proto__:null,DATE:function(e,t,n){return i(new Date(e,t-1,n))},TIME:function(e,t,n){return i(new Date(1900,0,1,e,t,n))},DAY:function(e){return c(e).getDate()},MONTH:function(e){return c(e).getMonth()+1},YEAR:function(e){return c(e).getFullYear()},HOUR:function(e){return c(e).getHours()},MINUTE:function(e){return c(e).getMinutes()},SECOND:function(e){return c(e).getSeconds()},NOW:function(){return i(new Date)},DATEDIF:function(e,t,n){if("D"===n)return t-e;var i=c(e),r=c(t);switch(n){case"Y":return r.getFullYear()-i.getFullYear();case"M":return(a=12*(r.getFullYear()-i.getFullYear()))+r.getMonth()-i.getMonth();case"D":return Math.floor(t-e);case"MD":if((l=r.getDate()-i.getDate())<0){var o=new Date(i.getFullYear(),i.getMonth()+1,0).getDate();return r.getDate()+o-i.getDate()}return l;case"YM":var a;return(a=r.getMonth()-i.getMonth())<0?12+a:a;case"YD":var l;return(l=s(r)-s(i))<0?365+l:l}}}),_=Object.freeze({__proto__:null,IF:function(e,t,n){return e?t:n}}),y={number:w,string:b,date:x,other:_},C=h(h(h(h({},w),b),x),_),k=Math.pow(10,8),N=function(){function e(e){var i=this;(e=e||{get:null,set:null})&&(this._getter=e.get,this._setter=e.set),this._parser=r,this._printer=o,this._parseContext={name:function(){},pageName:function(){return""},pageObj:function(){return null},page:function(){return 0},z:0},this.$count=0,this._data=new Map,this._triggers=new Map,this._holders={},this._context={v:function(e){if(-1===e)throw new Error;var t=i._getter(e);return void 0===t?null:t},r:function(e,t){var n=[];return a(e,t,function(e){return n.push(i._getter(e))}),n},m:C,e:function(e){throw e},p:function(e){return i.getPlaceholder(e)}}}return e.prototype.setValue=function(e,t,n,i){""===t&&(t=null),this._removeTriggers(e,null),this._setter(e,t,n)&&(i||this.trigger(e))},e.prototype.clean=function(e){this._removeTriggers(e,null)},e.prototype.getValue=function(e){return this._getter(e)},e.prototype.setPlaceholder=function(n,e){var i=this;"*"===n?Object.entries(e).forEach(function(e){return i.setPlaceholder(e[0],e[1])}):(null===e?delete this._holders[n]:this._holders[n]=e,this.each(function(e,t){(function(e,t,n){for(var i=0;i<e.length;i+=3)if(2===e[i]&&t.substr(e[i+1],e[i+2])==n)return!0;return!1})(t.code,t.source,n)&&i.setMath(e,t.source,i._parseContext)}))},e.prototype.getPlaceholder=function(e){if("*"===e)return this._holders;var t=this._holders[e];return void 0===t?null:t},e.prototype.setMath=function(e,t,n,i){var r=this._generate(t,n),o=this._setMathAt(e,r)
;i||this._execAndTrigger(o)},e.prototype.refresh=function(e){this._execAndTrigger(e)},e.prototype.getMath=function(e){return this._data.get(e)},e.prototype.trigger=function(e,t){var n=this._triggers.get(e);if(n){var i=!t;t||(t=new Set);for(var r=0;r<n.length;r++)t.add(n[r]);i&&this.triggerSet(t)}return null},e.prototype.triggerSet=function(t){for(var n=this,e=new Map;t.size;){var i=t.values(),r=!1;e:for(var o=i.next();!o.done;o=i.next()){var a=this._data.get(o.value),l=e.get(o.value);if(!l||(1==l&&(l=this._check_for_loops(o.value,a.triggers,e)),2!=l)){var s=a.triggers;if(s)for(var c=0;c<s.length;c++)if(t.has(s[c]))continue e;this._execAndTrigger(o.value,t),l||e.set(o.value,1),t["delete"](o.value),r=!0}}if(!r)return void t.forEach(function(e){return n._errorAndTrigger(e,t)})}},e.prototype._check_for_loops=function(e,t,n){var i=new Set;t.forEach(function(e){return i.add(e)});for(var r=i.values(),o=r.next();!o.done;o=r.next()){if(o.value==e)return n.set(e,2),2;var a=n.get(o.value);if(a&&1<a)return n.set(e,a),a;var l=this._data.get(o.value);l&&l.triggers&&l.triggers.forEach(function(e){return i.add(e)})}return n.set(e,3),3},e.prototype._setMathAt=function(e,t){if(this._removeTriggers(e,t)){if(t.triggers)if(-1===t.triggers.indexOf(e))for(var n=0;n<t.triggers.length;n++){var i=t.triggers[n],r=this._triggers.get(i);void 0===r&&(r=[],this._triggers.set(i,r)),r.push(e)}else t=h(h({},t),{broken:3});return this._data.set(e,t),e}},e.prototype._removeTriggers=function(t,e){var n=this._data.get(t);if(!n)return!0;if(n===e)return!1;var i=n.triggers;if(i&&3!==n.broken)for(var r=0;r<i.length;r++){var o=i[r],a=this._triggers.get(o);if(a){var l=a.findIndex(function(e){return e===t});a.splice(l,1)}}return this._data["delete"](t),!0},e.prototype.parse=function(e,t){return this._parser(e,t||this._parseContext)},e.prototype.exec=function(e,t){var n=this._generate(e,t);return this._exec(n)},e.prototype.each=function(t){var n=this;Array.from(this._data.keys()).forEach(function(e){return t(e,n._data.get(e))})},e.prototype.setLogger=function(e){this._err_handler=e},e.prototype._setErr=function(e,t){return e.broken=2,t&&this._err_handler&&this._err_handler(t),n[e.broken]},e.prototype._exec=function(e){if(0<e.broken&&2!==e.broken)return n[e.broken];try{var t=e.exec(this._context);return e.broken=0,"number"==typeof t?isFinite(t)?Math.round(t*k)/k:this._setErr(e):t}catch(n){return this._setErr(e,n)}},e.prototype.toString=function(e,t){return A(e,t||this._parseContext)},e.prototype.regenerate=function(o,a,l){var s=this;l=h({},l||this._parseContext),Array.from(this._data.keys()).forEach(function(e){var t=!1,n=s._data.get(e),i=m(e);if(a&&i===o)s._removeTriggers(e,null);else{for(var r=0;r<n.code.length;r+=3)if(9===n.code[r]&&m(n.code[r+1])===o){t=!0;break}t&&(l.z=i,a?s.setMath(e,n.source,l):(n.source=A(n,l),n.code=s._parser(n.source,l).code))}})},e.prototype.recalculate=function(n,i){var r=this;i=h({},i||this._parseContext);var o=new Set;this.each(function(e){if(n){var t=r._data.get(e);if(t.broken&&2!==t.broken)return i.z=m(e),void r.setMath(e,t.source,i)}o.add(e)}),this.triggerSet(o)},e.prototype._generate=function(e,t,n){var o=n||this._parser(e,t||this._parseContext);return this._printer(o),o.triggers=function(e){for(var t=[],n=o.code,i=n.length,r=0;r<i;r+=3)switch(n[r]){case 7:case 6:t.push(n[r+4]);break;case 8:a(n[r+4],n[r+7],function(e){return t.push(e)})}return t.length?t:null}(),o},e.prototype._execAndTrigger=function(e,t){this.$count+=1;var n=this._data.get(e);if(n){var i=this._exec(n);this._setter(e,i)&&this.trigger(e,t)}},e.prototype._errorAndTrigger=function(e,t){var n=this._data.get(e),i=this._setErr(n);this._setter(e,i)&&this.trigger(e,t)},e.prototype.debug=function(e){console.log(function(e){for(var t=e.code,n=e.source,i="",r=t.length,o=0;o<r;o+=3){var a=t[o],l=void 0;switch(a){case 4:l="method";break;case 1:l="text";break;case 5:l="page";break;case 2:l="holder";break;case 6:l="name";break;case 7:l="arg";break;case 8:l="range";break;case 9:l="data";break;case 10:l="op";break;case 11:l="number";break;case 3:l="error";break;case 12:l="extra"}
i+=9===a?"              "+t[o+1]+" x "+t[o+2]+")\n":"["+l+"]"+"              ".substr(0,10-l.length)+n.substr(t[o+1],t[o+2])+"\n"}return i}(this.parse(e)))},e.prototype.transpose=function(e,s,c,u){var h=this;u=u||this._parseContext;var t=S(e),d=t[0],f=t[1],g=t[2],v=[],m=new Map,p=new Map;Array.from(this._data.keys()).forEach(function(e){var t=S(e),n=t[0],i=t[1],r=t[2],o=h._data.get(e),a=h._transpose(o,d,f,s,c,u),l=e;if(r===g&&(f<=i||d<=n)&&(l=$(d<=n?n+s:n,f<=i?i+c:i,r)),o!==a||e!==l){if(p.set(e,a),r===g&&(c<0&&f<=i&&i<f-c||s<0&&d<=n&&n<d-s))return;m.set(l,a),v.push(l)}}),Array.from(m.keys()).forEach(function(e){return h._setMathAt(e,m.get(e))}),Array.from(p.keys()).forEach(function(e){m.has(e)||h._removeTriggers(e,null)});for(var n=new Set,i=0;i<v.length;i++)n.add(v[i]);this.triggerSet(n)},e.prototype.transposeMath=function(e,t,n,i){return"string"==typeof e&&(e=this.parse(e,i)),this._transpose(e,-1,-1,t,n,i||this._parseContext).source},e.prototype._transpose=function(e,t,n,i,r,o){for(var a=!0,l=e.code,s=!(t<0||n<0),c=0;c<l.length;c+=3)if(7===l[c]){var u=S(l[c+4]),h=u[0],d=u[1],f=u[2];if(o.z!==f)continue;var g=l[c+5];if(!s&&3==g)continue;(s||0==(1&g))&&t<=h&&(a&&(l=[].concat(l),a=!1),((h+=i)<t||h<0)&&(l[c]=3)),(s||0==(2&g))&&n<=d&&(a&&(l=[].concat(l),a=!1),((d+=r)<n||d<0)&&(l[c]=3)),a||(l[c+4]=$(h,d,f)),c+=3}else if(8===l[c]){var v=l[c+5],m=l[c+8];if(!s&&3===v&&3===m)continue;var p=S(l[c+4]),w=p[0],b=p[1],x=(f=p[2],S(l[c+7])),_=x[0],y=x[1];if(o.z!==f)continue;i&&((s||0==(1&v))&&(0<i?t<=w:t<w)&&(a&&(l=[].concat(l),a=!1),(w+=i)<0&&(l[c]=3)),(s||0==(1&m))&&t<=_&&(a&&(l=[].concat(l),a=!1),(_+=i)<w&&(l[c]=3))),r&&((s||0==(2&v))&&(0<r?n<=b:n<b)&&(a&&(l=[].concat(l),a=!1),(b+=r)<0&&(l[c]=3)),(s||0==(2&m))&&n<=y&&(a&&(l=[].concat(l),a=!1),(y+=r)<b&&(l[c]=3))),a||(l[c+4]=$(w,b,f),l[c+7]=$(_,y,f)),c+=6}if(a)return e;var C={code:l,broken:e.broken,source:e.source,triggers:null,exec:null};return C=this._parser(A(C,o),o),this._generate(C.source,o,C)},e}(),P=function(){function e(e,t,n){this._data=[],this._id=e,this._store=t,this._meta={},this._parseContext=h(h({},n),{z:e})}return e.prototype.getMeta=function(){return this._meta},e.prototype.setMeta=function(e){this._meta=h(h({},this._meta),e)},e.prototype.getID=function(){return this._id},e.prototype.cellID=function(e,t){return $(e,t,this._id)},e.prototype.getSize=function(){var e=this._data.length,t=0;return this._data.forEach(function(e){e&&e.length>t&&(t=e.length)}),[e,t]},e.prototype.getContext=function(){return this._parseContext},e.prototype.addRow=function(e,t){this._data.splice.apply(this._data,U(e,t)),this._store.transpose($(e,0,this._id),t,0,this._parseContext)},e.prototype.removeRow=function(e,t){this._data.splice(e,t),this._store.transpose($(e,0,this._id),-t,0,this._parseContext)},e.prototype.addColumn=function(e,t){var n=U(e,t);this._data.forEach(function(e){e&&e.splice.apply(e,n)}),this._store.transpose($(0,e,this._id),0,t,this._parseContext)},e.prototype.removeColumn=function(t,n){this._data.forEach(function(e){e&&e.splice(t,n)}),this._store.transpose($(0,t,this._id),0,-n,this._parseContext)},e.prototype.setCell=function(e,t,n){var i=this._data[e];i||(i=this._data[e]=[]);var r=i[t];i[t]=r?h(h(h({},r),n),{value:r.value}):n,void 0!==n.value&&this.setValue(e,t,n.value)},e.prototype.setValue=function(e,t,n,i){"string"==typeof n&&1<n.length&&"="===n[0]?this._store.setMath($(e,t,this._id),n.substr(1),this._parseContext):this._store.setValue($(e,t,this._id),n,i)},e.prototype.getCell=function(e,t,n){var i=this._data[e],r=i?i[t]:null;return r||!n||(i||(i=this._data[e]=[]),(r=i[t])||(r=i[t]={value:""})),r},e.prototype.getValue=function(e,t,n){if(n){var i=this._store.getMath($(e,t,this._id));if(i)return"="+i.source}var r=this.getCell(e,t,!1);return r?r.value:null},e.prototype.getRange=function(e,t,n,i){for(var r=[],o=e;o<=n;o++)for(var a=t;a<=i;a++)r.push(this.getValue(o,a,!1));return r},e.prototype.getCellRange=function(e,t,n,i){for(var r=[],o=e;o<=n;o++)for(var a=t;a<=i;a++)r.push(this.getCell(o,a));return r},e.prototype.eachCell=function(i){this._data.forEach(function(e,n){
e&&e.forEach(function(e,t){e&&i(n,t,e)})})},e.prototype.serialize=function(r){var o=this,a=[];return this.eachCell(function(e,t,n){if(n=h({},n),r){var i=o._store.getMath($(e,t,o.getID()));i&&(n.value="="+i.source)}a.push([e,t,n])}),a},e.prototype.parse=function(e,s){var c=this;this._store.each(function(e){m(e)===c._id&&c._store.clean(e)}),this._data=[];var u=new Set;e.forEach(function(e){var t=e[0],n=e[1],i=e[2],r=c._data[t];r||(r=c._data[t]=[]);var o=(i=r[n]=h({},i)).value;if(o)if("string"==typeof o&&1<o.length&&"="===o[0]){var a=$(t,n,c._id),l=o.substr(1);c._store.setMath(a,l,c.getContext(),!0),u.add(a)}else s&&(i.value=null,a=$(t,n,c._id),c._store.setValue(a,o,null,!0),c._store.trigger(a,u))}),this._store.triggerSet(u)},e}();function U(e,t){for(var n=[e,0],i=0;i<t;i++)n.push(null);return n}var j=function(){function e(e,t,n){this._ranges=new Map,this._counter=1,this._rangeOrder=[],this._store=e,this._page=t,this._pageGetter=n}return e.prototype.get=function(e){return this._store.getMath(this._ranges.get(e))},e.prototype.toId=function(e){return this._ranges.get(e)},e.prototype.add=function(e,t){var n=this._ranges.get(e)||this._next_id();this._store.setMath(n,t,this._page.getContext()),this._ranges.set(e,n),this._refresh(e)},e.prototype.remove=function(e){this._ranges["delete"](e),this._counter=1,this._refresh(e)},e.prototype.serialize=function(){var t=this;return Array.from(this._ranges.keys()).map(function(e){return[e,t.get(e).source]})},e.prototype.parse=function(e){var t=this;e.forEach(function(e){return t.add(e[0],e[1])})},e.prototype._refresh=function(i){var r=this,e=i.indexOf("!"),o="";-1!==e&&(o=i.substr(0,e),i=i.substr(e+1)),this._store.each(function(e,t){if(function(e,t,n,i){for(var r=0;r<e.length;r+=3)if(6===e[r]){if(""!==n){if(5===e[r-3]&&t.substr(e[r-2],e[r-1])!==n)continue;return!0}if(t.substr(e[r+1],e[r+2])===i)return!0}return!1}(t.code,t.source,o,i)){var n=m(e);r._store.setMath(e,t.source,r._pageGetter(n).getContext())}})},e.prototype._next_id=function(){for(;this._rangeOrder[this._counter];)this._counter++;return this._rangeOrder[this._counter]=!0,$(this._counter,0,this._page.getID())},e.prototype.renamePage=function(i,r){var o=this;i+="!",r&&(r+="!"),this._ranges.forEach(function(e,t,n){0===t.indexOf(i)&&(r?n.set(t.replace(i,r),e):o._store.clean(e),n["delete"](t))})},e}(),B=function(){function e(){var s=this;this._pages=[],this._pageNames=[],this._pageName2ID=new Map,this._pCounter=0,this._parseContext={page:function(e){return s._pageName2ID.get(e)},pageName:function(e){return s._pageNames[e]},pageObj:function(e){return s._pages[e]},name:function(e,t,n){var i,r=e.length,o=t.substr(e[r-2],e[r-1]);if(5===e[r-6]){var a=t.substr(e[r-5],e[r-4]);i=s._ranges.toId(a+"!"+o)||s._ranges.toId(o)}else i=s._ranges.toId(n.pageName(n.z)+"!"+o)||s._ranges.toId(o);e.push(9,i||-1,0)},z:0},this._store=new N({get:function(e){var t=S(e),n=t[0],i=t[1],r=t[2];return s._pages[r].getValue(n,i)},set:function(e,t,n){var i=S(e),r=i[0],o=i[1],a=i[2],l=s._pages[a].getCell(r,o,!0);return null==n&&(n=l.$format||0),l.$format=n,"string"==typeof t&&1!=n&&t&&parseFloat(t)==t&&(t=parseFloat(t)),l.value!==t&&(l.value=t,!0)}});var e=this._pages[63]=new P(63,this._store,this._parseContext);this._ranges=new j(this._store,e,this.getPage.bind(this))}return e.prototype.addPage=function(e){for(;this._pages[this._pCounter];)this._pCounter++;var t=this._pCounter,n=new P(t,this._store,this._parseContext);return this._pageName2ID.set(e,t),this._pages[t]=n,this._pageNames[t]=e,n},e.prototype.renamePage=function(e,t){if(e!==t){var n=this._pageName2ID.get(e);this._pageName2ID["delete"](e),this._pageName2ID.set(t,n),this._pageNames[n]=t,this._ranges.renamePage(e,t);var i=this._pages[n].getContext();this._store.regenerate(n,!1,i)}},e.prototype.removePage=function(e){var t=this._pageName2ID.get(e),n=this._pages[t].getContext();this._pageName2ID["delete"](e),this._pages[t]=this._pageNames[t]=null,this._pCounter=0,this._ranges.renamePage(e,null),this._store.regenerate(t,!0,n)},e.prototype.getPage=function(e){return"string"==typeof e&&(e=this._pageName2ID.get(e
)),this._pages[e]},e.prototype.getRanges=function(){return this._ranges},e.prototype.getStore=function(){return this._store},e}();t.D_COMMON=0,t.D_STRING=1,t.DataPage=P,t.DataStore=B,t.Store=N,t.T_ARG=7,t.T_DATA=9,t.T_ERROR=3,t.T_METHOD=4,t.T_NAME=6,t.T_NUMBER=11,t.T_OPERATOR=10,t.T_PAGE=5,t.T_PLACEHOLDER=2,t.T_RANGE=8,t.T_SPACE=12,t.T_TEXT=1,t.addMethod=function(e,t){C[e]=t},t.column=function(e){return e>>6&4095},t.fromId=S,t.methodGroups=y,t.methods=C,t.page=m,t.row=V,t.str2id=function(e){var t=[];return F(t,e,0),t[1]},t.str2pos=function(e){var t=[];return F(t,e,0),S(t[1]).slice(0,2)},t.str2range=function(e){var t=[];e.split(":").map(function(e){return F(t,e,0)});var n=S(t[1]),i=n[0],r=n[1],o=S(t[4]);return[i,r,o[0],o[1]]},t.toId=$});!function Bo(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e["default"]:e}(e);e.D_COMMON,e.D_STRING,e.DataPage;var t=e.DataStore,r=(e.Store,e.T_ARG,e.T_DATA,e.T_ERROR,e.T_METHOD,e.T_NAME,e.T_NUMBER,e.T_OPERATOR,e.T_PAGE,e.T_PLACEHOLDER,e.T_RANGE,e.T_SPACE,e.T_TEXT,e.addMethod),n=(e.column,e.fromId,e.methodGroups,e.methods);e.page,e.row,e.str2id,e.str2pos,e.str2range,e.toId;function x(e){var t=new Date(Math.round(86400*(e-25569)*1e3));return new Date(t.getTime()+6e4*t.getTimezoneOffset())}function c(e){return(25569+(e.getTime()-6e4*e.getTimezoneOffset())/864e5).toString()}var o=Object.freeze({init:function Ho(){r("IMAGE",function(e){return'<img class="webix_ssheet_cimage" src="'.concat(webix.template.escape(e),'">')}),r("SPARKLINE",function(e,t,n,i){var r,o={type:t,color:n,negativeColor:i},a="pie"==t?60:150;for(r=0;r<e.length;r++)e[r]=e[r]||0;return webix.Sparklines.getTemplate(o)(e,{width:a,height:35})}),r("HYPERLINK",function(e,t){return t=t||e,'<a target="blank" href="'.concat(webix.template.escape(e),'">').concat(webix.template.escape(t),"</a>")})},getJsDateFromExcel:x,getExcelDateFromJs:c});function i(e){return!e&&0!==e||e instanceof Date||isNaN(e)||(e=x(e)),e}function a(e){return e&&e instanceof Date&&(e=c(e)),e}function g(e){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function u(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function n(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function $(e,t){return function n(e){if(Array.isArray(e))return e}(e)||function c(e,t){var n=[],i=!0,r=!1,o=undefined;try{for(var a,l=e[Symbol.iterator]();!(i=(a=l.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(s){r=!0,o=s}finally{try{i||null==l["return"]||l["return"]()}finally{if(r)throw o}}return n}(e,t)||function i(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function p(e){return function i(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function t(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function n(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}
webix.protoUI({$cssName:"datepicker",name:"ssheet-datepicker",getValue:function(){return a(webix.ui.datepicker.prototype.getValue.apply(this))||""},$prepareValue:function(e){return e=i(e),webix.ui.datepicker.prototype.$prepareValue.apply(this,[e])}},webix.ui.datepicker),webix.protoUI({$cssName:"daterangepicker",name:"ssheet-daterangepicker",getValue:function(){var e=webix.ui.datepicker.prototype.getValue.apply(this);return e&&((e=webix.copy(e)).start=a(e.start),e.end=a(e.end)),e||""},$prepareValue:function(e){return e?e.start||e.end||(e={start:e}):e={start:null,end:null},e.start=i(e.start),e.end=i(e.end),webix.ui.daterangepicker.prototype.$prepareValue.apply(this,[e])}},webix.ui.daterangepicker),webix.protoUI({$cssName:"window",name:"ssheet-dialog",$init:function(e){this.$view.className+=" webix_ssheet_dialog",this.config.buttons=e.buttons,this.config.close=!0},getBodyConfig:function(e){e.borderless=!0;var t=this.getFormElements(e);return{view:"form",css:"webix_ssheet_form",padding:webix.skin.$active.layoutPadding.form,elements:t}},getFormElements:function(e){var t;return webix.isArray(e)?t=e:(t=[]).push(e),this.config.buttons&&(t.push({height:1}),t.push({margin:10,cols:[{},{view:"button",css:"ssheet_cancel_button",label:webix.i18n.spreadsheet.labels.cancel,autowidth:!0,click:function(){this.getTopParentView().callEvent("onCancelClick",[])}},{view:"button",label:webix.i18n.spreadsheet.labels.save,hotkey:"enter",autowidth:!0,click:function(){this.getTopParentView().callEvent("onSaveClick",[])}}]})),t},body_setter:function(e){return"object"==g(e)&&(webix.isUndefined(e.padding)&&(e.padding=webix.skin.$active.layoutPadding.form),"form"==e.view&&e.elements?(e.elements=this.getFormElements(e.elements),e.css||(e.css="webix_ssheet_form")):e=this.getBodyConfig(e)),webix.ui.window.prototype.body_setter.call(this,e)},defaults:{move:!0,head:"Dialog",buttons:!0,close:!0,autofocus:!1,width:350}},webix.ui.window,webix.IdSpace),webix.protoUI({$cssName:"datatable",name:"ssheet-dialog-table",$init:function(e){e.headerRowHeight||(e.headerRowHeight=34),this.$view.className+=" webix_ssheet_dialog_table"}},webix.ui.datatable),webix.protoUI({name:"ssheet-form-popup",defaults:{padding:0,borderless:!0},$init:function(){this.$view.className+=" webix_ssheet_form"}},webix.ui.suggest),webix.protoUI({name:"ssheet-form-suggest",defaults:{padding:0,borderless:!0},$init:function(){this.$view.className+=" webix_ssheet_suggest"}},webix.ui.suggest),webix.protoUI({$cssName:"colorpicker",name:"ssheet-colorpicker",$init:function(){this.$view.className+=" webix_ssheet_colorpicker"},defaults:{suggest:{borderless:!0,body:{view:"ssheet-colorboard"}}}},webix.ui.colorpicker),webix.protoUI({name:"formlate",setValue:function(e){return this.setHTML(e)},getValue:function(){return""}},webix.ui.template),webix.protoUI({name:"ssheet-icons",$cssName:"dataview",$init:function(){this.$view.className+=" webix_ssheet_dataview"},defaults:{borderless:!0,template:"<span class='webix_ssheet_button_icon #css#' ></span>",type:{width:36,height:36}}},webix.ui.dataview),webix.protoUI({name:"ssheet-suggest",defaults:{padding:0,css:"webix_ssheet_suggest"}},webix.ui.contextmenu);var w={value:null,set:function(e,t){this.value?e.call(t):(this.start(),e.call(t),this.end())},start:function(){this.value=webix.uid()},end:function(){this.value=null}};function b(e,t,n){var i,r=e.config.save;if(r){if("all"==t){if(!r.all)return;n={data:e.serialize({sheets:!0})},i=r.all}else i="string"==typeof r?r+"/"+t:r[t];if(i=webix.proxy.$parse(i)){if("function"==typeof i)return i(t,n);if(i.$proxy&&i.save)return i.save(e,n,null,null);var o=webix.ajax();"all"===t&&o.headers({"Content-type":"application/json"}),o.post(i,n)}}}for(var _=Object.freeze({init:function Lo(r){for(var o,t=[{name:"onSheetAdd",type:"insert"},{name:"onSheetRemove",type:"remove"},{name:"onSheetRename",type:"rename"},{name:"onCellChange"},{name:"onStyleChange"},{name:"onAction"},{name:"onRowOperation"},{name:"onColumnOperation"},{name:"onAfterConditionSet"},{name:"onAfterRangeSet"},{name:"onAfterSpan"},{name:"onAfterSplit"},{
name:"onAfterFilter",view:"cells"},{name:"onRowResize",view:"cells"},{name:"onColumnResize",view:"cells"}],e=function(e){var i=t[e];(i.view?r.$$(i.view):r).attachEvent(i.name,function(e,t){var n;r._loading_data||(n=i.type?"rename"==i.type?[i.type,t,e]:[i.type,e]:["update",r.getActiveSheet()],clearTimeout(o),o=webix.delay(function(){return r.callEvent("onChange",n)}))})},n=0;n<t.length;n++)e(n);r.attachEvent("onChange",function(){b(r,"all")})},save:b}),y={},C={},S="ABCDEFGHIJKLMNOPQRSTUVWXYZ",k=1;k<703;k++){var E=parseInt((k-1)/S.length),V=(E?S[E-1]:"")+S[(k-1)%S.length];y[V]=k,C[k]=V}function A(e){var t=e.charCodeAt(1)<59?1:2,n=e.substr(0,t);return[1*e.substr(t),y[n]]}function z(e,t,n){var i=e.indexOf("!"),r=n||"";-1!==i&&("'"===(r=e.substr(0,i))[0]&&(r=r.substr(1,r.length-2)),e=e.substr(i+1));var o=e.split(":");if(2!=o.length){if(!t)return null;var a=t.ranges.getCode(e,r);if(!a&&!(a=t.ranges.getCode(e,!0)))return null;var l=a.split("!");(l[0]!=n||t.getActiveSheet())&&(r=l[0].replace(/'/g,"")),o=(a=l[1]).split(":")}var s=A(o[0]),c=A(o[1]);if(s[0]&&s[1]&&c[0]&&c[1])return[s[0],s[1],c[0],c[1],r]}function I(e){return-1==e.indexOf(" ")?e:"'".concat(e,"'")}function R(e,t,n,i,r){return(r?I(r)+"!":"")+C[t]+e+":"+C[i]+n}function D(e,t){if("object"===g(e))return e;var n=z(e,t);return{start:{row:n[0],column:n[1]},end:{row:n[2],column:n[3]},sheet:n[4]}}function O(e,t,n,i){for(var r=D(e),o=r.start.row;o<=r.end.row;o++)for(var a=r.start.column;a<=r.end.column;a++)n(t,{row:o,column:a},i)}C[0]=C[1];var M=/[A-Z]+[0-9]+/;function T(e){if("string"==typeof e){var t=e.split(":");if(2==t.length){for(var n=0;n<t.length;n++){var i=t[n].split("!");if(!M.test(i.pop()))return}return!0}}}function F(e,t,n,i){var r=!1;if(T(e)){var o=$(z(e),5),a=o[0],l=o[1],s=o[2],c=o[3],u=o[4];if(s<a){var h=[s,a];a=h[0],s=h[1]}if(c<l){var d=[c,l];l=d[0],c=d[1]}if("row"===t&&i.row<=s){if((n<0&&i.row<a||0<n&&i.row<=a)&&(a+=n),(s+=n)<a)return"";r=!0}else if("column"===t&&i.column<=c){if((n<0&&i.column<l||0<n&&i.column<=l)&&(l+=n),(c+=n)<l)return"";r=!0}r&&(e=R(a,l,s,c,u))}return e}var N={width:38,margin:7,paddingY:1,sectorPadding:5,sectorMargin:0},P={color:"#666666",background:"#ffffff","font-family":"'PT Sans', Tahoma","font-size":"15px","text-align":"left","vertical-align":"middle","white-space":"nowrap"};var U=["color","background","text-align","font-family","font-size","font-style","text-decoration","font-weight","vertical-align","wrap","borders","format","border-right","border-bottom","border-left","border-top"],j={"text-align":{left:function(){return"justify-content:flex-start;"},center:function(){return"justify-content:center;"},right:function(){return"justify-content:flex-end;"}},"vertical-align":{top:function(){return"align-items:flex-start;"},middle:function(){return"align-items:center;"},bottom:function(){return"align-items:flex-end;"}},wrap:{wrap:function(){return"white-space: normal !important;"}},"border-left":function(e){return B("border-left",e)},"border-top":function(e){return B("border-top",e)},"border-right":function(e){return B("border-right",e)},"border-bottom":function(e){return B("border-bottom",e)},"font-weight":function(e){return"bold"!=e["font-weight"]?"":"font-weight:"+("'Roboto', sans-serif"==(e["font-family"]||P["font-family"])?500:700)+";"}};function B(e,t){var n=t[e];if(n){var i=$(n.split(","),2),r=i[0],o=i[1],a="1px";return"medium"==(o=o||"thin")?a="2px":"thick"!=o&&"double"!=o||(a="3px"),-1!=["thin","medium","thick"].indexOf(o)&&(o="solid"),"".concat(e,": ").concat(a," ").concat(o," ").concat(r," !important;")}return""}var H,L={"border-left":function(e,t,n){return e.column==t.start.column||"no"==n},"border-right":function(e,t,n){return e.column==t.end.column||"all"==n||"no"==n},"border-top":function(e,t,n){return e.row==t.start.row||"no"==n},"border-bottom":function(e,t,n){return e.row==t.end.row||"all"==n||"no"==n}},q={borders:function(e,t,n,i){var r=e.$$("cells").getSelectArea(),o=(n=n.split(","))[0],a=n[1],l=n[2],s=["border-left","border-right","border-bottom","border-top"];"top-bottom"==o?s=["border-top","border-bottom"
]:"no"!=o&&"all"!=o&&"outer"!=o&&(s=["border-"+o]);for(var c=0;c<s.length;c++){var u=s[c];if(!0===e.callEvent("onAction",["check-borders",{row:i.row,column:i.column,area:r,type:o,mode:u}])||L[u](i,r,o))t=Z(e,t,u,"no"==o?"":"".concat(a,",").concat(l),i)}return t}};function W(e){e._styles={},e._styles_cache={},e._styles_max=1;var t=".wss_"+e.$index;webix.html.removeStyle(t)}function K(e,t){var n=e._mPage.getCell(t.row-1,t.column-1),i=e.$$("cells").getSpan(t.row,t.column);if(i)for(var r=i[5].split(" "),o=0;o<r.length;o++){var a=e._styles[r[o]];if(a)return a}return n&&n.style?e._styles[n.style]:null}function G(e,t,n){var i=e._mPage.getCell(t-1,n-1);return i&&i.format||""}function Y(e,t,n){var i={props:oe(";;;;;;;;;;;;;;;")};if(n)for(var r in n.props)i.props[r]=n.props[r];for(var o in t)i.props[o]=t[o];i.text=re(i);var a=e._styles_cache[i.text];return a||(ie(e,i),i)}function X(e,t){if(t.styles)for(var n=0;n<t.styles.length;n++){var i=t.styles[n];ie(e,{id:i[0],text:i[1],props:oe(i[1])},!0)}for(var r=0;r<t.data.length;r++){var o=$(t.data[r],4),a=o[0],l=o[1],s=o[3];s&&Q(e,a,l,e._styles[s])}}function Z(e,t,n,i,r){if(q[n])return q[n](e,t,i,r);if(t&&t.props[n]==i)return t;var o={text:"",id:0,props:t?webix.copy(t.props):{}};o.props[n]=i,o.text=re(o);var a=e._styles_cache[o.text];return a||(ie(e,o),o)}function Q(e,t,n,i){var r=e._mPage.getCell(t-1,n-1,!0);r.style=i&&i.id,r.format=i&&i.props.format}function J(e,t,n){return ne(e,t,n,K(e,t))}function ee(e,t,n){O(t,e,ne,n)}function te(e,t,n,i){H.innerHTML=t,H.style.width=i?i+"px":"auto",H.className="webix_table_cell webix_cell "+n,e._table.$view.appendChild(H);var r=Math.max(0,H.offsetWidth+1),o=Math.max(0,H.offsetHeight+1);return e._table.$view.removeChild(H),H.innerHTML="",{width:r,height:o}}function ne(i,r,o,a){i.callEvent("onBeforeStyleChange",[r.row,r.column,o,a])&&w.set(function(){var e=o&&o.props.format||null,t=a&&a.props.format||null,n=e!=t;(!n||n&&i.callEvent("onBeforeFormatChange",[r.row,r.column,e,t]))&&(Q(i,r.row,r.column,o),i.callEvent("onStyleChange",[r.row,r.column,o,a]),n&&i.callEvent("onFormatChange",[r.row,r.column,e,t]),i.saveCell(r.row,r.column))})}function ie(e,t,n){for(e._styles_cache[t.text]=t;!t.id||e._styles[t.id];)t.id="wss"+e._styles_max++;var i=function o(e){var t="";for(var n in e)e[n]&&(j[n]?j[n][e[n]]?t+=j[n][e[n]](e):"function"==typeof j[n]&&(t+=j[n](e)):t+=n+":"+e[n]+";");return t}((e._styles[t.id]=t).props),r=".wss_"+e.$index;webix.html.addStyle(r+" ."+t.id+"{"+i+"}",r),n||b(e,"styles",{name:t.id,text:t.text})}function re(e){for(var t=[],n=0;n<U.length;n++)t.push(e.props[U[n]]);return t.join(";")}function oe(e){for(var t=e.split(";"),n={},i=0;i<U.length;i++)n[U[i]]=t[i];return n}function ae(e,t){w.set(function(){O(t,e,function(e,t){K(e,t)&&J(e,t,null)})})}function le(e){var t=e.serialize();t.styles=se(t),W(e),X(e,t)}function se(e){for(var t=e.data,n=e.styles,i={},r=0;r<t.length;r++){var o=t[r][3];o&&(i[o]=1)}for(var a=[],l=0;l<n.length;l++){i[n[l][0]]&&a.push(n[l])}return a}var ce=Object.freeze({style_names:U,init:function qo(o){o.attachEvent("onStyleSet",function(e,t){return function r(t,n,i){w.set(function(){t.eachSelectedCell(function(e){!function a(e,t,n,i){var r=K(e,t),o=Z(e,r,n,i,t);o&&o!=r&&ne(e,t,o,r)}(t,e,n,i)})}),t.refresh()}(o,e,t)}),o.attachEvent("onDataParse",function(e){return X(o,e)}),o.attachEvent("onDataSerialize",function(e){return function r(e,t){var n=[];for(var i in e._styles_cache)n.push([e._styles_cache[i].id,i]);t.styles=n}(o,e)}),o.attachEvent("onReset",function(){return W(o)}),o.attachEvent("onUndo",function(e,t,n,i){"style"==e&&function r(e,t,n,i){J(e,{row:t,column:n},i)}(o,t,n,i)}),W(o),H||(H=webix.html.create("DIV",{style:"visibility:hidden; position:absolute; top:0px; left:0px; height:auto;"},""))},getStyle:K,getFormat:G,addStyle:Y,setStyle:J,setRangeStyle:ee,getTextSize:te,styleFromText:oe,clearRangeStyle:ae,compactStyles:le,removeUnusedStyles:se});var ue,he,de,fe,ge={},ve=[];function me(){var n=webix.i18n.spreadsheet.formats;for(var e in ve=(ve=(ve=[webix.i18n.price]).concat(webix.copy(n.currencies))).map(function(e){
var t=function n(e){return webix.template(e)("")}(e);return{format:e,id:t,value:t.trim()}}),ue={},he=0,de={},fe={},ge={price:{getFormat:function(e,t){return t.css="webix_ssheet_format_price",webix.i18n.priceFormat(e)},values:webix.extend({zeros:webix.i18n.priceSettings.decimalSize,symbol:webix.i18n.priceFormat(""),separator:1,negative:1,type:"price"},pe("price"))},"int":{getFormat:function(e,t){return t.css="webix_ssheet_format_int",webix.i18n.numberFormat(e)},values:webix.extend({zeros:webix.i18n.decimalSize,separator:1,negative:1,type:"int"},pe("int"))},percent:{getFormat:function(e,t){return t.css="webix_ssheet_format_percent",Math.round(100*e)+"%"},values:webix.extend({zeros:0,separator:0,negative:1,type:"percent"},pe("percent"))},date:{getFormat:function(e,t){return t.css="webix_ssheet_format_date",$e(n.dateFormat,pe("date"))(e)},values:{type:"date",date:n.dateFormat}},string:{getFormat:function(e,t){return t.css="webix_ssheet_format_text",e},values:{type:"string"}}})de[e]=Me(Oe(e,ge[e].values)),fe[de[e]]=e}function pe(e){return"price"==e?{groupSign:webix.i18n.priceSettings.groupDelimiter,decimalSign:webix.i18n.priceSettings.decimalDelimiter}:{groupSign:webix.i18n.groupDelimiter,decimalSign:webix.i18n.decimalDelimiter}}function we(e){return ge[e]?ge[e].getFormat:ge[e]}function be(e,t){return t?Me(Te({values:ge[e].values,format:de[e]}),!0):de[e]}function xe(e,t){if(fe[e])return fe[e];var n="object"==g(t)?"fmt"+he:t;return he++,ue[n]=e,"string"==typeof t&&(t=function b(t){var e=webix.i18n.spreadsheet.formats,n=[e.dateFormat,e.timeFormat,e.fullDateFormat,e.longDateFormat],i={format:t,type:"custom"};if(n.find(function(e){return e==t}))webix.extend(i,{type:"date",date:t},!0);else{var r,o=t.split(";"),a=$(o,2),l=a[0],s=a[1];if(l&&s)if(0==l.indexOf("[>=0]")&&0==s.indexOf("[<0]"))if(l=l.replace("[>=0]",""),0==(s=s.replace("[<0]","")).indexOf("[red]")&&(s=s.replace("[red]",""),r=!0),"-"==s[0]?(s=s.substring(1),i.negative=r?2:1):r&&("("==s[0]&&")"==s[s.length-1]?(i.negative=4,s=s.substring(1,s.length-1)):i.negative=3),i.negative&&l==s){var c="int",u=-1!=l.indexOf("[$");if("%"==l[l.length-1])l=l.substring(0,l.length-1),c="percent";else for(var h=0;h<ve.length;h++){var d=ve[h].id,f=void 0;if(u?-1!=l.indexOf("[$".concat(d,"]"))&&(l=l.replace("[$".concat(d,"]"),""),f=!0):-1!=l.indexOf(d)&&(l=l.replace(d,""),f=!0),f){c="price",i.symbol=d;break}}var g=pe(c);0==l.indexOf("#"+g.groupSign)&&(l=l.replace("#"+g.groupSign,""),i.separator=1);var v=l.split(g.decimalSign),m=$(v,2),p=m[0],w=m[1];p&&"0"!=p||w&&!/^[0]+$/.test(w)||(i.type=c,i.delimiters=g,i.zeros=w?w.length:0)}}return i}(e)),webix.extend(t,pe("custom")),ge[n]={getFormat:$e(e,{decimalSign:t.decimalSign,groupSign:t.groupSign}),values:t},de[n]=e,fe[e]=n}function _e(e,t,n,i,r){r||(r={format:i,type:"custom"});var o=e.getStyle(t,n),a=Y(e,{format:xe(i,r)},o);e.setStyle(t,n,a)}function ye(e,t,n){var i=Y(e,{format:""},e.getStyle(t,n));e.setStyle(t,n,i)}function Ce(e){var t=e.match(/.*\[[><=].*/g),n=e.split(";");return t||1<n.length&&(n[0]=(2<n.length?"[>0]":"[>=0]")+n[0],n[1]="[<0]"+n[1],n[2]&&(n[2]="[=0]"+n[2])),n}function $e(e,t){for(var n=webix.i18n.spreadsheet.table["format-error"],i=Ce(e),r=['var spaces = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";'],o=0;o<i.length;o++){var a=Ne(i[o]);r.push(Se(a.condition,a.color.toLowerCase(),a.symbol,a.fmt,o,0<i.length,t))}return new Function("val","extra","try{ ".concat(r.join("\n"),' return val; } catch(err) { return "').concat(n,'"; }'))}function Se(e,t,n,i,r,o,a){var l="";return e&&(l+=r?"else if":"if","="===e[0]&&(e="="+e),l+="(val"+e+"){",o&&(l+="val = Math.abs(val);")),t&&(l+='extra.css = "webix_ssheet_format_'+t+'";'),(l+=function b(e,t,n){if(!e)return"return val;";var i,r,o,a,l,s='return ""',c="",u=1,h=[],d="date";if(n){var f=ve.find(function(e){return e.id==n});l="left",f&&(l=f.format.split("{obj}").findIndex(function(e){return e})?"right":"left")}for(var g=0;g<e.length;g++){var v=Pe(e[g-1])&&Pe(e[g+1]);if('"'!=e[g]){if(webix.isUndefined(i))if("%"==e[g]&&(u*=100),/[a-zA-Z]/.test(e[g])){var m=ze(e.substr(
g),d);if(m){if(o||a)return'throw "unexpected number placeholder";';h.push(m.format),s+="/*date*/",d=m.type,g+=m.length-1;continue}s+='+"'.concat(e[g],'"')}else if(e[g]===t.decimalSign&&v)c+=t.decimalSign;else if("@"==e[g]){if(o||h.length)return'throw "unexpected number placeholder";';a||(s+="+fmt",a=!0),c+=e[g]}else if(Pe(e[g])){if(a||h.length)return'throw "unexpected text placeholder";';o||("left"==l&&(s+='+"'.concat(n,'"')),s+="+fmt","right"==l&&(s+='+"'.concat(n,'"')),o=!0),c+=e[g]}else e[g]===t.groupSign&&v?r=!0:s+='+"'.concat(e[g],'"')}else i=webix.isUndefined(i)?g:(s+='+"'.concat(e.substr(i+1,g-i-1),'"'),undefined)}if(h.length){-1!=h.indexOf("%A")&&(h=h.map(function(e){switch(e){case"%G":return"%g";case"%H":return"%h";default:return e}}));for(var p=0;p<h.length;p++)s=s.replace("/*date*/","+dateParts[".concat(p,"]"))}return"\n\t\t".concat(h.length?"val = (".concat(x,')(val); var dateParts = webix.Date.dateToStr("').concat(h.join(";"),'")(val).split(";");'):"","\n\t\t").concat(c?"".concat(function w(e,t,n,i){var r='if(/^@+$/.test("'.concat(e,'") || isNaN(val)){ var fmt = val; }else {'),o=n.decimalSign,a=$(Ue(e,o),2),l=a[0],s=a[1];s=(s||"").split("").reverse().join("");var c=l.indexOf("0");0<=c&&(c=l.length-c);var u=l.indexOf("?");0<=u&&(u=l.length-u);var h=s.indexOf("0");0<=h&&(h=s.length-h);var d=s.indexOf("?");0<=d&&(d=s.length-d);var f=s.length;return(r+="\n\tval = val*".concat(i,";\n\tvar parts = val.toFixed(").concat(f,').split(".");\n\tvar left = parts[0];\n\tvar lsize = left.length; \n\tvar right = parts[1] || "";\n\tif (left.length < ').concat(c,') left = "0000000000".substr(0, ').concat(c," - left.length)+left;\n\tif (left.length < ").concat(u,") left = spaces.substr(0, 6*(").concat(u," - left.length))+left;\n\tif (").concat(t,') {\n\t\tvar buf = [];\n\t\tvar start = 3;\n\t\twhile (lsize > start) { buf.push(left.substr(left.length-start,3)); start+=3; }\n\t\tvar last = left.substr(0,left.length-start+3);\n\t\tif (last !== "-")\n\t\t\tbuf.push(last);\n\t\telse\n\t\t\tbuf.push("-"+buf.pop());\n\n\t\tleft = buf.reverse().join("').concat(n.groupSign,'");\n\t}\n\tif (right){\n\t\tvar zpoint = right.length-1;\n\t\twhile (zpoint >= ').concat(h,'){\n\t\t\tif (right[zpoint] !== "0"){\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tzpoint--;\n\t\t}\n\n\t\tif (zpoint <= right.length)\n\t\t\tright = right.substr(0, zpoint+1);\n\n\t\tif (right.length < ').concat(d,"){\n\t\t\tright += spaces.substr(0, 6*(").concat(d,' - right.length));\n\t\t}\n\t}\n\tvar fmt = left+(right?"').concat(o,'":"")+right;\n\t'))+"}\n"}(c,r,t,u),";"):"","\n\t\t").concat(s,";")}(i,a,n))+(e?"}":"")}var ke={yy:"%y",yyyy:"%Y",m:"%n",mm:"%m",mmm:"%M",mmmm:"%F",mmmmm:"%F",d:"%j",dd:"%d",ddd:"%D",dddd:"%l"},Ee={h:"%G",hh:"%H",m:"%i",mm:"%i",s:"%s",ss:"%s","AM/PM":"%A"},Ve=Object.keys(ke).sort(function(e,t){return t.length-e.length}),Ae=Object.keys(Ee).sort(function(e,t){return t.length-e.length});function ze(e,t){var n=[{name:"date",order:Ve,types:ke},{name:"time",order:Ae,types:Ee}];/^m{1,2}(?!m)/.test(e)&&"date"!=t&&n.reverse();for(var i=0;i<n.length;i++)for(var r=n[i],o=0;o<r.order.length;o++)if(0==e.indexOf(r.order[o]))return{format:r.types[r.order[o]],length:r.order[o].length,type:r.name}}function Ie(t,n,e,i){var r=function c(e,t,n){{if(t&&n){if("object"!==g(t)||"object"!==g(n))return[{row:t,column:n}];for(var i=[],r=t.row;r<=n.row;r++)for(var o=t.column;o<=n.column;o++)i.push({row:r,column:o});return i}return e.getSelectedId(!0)}}(t,e,i);if(0!=r.length){var o=t._mPage.getCell(r[0].row-1,r[0].column-1),a=o&&o.format,l=o&&o.value?o.value.toString():"";if(webix.rules.isNumber(l)||a){w.set(function(){for(var e=0;e<r.length;e++)Re(t,n,r[e])}),t.refresh();var s=Be(t,r[0].row,r[0].column)||"common";s=De(s)?"custom":s,t.callEvent("onCommand",[{id:"toolbar-update",name:"format",value:s}])}}}function Re(e,t,n){var i,r=e._mPage.getCell(n.row-1,n.column-1),o=r&&r.format,a=r&&r.value?r.value.toString():"";o?((i=webix.copy({values:ge[o].values,format:be(o)})).format=function l(e,t,n){for(var i=Te(e),r=0;r<i.length;r++){if(i[r].decimals)0<t?i[r].right.placeholders+=Array(t+1
).join("0"):i[r].right.placeholders=i[r].right.placeholders.slice(0,t);else{var o=!i[r].left.text&&!i[r].right.text,a=!i[r].left.placeholders&&!i[r].right.placeholders;t<0&&o&&a&&webix.rules.isNumber(n)&&-1<n.indexOf(".")?(i[r].left.placeholders="0",i[r].right.placeholders=Array(n.split(".")[1].length).join(Array(t+1).join("0"))):0<t&&(i[r].left.placeholders||o)&&(i[r].left.placeholders=i[r].left.placeholders||"0",i[r].right.placeholders=Array(t+1).join("0"),i[r].decimals=!0)}i[r].decimals=0<i[r].right.placeholders.length}return Me(i)}(i,t,a),i.values&&i.values.hasOwnProperty("zeros")&&(i.values.zeros=Math.max(i.values.zeros+t,0))):(i={values:{negative:1,zeros:webix.rules.isNumber(a)&&a.split(".")[1]?Math.max(a.split(".")[1].length+t,0):Math.max(t,0),separator:0,type:"int"}}).format=Me(Oe(i.values.type,i.values));_e(e,n.row,n.column,i.format,i.values)}function De(e){return"common"!=e&&(-1!=e.indexOf("fmt")||"custom"==ge[e].values.type)}function Oe(e,t){if("string"==e)return[{left:{text:"@"}}];if(t.date)return[{left:{text:t.date}}];var n=[{condition:">=0",left:{text:""},right:{text:""}},{condition:"<0",left:{text:""},right:{text:""}}];if(webix.extend(n,pe(e)),n[0].right.placeholders=n[1].right.placeholders=t.zeros?Array(t.zeros+1).join("0"):"",n[0].separator=n[1].separator=t.separator&&"percent"!=e,n[0].left.placeholders=n[1].left.placeholders=n[0].separator?"#"+n.groupSign+"0":"0",n[0].decimals=n[1].decimals=!!t.zeros,n[1].color=1!=t.negative?"red":"",n[1].left.text+=t.negative<3?"-":"",4==t.negative&&(n[1].left.text+="("),"percent"===e)n[0].right.text=n[1].right.text+="%";else if("price"===e){var i=t.symbol,r=ve.find(function(e){return e.id==i}).format.split("{obj}").findIndex(function(e){return e})?"right":"left";n[0][r].symbol=n[1][r].symbol=i}return 4==t.negative&&(n[1].right.text+=")"),n}function Me(e,t){for(var n="",i=0;i<e.length;i++){if(e[i].condition&&(n+="["+e[i].condition+"]"),e[i].color&&(n+="["+e[i].color+"]"),e[i].left){if(e[i].left.text)n+=e[i].left.text;if(e[i].left.symbol&&(n+="[$"+e[i].left.symbol+"]"),e[i].left.placeholders){var r=e[i].left.placeholders;n+=t?r.replace(e.groupSign,","):r}}if(e[i].decimals&&(n+=t?".":e.decimalSign),e[i].right)if(e[i].right.placeholders&&(n+=e[i].right.placeholders),e[i].right.symbol&&(n+="[$"+e[i].right.symbol+"]"),e[i].right.text)n+=e[i].right.text;i!=e.length-1&&(n+=";")}return n}function Te(c){for(var u=c.format.split(";"),h=[],e=function(e){var t=Ne(u[e]);h[e]={color:t.color,condition:t.condition,left:{},right:{}};var n=t.fmt;h.groupSign=c.values.groupSign,h.decimalSign=c.values.decimalSign,-1<n.indexOf(h.groupSign)&&(h[e].separator=!0);var i=Ue(n,h.decimalSign),r=i[0],o=i[1]||"";i[1]&&(h[e].decimals=!0),r=Fe(r,"left",h.groupSign),o=Fe(o,"right",h.groupSign),h[e].left={text:r.leftText,placeholders:r.placeholders},h[e].right={text:r.rightText+o.rightText,placeholders:o.placeholders};var a=t.symbol;if(a){var l=ve.find(function(e){return e.id==a}),s="left";l&&(s=l.format.split("{obj}").findIndex(function(e){return e})?"right":"left"),h[e][s].symbol=a}},t=0;t<u.length;t++)e(t);return h}function Fe(e,t,n){var i;"left"==t&&(i=(i=e.match(/[#?0]/))?i.index:Infinity);for(var r="",o="",a="",l=0;l<e.length;l++)if(Pe(e[l]))a+=e[l];else{if(e[l]==n&&Pe(e[l+1])&&Pe(e[l-1])){a+=e[l];continue}if("left"==t&&l<i){r+=e[l];continue}o+=e[l]}return{leftText:r,rightText:o,placeholders:a}}function Ne(e){var t="",n="",i="",r=e.indexOf("[");if(-1!=r&&e[1].match(/[><=]/)){var o=e.indexOf("]");n=e.substr(r+1,o-r-1),e=e.substr(o+1)}if(-1!=(r=e.indexOf("[$"))){var a=r+e.substr(r).indexOf("]");i=e.substr(r+2,a-r-2),e=e.substr(0,r)+e.substr(a+1)}if(-1!=(r=e.indexOf("["))){var l=e.indexOf("]");t=e.substr(r+1,l-r-1),e=e.substr(l+1)}return{condition:n,color:t,symbol:i,fmt:e}}function Pe(e){return"0"===e||"#"===e||"?"===e}function Ue(e,t){var n=e.match("[#?0][/"+t+"][#?0]");return n?[e.substring(0,n.index+1),e.substring(n.index+2)]:[e]}function je(e,t,n){if(e=e&&e.fmt?e.fmt:be(e)){var i,r=Ne(Ce(e)[0]).fmt;if(r)for(var o=0;o<r.length;o++)if('"'==r[o]&&(i=!i),!i){if("date"==t&&/[a-zA-Z]/.test(r)){
var a=ze(r.substr(o),"date");if(a){if(!n)return!0;if("time"==a.type)return!0}}if("string"==t&&"@"==r[o])return!0}}}function Be(e,t,n){var i=e._mPage.getCell(t-1,n-1);return i&&i.format||null}function He(e){return e<-99974430.925||100025569.125<e}function Le(e,t,n){var i=Be(e,t,n),r=webix.i18n.spreadsheet.formats,o=je(i,"date",!0);return webix.Date.dateToStr(r[o?"parseDateTime":"parseDate"])}function qe(e,t){var n,i=t[3];if(i){var r=e.styles.find(function(e){return e[0]==i});if(r){var o=oe(r=r[1]).format;o&&(e.formats&&(n=e.formats.find(function(e){return e[0]==o})),n=n?n[1]:be(o))}}return n}var We=Object.freeze({init:function Wo(e){e.attachEvent("onDataParse",function(e){return function r(e,t){var n,i=t.formats;if(i)for(n=0;n<i.length;n++)xe(i[n][1],i[n][0])}(0,e)}),e.attachEvent("onDataSerialize",function(e,t){return function o(e,t){var n=[],i=["percent","int","price","date","string"];for(var r in de)-1==i.indexOf(r)&&n.push([r,de[r]]);t.formats=n}(0,e)})},get formatHelpers(){return ge},get currencies(){return ve},setDefaultFormats:me,getDelimiters:pe,getFormat:we,getFormatSource:be,addFormat:_e,removeFormat:ye,format2code:$e,changeAreaDecimals:Ie,changeCellDecimals:Re,isCustom:De,formToValues:Oe,serializeFormat:Me,checkFormat:je,getFormatName:Be,isDateInvalid:He,getDateEditFormat:Le,getFormatFromData:qe});function Ke(e){var t=e.charCodeAt(0);return t<=122?65<=t||35===t||36===t:191<t}function Ge(e){for(var t=e.length-1;0<=t;t--)if(!Ke(e[t]))return t+1}function Ye(e,t,n){for(var i,r=e.length,o=n,a=!1,l=t;l<r;l++){var s=e[l];if("'"!==s){if(!a)if("!"==s){if("#"==e[t])continue;"'"===(o=e.substr(t,l-t))[0]&&(o=o.substr(1,o.length-2)),t=l+1}else if(!(Ke(s)||(void 0,48<=(i=s.charCodeAt(0))&&i<=57)))return[e.substr(t,l-t),l,t,o]}else a=!a}return[e.substr(t),l,t,o]}var Xe=/^[A-Z$]+[0-9]+$/;function Ze(e){for(var t=0,n=0,i=1,r=1,o=0,a=!1,l=e.length-1;0<=l;l--){var s=e[l].charCodeAt(0);36!==s?s<58?(n+=(s-48)*i,i*=10):(a||(t=n,a=!(n=0),r+=i=1),n+=(s-64)*i,i*=26):o+=r}return[t,n,o]}function Qe(e,t,n){for(var i,r=t.getActiveSheet(),o=[],a=0,l=!1,s=!1,c="="===e[c]?1:0;c<e.length;c++){var u=e[c];if('"'==u)l=!l;else if(!l)if("{"==u&&"{"==e[c+1])s=!0;else if("}"==u&&"}"==e[c+1])s=!1;else if(!s){var h="'"===u;if(h||Ke(u)){var d=$(Ye(e,c,""),4),f=d[0],g=d[1],v=d[3],m=g-1;if("("!==e[m+1])if(i=f,Xe.test(i))v&&v!=r&&!n||(Je(o,e,c,a,v?[v,f,h]:f),a=m+1);else if(n)Je(o,e,c,a,v?[v,f,h]:f),a=m+1;else{var p=void 0;if(v?p=t.ranges.getCode(f,v):(p=t.ranges.getCode(f,!0))||(p=t.ranges.getCode(f)),p){var w=p.split("!");w[0]==r&&(Je(o,e,c,a,[v,f,h,w[1]]),a=m+1)}}c=m}}}return a!=e.length&&o.push(e.substr(a)),o}function Je(e,t,n,i,r){0!==n&&e.push(t.substr(i,n-i)),e.push(r)}function et(e,t,n){var i=qe(t,n),r={value:n[2],fmt:i?{fmt:i}:null,type:n[4]};return rt(e,r),r}function tt(e,t,n){n=c(n),t.value=n,e._loading_data||e.setCellValue(t.row,t.col,n)}function nt(e){var t=e?"number":null;return je(e,"string")?t="string":je(e,"date")&&(t="date"),t}function it(e,t,n){var i=e._mPage.getCell(t-1,n-1);return i&&i.type||null}function rt(e,t,n){var i=!(t.row&&t.col);e._setType=!0;var r,o="string"==typeof t.value&&"="==t.value[0],a=!(n&&t.fmt!=be("date")||e._loading_data&&"date"!=t.type);i||(r=o&&!t.fmt?function u(e,t){for(var n,i=0,r=Qe(t,e),o=0;o<r.length;o++)if(o%2==0){var a=r[o].match(/(([a-zA-Z]*\()|\))(?=(?:[^"]|"[^"]*")*$)/g);a&&a.forEach(function(e){-1<e.indexOf("(")?(i++,n||/^(SUM|AVERAGE|MAX|MIN|INT|ROUND|ROUNDDOWN|ROUNDUP|TRUNC)?\($/gi.test(e)||(n=i)):--i<n&&(n=null)})}else if(!n){if(webix.isArray(r[o]))if(/^[A-Za-z]+$/.test(r[o][1]))r[o]=r[o][3].split(":")[0];else{if(r[o][0]!=e.getActiveSheet())continue;r[o]=r[o][1]}var l=Ze(r[o]),s=Be(e,l[0],l[1]);if(s)return{fmt:be(s)}}}(e,t.value):null);var l=nt(t.fmt||r),s=function h(e,t,n,i,r,o){var a="string";if(!webix.isUndefined(t.value))if(i)a="number",/^=(now|date|time)\(/i.test(t.value)?a="date":/^=(sparkline|image)\(/i.test(t.value)&&(a="string");else if(isNaN(t.value)){if("string"!=r&&n){var l=webix.Date.strToDate(webix.i18n.spreadsheet.formats.parseDateTime)(t.value);""==l||isNaN(l)||(o?tt(e,t,l
):e.ignoreUndo(function(){return tt(e,t,l)}),a="date")}}else a="number";return a}(e,t,a,o,l,n);if(t.type=function d(e,t,n,i,r){return e=e||t,"string"==t?e="string":n&&(e=n),"date"==e&&!i&&He(r)&&(e="number"),e}(t.type,s,l,o,t.value),t.$format="string"==l?1:0,!i){var c=e._mPage.getCell(t.row-1,t.col-1,!0);c.type=t.type,c.$format=t.$format,function f(e,t,n,i,r){var o=t.row,a=t.col,l="string"==typeof t.value,s=l&&"="==t.value[0],c=e.getCellEditor(o,a);e._loading_data||"number"!==t.type||!l||s||""===t.value||e.setCellValue(o,a,1*t.value);if(r)e.setFormat(o,a,r.fmt);else if("date"==t.type){if("date"!=i){var u=s&&0==t.value.toUpperCase().indexOf("=TIME("),h=webix.i18n.spreadsheet.formats,d=u?h.timeFormat:h.dateFormat;e.setFormat(o,a,d)}s||c||e.setCellEditor(o,a,{editor:"excel_date"})}else"string"!=i&&"string"==t.type&&"string"!=n&&e.setFormat(o,a,"@");("date"!=t.type||s)&&c&&"excel_date"==c.editor&&e.setCellEditor(o,a,null)}(e,t,s,l,r)}delete e._setType}webix.protoUI({name:"suggest-formula",defaults:{fitMaster:!1,width:200,filter:function(e,t){var n=webix.$$(this.config.master),i=n.getInputNode().selectionStart,r=n.getValue();if("="===r.charAt(0)){var o=r.substring(0,i),a=o.substring(Ge(o)),l=r.charAt(i);return!a||i!==r.length&&(Ke(l)||/^[0-9]/.test(l))||(t=a),0===e.value.toString().toLowerCase().indexOf(t.toLowerCase())}}},$init:function(){var s=this;this.attachEvent("onBeforeShow",function(e){if(e.tagName){var t=webix.$$(s.config.master),n=t.getValue();if(!n||"="!==n.charAt(0))return!1;var i=webix.html.offset(e),r=t.getInputNode().selectionStart,o=webix.html.getTextSize(n.substring(0,r),"webix_ssheet_formula").width,a=i.y+i.height,l=i.x+o;return webix.ui.popup.prototype.show.apply(s,[{x:l,y:a}]),!1}})},setMasterValue:function(e,t){var n=e.id?this.getItemText(e.id):e.text||e.value;webix.$$(this.config.master).setValueHere(n),t||this.hide(!0),this.callEvent("onValueSuggest",[e,n])},$enterKey:function(){if(this.isVisible())return webix.ui.suggest.prototype.$enterKey.apply(this,arguments)}},webix.ui.suggest);var ot=Object.freeze({init:function Ko(i){i.attachEvent("onCellChange",function(e,t,n,i){if(!this._setType){var r=Be(this,e,t);rt(this,{row:e,col:t,value:n,fmt:r?{fmt:be(r)}:null,type:i})}}),i.attachEvent("onBeforeFormatChange",function(e,t,n){this._setType||rt(this,{row:e,col:t,value:i.getCellValue(e,t),fmt:{fmt:be(n)}},!0)}),i.attachEvent("onAction",function(e,t){"dropdown"==e&&t.newValue&&"excel_date"==t.newValue.editor&&"date"!=nt(Be(this,t.row,t.column))&&this.setFormat(t.row,t.column,webix.i18n.spreadsheet.formats.dateFormat)})},loadCell:et,getType:it});function at(e){return{view:"ssheet-suggest",css:"webix_ssheet_suggest",autowidth:!0,template:function(e){var t="";return e.icon&&(t+="<span class='webix_ssheet_button_icon webix_ssheet_icon ssi-"+e.icon+"'></span> "),t+=e.value||webix.i18n.spreadsheet.menus[e.id]||e.id},data:e,on:{onItemClick:function(e){var t=this.config.master;if(t){var n=webix.$$(t).getTopParentView(),i=[this.getItem(e)];if(webix.$$(t).config.area){var r=n.$$("cells").getSelectArea();r&&(i=i.concat([r.start,r.end]))}n.callEvent("onCommand",i)}}}}}webix.protoUI({name:"live-editor",$cssName:"texthighlight",$init:function(e){var i=this;e.suggest={view:"suggest-formula",data:e.suggestData},e.highlight=this.highlight,this._highlightedCells={},this.$view.className+=" webix_ssheet_formula",this.attachEvent("onKeyPress",function(e,t){if(delete i._update_range,13==e){if(300<new Date-(i._last_value_set||0)){var n=i.config.activeCell;i.showActiveSheet(!0),i.updateCellValue(n),i.getInputNode().blur()}webix.html.preventEvent(t)}else 27==e&&(i.showActiveSheet(),webix.delay(function(){var e=i.getTopParentView(),t=e.getSelectedId(),n=i.getCellValue(t.row,t.column);i.getValue()==n?e.$$("cells").refresh(t.row):i.setValue(n),delete e.$handleSelection,webix.UIManager.setFocus(e.$$("cells"))}))}),this.attachEvent("onAfterRender",function(){var t=this;webix.eventRemove(this.keydownEv),this.keydownEv=webix.event(this.getInputNode(),"keydown",function(e){t.endEdit(e)})})},highlight:function(e){var t="",
n=this.getTopParentView(),i=webix.template.escape;for(var r in this._highlightedCells){var o=this._highlightedCells[r];this.changeCellCss(o[0],o[1],o[2],!0)}if(this._highlightedCells={},e&&"="==e[0])for(var a=Qe(e,n),l=n.getActiveSheet(),s=1,c=0;c<a.length;c++)if(c%2==0)t+=i(a[c]);else{var u=webix.isArray(a[c]),h=u?this.prepareSheet(a[c][0],a[c][2]):"",d=this._activeMath,f=!(u||d&&d!=l),g=Ze(u?a[c][1]:a[c]),v=u?h+a[c][1]:a[c],m=u&&!Ge(a[c][1]);if(m||f||u&&a[c][0]==l){var p=void 0;if(":"==a[c+1]&&a[c+2]||m){var w=void 0,b=void 0;if(m){var x=a[c][3].split(":");g=Ze(x[0]),w=Ze(x[1])}else w=Ze(webix.isArray(a[c+2])?a[c+2][1]:a[c+2]),b=webix.isArray(a[c+2])?h+a[c+2][1]:a[c+2],c+=2;p=this.setColor(g[0],g[1],w[0],w[1],s),t+='<span class="webix_ssheet_highlight_color_'.concat(p||s,'">').concat(m?v:v+":"+b,"</span>")}else{if(a[c-1]&&":"==a[c-1][a[c-1].length-1]){t+=v;continue}p=this.setColor(g[0],g[1],g[0],g[1],s),t+='<span class="webix_ssheet_highlight_color_'.concat(p||s,'">').concat(v,"</span>")}p||(s+=7==s?-6:1)}else t+=v}else t=i(e);return n.$$("cells").refresh(),document.activeElement==this.getInputNode()&&this.paintValue(),t},showActiveSheet:function(e){var t=this.getTopParentView(),n=t._table;if(this._activeMath){if(this._activeMath!=t.getActiveSheet()){var i=this.config.activeCell;this.define({activeCell:null}),t.showSheet(this._activeMath),webix.delay(function(){n.select(i.row+(e?1:0),i.column)})}delete this._activeMath}else e&&webix.delay(function(){n.moveSelection("down")})},changeCellCss:function(e,t,n,i){for(var r="webix_ssheet_highlight_background_".concat(n),o=e.start;o<=e.end;o++)for(var a=t.start;a<=t.end;a++)this.getTopParentView().$$("cells")[i?"removeCellCss":"addCellCss"](o,a,r,!0)},endEdit:function(e){var t=e.which||e.keyCode;if(9==t||36<t&&t<41&&"="!==this.getValue().charAt(0)){var n=40==t?"down":39===t?"right":37==t?"left":"up";9===t&&(n="right"),this.getInputNode().blur(),this.updateCellValue(),this.getTopParentView()._table.moveSelection(n)}},paintValue:function(){var e=this.getTopParentView();if(!this._activeMath||this._activeMath==e.getActiveSheet()){var t=this.config.activeCell,n=e._table.getItemNode(t);t&&n&&(n.innerHTML="<div>".concat(webix.template.escape(this.getValue()),"</div>"))}},updateCellValue:function(e){var t=this.getValue(),n=this.getTopParentView();(e=e||this.config.activeCell)?t!==n.getCellValue(e.row,e.column)&&(this.config.value=t,n.setCellValue(e.row,e.column,t),n.refresh()):this.setValue("");delete n.$handleSelection},$setValueHere:function(e){this.setValueHere(e)},setValueHere:function(e){this._last_value_set=new Date;var t=this.getValue();if(t&&"="===t.charAt(0)){var n=this.getInputNode().selectionStart,i=t.substring(0,n),r=t.substring(n);"("==i[i.length-1]&&(i=i.substring(0,i.length-1)),i=i.substring(0,Ge(i)),i+=e+("("==r[0]?"":"("),this.setValue(i+r),this.getInputNode().setSelectionRange(i.length,i.length)}},expectOperator:function(){var e=this.getValue();if("="==e[0]){for(var t=this.getInputNode().selectionStart;" "==e[t-1];)t--;return e[t-1]&&e[t-1].match(/[+&\-/*%=(:,]/)}},setRange:function(e,t){var n,i,r=this.getInputNode().selectionStart,o=this.getValue();t&&(t=this._update_range&&r==this._update_range.pos+this._update_range.len);var a=t?this._update_range.pos:r;n=o.substring(0,a)+e,i=o.substring(r),this._update_range={pos:a,len:e.length},this.setValue(n+i)},prepareSheet:function(e,t){return e?((webix.isUndefined(t)?-1!=e.indexOf(" "):t)?"'".concat(e,"'"):e)+"!":""},prepareArea:function(e,t){return{start:Math.min(e,t),end:Math.max(e,t)}},setColor:function(e,t,n,i,r){var o=this.prepareArea(e,n),a=this.prepareArea(t,i),l=[o.start,o.end,a.start,a.end].join(","),s=this._highlightedCells[l];if(s)return s[2];this._highlightedCells[l]=[o,a,r],this.changeCellCss(o,a,r)},getCellValue:function(e,t){var n=this.getTopParentView(),i=n.getCellValue(e,t);"date"==it(n,e,t)&&"="!=i[0]&&(i=Le(n,e,t)(x(i)));return i}},webix.ui.texthighlight),webix.protoUI({name:"ssheet-separator",defaults:{css:"webix_ssheet_toolbar_spacer",template:" ",width:1,borderless:!0}},webix.ui.view),webix.protoUI({
name:"sheets",defaults:{layout:"x",borderless:!0,css:"ssheet_list_sheets",select:!0,drag:"order",dragscroll:"x",scroll:!1}},webix.EditAbility,webix.ui.list),webix.protoUI({$cssName:"toggle",name:"ssheet-toggle",toggle:function(){var e=this.getValue()==this.config.onValue;this.setValue(!e)},$setValue:function(e){e==this.config.offValue?e=!1:e==this.config.onValue&&(e=!0),webix.ui.toggle.prototype.$setValue.call(this,e)},getValue:function(){var e=this.config,t=e.value;return t&&t!=e.offValue?e.onValue||!0:e.offValue||!1},defaults:{template:function(e,t){var n=!0===e.value||e.value==e.onValue?" webix_pressed":"",i=t.$renderInput(e,t);return"<div class='webix_el_box"+n+"' style='width:"+e.awidth+"px; height:"+e.aheight+"px'>"+i+"</div>"}}},webix.ui.toggle),webix.protoUI({name:"ssheet-toggle-silent",$cssName:"toggle",$allowsClear:!1,setValue:function(){this.blockEvent(),webix.ui.toggle.prototype.setValue.apply(this,arguments),this.unblockEvent()}},webix.ui.toggle),webix.protoUI({name:"ssheet-bar-title",defaults:{borderless:!0},$init:function(){this.$view.className+=" webix_ssheet_subbar_title"}},webix.ui.template),webix.protoUI({name:"ssheet-button",$cssName:"button",defaults:{type:"htmlbutton",width:40},$init:function(e){if(this.$view.className+=" webix_ssheet_button"+(e.arrow?" webix_ssheet_button_menu":""),e.label||e.icon){var t=e.icon||e.name,n=e.label||"";e.arrow&&(n+="<span class='webix_ssheet_button_icon webix_ssheet_icon_arrow webix_icon wxi-menu-down'></span>"),e.label="<span class='webix_ssheet_button_icon webix_ssheet_icon ssi-"+t+"'></span> "+n,e.tooltip=webix.i18n.spreadsheet.tooltips[e.name]||""}e.options&&!e.popup&&(e.popup=at(e.options))}},webix.ui.button),webix.protoUI({name:"ssheet-button-icon-top",$cssName:"button",defaults:{type:"htmlbutton",width:70,height:70},$init:function(e){if(this.$view.className+=" ssheet_button_icon_top",e.label){var t=e.icon||e.name||"",n=e.label;e.label="<span class='webix_ssheet_button_icon webix_ssheet_icon ssi-"+t+"'></span><br/>",e.label+="<span class='ssheet_button_icon_top_text'>"+n+"</span>",e.arrow&&(e.label+="<br/><span class='ssheet_button_icon_top_arrow webix_icon wxi-menu-down'></span>"),e.tooltip=webix.i18n.spreadsheet.tooltips[e.name]||""}e.options&&!e.popup&&(e.popup=at(e.options))}},webix.ui.button),webix.protoUI({name:"multicheckbox",defaults:{padding:0,type:"clean",borderless:!0,elementsConfig:{labelWidth:10}},$init:function(e){e.rows=[{height:1e-6}],this.$ready.push(function(){this._initOnChange()})},_initOnChange:function(){this.attachEvent("onChange",function(e){var t=this.$eventSource.config.name;if(this.blockEvent(),"$all"==t){for(var n in this.elements)this.elements[n].setValue(e);e||this._getCheckboxes()[0].setValue(1)}else{var i=this.getValue().length;this.elements.$all.setValue(i==this._count?1:0),i||this._getCheckboxes()[0].setValue(1)}this.unblockEvent()})},setValue:function(e){if(this.elements={},this._count=e.length,1<e.length){var t=[],n=[];e.forEach(function(e){n.push({view:"checkbox",labelRight:e.name,name:e.name,value:e.active})});var i=n.length*webix.skin.$active.inputHeight,r=400<i;t.push({view:"scrollview",body:{rows:n},scroll:r,height:r?400:i}),t.push({template:"<div class='ss_sep_line'></div>",height:10}),t.push({view:"checkbox",labelRight:webix.i18n.spreadsheet.labels["export-all-sheets"],name:"$all",value:0}),webix.ui(t,this)}else 1<this.getChildViews().length&&webix.ui([{height:1e-6}],this)},getValue:function(){for(var e=this._getCheckboxes(),t=[],n=0;n<e.length;n++)e[n].getValue()&&t.push(e[n].config.name);return t},_getCheckboxes:function(){var e=this.queryView("scrollview");return e?e.getBody().getChildViews():[]}},webix.ui.form),webix.protoUI({name:"formlist",defaults:{paddingY:5,height:120},$init:function(e){var t=this;e.cols=[{css:"webix_inp_label",template:e.label,width:e.labelWidth,borderless:!0},{view:"list",data:e.data,css:e.css,template:e.template,select:!0,scroll:!1,borderless:!0,on:{onSelectChange:function(){t.getParentView().callEvent("onChange",[])}}}]},setValue:function(e){this.getChildViews()[1].select(e)},
getValue:function(){return this.getChildViews()[1].getSelectedId()},refresh:function(){this.getChildViews()[1].refresh()},focus:function(){}},webix.ui.layout),webix.protoUI({name:"ssheet-ui",defaults:{move:!0,css:"webix_shadow_none webix_ssheet_ui",head:!1,resize:!0,toFront:!0,minWidth:50,minHeight:200,escHide:!1,autofit:!1},$init:function(){this.$view.setAttribute("webixignore","1"),this.$ready.push(function(){webix.UIManager.addHotKey("delete",webix.bind(this._removeView,this)),webix.UIManager.addHotKey("backspace",webix.bind(this._removeView,this)),this.getMenu()}),this.attachEvent("onDestruct",function(){webix.eventRemove(this._clickEv),this._menu.destructor()})},move_setter:function(e){return e&&webix.DragControl.addDrag(this.$view,this),e},$dragPos:function(e,t){return this.callEvent("onViewMove",[e,t]),e},$dragCreate:function(e,t){var n=t.target;if(n.getAttribute&&!n.getAttribute("webix_disable_drag")&&!n.getAttribute("webixignore")){this.getMenu().hide();var i=webix.html.offset(e),r=webix.html.pos(t),o=webix.html.offset(e.parentNode),a=webix.$$(this.config.master).getScrollState();return webix.DragControl.top=i.y-r.y-o.y,webix.DragControl.left=i.x-r.x-o.x+a.x,webix.toNode(this.$view)}},$dragDestroy:function(e,t){var n=this.config.left=parseInt(t.style.left,10),i=this.config.top=parseInt(t.style.top,10);webix.DragControl.top=webix.DragControl.left=0,this.callEvent("onViewMoveEnd",[n,i])},getMenu:function(){var t=this,e=webix.i18n.spreadsheet.labels;if(!this._menu){var n=[{value:e["export-view"],submenu:[{id:"pdf",value:e["export-view-pdf"]},{id:"png",value:e["export-view-png"]},{id:"excel",value:e["export-view-excel"]}]}];webix.$$(this.config.master).getTopParentView().config.readonly||(n=[{id:"edit",value:e["edit-view"]}].concat(p(n),[{id:"del",value:e["remove-view"]}])),this._menu=webix.ui({view:"contextmenu",submenuConfig:{externalUI:this.config.id},data:n,on:{onMenuItemClick:function(e){return t._menuActions(e)},onBeforeShow:function(){return t._toggleExcel()}}});var i=webix.html.create("span",{"class":"webix_ssheet_view_menu webix_icon wxi-dots"});this._clickEv=webix.event(i,"click",function(){t._menu.isVisible()?t._menu.hide():t._menu.show(i)}),this.$view.firstChild.appendChild(i)}return this._menu},_menuActions:function(e){switch(e){case"del":this.callEvent("onViewRemove",[]);break;case"edit":this.callEvent("onViewEdit",[]);break;case"pdf":webix.toPDF(this.getBody(),{display:"image"});break;case"png":webix.toPNG(this.getBody());break;case"excel":webix.toExcel(this.getBody(),{header:!1})}},_toggleExcel:function(){var e=this.getBody();e.data&&e.data.pull?this._menu.showItem("excel"):this._menu.hideItem("excel")},_removeView:function(e){e&&e.getTopParentView()==this&&this.callEvent("onViewRemove",[])}},webix.ui.window),webix.protoUI({name:"ssheet-series",$init:function(e){var t=this;e.rows=[{view:"scrollview",borderless:!0,body:{view:"accordion",css:"webix_ssheet_accordion",margin:webix.skin.$active.layoutMargin.form,multi:!0,type:"clean",rows:[this.getSectionConfig()]},on:{onAfterScroll:function(){webix.callEvent("onClick",[])}}},{view:"button",label:webix.i18n.spreadsheet.labels["add-line"],click:function(){t.addSection()}}]},getSectionConfig:function(e){var t=this,i=this,r=webix.i18n.spreadsheet.labels,o="<span class='webix_icon webix_ssheet_series_icon wxi-trash'></span>",n=webix.skin.$active.dataPadding-2;return{view:"accordionitem",header:"".concat(r["chart-item"]," ").concat(e?e+1:1," ").concat(o),body:{view:"form",padding:n,elementsConfig:{labelWidth:180},on:{onChange:function(){t.callEvent("onChange",[])}},elements:[{view:"text",label:r["chart-range"],name:"range",range:!0,on:{onChange:function(e,t){var n=e.toUpperCase();e!=n&&(this.blockEvent(),this.setValue(n),this.unblockEvent()),i.callEvent("onRangeChange",[n,t])}}},{view:"ssheet-colorpicker",label:r["chart-series-color"],name:"color"},{view:"checkbox",label:r["chart-tooltip"],name:"tooltip"},{view:"checkbox",label:r["chart-label"],name:"label",hidden:!this.labelsVisible},{view:"richselect",label:r["chart-markers"],value:"square",name:"marker",
hidden:!this.markersVisible,suggest:{view:"ssheet-form-suggest",data:[{id:"square",value:r["chart-markers-square"]},{id:"triangle",value:r["chart-markers-triangle"]},{id:"diamond",value:r["chart-markers-diamond"]},{id:"round",value:r["chart-markers-round"]}]}}]},onClick:{"wxi-trash":function(){var e=this.getParentView();e.removeView(this);for(var t=e.getChildViews(),n=0;n<t.length;n++)t[n].define({header:"".concat(r["chart-item"]," ").concat(n+1," ").concat(o)}),t[n].refresh();return i.callEvent("onChange",[]),!1}}}},addSection:function(){var e=this.getLayout(),t=e.getChildViews().length,n=e.addView(this.getSectionConfig(t));webix.$$(n).queryView({name:"range"}).focus()},setValue:function(e){e=e||[];var t=this.getLayout().getChildViews(),n=t.length;if(n>e.length)for(var i=n;i>e.length;i--)this.getLayout().removeView(t[i-1]);else if(e.length>n)for(var r=e.length;n<r;r--)this.addSection();for(var o=0;o<t.length;o++){var a=t[o].getChildViews()[0],l=a.queryView({name:"range"});l.blockEvent(),a.setValues(e[o]),l.unblockEvent()}},setSubValue:function(e,t){e.blockEvent(),e.setValue(t),e.unblockEvent()},getLayout:function(){return this.queryView("scrollview").getBody()},hideSubviews:function(e,t){"marker"==e?this.markersVisible=t:this.labelsVisible=t,this.queryView({name:e},"all").forEach(function(e){t?e.show():e.hide()})},getValue:function(){var t=[];return this.getLayout().getChildViews().forEach(function(e){t.push(e.getChildViews()[0].getValues())}),t}},webix.ui.layout),webix.editors.excel_date=webix.extend({createPopup:function(){var e=webix.editors.excel_date;if(!e.popup){var t=webix.ui({view:"popup",body:{view:"calendar",icons:!0,timepicker:!0,on:{onChange:function(e){e=e[0],this.getParentView()._last_input_target.value=e?c(e):"",webix.callEvent("onEditEnd",[])}}},on:{onEnter:function(){webix.callEvent("onEditEnd",[])}}});e.popup=t.config.id}return e.popup},render:function(){var e=this,t=webix.html.create("div",{"class":"webix_dt_editor"},"<input type='text'>");return this.popup=this.createPopup(),webix.event(t.firstChild,"click",function(){return e.getPopup().show(t)}),t},getPopup:function(){return webix.$$(this.popup)},showPopup:function(){var e=this.getInputNode(),t=this.getPopup();t._last_input_target=e,t.show(e),e.setAttribute("aria-expanded","true")},updateCalendar:function(e){var t=this.getPopup().getBody();t.blockEvent(),t.setValue(e),t.unblockEvent()},afterRender:function(){this.showPopup()},setValue:function(e){e=""===e||isNaN(1*e)?new Date:x(e),this.updateCalendar(e);var t=Le(webix.$$(this.config.node).queryView(function(e){return"spreadsheet"===e.name},"parent"),this.config.row.id,this.config.id);this.getInputNode().value=t(e)},getValue:function(){var e=this.getInputNode().value;return this.getPopup().hide(),e}},webix.editors.text),webix.editors.ss_richselect=webix.extend({getFormat:function(e){var t,n=this.getInputNode();return e&&n.exists(e)&&(t=n.getItem(e)),t&&t.format},popupInit:function(e){webix.editors.richselect.popupInit.apply(this,arguments),e.getList().define("template",function(e){return e.$value||e.value})}},webix.editors.richselect);var lt={span:function(e){var t=e.$$("cells").getSelectArea();if(t)if(function a(e,t){var n,i,r=t.start,o=t.end;for(n=1*r.row;n<=1*o.row;n++)for(i=1*r.column;i<=1*o.column;i++)if(e.$$("cells").getSpan(n,i))return!0;return!1}(e,t))e.splitCell();else{for(var n=[],i=t.start.row;i<=t.end.row;i++){for(var r=t.start.column;r<=t.end.column;r++){var o=e.getCellValue(i,r);if(o&&n.push(o),1<n.length)break}if(1<n.length)break}1<n.length?e.confirm({text:webix.i18n.spreadsheet.labels["merge-cell-confirm"]}).then(function(){return e.combineCells()}):e.combineCells()}},undo:function(e){e.undo()},redo:function(e){e.redo()},"hide-gridlines":function(e){e.hideGridlines("toggle")},"hide-headers":function(e){e.hideHeaders("toggle")},"freeze-columns":function(e){var t=e.$$("cells").getSelectedId();e.freezeColumns(t&&"rowId"!=t.column?t.column:0)},"freeze-rows":function(e){var t=e.$$("cells").getSelectedId();e.freezeRows(t?t.row:0)},"increase-decimals":function(e){Ie(e,1)},
"decrease-decimals":function(e){Ie(e,-1)}};var st=[{id:"Arial",value:"Arial"},{id:"'Roboto', sans-serif",value:"Roboto"},{id:"'PT Sans', Tahoma",value:"PT Sans"},{id:"Tahoma",value:"Tahoma"},{id:"Verdana",value:"Verdana"},{id:"Calibri, Tahoma",value:"Calibri"}];function ct(e){var t=webix.i18n.spreadsheet.menus,n=[{id:"add",group:"column",value:t["insert-column"]},{id:"del",group:"column",value:t["delete-column"]},{id:"show",group:"column",value:t["show-column"]},{id:"hide",group:"column",value:t["hide-column"]}];return 0!=e.config.resizeCell&&n.push({id:"resize",group:"column",value:t["resize-column"]}),n}function ut(e){var t=webix.i18n.spreadsheet.menus,n=[{id:"add",group:"row",value:t["insert-row"]},{id:"del",group:"row",value:t["delete-row"]},{id:"show",group:"row",value:t["show-row"]},{id:"hide",group:"row",value:t["hide-row"]}];return 0!=e.config.resizeCell&&n.push({id:"resize",group:"row",value:t["resize-row"]}),n}function ht(){return[{id:"clear-value",value:ft("value")},{id:"clear-style",value:ft("style")},{id:"clear-conditional-formats",value:ft("conditional-formats")},{id:"clear-dropdown-editors",value:ft("dropdown-editors")},{id:"clear-comments",value:ft("comments")},{$template:"Separator"},{id:"clear-all",value:ft("all")}]}var dt=[{id:"no",value:"no"},{id:"left",value:"left"},{id:"top",value:"top"},{id:"right",value:"right"},{id:"bottom",value:"bottom"},{id:"all",value:"all"},{id:"outer",value:"outer"},{id:"top-bottom",value:"top-bottom"}];function ft(e){var t=webix.i18n.spreadsheet.menus;return t.clear+" "+t["clear-"+e].toLowerCase()}var gt={"font-weight":"bold","font-style":"italic","text-decoration":"underline"},vt={button:function(e){return{view:"ssheet-toggle",width:e.width||N.width,id:e.name,name:e.name,label:e.label,css:e.css||"",onValue:gt[e.name],offValue:"normal",tooltip:webix.i18n.spreadsheet.tooltips[e.name]||""}},colorButton:function(e){return{view:"ssheet-color",css:e.css,name:e.name,width:e.width||N.width+24,title:"<span class='webix_ssheet_button_icon webix_ssheet_color_button_icon webix_ssheet_icon ssi-"+e.name+"' ></span>",tooltip:webix.i18n.spreadsheet.tooltips[e.name]||""}},toggleButton:function(e){return{view:"ssheet-toggle-silent",width:N.width,id:e.name,name:e.name,label:"<span class='webix_ssheet_button_icon webix_ssheet_icon ssi-"+e.name+"'></span>",tooltip:webix.i18n.spreadsheet.tooltips[e.name]||""}},iconButton:function(e){var t=webix.copy(e);return webix.extend(t,{view:"button",width:N.width,id:e.name,label:"<span class='webix_ssheet_button_icon webix_ssheet_icon ssi-"+e.name+"'></span>",css:"",tooltip:webix.i18n.spreadsheet.tooltips[e.name]||webix.i18n.spreadsheet.menus[e.name]||""}),e.onValue&&webix.extend(t,{view:"ssheet-toggle",onValue:e.onValue,offValue:e.offValue},!0),t},segmented:function(e){return{view:"segmented",name:e.name,css:e.css||"",width:e.width||N.width+76,options:e.options}},select:function(e){return webix.extend(e,{view:"richselect",id:e.name,value:P[e.name],suggest:{css:"webix_ssheet_suggest",padding:0,data:e.options}}),e.tooltip=webix.i18n.spreadsheet.tooltips[e.name]||"",e.popupWidth&&(e.suggest.fitMaster=!1,e.suggest.width=e.popupWidth),e.popupTemplate&&(e.suggest.body={template:e.popupTemplate}),e.popupEvents&&(e.suggest.body=e.suggest.body||{},e.suggest.body.on=e.popupEvents),e},separator:function(){return{view:"ssheet-separator"}},title:function(e){var t=e.title;return 0===t.indexOf("$")&&(t=""),{template:t=webix.i18n.spreadsheet.labels[e.title]||t,view:"ssheet-bar-title",height:N.titleHeight}},borders:function(e){return{view:"ssheet-borders",width:e.width||N.width+24,data:dt,id:e.name,name:e.name,tooltip:webix.i18n.spreadsheet.tooltips[e.name]}},align:function(e){return{view:"ssheet-align",value:P[e.name],width:e.width||N.width+24,data:e.options,name:e.name,tooltip:webix.i18n.spreadsheet.tooltips[e.name]}},condFormat:function(e){return{view:"ssheet-cond-format",width:40,id:e.name,name:e.name}}},mt={"font-family":function(){return vt.select({name:"font-family",options:st,width:100})},"font-size":function(){return vt.select({name:"font-size",
options:function i(){for(var e=["8","9","10","11","12","14","15","16","18","20","22","24","28","36"],t=[],n=0;n<e.length;n++)t.push({id:e[n]+webix.i18n.spreadsheet.labels.px,value:e[n]});return t}(),width:64})},"font-weight":function(){return vt.button({name:"font-weight",label:"B",css:"webix_ssheet_bold"})},"font-style":function(){return vt.button({name:"font-style",label:"I",css:"webix_ssheet_italic"})},"text-decoration":function(){return vt.button({name:"text-decoration",label:"U",css:"webix_ssheet_underline"})},color:function(){return vt.colorButton({name:"color",icon:"font",css:"webix_ssheet_color"})},background:function(){return vt.colorButton({name:"background",icon:"paint-brush",css:"webix_ssheet_background",width:64})},borders:function(){return vt.borders({name:"borders"})},"text-align":function(){var e=webix.i18n.spreadsheet.tooltips;return vt.align({name:"text-align",css:"webix_ssheet_align",options:[{id:"left",css:"webix_ssheet_icon ssi-left",tooltip:e["align-left"]},{id:"center",css:"webix_ssheet_icon ssi-center",tooltip:e["align-center"]},{id:"right",css:"webix_ssheet_icon ssi-right",tooltip:e["align-right"]}]})},"vertical-align":function(){var e=webix.i18n.spreadsheet.tooltips;return vt.align({name:"vertical-align",css:"webix_ssheet_align",options:[{id:"top",css:"webix_ssheet_icon ssi-top",tooltip:e["align-top"]},{id:"middle",css:"webix_ssheet_icon ssi-middle",tooltip:e["align-middle"]},{id:"bottom",css:"webix_ssheet_icon ssi-bottom",tooltip:e["align-bottom"]}]})},wrap:function(){return vt.iconButton({name:"wrap",onValue:"wrap",offValue:"nowrap"})},format:function(){return vt.select({name:"format",width:106,options:function t(){var e=webix.i18n.spreadsheet.labels;return[{id:"common",value:e.common},{id:"price",value:e.currency,example:"98.20"},{id:"int",value:e.number,example:"2120.02"},{id:"percent",value:e.percent,example:"0.5"},{id:"date",value:e.date,example:"45000"},{id:"string",value:e.string,example:"012345"},{id:"custom",value:e["custom-format"]}]}(),popupWidth:180,popupTemplate:function(e){var t=ge[e.id]?ge[e.id].getFormat:"",n={css:""},i=t&&e.example?t(e.example,n):"";return e.value+(t?"<span class='webix_ssheet_right"+(n.css?" "+n.css:"")+"'>"+i+"</span>":"")},popupEvents:{onItemClick:function(e){"custom"==e&&this.getTopParentView().callEvent("onCommand",[{id:e}])}}})},column:function(e){return{name:"column",view:"ssheet-button",icon:"column",arrow:!0,area:!0,width:58,options:ct(e)}},row:function(e){return{name:"row",view:"ssheet-button",icon:"row",arrow:!0,area:!0,width:58,options:ut(e)}},clear:function(){return{name:"clear",view:"ssheet-button",icon:"clear-styles",arrow:!0,area:!0,width:58,options:ht()}},image:function(){return{name:"image",view:"ssheet-button",icon:"add-image",arrow:!0,options:[{id:"add-image-cell",value:webix.i18n.spreadsheet.labels["add-image-cell"]},{id:"add-image-top",value:webix.i18n.spreadsheet.labels["add-image-top"]}]}},graph:function(){return{name:"graph",view:"ssheet-button",icon:"add-sparkline",arrow:!0,options:[{id:"add-sparkline",value:webix.i18n.spreadsheet.labels["add-sparkline"]},{id:"add-chart",value:webix.i18n.spreadsheet.labels["add-chart"]}]}},comment:function(){return{name:"comment",view:"ssheet-button",icon:"comments",arrow:!0,area:!0,width:55}},"create-filter":function(){return vt.toggleButton({name:"create-filter"})},"hide-gridlines":function(){return vt.toggleButton({name:"hide-gridlines"})},"hide-headers":function(){return vt.toggleButton({name:"hide-headers"})}};function pt(e){var t=webix.i18n.spreadsheet;return t.menus[e]||t.labels[e]||t.tooltips[e]||e}function wt(){var e=function o(){var e,t,n,i={undo:["undo","redo"],insert:["add-sparkline","add-image","add-comment"]},r={};for(t in i)for(e=r[t]=0;e<i[t].length;e++)n=webix.html.getTextSize(pt(i[t][e]),"webix_ssheet_button_measure").width+7,r[t]=Math.max(n,r[t]);return r}(),t=N.titleHeight;return[{padding:3,margin:0,rows:[{margin:2,cols:[{name:"sheet",view:"ssheet-button-icon-top",label:pt("sheet"),arrow:!0,options:[{id:"new-sheet"},{id:"copy-sheet"},{id:"remove-sheet"}]},{rows:[{
$button:"excel-import"},{$button:"excel-export"}]},{rows:[{$button:"print"}]}]},{},{template:pt("file"),view:"ssheet-bar-title",height:t,width:85}]},{view:"ssheet-separator"},{padding:3,rows:[{$button:"undo",view:"ssheet-button",label:pt("undo"),width:e.undo},{$button:"redo",view:"ssheet-button",label:pt("redo"),width:e.undo},{template:pt("undo-redo"),view:"ssheet-bar-title",height:t}]},{view:"ssheet-separator"},{padding:3,rows:[{margin:2,cols:[{margin:2,cols:[{$button:"font-family",width:3*(webix.skin.$active.inputHeight+2)+4},{$button:"font-size"}]},{$button:"borders"}]},{margin:2,cols:[{margin:2,cols:[{$button:"font-weight"},{$button:"font-style"},{$button:"text-decoration"}]},{$button:"background"},{$button:"color"}]},{template:pt("font"),view:"ssheet-bar-title",height:t}]},{view:"ssheet-separator"},{padding:3,rows:[{margin:2,cols:[{$button:"text-align"},{$button:"span"}]},{margin:2,cols:[{$button:"vertical-align"},{$button:"wrap"}]},{template:pt("align"),view:"ssheet-bar-title",height:t}]},{view:"ssheet-separator"},{padding:3,rows:[{$button:"format"},{margin:2,cols:[{$button:"increase-decimals"},{$button:"decrease-decimals"}]},{template:pt("number"),view:"ssheet-bar-title",height:t}]},{view:"ssheet-separator"},{padding:3,rows:[{cols:[{$button:"sort-asc"},{$button:"create-filter"},{$button:"conditional-format"},{$button:"add-link"},{$button:"clear"}]},{cols:[{$button:"sort-desc"},{$button:"add-range"},{$button:"lock-cell"},{$button:"add-dropdown"}]},{template:pt("edit"),view:"ssheet-bar-title",height:t}]},{view:"ssheet-separator"},{padding:3,rows:[{cols:[{$button:"image",view:"ssheet-button",label:pt("image"),width:e.insert},{$button:"add-comment",view:"ssheet-button",label:pt("comment"),width:e.insert}]},{$button:"graph",view:"ssheet-button",label:pt("graph"),width:e.insert},{template:pt("insert"),view:"ssheet-bar-title",height:t}]},{view:"ssheet-separator"},{padding:3,rows:[{cols:[{rows:[{$button:"row"},{$button:"column"}]},{rows:[{$button:"hide-gridlines"},{$button:"hide-headers"}]},{rows:[{$button:"freeze-rows"},{$button:"freeze-columns"}]}]},{template:pt("view"),view:"ssheet-bar-title",height:t}]},{view:"ssheet-separator"},{}]}var bt={"undo-redo":["undo","redo"],font:["font-family","font-size","font-weight","font-style","text-decoration","color","background","borders"],align:["text-align","vertical-align","wrap","span"],format:["format"]};function xt(i){i.attachEvent("onComponentInit",function(){return function e(t){t.attachEvent("onAfterSelect",function(e){return function i(e,t){var n=function c(e,t){for(var n=["font-family","font-size","text-align","vertical-align","format","background","color"],i=t[0],r=_t(e,i),o=1;o<t.length;o++){for(var a=_t(e,t[o]),l=n.length-1;0<=l;l--){var s=n[l];r[s]!=a[s]&&(delete r[s],n.splice(l,1))}if(!n.length)break}return r}(e,t);e.$$("bar").setValues(n)}(t,e)})}(i)}),i.attachEvent("onCommand",function(e){"toolbar-update"==e.id&&function r(e,t,n){var i=e.$$("bar").elements[t];i&&i.setValue(n)}(i,e.name,e.value)});var e=[];if(i.config.toolbar){var t=i.config.toolbar;"full"==t&&(t=wt(),webix.isUndefined(i.config.bottombar)&&(i.config.bottombar=!0)),e=function a(r,e){var o=function(e){for(var t=0;t<e.length;t++){var n=e[t].$button;if(n){var i=mt[n]?mt[n](r):vt.iconButton({name:n});webix.extend(e[t],i)}e[t].rows&&o(e[t].rows),e[t].cols&&o(e[t].cols)}};return o(e),e}(i,t)}else e=function s(e,t){var n,i,r,o=[];for(var a in t)o.push((n=e,r=t[i=a],{rows:[{padding:2,cols:[{margin:2,cols:function l(e,t){for(var n=[],i=0;i<t.length;i++){var r=t[i];if("object"==g(r))n.push(r);else{var o=mt[r]?mt[r](e):vt.iconButton({name:r});n.push(o)}}return n}(n,r)}]},vt.title({title:i})]})),o.push(vt.separator());return o}(i,i.config.buttons||bt);var n={view:"toolbar",css:"webix_ssheet_toolbar webix_layout_toolbar",id:"bar",padding:0,elements:e,on:{onChange:function(){var e=this.$eventSource,t=e.getValue(),n=e.config.name;"format"==n&&"common"==t&&(t=""),"format"==n&&"custom"==t||i.callEvent("onStyleSet",[n,t])},onItemClick:function(e){var t=i.innerId(e);lt[t]?lt[t].call(this,i):i.callEvent("onCommand",[{
id:t}])}}};return i.callEvent("onViewInit",["toolbar",n]),n}function _t(e,t){var n=e.$$("cells").getSpan(t.row,t.column);if(n){var i=$(n,2);t.row=i[0],t.column=i[1]}var r=K(e,t),o=r?webix.copy(r.props):{};for(var a in P)o[a]||(o[a]=P[a]);var l=G(e,t.row,t.column)||"common";return o.format=De(l)?"custom":l,o}function yt(e,t,n){var i=t.$$("cells").config.columns,r={row:e,column:i["rowId"==i[0].id?1:0].id},o={row:n||e,column:i[i.length-1].id};r.column&&o.column&&At(r,o,t)}function Ct(e){var t=e.$$("cells").data.order,n=e.$$("cells").config.columns,i="rowId"==n[0].id?1:0,r={row:t[0],column:n[i].id},o={row:t[t.length-1],column:n[n.length-1].id};r.column&&o.column&&At(r,o,e)}function $t(e,t,n){var i=t.$$("cells").data.order;At({row:i[0],column:e},{row:i[i.length-1],column:n||e},t)}function St(e,t){var n=t.$$("cells").getSelectArea();return!!(n&&e>=n.start.column&&e<=n.end.column)}function kt(e,t,n){return Et(e,n)&&St(t,n)}function Et(e,t){var n=t.$$("cells").getSelectArea();return!!(n&&e>=n.start.row&&e<=n.end.row)}function Vt(e,t){var n=t.$$("cells").getSelectArea();n?$t(Math.min(n.start.column,n.end.column,e),t,Math.max(n.start.column,n.end.column,e)):$t(e,t)}function At(e,t,n){n.$$("cells").addSelectArea(e,t)}function zt(a,l){var s=25,c=l._table.getColumnConfig(a).width;l._table.eachRow(function(e){var t=l._table.getSpan(e,a);if(!(t&&1<t[2])){var n=this.getText(e,a),i=l.getStyle(e,a),r=i?i.id:"";if(n.replace(/<\/?[^>]+(>|$)/g,"")){var o=te(l,n,r);l.getCellEditor(e,a)&&(o.width+=20),l.getCellFilter(e,a)&&(o.width+=20),i&&"wrap"==i.props.wrap&&o.width>c&&(o.width=c),o.width>s&&(s=o.width)}}}),l._table.setColumnWidth(a,s)}function It(l,s){var c=25;s._table.eachColumn(function(e){if("rowId"!=e){var t=this.getText(l,e),n=this.getColumnConfig(e).width,i=s._table.getSpan(l,e);i&&(n=s._table.getSpanNode({row:i[0],column:i[1]}).offsetWidth);var r=s.getStyle(l,e),o=r?r.id:"";if(t.replace(/<\/?[^>]+(>|$)/g,"")){var a=te(s,t,o,n);a.height>c&&(c=a.height)}}}),s._table.setRowHeight(l,c)}function Rt(e,t,n){if(n._table.config.header){var i=n._table,r="webix_highlight",o=e.row,a=t.row,l=e.column,s=t.column,c=i.config.columns,u=c[1].id;if("rowId"==l?l==s?(e.column=l=u,t.column=s=c[c.length-1].id):e.column=l=u:"rowId"==s&&(t.column=s=u),a<o){var h=[a,o];o=h[0],a=h[1]}if(s<l){var d=[s,l];l=d[0],s=d[1]}i.eachRow(function(e){e<o||a<e?i.removeCellCss(e,"rowId",r,!0):i.addCellCss(e,"rowId",r,!0)}),webix.delay(function(){return i.refresh()}),i.eachColumn(function(e){var t=i.getHeaderNode(e);"rowId"!=e&&t&&(e<l||s<e?webix.html.removeCss(t,r):webix.html.addCss(t,r,!0))})}}var Dt=Object.freeze({selectRow:yt,selectAll:Ct,selectColumn:$t,isColSelected:St,isCellSelected:kt,isRowSelected:Et,selectColumns:Vt,adjustColumn:zt,adjustRow:It,highlightColRow:Rt}),Ot="webix_lock";function Mt(n,e,t,i,r){var o=n.$$("cells");"object"===g(e)&&"object"===g(t)?w.set(function(){!function a(e,t,n,i){for(var r=e.row;r<=t.row;r++)for(var o=e.column;o<=t.column;o++)n.call(i||this,r,o)}(e,t,function(e,t){Mt(n,e,t,i,!0)})}):(i=!1!==i,((n._locks[e]=n._locks[e]||{})[t]=i)?o.addCellCss(e,t,Ot,!0):o.removeCellCss(e,t,Ot,!0),n.callEvent("onAction",["lock",{row:e,column:t,value:!i,newValue:i}]));r||o.refresh()}function Tt(e,t,n){return!!e._locks[t]&&e._locks[t][n]}var Ft=Object.freeze({lockCss:Ot,init:function Go(r){r._locks={},r.attachEvent("onReset",function(){return function t(e){e._locks={}}(r)}),r.attachEvent("onUndo",function(e,t,n,i){"lock"===e&&Mt(r,t,n,!!i,!0)}),r.attachEvent("onCommand",function(e){"lock-cell"===e.id&&function i(e){var t=e.$$("cells").getSelectArea();if(t){var n=e.isCellLocked(t.start.row,t.start.column);e.lockCell(t.start,t.end,!n)}}(r)}),r.attachEvent("onAction",function(e,t){"before-grid-change"==e&&function u(e,t,n,i,r){var o=i.locked,a=o.length;if(n)for(;a--;){var l=$(o[a],2),s=l[0],c=l[1];(s&&"row"==t&&s>=r.row||c&&"column"==t&&c>=r.column)&&("row"==t?s<r.row-n?o.splice(a,1):o[a][0]=1*s+n:"column"==t&&(c<r.column-n?o.splice(a,1):o[a][1]=1*c+n))}}(0,t.name,t.inc,t.data,t.start)})},lockCell:Mt,isCellLocked:Tt,serialize:function Yo(e,t){var n,i,r=[]
;for(n in e._locks)for(i in e._locks[n])e._locks[n][i]&&r.push([n,i]);t.locked=r},load:function Xo(e,t){var n,i=t.locked;if(i)for(n=0;n<i.length;n++)Mt(e,i[n][0],i[n][1],!0,!0)}});function Nt(e,t,n){var i=e.$$("cells").getSpan()[t];if(i)return i[n]}function Pt(e,t,n,i,r){if(!(n<2&&i<2)&&(r||e.callEvent("onBeforeSpan",[t.row,t.column,[n,i]]))){var o=e._mPage.getCell(t.row-1,t.column-1),a=o&&o.style||"",l=Ht(e,t.row,t.column);l&&(a+=" "+l),function u(e,t,n,i){var r,o,a,l=1*t.row,s=1*t.column,c=!e.getCellValue(l,s);for(r=l;r<l+i;r++)for(o=s;o<s+n;o++)""===(a=e.getCellValue(r,o))||o==s&&r==l||(c&&(c=!1,e.setCellValue(l,s,a)),e.setCellValue(r,o,""))}(e,t,n,i),e.$$("cells").addSpan(t.row,t.column,n,i,null,a),r||(e.callEvent("onAfterSpan",[t.row,t.column,[n,i]]),b(e,"spans",{row:t.row,column:t.column,x:n,y:i}))}}function Ut(e,t){var n=e.$$("cells").getSpan(t.row,t.column);n&&e.callEvent("onBeforeSplit",[t.row,t.column,[n[2],n[3]]])&&(e.$$("cells").removeSpan(t.row,t.column),e.callEvent("onAfterSplit",[t.row,t.column,[n[2],n[3]]]),b(e,"spans",{row:t.row,column:t.column,x:0,y:0}))}function jt(e){var t,n,i,r;i=r=0,t=n=Infinity;for(var o=0;o<e.length;o++){var a=1*e[o].column,l=1*e[o].row;t=Math.min(a,t),i=Math.max(a,i),n=Math.min(l,n),r=Math.max(l,r)}return{cell:{row:n,column:t},x:i-t+1,y:r-n+1}}function Bt(e,t,n,i,r){var o=Nt(e,t,n);o&&(r?-1==o[3].indexOf(i)&&(o[3]+=" "+i):o[3]=o[3].replace(" "+i,""))}function Ht(e,t,n){var i=[];return e.getCellEditor(t,n)&&i.push("ss_editor"),e.getCellFilter(t,n)&&i.push("ss_filter"),i.join(" ")}var Lt={"border-right":function(e,t,n,i){return i.end.column==t+n[0]-1},"border-bottom":function(e,t,n,i){return i.end.row==e+n[1]-1}};function qt(t,e,n,i,r,o,a){var l="row"==e.group?t[3]:t[2],s="row"==e.group?[1*t[0],1*t[0]+t[3]-1]:[1*t[1],1*t[1]+t[2]-1],c="row"==e.group?[n.row,i.row]:[n.column,i.column],u=c[1]-c[0]+1;c[0]=Math.max(c[0],s[0]),c[1]=Math.min(c[1],s[1]);var h=c[0]==s[0];if(c[0]<=c[1]){if("del"==e.id&&(u=-1*(c[1]-c[0]+1)),"del"==e.id&&h&&-1*u<l){var d=o.find(function(e){return e[0]==t[0]&&e[1]==t[1]});d&&a.push(d)}h&&"add"==e.id||(t[2]="column"==e.group?t[2]+u:t[2],t[3]="row"==e.group?t[3]+u:t[3])}return t}function Wt(i,e,t,n,r,o){var a=i._table.getSpan(t,n);if(e&&e.span){var l=e.span;t==1*l[0]+o.row&&n==1*l[1]+o.column&&(i._table.mapCells(t,n,l[3],l[2],function(e,t,n){(a=i._table.getSpan(t,n))&&Ut(i,{row:a[0],column:a[1]})},!0),Pt(i,{row:t,column:n},l[2],l[3]),1===r&&Ut(i,{row:e.row,column:e.col}))}else a&&Ut(i,{row:a[0],column:a[1]})}var Kt=Object.freeze({init:function Zo(l){l.attachEvent("onStyleChange",function(e,t,n){var i=Nt(l,e,t);if(i){var r=Ht(l,e,t);i[3]=(n?n.id:"")+(r?" "+r:"")}}),l.attachEvent("onDataParse",function(e){!function r(e,t){if(t.spans)for(var n=0;n<t.spans.length;n++){var i=t.spans[n];Pt(e,{row:i[0],column:i[1]},1*i[2],1*i[3],!0)}}(l,e)}),l.attachEvent("onDataSerialize",function(e){!function s(e,t){var n=[],i=e.$$("cells").getSpan();if(i){for(var r in i){var o=i[r];for(var a in o){var l=o[a];n.push([1*r,1*a,l[0],l[1]])}}t.spans=n}}(l,e)}),l.attachEvent("onUndo",function(e,t,n,i,r){"span"!=e&&"split"!=e||("span"==e&&(r=!r),function o(e,t,n,i,r){r?Ut(e,{row:t,column:n}):Pt(e,{row:t,column:n},i[0],i[1])}(l,t,n,i,r))}),l.attachEvent("onAction",function(e,t){if("lock"==e)Bt(l,t.row,t.column,Ot,t.newValue);else if("before-grid-change"==e)!function u(e,t,n,i,r){var o=i.spans;if(n)for(var a=o.length-1;0<=a;a--){var l=$(o[a],2),s=l[0],c=l[1];n<0&&("row"==t&&s<=r.row-n-1?n=r.row-o[a][0]:"column"==t&&c<=r.column-n-1&&(n=r.column-o[a][1])),("row"==t&&s>=r.row||"column"==t&&c>=r.column)&&(o[a][0]="row"==t?1*s+n:s,o[a][1]="column"==t?1*c+n:c)}}(0,t.name,t.inc,t.data,t.start);else if("check-borders"==e)return function a(e,t,n,i,r){var o=Nt(e,t,n);return!(!o||!Lt[r])&&Lt[r](t,n,o,i)}(l,t.row,t.column,t.area,t.mode)})},addSpan:Pt,removeSpan:Ut,getRange:jt,setSpanCss:Bt,adjustSpan:qt,pasteSpan:Wt});function Gt(e){return webix.i18n.spreadsheet.labels[e]||e}function Yt(e){return e&&!isNaN(e)&&!He(e)}var Xt={number:[{id:"greater",batch:"text",handler:function(e,t){return""!==e&&1*t<1*e}},
{id:"less",batch:"text",handler:function(e,t){return""!==e&&1*e<1*t}},{id:"greaterOrEqual",batch:"text",handler:function(e,t){return""!==e&&1*t<=1*e}},{id:"lessOrEqual",batch:"text",handler:function(e,t){return""!==e&&1*e<=1*t}},{id:"equal",batch:"text",handler:function(e,t){return e==t}},{id:"notEqual",batch:"text",handler:function(e,t){return e!=t}},{id:"contains",batch:"text",handler:function(e,t){return-1!==e.toString().toLowerCase().indexOf(t.toString().toLowerCase())}},{id:"notContains",batch:"text",handler:function(e,t){return-1===e.toString().toLowerCase().indexOf(t.toString().toLowerCase())}}],text:[{id:"contains",batch:"text",handler:function(e,t){return-1!==e.toString().toLowerCase().indexOf(t.toString().toLowerCase())}},{id:"notContains",batch:"text",handler:function(e,t){return-1===e.toString().toLowerCase().indexOf(t.toString().toLowerCase())}},{id:"equal",batch:"text",handler:function(e,t){return e.toString().toLowerCase()===t.toString().toLowerCase()}},{id:"notEqual",batch:"text",handler:function(e,t){return e.toString().toLowerCase()!==t.toString().toLowerCase()}},{id:"beginsWith",batch:"text",handler:function(e,t){return 0===e.toString().toLowerCase().lastIndexOf(t.toString().toLowerCase(),0)}},{id:"notBeginsWith",batch:"text",handler:function(e,t){return 0!==e.toString().toLowerCase().lastIndexOf(t.toString().toLowerCase(),0)}},{id:"endsWith",batch:"text",handler:function(e,t){return-1!==e.toString().toLowerCase().indexOf(t.toString().toLowerCase(),e.length-t.length)}},{id:"notEndsWith",batch:"text",handler:function(e,t){return-1===e.toString().toLowerCase().indexOf(t.toString().toLowerCase(),e.length-t.length)}}],date:[{id:"greater",batch:"datepicker",handler:function(e,t){return Yt(e)&&t<e}},{id:"less",batch:"datepicker",handler:function(e,t){return Yt(e)&&e<t}},{id:"greaterOrEqual",batch:"datepicker",handler:function(e,t){return Yt(e)&&t<=e}},{id:"lessOrEqual",batch:"datepicker",handler:function(e,t){return Yt(e)&&e<=t}},{id:"equal",batch:"datepicker",handler:function(e,t){return Yt(e)&&e==t}},{id:"notEqual",batch:"datepicker",handler:function(e,t){return!Yt(e)||e!=t}},{id:"between",batch:"daterangepicker",handler:function(e,t){return!!Yt(e)&&((!t.start||e>t.start)&&(!t.end||e<t.end))}},{id:"notBetween",batch:"daterangepicker",handler:function(e,t){return!!Yt(e)&&(!t.start||e<=t.start||!t.end||e>=t.end)}}]};function Zt(e,t){return isNaN(1*t)?"="==t.charAt(0)&&1<t.length&&null===(t=e._mData.getStore().exec(t.substring(1)))&&(t=""):t*=1,t}function Qt(c,u,h,d){var f="";if(!c.conditions._empty){var g=c.conditions.get(u,h);if(g){var v=c.$$("cells").getSpan(u,h),m=c.getCellValue(u,h,!1);m||0===m||(m="");var p=it(c,u,h);p&&"string"!=p||(p="text");for(var e=function(e){var t=m,n=g[e][0],i=c.conditions.handlers,r=void 0,o=["text",p,"number","date"];o=o.filter(function(e,t){return o.indexOf(e)==t});for(var a=0;a<o.length;a++){var l=o[a];if(r=i[l].find(function(e){return e.id==n})){r=r.handler,"text"==l&&"equal"!=n&&"notEqual"!=n&&(t=d);break}}var s=g[e][1];if(s=webix.isArray(s)?{start:Zt(c,s[0]),end:Zt(c,s[1])}:Zt(c,s),!f&&r&&r(t,s)){if(f=g[e][2],!v)return"break";Bt(c,u,h,g[e][2],!0)}else Bt(c,u,h,g[e][2],!1)},t=g.length-1;0<=t;t--){if("break"===e(t))break}}}return f}function Jt(e,t,n,i){return i._empty=!1,e[t]||(e[t]={}),e[t][n]||(e[t][n]=[]),e[t][n]}function en(e){var t={">":"greater","<":"less","=":"equal","!=":"notEqual","<>":"between"};if(this._empty=!0,e)for(var n=e.length;n--;){var i=e[n],r=Jt(this._pull,i[0],i[1],this);i[2]=t[i[2]]||i[2],r.push([i[2],i[3],i[4]])}}function tn(){this._pull={}}function nn(e,t){return e?t?this._pull[e]?this._pull[e][t]:null:this._pull[e]:this._pull}function rn(e,t){this.get(e,t)&&delete this._pull[e][t]}function on(){var e,t,n,i,r=[];for(i in this._pull)for(e in this._pull[i])for(n=0;n<this._pull[i][e].length;n++)t=this._pull[i][e][n],r.push([i,e,t[0],t[1],t[2]]);return r}function an(e,t){w.set(function(){O(t,e,function(e,t){var n=e.conditions.get(t.row,t.column);n&&sn("remove",t.row,t.column,n,null,e)}),e.refresh()})}function ln(e,t,n,i,r){var o=t.condition;sn("update",n
,i,e.conditions.get(n,i)||null,o,e),1===r&&sn("remove",t.row,t.col,o,null,e)}function sn(e,t,n,i,r,o){o.callEvent("onBeforeConditionSet",[t,n,i,r])&&(o.conditions[e].apply(o.conditions,[t,n,r]),o.callEvent("onAfterConditionSet",[t,n,i,r]))}function cn(e,t){var n=t[1];return"="==n[0]&&(t[1]=e._mData.getStore().parse(n).source),t}var un=Object.freeze({init:function Qo(o){o.conditions={_empty:!0,_pull:{},handlers:function t(){var e=webix.copy(Xt);return e.number=e.number.concat([{id:"between",handler:function(e,t){return(!t.start||e>t.start)&&(!t.end||e<t.end)}},{id:"notBetween",handler:function(e,t){return!t.start||e<=t.start||!t.end||e>=t.end}}]),e}(),add:function(e,t,n,i,r){(function a(e,t,n,i,r,o){Jt(this._pull,t,n,this).push(cn(e,[i,r,o]))}).apply(this,[o,e,t,n,i,r])},update:function(e,t,n){(function r(t,e,n,i){this.get(e,n)||Jt(this._pull,e,n,this),i.map(function(e){return cn(t,e)}),this._pull[e][n]=i}).apply(this,[o,e,t,n])},remove:rn,get:nn,parse:en,serialize:on,clear:tn},o.attachEvent("onConditionSet",function(e){return function t(i,r){w.set(function(){i.eachSelectedCell(function(e){var t=i.conditions.get(e.row,e.column);if(t)for(var n=0;n<t.length;n++)Bt(i,e.row,e.column,t[n][2],!1);sn("update",e.row,e.column,t||null,r,i)})}),i.refresh()}(o,e)}),o.attachEvent("onUndo",function(e,t,n,i){"condition"==e&&function r(e,t,n,i){e.conditions.get(t,n)&&e.conditions.remove(t,n),i&&e.conditions.update(t,n,i)}(o,t,n,i)}),o.attachEvent("onDataSerialize",function(e){return function n(e,t){t.conditions=e.conditions.serialize()}(o,e)}),o.attachEvent("onDataParse",function(e){return function n(e,t){e.conditions.parse(t.conditions)}(o,e)}),o.attachEvent("onReset",function(){return o.conditions.clear()}),o.attachEvent("onAction",function(e,t){"before-grid-change"==e&&function u(e,t,n,i,r){var o=i.conditions,a=o.length;if(n)for(;a--;){var l=$(o[a],2),s=l[0],c=l[1];("row"==t&&s>=r.row||"column"==t&&c>=r.column)&&("row"==t?s<r.row-n?o.splice(a,1):o[a][0]=1*s+n:"column"==t&&(c<r.column-n?o.splice(a,1):o[a][1]=1*c+n))}}(0,t.name,t.inc,t.data,t.start)}),function n(e){e.conditions.clear()}(o)},getConditionCss:Qt,clearConditionalFormats:an,pasteCondition:ln,_changeCondition:sn});function hn(e,t){e.attachEvent("onComponentInit",function(){return function h(r){var o,n,a=r._table,e=webix.event(document.body,"mousemove",function(e){clearTimeout(t),t=webix.delay(function(e){if(!r.comments._activeComment.editStatus){var t=a.locate(e),n=r.comments.commentsView&&r.comments.commentsView.isVisible();if(t&&r.comments.get(t.row,t.column)){var i=r.comments._activeComment.cell;(!i||i.row==t.row&&i.column==t.column)&&n||r.callEvent("onCommand",[{id:"add-comment",cell:t,viewonly:!0}])}else n&&!r.comments.commentsView.$view.contains(e.target)&&r.callEvent("onCommentHide",[])}},!0,[e],250)});var t;r.config.math&&(a.config.editMath=!0);function i(){var e=a.getSelectedId(!0);if(e.length){var t=e[0],n=e[e.length-1]?e[e.length-1]:e[0];Rt(t,n,r)}else{var i={row:0,column:0};Rt(i,i,r)}}a.attachEvent("onBeforeEditStop",function(e,t){e.old===webix.undefined&&""===e.value||(e.value!=e.old&&(r.setCellValue(t.row,t.column,e.value),a.refresh()),e.value=e.old)}),a.attachEvent("onEnter",function(e){a.getEditor()&&webix.delay(function(){a.moveSelection("down")}),webix.html.preventEvent(e)}),r.attachEvent("onBeforeEditStart",function(e,t){return!r.isCellLocked(e,t)}),a.attachEvent("onAfterEditStart",function(e){var t=e.row,n=e.column,i=r.getCellValue(t,n);a.$anyKey&&(a.$anyKey=!1,i=""),a.getEditor().setValue(i)}),a.attachEvent("onBeforeEditStart",function(e){return r.callEvent("onBeforeEditStart",[e.row,e.column])}),a.attachEvent("onBeforeSelect",function(e){return"rowId"!=e.column}),a.attachEvent("onBeforeBlockSelect",function(e,t,n){Rt(n?e:webix.copy(e),n?t:webix.copy(t),r)}),a.attachEvent("onSelectChange",function(){return i()}),a.attachEvent("onAfterColumnShow",function(){webix.delay(function(){return i()})}),a.attachEvent("onColumnResize",function(){webix.delay(function(){return i()})}),webix.event(a.$view.firstChild,"mousedown",function(e){var t=a.config.resizeColumn,
n=a.locate(e);if(n&&n.cind){if(t){var i=a.getColumnConfig(n.column).width,r=webix.html.posRelative(e);if(r.x<t.size||i-r.x<t.size+1)return}o=n.cind}}),webix.event(a.$view.firstChild,"mousemove",function(e){if(o){var t=a.locate(e);t&&(n=t.cind,Rt({column:a.columnId(o)},{column:a.columnId(n||1)},r))}});var l=webix.event(document.body,"mouseup",function(){o&&(null!=n&&($t(a.columnId(o),r,a.columnId(n||1)),n=null),o=null)});a.attachEvent("onItemDblClick",function(e){"rowId"===e.column&&It(e.row,r)});var s=0;a.attachEvent("onHeaderClick",function(e,t){if("rowId"!=e.column){var n=new Date,i=n-s<=300;i?zt(e.column,r):(s=n,t.shiftKey?Vt(e.column,r):$t(e.column,r))}else Ct(r)});var c=null;a.attachEvent("onItemClick",function(e,t){"rowId"===e.column&&(t.shiftKey&&c?yt(c,r,e.row):yt(e.row,r),c=e.row)}),r.attachEvent("onReset",function(){return fn(r)}),r.attachEvent("onBeforeSheetShow",function(){return a.editStop()}),a.attachEvent("onBlur",function(){webix.delay(function(){var e=document.activeElement;if(!e||"INPUT"!=e.tagName){var t=webix.UIManager.getFocus(),n=t&&t!=a&&t.getTopParentView&&t.getTopParentView()===r;n&&webix.UIManager.setFocus(a)}},this,[],100)}),function u(e){webix.html.addStyle("#"+e._table.$view.id+".webix_dtable .webix_cell { white-space:nowrap;}")}(r),r.attachEvent("onDestruct",function(){webix.eventRemove(e),webix.eventRemove(l)})}(e)});var n={view:"datatable",id:"cells",css:"webix_ssheet_table webix_data_border wss_"+e.$index,headerRowHeight:"contrast"==webix.skin.$name||"flat"==webix.skin.$name?24:20,spans:!0,leftSplit:1,areaselect:!0,minColumnWidth:38,editable:!0,editaction:t.liveEditor?"custom":"dblclick",minRowHeight:1,navigation:!0};return t&&(n=webix.extend(n,t,!0)),n}function dn(e,t,n,i,r,o){var a=r.id,l=t.id;if(!e._mPage)return"";var s=e._mPage.getCell(l-1,a-1),c=s?s.value:"",u=s?s.format:"";if(e.getCellValue(l,a)!=c){var h=webix.i18n.spreadsheet.table;"#REF!"==c?c=h["math-ref-error"]:"#ERROR"==c&&(c=h["math-error"])}var d="",f=!c&&0!==c||isNaN(c),g=je(u,"date")&&He(c),v="";if(o||(v+=e.comments.get(l,a)?"<div class='ssheet_commented_sign'></div>":"",v+=e.getCellFilter(l,a)?"<div class='ssheet_filter_sign'></div>":""),!g&&(!f||je(u,"string")))if(u){var m={css:""},p=we(u);if(p){var w=p(c,m);w!=webix.i18n.spreadsheet.table["format-error"]?(m.css&&(d='class="'.concat(m.css,'"')),c=w):f||(c*=1)}}else c*=1;return e._print&&!c&&0!==c?"":((webix.isUndefined(c)||null===c)&&(c=""),"<div ".concat(d,">").concat(c,"</div>").concat(e._print?"":v))}function fn(s){var e=s.$$("cells");e.clearAll();for(var t=s.config.columnCount,n=s.config.rowCount,i=[{id:"rowId",header:"",width:40,css:"sheet_column_0",template:function(e){return e.id}}],r=1;r<=t;r++)i.push({id:r,editor:"text",header:{text:C[r]},template:function(e,t,n,i){return dn(s,e,0,0,i)},cssFormat:function(e,t,n,i){var r=gn(s,n,i),o=s._mPage.getCell(n-1,i-1),a=o?o.style:"",l=Qt(s,n,i,r);return"".concat(a," ").concat(l)}}),s.callEvent("onColumnInit",[i[r]]);e.refreshColumns(i);for(var o=[],a=1;a<=n;a++)o.push({id:a});e.parse(o)}function gn(e,t,n){return dn(e,{id:t},0,0,{id:n},!0).replace(/<[^>]*>/gi,"")}function vn(i){var o=i.$$("cells"),e=webix.env.isMac?"command":"ctrl";if(webix.UIManager.addHotKey(e+"-a",function(){o.getEditor()||Ct(i)},o),!i.config.readonly){webix.UIManager.addHotKey("any",function(e,t){var n=t.which||t.keyCode,i=113==n;if(!(16==n||112<=n&&n<=123&&!i)){var r=e.getSelectedId(!0);r.length&&(e.config.liveEditor&&i||(o.$anyKey=!0),o.edit(r[0]))}},o),webix.UIManager.addHotKey("enter",function(e){var t=e.getSelectedId(!0);t.length&&(e.config.liveEditor&&!o.callEvent("onBeforeLiveEditor",[t[0]])||o.edit(t[0]))},o),webix.UIManager.addHotKey("backspace",function(){return mn(i)},o),webix.UIManager.addHotKey("delete",function(){return mn(i)},o);var t=webix.env.isMac?"command-shift-z":"ctrl-y";webix.UIManager.addHotKey(t,function(){return i.redo()},o),webix.UIManager.addHotKey(e+"-z",function(){return i.undo()},o),webix.UIManager.addHotKey(e+"-b",function(){return pn(i,"font-weight")},o),webix.UIManager.addHotKey(e+"-i",function(){return pn(i,"font-style"
)},o),webix.UIManager.addHotKey(e+"-u",function(e,t){return function n(e,t){return pn(e,"text-decoration"),webix.html.preventEvent(t)}(i,t)},o),webix.UIManager.addHotKey(e+"-p",function(e,t){return function n(e,t){return e.callEvent("onCommand",[{id:"print"}]),webix.html.preventEvent(t)}(i,t)},o)}}function mn(t){t.$$("cells").getEditor()||w.set(function(){t.eachSelectedCell(function(e){return t.setCellValue(e.row,e.column,"")}),t.refresh()})}function pn(e,t){var n=e.getSelectedId();if(n){var i=e.getStyle(n.row,n.column),r=gt[t],o=i&&i.props[t]===r?"normal":r;e.callEvent("onStyleSet",[t,o])}}var wn=[];for(var bn in n)wn.push(bn);function xn(t){return t.attachEvent("onComponentInit",function(){return function e(u){var h=u.$$("liveEditor");function n(e,t){var n=h.config.activeCell;n&&n.row==e&&n.column==t&&o({row:e,column:t})}function i(e,t,n){if(u.getCellEditor(t.row,t.column)||!o(t,n))return!0;if(h.focus(),!n){h.paintValue();var i=h.getInputNode(),r=i.value.length;i.setSelectionRange(r,r)}return!1}function r(e,t){var n=u.getCellEditor(e,t)||u.isCellLocked(e,t);return n?h.disable():h.enable(),n}function o(e,t){var n=r(e.row,e.column);return h.config.activeCell=e,h.setValue(t?"":h.getCellValue(e.row,e.column)),u._rangeDialog||(u.$handleSelection=n?null:function(e,t,n,i){return a(n,i,e)}),!n}function a(e,t,n){var i,r=h._update_range,o=h.getInputNode().selectionStart,a="";if(h._activeMath){var l=u.getActiveSheet();h._activeMath!=l&&(a=h.prepareSheet(l))}if(e==t){var s=":"==h.getValue()[(r?r.pos:o)-1];i=s?e:a+e}else i="".concat(a+e,":").concat(t);if(r&&r.pos==o-r.len)h.setRange(i,!0),o=h._update_range.pos+i.length;else{if(!h.expectOperator())return function c(e){if(h.isEnabled()){var t=h.config.activeCell;h.showActiveSheet(),h.updateCellValue(t),h.setValue(e?u.getCellValue(e.row,e.column):"")}return!0}(n);h.setRange(i),o+=i.length}return h.focus(),h.getInputNode().setSelectionRange(o,o),h.paintValue(),!1}function l(){h.define({activeCell:null}),h.setValue(""),h.disable()}u._table.attachEvent("onBeforeEditStart",function(e){var t=u._table.$anyKey;return u._table.$anyKey=!1,i(this,e,t)}),u._table.attachEvent("onBeforeLiveEditor",function(e){return i(this,e,!1)}),u._table.attachEvent("onItemDblClick",function(e){u.getCellEditor(e.row,e.column)?this.edit(e):i(this,e,!1)}),u._table.attachEvent("onAfterScroll",function(){h.$view.contains(document.activeElement)&&h.paintValue()}),u.attachEvent("onCellChange",function(e,t,n){var i=h.config.activeCell;i&&i.row==e&&i.column==t&&h.setValue(n)}),u.attachEvent("onAfterSelect",function(e){if(!u.$handleSelection){var t=e[0];o(t)}}),u.attachEvent("onChange",function(e){if("update"==e&&h.isEnabled()){var t=h.config.activeCell;t&&h.getValue()!=u.getCellValue(t.row,t.column)&&(delete h._update_range,h.showActiveSheet(),h.updateCellValue())}}),u.attachEvent("onBeforeSheetShow",function(t){if(!u._rangeDialog){var e=h.config.activeCell;if(e){var n=h.getInputNode().selectionStart,i=h.getValue();u.getCellValue(e.row,e.column)!=i?(h._activeMath||(h._activeMath=u.getActiveSheet()),webix.delay(function(){if(t==h._activeMath){u.$handleSelection=null;var e=h.config.activeCell;u._table.select(e.row,e.column)}h.setValue(i),h.refresh(),h.getInputNode().setSelectionRange(n,n),h.paintValue(),u.$handleSelection=function(e,t,n,i){return a(n,i,e)}})):l()}}}),u.attachEvent("onReset",function(){u._rangeDialog||(u.$handleSelection=null)}),u.$$("cells").attachEvent("onFocus",function(){h._activeMath&&webix.delay(function(){return h.focus()})}),u.attachEvent("onAfterLoad",function(){return l()}),u.attachEvent("onAction",function(e,t){var n=h.config.activeCell,i=n&&n.row==t.row&&n.column==t.column;!i||"lock"!=e&&"dropdown"!=e||r(t.row,t.column)}),u.attachEvent("onFormatChange",function(e,t){return n(e,t)}),u.attachEvent("onCellChange",function(e,t){return n(e,t)})}(t)}),{view:"toolbar",css:"webix_ssheet_toolbar",elements:[{view:"label",label:webix.i18n.spreadsheet.liveEditor.edit,width:60},{view:"live-editor",disabled:!0,id:"liveEditor",suggestData:wn}]}}function _n(e,t){for(var n=-1,i=0;n<0&&i<e.length;i++)t(e[i])&&(
n=i);return n}function yn(e,t,n,i){for(var r=0;r<e.length;r++){var o=e[r];o[0]>n&&(n=o[0]),o[1]>i&&(i=o[1])}if(t)for(var a=0;a<t.length;a++){var l=t[a][0]+t[a][3]-1,s=t[a][1]+t[a][2]-1;n<l&&(n=l),i<s&&(i=s)}return[1*n,1*i]}function Cn(e,t,n){return(n=n?e._mData.getPage(n):e._mPage).serialize(t).map(function(e){return[++e[0],++e[1],e[2].value,e[2].style||"",e[2].type]}).filter(function(e){return e[2]||0===e[2]||e[3]})}var $n=Object.freeze({init:function Jo(o){o.attachEvent("onDataParse",function(e){return function r(a,l){var e=a.$$("cells"),t=l.table||{frozenColumns:0,frozenRows:0};a._frozenColumns=a._frozenRows=0,t&&(webix.isUndefined(t.frozenColumns)||a.freezeColumns(t.frozenColumns),webix.isUndefined(t.frozenRows)||a.freezeRows(t.frozenRows)),l.sizes&&e.define("fixedRowHeight",!1);for(var n=function(e){var t=$(l.data[e],5),n=t[0],i=t[1],r=t[2],o=t[4];a.ignoreUndo(function(){a.callEvent("onCellChange",[n,i,r,o])})},i=0;i<l.data.length;i++)n(i)}(o,e)}),o.attachEvent("onDataSerialize",function(e,t){return function a(e,t,n){var i=!n||!1!==n.math,r=e.$$("cells").getState(),o=r.ids.concat(r.hidden);o.splice(o.indexOf("rowId"),1),t.data=Cn(e,i),t.table={frozenColumns:e._frozenColumns||0,frozenRows:e._frozenRows||0}}(o,e,t)}),o.attachEvent("onUndo",function(e,t,n,i){"value"==e&&function r(e,t,n,i){e.setCellValue(t,n,i)}(o,t,n,i)})},getSheetData:Cn}),Sn=["rename-sheet","remove-sheet"],kn={"remove-sheet":function(e){e.confirm({text:webix.i18n.spreadsheet.labels["sheet-remove-confirm"]}).then(function(){Rn(e,e._activeSheet)})},"rename-sheet":function(e){In(e,e._activeSheet)},"new-sheet":function(e){zn(e)},"copy-sheet":function(e){!function t(e){zn(e,e.serialize())}(e)}};function En(t){t.attachEvent("onComponentInit",function(){return function e(t){Mn(t),t.$$("add-sheet")&&t.$$("add-sheet").attachEvent("onItemClick",function(){zn(t)});t.attachEvent("onAfterSheetShow",function(e){return function n(e,t){e.$$("sheets")&&(e.$$("sheets").select(t),e.$$("sheets").showItem(t))}(t,e)}),t.attachEvent("onCommand",function(e){kn[e.id]&&kn[e.id](this)}),t.$$("sheets")&&(t.$$("sheets").data.attachEvent("onStoreUpdated",function(){return function i(e){var t=e.$$("bottom-toolbar"),n=e.$$("sheets");n.count()<=n.config.width/e.config.sheetTabWidth?t.showBatch("pager",!1):t.showBatch("pager")}(t)}),t.$$("sheets").attachEvent("onAfterScroll",function(){return function r(e){var t=e.$$("sheets"),n=t.getScrollState().x;if(0==n)e.$$("prev-sheet").disable();else{e.$$("prev-sheet").enable();var i=e.config.sheetTabWidth;if(n==(t.count()-t.config.width/i)*i)return void e.$$("next-sheet").disable()}e.$$("next-sheet").enable()}(t)}),t.$$("sheets").attachEvent("onAfterDrop",function(e){return function o(e,t,n){for(var i in e._sheets)if(e._sheets[i].name==t){var r=e._sheets.splice(i,1);e._sheets.splice(n,0,r[0]);break}}(t,e.start,e.index)}),t.$$("sheets").attachEvent("onAfterEditStop",function(e){return Dn(t,e.old,e.value)}))}(t)})}function Vn(n){var t=n.config.readonly,e=n.config.sheetTabWidth,i={view:"toolbar",id:"bottom-toolbar",css:"webix_ssheet_bottom_toolbar webix_layout_toolbar",paddingY:0,height:34,elements:[{view:"button",type:"htmlbutton",width:34,id:"add-sheet",label:"<span class='webix_ssheet_icon_add_sheet'></span>",tooltip:webix.i18n.spreadsheet.tooltips["add-sheet"]||"",hidden:t},{id:"sheets",view:"sheets",width:5*e,editable:!t,editaction:"dblclick",editor:"text",editValue:"value",type:{width:e,height:32,template:function(e){return"<div>"+e.value+"</div>"+(t?"":"<div class='webix_input_icon wxi-menu-down webix_ssheet_sheet_arrow'></div>")},css:"ssheet_order_sheets"},onClick:{webix_ssheet_sheet_arrow:function(e,t){!function i(t,e,n){t.$sheetMenu||(t.$sheetMenu=webix.ui(function r(e){for(var t=[],n=0;n<Sn.length;n++)t.push({id:Sn[n],value:webix.i18n.spreadsheet.menus[Sn[n]]||Sn[n]});var i={view:"ssheet-suggest",data:t};return e.callEvent("onViewInit",["sheet-menu",i]),i}(t)),t._destroy_with_me.push(t.$sheetMenu),t.$sheetMenu.attachEvent("onItemClick",function(e){return function n(e,t){e.$sheetMenu.data.getMark(t,"webix_disabled")||kn[t](e)}(t,e)}))
;t.$sheetMenu.getItem("remove-sheet")&&(1==t.$$("sheets").count()?t.$sheetMenu.disableItem("remove-sheet"):t.$sheetMenu.enableItem("remove-sheet"));t.callEvent("onBeforeSheetMenu",[n])&&t.$sheetMenu.show(e)}(n,e,t)}},on:{onItemClick:function(e){e!=n._activeSheet&&n.showSheet(e)}}},{view:"button",type:"htmlbutton",width:34,id:"prev-sheet",disabled:!0,hidden:!0,label:"<span class='webix_icon wxi-menu-left'></span>",batch:"pager",click:function(){An(n,-1)}},{view:"button",type:"htmlbutton",width:34,id:"next-sheet",hidden:!0,label:"<span class='webix_icon wxi-menu-right'></span>",batch:"pager",click:function(){An(n,1)}}]};return n.callEvent("onViewInit",["bottom-toolbar",i]),i}function An(e,t){var n=e.$$("sheets");n.scrollTo(n.getScrollState().x+t*e.config.sheetTabWidth,0)}function zn(t,e){var n,i,r;return r=-1<(n=_n(t._sheets,function(e){return e.name==t._activeSheet}))?n+1:t._sheets.length,i=function o(e){var t=e._sheets.length+1;for(;Nn(e,webix.i18n.spreadsheet.labels.sheet+t);)t++;return webix.i18n.spreadsheet.labels.sheet+t}(t),e=e||{data:[]},t._sheets.splice(r,0,{name:i,content:e}),t.$$("sheets").add({id:i,value:i},r),t._mData.addPage(i),On(t,i,e),t.showSheet(i),t.callEvent("onSheetAdd",[i]),i}function In(e,t){e.$$("sheets").edit(t)}function Rn(e,t){var n,i;1<e._sheets.length&&(n=_n(e._sheets,function(e){return e.name==t}),e._sheets.splice(n,1),e._mData.removePage(t),e._sheets[n]||(n=0),i=e._sheets[n],e._activeSheet=null,e.$$("sheets")&&(e.$$("sheets").remove(t),e.$$("sheets").refresh()),e.showSheet(i.name),e.callEvent("onSheetRemove",[t]))}function Dn(e,t,n){if(t!=n){for(var i=1;!n||Nn(e,n);)n=webix.i18n.spreadsheet.labels.sheet+i,i++;n=n.replace(/[*?:[\]\\/]/g,"").substring(0,31);var r=Nn(e,t),o=e.$$("sheets");if(r.name=n,e._activeSheet==t&&(e._activeSheet=n),o)o.getItem(t).value=n,o.data.changeId(t,n),o.refresh(n);e._mData.renamePage(t,n),e.callEvent("onSheetRename",[t,n])}}function On(o,e,a){o.ranges.parse(a.ranges,e);var t=o._mData.getPage(e),n=webix.copy(a.data).map(function(e,t){var n=et(o,a,e),i=/^=link\(/i;"string"==typeof n.value&&i.test(n.value)&&(n.value=n.value.replace(i,"=HYPERLINK("));var r=a.data[t];return r[2]=n.value,r[3]=r[3]||"",r[4]=n.type,[--e[0],--e[1],{value:n.value,type:n.type,style:r[3],$format:n.$format}]});t.parse(n,!0)}function Mn(o,e){var a;e||(e={data:[]}),e.sheets||(e=Tn(e)),o._activeSheet="",o._sheets=e.sheets,o._mData=new t,e.sheets.forEach(function(e){o._mData.addPage(e.name)}),e.sheets.forEach(function(e,t){var n=o._mData.getPage(e.name),i=e.content,r=e.name;On(o,r,i),0==t&&(a=r,o._mPage=n)}),function r(e,t){var n=e.$$("sheets");if(n){n.clearAll();var i=[];t.sheets.forEach(function(e){i.push({id:e.name,value:e.name})}),n.parse(i)}}(o,e),Fn(o,a)}function Tn(e){return{sheets:[{name:webix.i18n.spreadsheet.labels.sheet+1,content:e}]}}function Fn(e,t){if(t!=e._activeSheet&&e.callEvent("onBeforeSheetShow",[t])){e._activeSheet&&(Nn(e,e._activeSheet).content=e.serialize()),e._activeSheet=t;var n=Nn(e,t).content;e._mPage=e._mData.getPage(t),Pn(e,n),e.callEvent("onAfterSheetShow",[t])}}function Nn(e,t){return function n(e,t){return e[_n(e,t)]}(e._sheets,function(e){return e.name==t})}function Pn(e,t){var n=$(yn(Cn(e),t.spans,e.config.rowCount,e.config.columnCount),2),i=n[0],r=n[1];e.callEvent("onReset",[]),i==e.config.rowCount&&r==e.config.columnCount||(e.config.rowCount=i,e.config.columnCount=r,e._resetTable()),e._loading_data=!0,e.callEvent("onDataParse",[t]),e._loading_data=!1,e._table.refresh(),e.config.bottombar&&e.$$("sheets").refresh()}var Un=function(){function t(e){l(this,t),this.view=e}return u(t,[{key:"$init",value:function(){}},{key:"$show",value:function(){}},{key:"$hide",value:function(){}},{key:"open",value:function(){var e=this;this.$dialog||(this.$dialog=webix.ui(this.$init()),this.view._destroy_with_me.push(this.$dialog),this.$dialog.attachEvent("onHide",function(){e.$hide(),webix.UIManager.setFocus(e.view)}),this.$dialog.attachEvent("onShow",function(){webix.UIManager.setFocus(e.$dialog)}));var t=this.$dialog.getBody();this.$dialog.show(),!1===this.$show(this.$dialog,t
)&&this.close()}},{key:"close",value:function(){this.$dialog.hide()}}]),t}();function jn(e){return e?('"'===(e=e.trim())[0]&&(e=e.substr(1)),'"'===e[e.length-1]&&(e=e.substr(0,e.length-1)),e):""}var Bn=function(e){function t(){return l(this,t),m(this,f(t).apply(this,arguments))}return d(t,Un),u(t,[{key:"$show",value:function(e,t){if(this.cell=this.view.getSelectedId(),!this.cell)return!1;t.elements.preview.setHTML(""),t.elements.url.setValue("");var n=function i(e){if(e&&0===e.indexOf("=IMAGE("))return{url:jn(e.substr(7,e.length-8))}}(this.view.getCellValue(this.cell.row,this.cell.column));n&&n.url&&t.elements.url.setValue(n.url),t.elements.url.focus()}},{key:"$init",value:function(){var t=this,e=this.view.config.save,n=e&&e.images||null;return{view:"ssheet-dialog",head:webix.i18n.spreadsheet.labels["image-title"],move:!0,position:"center",body:{view:"form",elements:[{view:"text",name:"url",placeholder:webix.i18n.spreadsheet.labels["image-url"],on:{onChange:function(e){return t.showPreview(e)}}},{view:"label",label:webix.i18n.spreadsheet.labels["image-or"],align:"center"},{view:"uploader",label:webix.i18n.spreadsheet.labels["image-upload"],upload:n,on:{onBeforeFileAdd:function(e){var t=this;if(!this.config.upload){var n=new FileReader;return n.onload=function(e){return t.getFormView().elements.url.setValue(e.target.result)},n.readAsDataURL(e.file),!1}this.getFormView().elements.preview.setHTML("")},onFileUpload:function(e,t){this.getFormView().elements.url.setValue(t.imageURL)}}},{view:"formlate",name:"preview",borderless:!0,css:"webix_ssheet_preview",template:"",height:50}]},on:{onSaveClick:function(){return t.okClick()},onCancelClick:function(){return t.close()}}}}},{key:"okClick",value:function(){var e=this.cell,t=this.fillUrl(this.$dialog.getBody().elements.url.getValue());this.view.addImage(e.row,e.column,t),this.close()}},{key:"fillUrl",value:function(e){return/^[/]|((https?:\/|data:image)\/)/i.test(e)||(e="http://"+e),e}},{key:"showPreview",value:function(e){e&&(e=webix.template.escape(this.fillUrl(e)),this.$dialog.queryView("form").elements.preview.setHTML("<img class='webix_ssheet_cimage' src='"+e+"'></img>"))}}]),t}(),Hn=Object.freeze({action:"add-image-cell",DialogBox:Bn}),Ln=function(e){function t(){return l(this,t),m(this,f(t).apply(this,arguments))}return d(t,Bn),u(t,[{key:"open",value:function(e){this.config=e.config,this.viewid=e.viewid,this.view.callEvent("onUIEditStart",[this.viewid,"image"]),Bn.prototype.open.apply(this,arguments)}},{key:"$hide",value:function(){this.view.callEvent("onUIEditStop",[this.viewid,"image"]),this.config=this.viewid=null}},{key:"$init",value:function(){var n=this;return this.view.attachEvent("onUIEditStart",function(e,t){n.$dialog&&n.$dialog.isVisible()&&"image"!=t&&n.close()}),this.view.attachEvent("onCommand",function(e){"close-ui-editor"==e.id&&n.$dialog&&n.$dialog.isVisible()&&n.close()}),Bn.prototype.$init.apply(this,arguments)}},{key:"$show",value:function(e,t){t.elements.preview.setHTML(""),t.elements.url.setValue(""),this.config&&this.config.data&&t.elements.url.setValue(this.config.data),t.elements.url.focus()}},{key:"okClick",value:function(){var e=this.fillUrl(this.$dialog.getBody().elements.url.getValue());if(this.viewid)this.view.views.update(this.viewid,e);else{var t=this.view.views.add(null,null,"image",e);this.view.views.highlight(t)}this.close()}}]),t}(),qn=Object.freeze({action:"add-image-top",DialogBox:Ln}),Wn=webix.i18n.spreadsheet.labels;var Kn=function(e){function t(){return l(this,t),m(this,f(t).apply(this,arguments))}return d(t,Un),u(t,[{key:"$show",value:function(e,t){if(this.cell=this.view.getSelectedId(),!this.cell)return!1;var r=t.elements;this.view.$handleSelection=function(e,t,n,i){return r.range.setValue(n+":"+i),!1},r.range.setValue("");var n=function i(e){if(e&&0===e.indexOf("=SPARKLINE(")){var t=e.substr(11,e.length-12).split(",");return{range:t[0],type:jn(t[1]),color:jn(t[2]),negativeColor:jn(t[3])}}}(this.view.getCellValue(this.cell.row,this.cell.column));n&&(t.blockEvent(),r.type.setValue(n.type),r.range.setValue(n.range),n.color&&(
r.color_def.setValue(n.color),r.color_pos.setValue(n.color)),n.negativeColor&&r.color_neg.setValue(n.negativeColor),t.unblockEvent(),this.renderPreview()),r.range.focus()}},{key:"$hide",value:function(){this.view.$handleSelection=null}},{key:"$init",value:function(){var e=this;return{view:"ssheet-dialog",head:Wn["sparkline-title"],move:!0,position:"center",body:{view:"form",visibleBatch:1,on:{onChange:function(){return e.renderPreview()}},elements:[{view:"richselect",name:"type",label:Wn["sparkline-type"],value:"line",labelPosition:"left",suggest:{view:"ssheet-form-suggest",data:function t(){return[{id:"line",value:Wn["line-chart"]},{id:"spline",value:Wn["spline-chart"]},{id:"splineArea",value:Wn["splinearea-chart"]},{id:"area",value:Wn["area-chart"]},{id:"bar",value:Wn["bar-chart"]},{id:"pie",value:Wn["pie-chart"]}]}()},on:{onChange:function(e){var t=this.getFormView();switch(e){case"pie":t.showBatch(3);break;case"bar":t.showBatch(2);break;default:t.showBatch(1)}}}},{view:"text",label:Wn["sparkline-range"],name:"range"},{view:"ssheet-colorpicker",label:Wn["sparkline-color"],name:"color_def",id:"add_sparkline_color",value:"#6666FF",batch:"1"},{view:"ssheet-colorpicker",label:Wn["sparkline-positive"],name:"color_pos",value:"#6666FF",batch:"2"},{view:"ssheet-colorpicker",label:Wn["sparkline-negative"],name:"color_neg",value:"#FF6666",batch:"2"},{view:"formlate",name:"preview",borderless:!0,css:"webix_ssheet_preview",height:50}]},on:{onSaveClick:function(){return e.okClick()},onCancelClick:function(){return e.close()}}}}},{key:"checkRange",value:function(e){if(e&&z(e,this.view))return!0;this.view.alert({text:Wn["error-range"]})}},{key:"okClick",value:function(){var e=this.$dialog.getBody().getValues();if(e.range=e.range.toUpperCase(),e.range&&this.checkRange(e.range)){var t=this.sparkConfig(e);this.view.addSparkline(this.cell.row,this.cell.column,t),this.close()}}},{key:"renderPreview",value:function(){var e=this.$dialog.getBody(),t=e.getValues();if(t.range=t.range.toUpperCase(),t.range&&this.checkRange(t.range)){var n,i=z(t.range,this.view),r=this.view._mPage.getRange(i[0]-1,i[1]-1,i[2]-1,i[3]-1),o=this.sparkConfig();for(n=0;n<r.length;n++)r[n]=r[n]||0;e.elements.preview.setValue(webix.Sparklines.getTemplate(o)(r,{width:200,height:40}))}else e.elements.preview.setValue("")}},{key:"sparkConfig",value:function(e){var t=this.$dialog.getBody(),n=t.getValues();return e=e||{type:n.type},"bar"===n.type?(e.color=n.color_pos,e.negativeColor=n.color_neg):t.elements.color_def.isVisible()&&(e.color=n.color_def),e}}]),t}(),Gn=Object.freeze({action:"add-sparkline",DialogBox:Kn}),Yn=function(e){function t(){return l(this,t),m(this,f(t).apply(this,arguments))}return d(t,Un),u(t,[{key:"$show",value:function(e){var o=this,a=e.$$("form");a.clear(),a.clearValidation(),a.elements.name.focus();var t=this.view.getSelectedRange();t&&(t=this.view.getActiveSheet()+"!"+t),a.setValues({range:t,scope:"$global"}),this._updateData(),this.view._rangeDialog=!0,this.view.$handleSelection=function(e,t,n,i){return a.elements.range.setValue(function r(e,t,n){return(n?I(n)+"!":"")+e+":"+t}(n,i,o.view.getActiveSheet())),!1}}},{key:"$hide",value:function(){this.view.$handleSelection=null,this.view._rangeDialog=null}},{key:"saveClick",value:function(){var e=this.view,t=this.$dialog.$$("form"),n=t.getValues();if(n.range){var i=n.range.split("!");1==i.length&&i.unshift(e.getActiveSheet()),n.range=i[0]+"!"+i[1].toUpperCase()}if(n.name=n.name.toUpperCase(),t.setValues(n),t.validate()){var r=this.$dialog.$$("table");if(n.id){var o=r.getItem(n.id);e.ranges.remove(o.name,this._getScope(o)),r.updateItem(n.id,n)}else r.add(n);e.ranges.add(n.name,n.range,this._getScope(n)),e.refresh(),r.unselect(),t.setValues({scope:"$global"})}}},{key:"_getScope",value:function(e){return"$global"==e.scope||e.scope}},{key:"removeRange",value:function(n){var i=this,r=this.view;r.confirm({text:webix.i18n.spreadsheet.labels["range-remove-confirm"]}).then(function(){var e=i.$dialog.$$("table"),t=e.getItem(n);r.ranges.remove(t.name,i._getScope(t)),r.refresh(),e.remove(n)})}},{key:"editRange",
value:function(e){var t=this.$dialog.$$("form"),n=this.$dialog.$$("table");t.clearValidation();var i=webix.copy(n.getItem(e));t.setValues(i)}},{key:"$init",value:function(){var n=this;this.view.attachEvent("onSheetRename",function(e,t){return n._updateData(e,t)}),this.view.attachEvent("onSheetRemove",function(e){return n._updateData(e)}),this.view.attachEvent("onSheetAdd",function(){return n._updateData()});var t=webix.i18n.spreadsheet.labels,e={padding:0,type:"clean",cols:[{view:"ssheet-dialog-table",id:"table",borderless:!0,columns:[{id:"name",header:t["range-name"],width:120},{id:"range",header:t["range-cells"],width:150},{id:"scope",header:t["range-scope"],width:95,template:function(e){return"$global"==e.scope?t["range-global"]:e.scope}},{template:"<span class='webix_icon ssheet_ranges_edit wxi-pencil'></span>",width:44},{template:"<span class='webix_icon ssheet_ranges_edit wxi-trash'></span>",width:44}],autowidth:!0,height:200,select:"row",on:{onBeforeSelect:function(e){return e==n.$dialog.$$("form").getValues().id}},onClick:{"wxi-trash":function(e,t){return n.removeRange(t)},"wxi-pencil":function(e,t){return n.editRange(t)}}},{width:270,view:"form",id:"form",rules:{name:function(e,t){return!n.$dialog.$$("table").find(function(e){return e.name==t.name&&e.scope==t.scope&&e.id!=t.id},!0)&&!Ge(t.name)},range:T,scope:webix.rules.isNotEmpty},elementsConfig:{labelWidth:95},elements:[{view:"text",name:"name",label:t["range-name"]},{view:"text",name:"range",id:"range",label:t["range-cells"],on:{onFocus:function(){var e=n.$dialog.$$("range").getValue().split("!");2==e.length&&n.view.getActiveSheet()!=e[0]&&n.view.showSheet(e[0])}}},{view:"richselect",name:"scope",id:"sheets",label:t["range-scope"],suggest:{view:"ssheet-form-suggest",body:{data:[]}}}]}]};return{view:"ssheet-dialog",move:!0,head:webix.i18n.spreadsheet.labels["range-title"],autoheight:!0,width:800,position:"center",body:e,on:{onSaveClick:function(){return n.saveClick()},onCancelClick:function(){return n.close()}}}}},{key:"_updateData",value:function(e,t){if(this.$dialog.isVisible()){var n=this.view._mData.getRanges(),i=webix.i18n.spreadsheet.labels,r=this.$dialog.$$("table"),o=this.$dialog.$$("form"),a=r.getItem(o.getValues().id);if(a){var l=a.name;a=(l=e==a.scope?t?t+"!"+l:null:a.scope+"!"+l)?n.get(l):null}r.clearAll();for(var s,c=n.serialize(),u=[],h=0;h<c.length;h++){var d=h+1,f=$(c[h],2),g=f[0],v=f[1];a&&n.get(g)==a&&(s=d);var m=g.split("!");u.push({scope:1==m.length?"$global":m[0],name:m[1]||m[0],range:v,id:d})}r.parse(u),o.setValues({id:s},!0),s&&r.select(s);var p=this.$dialog.$$("sheets"),w=p.getList();w.clearAll();var b=[{id:"$global",value:i["range-global"]}];if(this.view._sheets.forEach(function(e){b.push({id:e.name,value:e.name})}),w.parse(b),e){var x=(v=this.$dialog.$$("range")).getValue();t=t||this.view.getActiveSheet(),0==x.indexOf(e+"!")&&v.setValue(t+"!"+x.split("!")[1]),p.getValue()==e&&p.setValue(t)}}}}]),t}(),Xn=Object.freeze({action:"add-range",DialogBox:Yn}),Zn=function(e){function t(){return l(this,t),m(this,f(t).apply(this,arguments))}return d(t,Un),u(t,[{key:"$show",value:function(){var r=this.$dialog.$$("form");if(this.cell=this.view.getSelectedId(!0),!this.cell.length)return!1;r.clear();var e=this.view.getCellEditor(this.cell[0].row,this.cell[0].column);e&&e.options&&r.elements.range.setValue(e.options),this.view.$handleSelection=function(e,t,n,i){return r.elements.range.setValue(n+":"+i),!1},r.elements.range.focus()}},{key:"$hide",value:function(){this.view.$handleSelection=null}},{key:"$init",value:function(){var e=this;return{view:"ssheet-dialog",position:"center",head:webix.i18n.spreadsheet.labels["dropdown-title"],move:!0,body:{padding:0,view:"form",id:"form",rows:[{view:"text",label:webix.i18n.spreadsheet.labels["dropdown-range"],name:"range"}]},on:{onSaveClick:function(){return e.okClick()},onCancelClick:function(){return e.close()}}}}},{key:"okClick",value:function(){var t=this.$dialog.$$("form").elements.range.getValue();t?z(t,this.view)?(w.set(function(){for(var e=0;e<this.cell.length;e++)this.view.setCellEditor(
this.cell[e].row,this.cell[e].column,{editor:"ss_richselect",options:t})},this),this.close()):this.view.alert({text:webix.i18n.spreadsheet.labels["error-range"]}):this.close()}}]),t}(),Qn=Object.freeze({action:"add-dropdown",DialogBox:Zn}),Jn=function(){function t(e){l(this,t),this._master=e}return u(t,[{key:"clear",value:function(t){var n=this,e="string"==typeof t?t:this._master.getActiveSheet();this.serialize(e).forEach(function(e){!0!==t?n.remove(e[0],t):e[2]&&n.remove(e[0],t)})}},{key:"_normalizeName",value:function(e,t){return!0!==t&&(e=(t||this._master.getActiveSheet())+"!"+e),e}},{key:"_normalizeRange",value:function(e,t){return 1==e.split("!").length&&(e=("string"==typeof t?t:this._master.getActiveSheet())+"!"+e),e}},{key:"add",value:function(e,t,n){var i=this._master;i.callEvent("onAfterRangeSet",[e,t,n]),e=this._normalizeName(e,n),i._mData.getRanges().add(e,this._normalizeRange(t,n)),i.callEvent("onMathRefresh",[])}},{key:"getCode",value:function(e,t){e=this._normalizeName(e,t);var n=this._master._mData.getRanges().get(e);if(n)return n.source}},{key:"remove",value:function(e,t){e=this._normalizeName(e,t),this._master._mData.getRanges().remove(e),this._master.callEvent("onMathRefresh",[])}},{key:"parse",value:function(e,t){if(e)for(var n=0;n<e.length;n++){var i=this._master._mData.getRanges(),r=$(e[n],3),o=r[0],a=r[1],l=r[2];o=this._normalizeName(o,l||t),i.get(o)||i.add(o,this._normalizeRange(a,t))}}},{key:"serialize",value:function(e){e=e||this._master.getActiveSheet();for(var t=this._master._mData.getRanges().serialize(),n=[],i=0;i<t.length;i++){var r=t[i],o=r[0].split("!"),a=1==o.length;(a||o[0]==e)&&n.push([o[a?0:1],r[1],a])}return n}},{key:"getRanges",value:function(e){return this.serialize(e).map(function(e){return{name:e[0],range:e[1],global:e[2]}})}}]),t}();function ei(o,e,t){var n=[];if("string"==typeof e){var i=z(e,o);if(i){var r=o._mPage;i[4]&&(r=o._mData.getPage(i[4])),n=r?function d(e,t,n,i,r){for(var o=[],a=e._mPage===this,l=t-1;l<=i-1;l++)for(var s=n-1;s<=r-1;s++){var c=this.getCell(l,s),u=void 0;u=c?webix.copy(c):{value:""},a?u.$value=dn(e,{id:l+1},0,0,{id:s+1},!0):delete u.format,u.id=u.value,o.push(u)}return o}.apply(r,[o].concat(p(i))):[]}}else if(webix.isArray(e))for(var a=0;a<e.length;a++){var l=e[a]||0===e[a]?e[a]:"";l="object"===g(l)?webix.copy(l):{id:l,value:l},n.push(l)}if(t){if(t.unique)for(var s={},c=n.length-1;0<=c;c--)s[n[c].id]?n.splice(c,1):s[n[c].id]=!0;for(var u=!1,h=n.length-1;0<=h;h--)n[h].value=String(n[h].value),""===n[h].value&&(n.splice(h,1),u=!0);t.order&&n.sort(function(e,t){var n=o.$$("cells").data.sorting.as,i=e.value,r=t.value;return webix.rules.isNumber(i)&&webix.rules.isNumber(r)?n["int"](i,r):n.string(i,r)}),u&&t.filter&&n.unshift(function f(){return{id:"$empty",value:"",$value:"<span class='webix_ssheet_empty'>"+webix.i18n.spreadsheet.labels["dropdown-empty"]+"</span>"}}()),t.empty&&n.unshift({id:"$empty",$empty:!0,value:""})}return n}var ti=Object.freeze({init:function ea(t){t.ranges=new Jn(t),t.attachEvent("onDataSerialize",function(e){e.ranges=t.ranges.serialize()})},rangeOptions:ei});function ni(e){e._table._ssFilters={},si(e)}function ii(e){var t=e._ssFilters,n=[];for(var i in t)for(var r in t[i])n.push(t[i][r]);return n}function ri(e,t){var i=!1;O(t,e,function(e,t){var n=e._table._ssFilters[t.row];n&&n[t.column]&&(i=!0,delete n[t.column],e._table.removeCellCss(t.row,t.column,"ss_filter"),e._table.removeCellCss(t.row,t.column,"ss_filter_active"),Bt(e,t.row,t.column,"ss_filter",!1),Bt(e,t.row,t.column,"ss_filter_active",!1))}),i&&e.filterSpreadSheet()}function oi(e,t,n,i){(i||(i={end:{row:t}}),i.end)&&(i=function r(e,t,n,i){if(t===i)for(i=t;i<e.config.rowCount&&e.getCellValue(i+1,n);i++);return R(t+1,n,i,n)}(e,t,n,i.end.row));return i}function ai(e){return!!(e.includes||e.condition&&e.condition.filter)}function li(e){var t=e._table._ssFilters;for(var n in t)for(var i in t[n])if(t[n][i])return!0;return!1}function si(e){var t=li(e);e.callEvent("onCommand",[{id:"toolbar-update",name:"create-filter",value:t}])}function ci(e,t,n){for(
var i=t+1;i<e.config.rowCount;i++){var r=e.getCellValue(i,n);if(r||0===r){var o=it(e,i,n);return"number"==o||"date"==o?o:"text"}if(""!==r)break}return"text"}function ui(e,t,n,i,r,o){var a=t.filter;a.options=F(a.options,"row",o.row,{column:t.col,row:t.row}),a.options=F(a.options,"column",o.column,{column:t.col,row:t.row}),delete a.value,delete a.handler,e.setCellFilter(n,i,a)}function hi(e,t){for(var n=Xt[e],i=0;i<n.length;i++)if(n[i].id==t)return n[i]}function di(e){return webix.copy(Xt[e])}function fi(e,t){var n=t.includes,i=t.condition,r=hi(e,i.type),o=r?r.handler:function(){return!0};if(n)for(var a=0;a<n.length;a++)n[a]=String(n[a]);return function(e){return n?-1!==n.indexOf(e):""===i.filter||o(e,i.filter)}}var gi=Object.freeze({init:function ta(l){var s=l._table;l.attachEvent("onReset",function(){return ni(l)}),ni(l),s.on_click.ssheet_filter_sign=function(e,t){var n=s._ssFilters[t.row][t.column],i=n.mode||ci(l,t.row,t.column),r=[];n.options&&("string"==typeof n.options?r=ei(l,n.options,{unique:!0,order:!0,filter:!0}):webix.isArray(n.options)&&(r=ei(l,n.options,{filter:!0}))),l.callEvent("onCommand",[{id:"start-filter",cell:t,mode:i,options:r,filter:n}])},s.on_dblclick.ssheet_filter_sign=function(){return!1},l.attachEvent("onCommand",function(e){"create-filter"===e.id&&function t(n){var i=n._table.getSelectArea();li(n)?(w.set(function(){n.removeFilters()}),i&&n._table.addSelectArea(i.start,i.end)):i&&w.set(function(){for(var e=i.start.row,t=i.start.column;t<=i.end.column;t++)n.setCellFilter(e,t,{options:i})}),si(n)}(l)});var c=!1;l.attachEvent("onUndo",function(e,t,n,i){if("filter"==e)i="object"==g(i)?i:null,l.setCellFilter(t,n,i),c=!0;else if("apply-filter"==e){var r=l.getCellFilter(t,n);if(r.value=i,delete r.handler,i&&i.condition){var o=r.mode||ci(l,t,n);r.handler=fi(o,r.value)}c=!0;var a=i&&ai(i);s[a?"addCellCss":"removeCellCss"](t,n,"ss_filter_active"),Bt(l,t,n,"ss_filter_active",a)}}),l.attachEvent("onAfterUndo",function(){c&&(l.filterSpreadSheet(),c=!1)}),l.attachEvent("onAction",function(e,t){"filter"==e?(Bt(l,t.row,t.column,"ss_filter",t.newValue),Bt(l,t.row,t.column,"ss_filter_active",t.newValue&&t.newValue.value&&ai(t.newValue.value)),si(l)):"before-grid-change"==e&&function h(e,t,n,i,r){var o=i.filters;if(n)for(var a=o.length-1;0<=a;a--){var l=$(o[a],3),s=l[0],c=l[1],u=l[2];if("row"==t&&s>=r.row||"column"==t&&c>=r.column){if("row"==t){if(s<r.row-n){o.splice(a,1);continue}o[a][0]=1*s+n}else if("column"==t){if(c<r.column-n){o.splice(a,1);continue}o[a][1]=1*c+n}u.options=F(u.options,t,n,r)}}}(0,t.name,t.inc,t.data,t.start)})},getFilters:ii,serialize:function na(e,t){for(var n=ii(e._table),i=t.filters=[],r=0;r<n.length;r++){var o=n[r],a=o.row,l=o.column,s=o.options,c=o.mode,u=o.value;u=u&&webix.copy(u),i.push([a,l,{value:u,options:s,mode:c}])}},load:function ia(e,t){var n=t.filters;if(n){for(var i=0;i<n.length;i++)e.setCellFilter(n[i][0],n[i][1],n[i][2]||{options:""});e.filterSpreadSheet()}},clearFilters:ri,isFilter:function ra(e,t,n){var i=e._table._ssFilters;return i[t]&&!!i[t][n]},calibrateRange:oi,isValueActive:ai,getFilterMode:ci,pasteFilter:ui,getSingleOption:hi,getConditions:di,getFilterFunction:fi}),vi=function(e){function t(){return l(this,t),m(this,f(t).apply(this,arguments))}return d(t,Un),u(t,[{key:"open",value:function(e){var t=this;if(this.cell=e.cell,this.$mode=e.mode,this.$filter=e.filter,!this.cell||this.view.isCellLocked(this.cell.row,this.cell.column))return!1;if(!this.$dialog){this.$dialog=webix.ui(this.$init()),this.view._destroy_with_me.push(this.$dialog),this.$dialog.attachEvent("onHide",function(){return t.$hide()});var n=this.view.$$("cells");n.attachEvent("onScrollY",function(){return t.syncScroll()}),n.attachEvent("onScrollX",function(){return t.syncScroll()})}if(!1===this.$show(this.$filter.value,e.options))return this.close();this.$dialog.show(this._getTargetNode())}},{key:"_getTargetNode",value:function(){var e=this.view.$$("cells");return e.getSpan(this.cell.row,this.cell.column)?e.getSpanNode(this.cell):e.getItemNode(this.cell)}},{key:"$show",value:function(e,t){
var n=this.getList(),i=this.getFilter();i.config.mode!==this.$mode&&(i.define("conditions",this.getConditions(this.$mode)),i.define("mode",this.$mode));var r=e&&e.conditions&&e.conditions.type;r&&!hi(this.$mode,r)&&(e=""),n.clearAll(),n.data.importData(t),i.config.value="",i.setValue(webix.copy(e||{}))}},{key:"$init",value:function(){var e=this,t=webix.i18n.spreadsheet.labels;return{view:"popup",css:"ssheet_filter",padding:7,relative:"right",body:{margin:4,rows:[{view:"filter",field:"value",mode:"text",conditions:this.getConditions("text"),inputs:["text",{view:"ssheet-datepicker",timepicker:!0,batch:"datepicker",on:{onChange:function(){return e.getFilter().applyFilter()}}},{view:"ssheet-daterangepicker",timepicker:!0,batch:"daterangepicker",on:{onChange:function(){return e.getFilter().applyFilter()}}}],template:function(e){return e.$value||e.value}},{cols:[{},{view:"button",label:t.cancel,autowidth:!0,css:"webix_transparent",on:{onItemClick:function(){return e.close()}}},{view:"button",label:t.apply,autowidth:!0,css:"webix_secondary",on:{onItemClick:function(){return e.applyFilter()}}}]}]}}}},{key:"applyFilter",value:function(){var e=this.getFilter(),t=this.$filter.value,n=this.$filter.value=e.getValue();this.$filter.handler=fi(this.$mode,n),this.view.filterSpreadSheet(),this.view.callEvent("onAction",["apply-filter",{row:this.cell.row,column:this.cell.column,value:t,newValue:n}]),this.setCellStyle(this.cell.row,this.cell.column,"ss_filter_active",ai(n)),this.close()}},{key:"setCellStyle",value:function(e,t,n,i){var r=this.view.$$("cells"),o=this.getSpan(r,e,t);o&&(i?-1==o[3].indexOf(n)&&(o[3]+=" "+n):o[3]=o[3].replace(" "+n,"")),r[i?"addCellCss":"removeCellCss"](e,t,n)}},{key:"getSpan",value:function(e,t,n){var i=e.getSpan()[t];if(i)return i[n]}},{key:"getList",value:function(){return this.getFilter().getChildViews()[2]}},{key:"getFilter",value:function(){return this.$dialog.getBody().getChildViews()[0]}},{key:"syncScroll",value:function(){if(this.$dialog.isVisible()){var e=this._getTargetNode(),t=this.view.$$("cells"),n=!1;if(e){var i=webix.html.offset(e),r=webix.html.offset(t.$view.getElementsByClassName("webix_ss_body")[0]),o=i.y-r.y,a=i.x-r.x+i.width;n=o<0||o+i.height>r.height||a<0||a-i.width>r.width-webix.env.scrollSize}!e||n?this.$dialog.show({x:-9999,y:-9999}):this.$dialog.show(e)}}},{key:"getConditions",value:function(e){for(var t=webix.i18n.filter,n=di(e),i=0;i<n.length;i++)n[i].id&&(n[i].value=t[n[i].id]);return n}}]),t}(),mi=Object.freeze({action:"start-filter",DialogBox:vi}),pi=function(e){function t(){return l(this,t),m(this,f(t).apply(this,arguments))}return d(t,Un),u(t,[{key:"$show",value:function(){if(this.form=this.$dialog.$$("form"),this.list=this.$dialog.$$("list"),this.preview=this.$dialog.$$("preview"),this.cell=this.view.getSelectedId(!0),!this.cell.length)return!1;this.fillForm(this.view),this.view.$handleSelection=function(){return!1}}},{key:"$hide",value:function(){this.view.$handleSelection=null}},{key:"$init",value:function(){var r=this,t=webix.i18n.spreadsheet,e=t.labels,n=t.formats,i=pe("int"),o=[{name:"zeros",view:"counter",css:"webix_ssheet_counter",label:e["decimal-places"],value:0,batch:"common"},{name:"separator",view:"checkbox",label:e.separator,batch:"common"},{view:"richselect",name:"symbol",label:e["currency-symbol"],options:ve,batch:"common"},{view:"formlist",label:e.negative,height:160,name:"negative",batch:"common",css:"webix_ssheet_format_negative",template:function(e){if(r.list){var t=r.getFormat(e.id),n={css:""},i=(t=$e(t.fmt,t.delimiters))(-1234.56789,n);return"<span class='"+n.css+"'>"+i+"</span>"}},data:[{id:1},{id:2},{id:3},{id:4}]}],a=[{view:"text",label:e["format-pattern"],name:"format",labelPosition:"top",batch:"custom",placeholder:"[>100]0"+i.groupSign+"000"+i.decimalSign+"00;[>0]None"},{id:"docs",template:"<a href='https://webix-guides.gitbook.io/spreadsheet-user-guide/formatting_numbers#custom-number-format' target='_blank' class = 'docs'>"+e["format-docs"]+"</a>",borderless:!0,batch:"custom"}],l=[{name:"date",batch:"date",view:"formlist",labelWidth:90,height:160,
label:e["date-format"],css:"webix_ssheet_format_date",template:function(e){return $e(e.value,i)(45e3)},data:[n.dateFormat,n.timeFormat,n.fullDateFormat,n.longDateFormat]}];return{view:"ssheet-dialog",position:"center",width:460,head:e["format-title"],move:!0,body:{padding:0,cols:[{view:"list",id:"list",css:"webix_ssheet_format_type",width:120,scroll:!1,data:this.getFormats(),select:!0,on:{onSelectChange:function(e){switch(r.updateForm(),e[0]){case"custom":case"date":r.form.showBatch(e[0]);break;default:var t=r.form.elements;r.form.showBatch("common"),t.separator["percent"==e[0]?"hide":"show"](),t.symbol["price"==e[0]?"show":"hide"]()}}}},{view:"form",id:"form",height:340,paddingY:0,paddingX:20,elements:[{id:"preview",template:function(e){return e.value==t.table["format-error"]?e.value:"<span class ='"+e.css+"'>"+e.value+"</span>"},css:"webix_ssheet_format_preview",autoheight:!0,borderless:!0}].concat(o,a,l),elementsConfig:{labelWidth:140},on:{onChange:function(){return r.updateForm()}}}]},on:{onSaveClick:function(){return r.okClick()},onCancelClick:function(){return r.closeWin()}}}}},{key:"okClick",value:function(){var t=this,e=this.list.getSelectedId(),n="custom"==e?{format:this.form.getValues().format}:this.form.getValues();n.type=e,w.set(function(){for(var e=0;e<t.cell.length;e++)_e(t.view,t.cell[e].row,t.cell[e].column,n.format,n)}),this.view.$$("cells").refresh(),this.closeWin()}},{key:"closeWin",value:function(){var e=G(this.view,this.cell[0].row,this.cell[0].column)||"common";De(e)||this.view.callEvent("onCommand",[{id:"toolbar-update",name:"format",value:e}]),this.close()}},{key:"getFormat",value:function(e){var t=this.list.getSelectedId(),n=this.form.getValues();return n.negative=e||n.negative,"custom"!=t?("date"!=t&&(n.date=""),{fmt:Me(n=Oe(t,n)),delimiters:pe(t)}):{fmt:n.format,delimiters:pe(t)}}},{key:"fillForm",value:function(e){var t,n=webix.i18n.spreadsheet,i=G(e,this.cell[0].row,this.cell[0].column),r={zeros:0,separator:0,negative:1,date:n.formats.dateFormat,symbol:ve[0].value,format:""},o=i||"";r.format=be(o||"price"),"custom"!=(t=o?"string"==o?o="custom":ge[o].values.type:o="price")&&webix.extend(r,ge[o].values,!0);var a=this.view.$$("cells").getItem(this.cell[0].row),l=this.cell[0].column;this.value=webix.isUndefined(a[l])?"":a[l],this.form.setValues(r),this.list.select(t),this.updateForm()}},{key:"updateForm",value:function(){var e=this.form.elements,t=this.getFormat(),n=this.value,i=""===n||isNaN(n);je(t,"date")&&(i||He(n))?n=45e3:i&&!je(t,"string")&&(n=1234.56789);var r={css:""};n=$e(t.fmt,t.delimiters)(n,r),this.preview.parse({value:n,css:r.css}),e.negative.refresh(),e.date.refresh(),e.format.setValue(t.fmt)}},{key:"getFormats",value:function(){var e=webix.i18n.spreadsheet.labels;return[{id:"price",value:e.currency},{id:"int",value:e.number},{id:"percent",value:e.percent},{id:"date",value:e.date},{id:"custom",value:e["custom-format"]}]}}]),t}(),wi=Object.freeze({action:"custom",DialogBox:pi});var bi=function(e){function t(){return l(this,t),m(this,f(t).apply(this,arguments))}return d(t,Un),u(t,[{key:"_rulesToArr",value:function(){var e=this.view.conditions.handlers;return[{value:webix.i18n.spreadsheet.labels.common,disabled:!0,$css:"webix_ssheet_cformats_type"}].concat(p(e.date),[{value:webix.i18n.spreadsheet.labels.text,disabled:!0,$css:"webix_ssheet_cformats_type"}],p(e.text)).map(function(e){return e.value||(e.value=webix.i18n.filter[e.id]),e})}},{key:"_getCondition",value:function(){var r=this,e=this.view,t=this.$dialog.getBody().getChildViews()[0].getChildViews(),o=[];t.forEach(function(e){if(e.getValues){var t=e.getValues(),n=[];n.push(t.condition),"between"!=t.condition&&"notBetween"!=t.condition?n.push(r._normalizeValue(t.value,t.condition)):n.push([r._normalizeValue(t.value,t.condition),r._normalizeValue(t.value2,t.condition)]),n.push(t.style);for(var i=0;i<n.length;i++)if(""===n[i]||webix.isArray(n[i])&&-1!=n[i].indexOf(""))return!1;o.push(n)}}),e.callEvent("onConditionSet",[o])}},{key:"_safeInt",value:function(e){var t=parseFloat(e);return t==e?t:e}},{key:"_setCondition",value:function(
){var i=this,e=this.view.conditions.get(this.cell.row,this.cell.column);if(e){var r=this.$dialog.getBody().getChildViews()[0].getChildViews();e.forEach(function(e,t){var n={};n.condition=e[0],webix.isArray(e[1])?(n.value=i._formatValue(e[1][0],n.condition),n.value2=i._formatValue(e[1][1],n.condition)):n.value=i._formatValue(e[1],n.condition),n.style=e[2],r[t+1].setValues(n)})}}},{key:"_formatValue",value:function(e,t){return t&&this._isNotDateRule(t)||!this.editFormat||""===e||"="==e[0]?e.toString():(e=x(e),this.editFormat(e))}},{key:"_normalizeValue",value:function(e,t){this._isNotDateRule(t)||(this.editFormat?isNaN(e)?"="!=e[0]&&(e=webix.Date.strToDate(webix.i18n.spreadsheet.formats.parseDateTime)(e),e=isNaN(e)?"":c(e)):e=He(e)?"":e:e=this._safeInt(e,10));return e}},{key:"_clean",value:function(){this.$dialog.getBody().getChildViews()[0].getChildViews().forEach(function(e){e.setValues&&e.setValues({condition:"",value:"",value2:"",style:""})})}},{key:"_isNotDateRule",value:function(t){return"equal"!=t&&"notEqual"!=t&&this.view.conditions.handlers.text.find(function(e){return e.id==t})}},{key:"okClick",value:function(){this._getCondition(),this.close()}},{key:"$show",value:function(){var r=this;if(this.cell=this.view.getSelectedId(),!this.cell)return!1;var t=it(this.view,this.cell.row,this.cell.column);"date"==t&&(this.editFormat=Le(this.view,this.cell.row,this.cell.column)),this.$dialog.queryView("text","all").forEach(function(e){e.define({placeholder:"date"==t?r._formatValue(45e3):""}),e.refresh()}),this.view.$handleSelection=function(e,t,n,i){return r.activeValue&&n==i&&r.activeValue.setValue("="+n),!1},this._setCondition()}},{key:"$hide",value:function(){this.view.$handleSelection=null,delete this.editFormat,this._clean()}},{key:"getRows",value:function(e,t){for(var i=this,r=this,n=[{height:36,padding:{left:12},cols:[{view:"label",width:131,label:webix.i18n.spreadsheet.labels.display},{view:"label",width:161,label:webix.i18n.spreadsheet.labels.condition},{view:"label",label:webix.i18n.spreadsheet.labels.value}]}],o={view:"form",padding:0,borderless:!0,css:"webix_ssheet_cformats",elements:[{margin:10,cols:[{view:"richselect",name:"style",width:120,placeholder:webix.i18n.spreadsheet.labels["conditional-style"],css:"webix_ssheet_cformat_select",suggest:{padding:0,borderless:!0,css:"webix_ssheet_cformat_list",body:{template:function(e){var t="webix_ssheet_cformat "+e.css;return'<div class="'.concat(t,'">').concat(e.name,"</div>")},data:e}}},{view:"richselect",width:150,name:"condition",placeholder:webix.i18n.spreadsheet.labels["conditional-operator"],on:{onChange:function(e){var t=this.getFormView().elements;if(r.editFormat){if(r._isNotDateRule(e))t.value.define({placeholder:""});else{var n=r._normalizeValue(t.value.getValue(),e);t.value.setValue(r._formatValue(n,e)),t.value.define({placeholder:r._formatValue(45e3)})}t.value.refresh()}"between"==e||"notBetween"==e?t.value2.show():t.value2.hide()}},suggest:{view:"ssheet-form-suggest",body:{data:this._rulesToArr()}}},{cols:[{view:"text",on:{onFocus:function(e){i.activeValue=e},onBlur:function(e){var t=e.getValue();if(""!==t){var n=e.getFormView().elements.condition.getValue();t=i._normalizeValue(t,n),e.setValue(i._formatValue(t,n))}}},name:"value"},{view:"text",name:"value2",on:{onFocus:function(e){i.activeValue=e},onBlur:function(e){var t=e.getValue();if(""!==t){var n=e.getFormView().elements.condition.getValue();t=i._normalizeValue(t,n),e.setValue(i._formatValue(t,n))}}},hidden:!0}]},{view:"icon",css:"webix_ssheet_cformat_clear",icon:"wxi-trash",click:function(){this.getFormView().clear()}}]}]};t--;)n.push(o);return n}},{key:"$init",value:function(){var e=this,t=webix.skin.$active.layoutMargin.form;return{view:"ssheet-dialog",head:webix.i18n.spreadsheet.labels["conditional-format"],position:"center",width:770,move:!0,margin:t,body:{view:"form",padding:0,borderless:!0,rows:this.getRows(function n(e){return e.map(function(e){return e.id=e.css,e})}(this.view.config.conditionStyle),3)},on:{onSaveClick:function(){return e.okClick()},onCancelClick:function(){return e.close()}}
}}}]),t}(),xi=Object.freeze({action:"conditional-format",DialogBox:bi}),_i=function(e){function t(){return l(this,t),m(this,f(t).apply(this,arguments))}return d(t,Un),u(t,[{key:"$show",value:function(e,t){this.view.$handleSelection=function(){return!1},t.elements.sheets.setValue(this.getSheets()),t.elements.filename.setValue("Data"),t.elements.filename.getInputNode().select()}},{key:"$hide",value:function(){this.view.$handleSelection=null}},{key:"$init",value:function(){var e=this;return{view:"ssheet-dialog",head:webix.i18n.spreadsheet.labels["export-title"],move:!0,position:"center",body:{view:"form",elements:[{view:"text",name:"filename",placeholder:webix.i18n.spreadsheet.labels["export-name"]},{view:"multicheckbox",name:"sheets"}]},on:{onSaveClick:function(){return e.okClick()},onCancelClick:function(){return e.close()}}}}},{key:"getSheets",value:function(){for(var e=this.view,t=e._sheets,n=[],i=0;i<t.length;i++)n.push({name:t[i].name,active:e._activeSheet===t[i].name?1:0});return n}},{key:"okClick",value:function(){var e=this.$dialog.getBody().getValues();webix.toExcel(this.view,e),this.close()}}]),t}(),yi=Object.freeze({action:"excel-export",DialogBox:_i}),Ci=function(e){function t(){return l(this,t),m(this,f(t).apply(this,arguments))}return d(t,Un),u(t,[{key:"$show",value:function(e,t){if(!this.view.getSelectedId())return!1;this.restoreValue(t)||t.clear(),t.elements.name.focus()}},{key:"restoreValue",value:function(e){var t=this.view.getSelectedId();if(t){var n=this.view.getCellValue(t.row,t.column);if(n&&"string"==typeof n&&0===n.indexOf("=HYPERLINK")){var i=n.split('"');return e.setValues({name:i[3]||"",url:i[1]||""}),!0}}return!1}},{key:"$init",value:function(){var e=this;return{view:"ssheet-dialog",head:webix.i18n.spreadsheet.labels["link-title"],move:!0,position:"center",body:{view:"form",elements:[{view:"text",name:"name",placeholder:webix.i18n.spreadsheet.labels["link-name"]},{view:"text",name:"url",placeholder:webix.i18n.spreadsheet.labels["link-url"]}]},on:{onSaveClick:function(){return e.okClick()},onCancelClick:function(){return e.close()}}}}},{key:"okClick",value:function(){var e=this.view.getSelectedId(),t=this.$dialog.getBody().getValues(),n="";t.url&&(t.name=t.name||t.url,/^https?:\/\//i.test(t.url)||(t.url="http://"+t.url),n='=HYPERLINK("'.concat(t.url,'","').concat(t.name,'")')),this.view.setCellValue(e.row,e.column,n),this.view.refresh(),this.close()}}]),t}(),$i=Object.freeze({action:"add-link",DialogBox:Ci}),Si=function(e){function t(){return l(this,t),m(this,f(t).apply(this,arguments))}return d(t,Un),u(t,[{key:"$show",value:function(e,t){t.setValues({data:"current",paper:"A4",fit:"page",mode:"landscape",sheetnames:1,margin:0})}},{key:"$init",value:function(){var e=this;return{view:"ssheet-dialog",head:webix.i18n.spreadsheet.labels["print-title"],move:!0,modal:!0,width:530,height:520,position:"center",buttons:!1,body:{view:"form",elements:[{type:"section",template:webix.i18n.spreadsheet.labels["print-settings"]},{cols:[{view:"radio",name:"data",vertical:!0,options:[{id:"current",value:webix.i18n.spreadsheet.labels["current-sheet"]},{id:"all",value:webix.i18n.spreadsheet.labels["all-sheets"]},{id:"selection",value:webix.i18n.spreadsheet.labels.selection}],on:{onChange:function(e){"all"==e&&this.getFormView().elements.sheetnames.setValue(1)}}},{rows:[{view:"checkbox",name:"sheetnames",labelRight:webix.i18n.spreadsheet.labels["sheet-names"]},{view:"checkbox",name:"borderless",labelRight:webix.i18n.spreadsheet.labels.borderless},{view:"checkbox",name:"skiprows",labelRight:webix.i18n.spreadsheet.labels["skip-rows"]},{view:"checkbox",name:"margin",labelRight:webix.i18n.spreadsheet.labels.margin}]}]},{type:"section",template:webix.i18n.spreadsheet.labels["print-paper"]},{view:"radio",name:"paper",options:[{id:"letter",value:webix.i18n.spreadsheet.labels["page-letter"]},{id:"A4",value:webix.i18n.spreadsheet.labels["page-a4"]},{id:"A3",value:webix.i18n.spreadsheet.labels["page-a3"]}]},{type:"section",template:webix.i18n.spreadsheet.labels["print-layout"]},{cols:[{view:"radio",name:"fit",options:[{
id:"page",value:webix.i18n.spreadsheet.labels["page-width"]},{id:"data",value:webix.i18n.spreadsheet.labels["page-actual"]}]},{width:25},{view:"radio",width:220,name:"mode",options:[{id:"portrait",value:webix.i18n.spreadsheet.labels["page-portrait"]},{id:"landscape",value:webix.i18n.spreadsheet.labels["page-landscape"]}]}]},{cols:[{},{view:"button",css:"ssheet_cancel_button",hotkey:"esc",value:webix.i18n.spreadsheet.labels.cancel,autowidth:!0,click:function(){return e.close()}},{view:"button",value:webix.i18n.spreadsheet.labels.print,hotkey:"enter",autowidth:!0,click:function(){return e.okClick()}}]}]}}}},{key:"okClick",value:function(){var e=this.$dialog.getBody().getValues();e.margin=e.margin?0:{},this.close(),webix.print(this.view,e)}}]),t}(),ki=Object.freeze({action:"print",DialogBox:Si}),Ei=function(e){function t(){return l(this,t),m(this,f(t).apply(this,arguments))}return d(t,Un),u(t,[{key:"open",value:function(e){var t=this;if(this.cell=e.cell?e.cell:this.view.getSelectedId(),!this.cell||this.view.isCellLocked(this.cell.row,this.cell.column)&&!e.viewonly||!this.view.callEvent("onBeforeCommentShow",[this.cell.row,this.cell.column,!e.viewonly]))return!1;this.view.comments._activeComment={editStatus:!e.viewonly,cell:this.cell},this.$dialog||(this.$dialog=webix.ui(this.$init()),this.view._destroy_with_me.push(this.$dialog),this.view.comments.commentsView=this.$dialog,this.$dialog.attachEvent("onHide",function(){return t.$hide()}),this.view.attachEvent("onCommentHide",function(){return t.$dialog.hide()}));var n=this.$dialog.getBody(),i=this.view.$$("cells").getSpan(this.cell.row,this.cell.column),r=i?{row:this.cell.row,column:1*i[1]+i[2]-1}:this.cell;webix.delay(function(){t.$dialog.show(t.view.$$("cells").getItemNode(r)),t._setComment()}),!1===this.$show(this.$dialog,n)&&this.close()}},{key:"$show",value:function(){this.textarea=this.$dialog.queryView({view:"textarea"}),this.template=this.$dialog.queryView({view:"template"})}},{key:"$init",value:function(){var e=this;return{view:"popup",css:"ssheet_comments",minWidth:250,minHeight:150,relative:"right",resize:!0,on:{onViewResize:function(){e.$dialog.hide(),e.$dialog.show(),e.textarea.isVisible()&&e.textarea.focus()}},body:{animate:!1,cells:[{view:"template",css:"ssheet_comment_view",borderless:!0,scroll:"auto",onClick:{ssheet_comment_view:function(){e.view.config.readonly||e.view.isCellLocked(e.cell.row,e.cell.column)||e.showInput(e.view.comments.get(e.cell.row,e.cell.column))}}},{view:"textarea",on:{onChange:function(){e.addComment()},onFocus:function(){e.view.comments._activeComment={editStatus:!0,cell:e.cell}},onBlur:function(){e.view.comments._activeComment={},e.$dialog.hide()}}}]}}}},{key:"_setComment",value:function(){var e=this.view.comments.get(this.cell.row,this.cell.column);this.view.comments._activeComment.editStatus?this.showInput(e):this.showTemplate(e)}},{key:"showTemplate",value:function(e){this.template.show(),this.template.setHTML(e)}},{key:"showInput",value:function(e){var t=this;this.view.$$("cells").select(this.cell.row,this.cell.column),webix.delay(function(){t.changeTextarea(e),t.textarea.show(),t.textarea.focus()})}},{key:"addComment",value:function(){this.view.comments.add(this.cell.row,this.cell.column,this.textarea.getValue())}},{key:"changeTextarea",value:function(e){this.textarea.blockEvent(),this.textarea.setValue(e||""),this.textarea.unblockEvent()}}]),t}(),Vi=Object.freeze({action:"add-comment",DialogBox:Ei}),Ai=function(e){function t(){return l(this,t),m(this,f(t).apply(this,arguments))}return d(t,Un),u(t,[{key:"open",value:function(e){this.group=e.group,this.header=e.value,Un.prototype.open.apply(this,arguments)}},{key:"$show",value:function(){var e=this.view.getSelectedId();if(!e)return!1;this.view.$handleSelection=function(){return!1};var t=this.$dialog.getBody().elements;this.type=t.type,this.size=t.size,this.$dialog.getHead().getChildViews()[0].setHTML(this.header);var n,i=this.view.$$("cells");n="row"==this.group?i.getItem(e.row).$height||i.config.rowHeight:i.getColumnConfig(e.column).width||i.config.columnWidth,
this.type.getOption(1).value=webix.i18n.spreadsheet.labels["row"==this.group?"height":"width"],this.type.setValue(1),this.type.refresh(),this.size.setValue(n),this.size.focus()}},{key:"$hide",value:function(){this.view.$handleSelection=null}},{key:"okClick",value:function(){var e=this.type.getValue(),t="auto";1==e?t=1*this.size.getValue():3==e&&(t=this.view.$$("cells").config["row"==this.group?"rowHeight":"columnWidth"]),"row"==this.group?this.view.setRowHeight(null,t):this.view.setColumnWidth(null,t),this.close()}},{key:"$init",value:function(){var t=this,e=webix.i18n.spreadsheet.labels;return{view:"ssheet-dialog",position:"center",width:300,move:!0,body:{padding:0,cols:[{view:"radio",name:"type",vertical:!0,optionHeight:40,on:{onChange:function(e){1==e?t.size.enable():t.size.disable()}},options:[{id:1,value:""},{id:2,value:e["fit-content"]},{id:3,value:e["default-size"]}]},{rows:[{view:"text",name:"size",width:120}]}]},on:{onSaveClick:function(){return t.okClick()},onCancelClick:function(){return t.close()}}}}}]),t}(),zi=[qn,Hn,Gn,Xn,Qn,mi,wi,xi,yi,$i,ki,Vi,Object.freeze({action:"resize",DialogBox:Ai})];var Ii=!1;function Ri(e){Ni(e,-1)}function Di(e){Ni(e,1)}function Oi(e){Ii||(e._ssUndoHistory=[],e._ssUndoCursor=-1)}function Mi(e,t){e.$skipHistory||e._loading_data||(e._ssUndoHistory.splice(e._ssUndoCursor+1),e._ssUndoHistory.push(t),e._ssUndoCursor++)}function Ti(e,t){t.$skipHistory++;try{e.call(t)}finally{t.$skipHistory--}}function Fi(e){Ii=!0,e(),Ii=!1}function Ni(e,t){var n=e._ssUndoHistory[0<t?e._ssUndoCursor+t:e._ssUndoCursor];if(n){var i=0<t?n.newValue:n.value,r=0<t,o=[n.action,n.row,n.column,i,r];e._ssUndoCursor+=t;var a=n.group,l=e._ssUndoHistory[0<t?e._ssUndoCursor+t:e._ssUndoCursor];Ti(function(){e.callEvent("onUndo",o),a&&l&&a==l.group||(e.refresh(),e.callEvent("onAfterUndo",[]))},e),l&&a&&a==l.group&&Ni(e,t)}}var Pi,Ui=Object.freeze({init:function oa(r){Oi(r),function e(r){r.attachEvent("onUndo",function(e,t,n,i){switch(e){case"freeze-row":r.freezeRows(i);break;case"freeze-column":r.freezeColumns(i)}})}(r),r.attachEvent("onHardReset",function(){return Oi(r)}),r.attachEvent("onAfterSheetShow",function(){return Oi(r)}),r.attachEvent("onBeforeStyleChange",function(e,t,n,i){if(Tt(r,e,t))return!1;Mi(r,{action:"style",row:e,column:t,value:i,newValue:n,group:w.value})}),r.attachEvent("onBeforeValueChange",function(e,t,n,i){if(Tt(r,e,t))return!1;Mi(r,{action:"value",row:e,column:t,value:i,newValue:n,group:w.value})}),r.attachEvent("onBeforeSpan",function(e,t,n){if(Tt(r,e,t))return!1;Mi(r,{action:"span",row:e,column:t,value:n,newValue:n,group:w.value})}),r.attachEvent("onBeforeSplit",function(e,t,n){if(Tt(r,e,t))return!1;Mi(r,{action:"split",row:e,column:t,value:n,newValue:n,group:w.value})}),r.attachEvent("onAction",function(e,t){return Mi(r,{action:e,row:t.row||null,column:t.column||null,value:t.value||null,newValue:t.newValue||null,group:w.value})}),r.$$("cells").attachEvent("onColumnResize",function(e,t,n){return Mi(r,{action:"c-resize",row:0,column:e,value:n,newValue:t,group:w.value})}),r.attachEvent("onColumnOperation",function(e,t,n){"add"!==e.id&&"del"!==e.id&&Mi(r,{action:e,row:0,column:{start:t,end:n}})}),r.attachEvent("onRowOperation",function(e,t,n){"add"!==e.id&&"del"!==e.id&&Mi(r,{action:e,row:{start:t,end:n},column:0})}),r.$$("cells").attachEvent("onRowResize",function(e,t,n){return Mi(r,{action:"r-resize",row:e,column:0,value:n,newValue:t,group:w.value})}),r.attachEvent("onBeforeConditionSet",function(e,t,n,i){if(Tt(r,e,t))return!1;n=n?webix.copy(n):null,Mi(r,{action:"condition",row:e,column:t,value:n,newValue:i,group:w.value})}),r.$skipHistory=0},undo:Ri,redo:Di,reset:Oi,ignoreUndo:Ti,ignoreReset:Fi});function ji(a){clearTimeout(Pi),Pi=webix.delay(function(){var e=a.views;for(var t in e._pull){var n=e._pull[t],i=e._types[n.type],r=i.render,o=i.track;o&&Bi(a,e.get(t),o,n,r)}})}function Bi(e,t,n,i,r){var o=Ki(e,i);if("chart"==i.type){r&&(t=r(t,i,o,!0));var a=i.config;a&&!Xi(a.type)&&function u(e,t,n){var i=t.config;"object"!=g(i.legend)&&(i.legend={fromData:!!i.legend});var r=i.legend;if(r.fromData
)e.shift();else if(r.range)for(var o=Gi(n,t),a="rows"==i.dataSeries,l=Qi(r.range,a,o),s=0;s<l.length;s++){var c=l[s];delete e[0][c]}}(o,i,e)}n(t,o)}function Hi(e,t){for(var n in webix.callEvent("onClick",[]),e.views._pull){var i=webix.$$(n),r=e.views._pull[n];t&&(r.x=qi(e,i,r.x,"x"),r.y=qi(e,i,r.y,"y")),Li(e,i,r)}}function Li(e,t,n){var i=e._table.getScrollState();t.show({x:n.x,y:n.y-i.y})}function qi(e,t,n,i){if(n||0===n){var r="x"==i?function o(e){var t=0;return e._table.eachColumn(function(e){"rowId"!==e&&(t+=this.getColumnConfig(e).width)}),t}(e)-t.$width:function a(e){var t=0;return e._table.data.each(function(e){t+=e.$height||webix.skin.$active.rowHeight}),t}(e)-t.$height;n=Math.min(Math.max(n,0),r)}else n=e._table.getScrollState()[i]+50;return n}function Wi(e){return"string"==typeof e&&-1===e.indexOf("data:image")}function Ki(e,t){var n=t.data;if(/^(http|data:image|\/)/i.test(n))return n;var i=[];if(n){var r="rows"==t.config.dataSeries,o=0;n=Yi(n);for(var a=0;a<n.length;a++){var l=Wi(n[a])?z(n[a],e):null;if(l){var s=l[4]?e._mData.getPage(l[4]):e._mPage;if(l[5]=o,s){var c=r?tr.apply(s,l):er.apply(s,l);o+=c[2];for(var u=0;u<c[0].length;u++)i[u]||(i[u]={}),webix.extend(i[u],c[0][u])}}}}return i}function Gi(e,t){var n=t.data;if(!/^(http|data:image|\/)/i.test(n)){var i={};if(n){var r="rows"==t.config.dataSeries,o=0;n=Yi(n);for(var a=0;a<n.length;a++){var l=Wi(n[a])?z(n[a],e):null;if(l){var s=l[4]?e._mData.getPage(l[4]):e._mPage;if(l[5]=o,s){var c=r?tr.apply(s,l):er.apply(s,l);o+=c[2],webix.extend(i,c[1])}}}}return i}}function Yi(e){return e.replace(/\s/g,"").split(",")}function Xi(e){return/pie|donut/.test(e)}function Zi(s,e,t,n,c){var u="rows"==t,h=[];if(e){var d=[],f=[],g=[];n&&(n.legend&&(f=Qi(n.legend,u)),n.xAxis&&(d=Qi(n.xAxis,u)),n.series&&(g=n.series.filter(function(e){return-1==f.indexOf(e.range)&&-1==d.indexOf(e.range)}))),e=Yi(e);var v=0,m=1;e.forEach(function(r){var o=T(r)?z(r,s):null;if(o){for(var a,l=u?o[0]:o[1],e=u?o[2]:o[3],t=function(e){var t=u?R(e,o[1],e,o[3],o[4]):R(o[0],e,o[2],e,o[4]),n=g.find(function(e){return e.range==t&&(!e.active||e.active==r)});n&&(n.active||(n.active=r),a=1)},n=l;n<=e;n++)t(n);var i=function(e){var t=u?R(e,o[1],e,o[3],o[4]):R(o[0],e,o[2],e,o[4]);if(-1!=f.indexOf(t)||-1!=d.indexOf(t))return"continue";var n=g.filter(function(e){return e.range==t&&e.active==r})[0];if(a&&!n&&(!c||!m||e!=l))return"continue";h.push(n||{active:r,range:t,marker:"square",tooltip:1,color:function i(e){var t=["#e06666","#6aa84f","#3c78d8","#e69138","#783f04","#134f5c","#674ea7","#c27ba0"];return t[e%t.length]}(v)}),v++};for(n=l;n<=e;n++)i(n);m=0}})}return h}function Qi(e,o,a){var l=[];return(e=Yi(e)).forEach(function(e){if(e=T(e)?z(e):null)for(var t=o?e[0]:e[1],n=o?e[2]:e[3],i=t;i<=n;i++){var r=o?R(i,e[1],i,e[3],e[4]):R(e[0],i,e[2],i,e[4]);l.push(a?a[r]:r)}}),l}function Ji(e){return"object"!=g(e.xAxis)&&(e.xAxis={fromData:!!e.xAxis}),"object"!=g(e.legend)&&(e.legend={fromData:!!e.legend}),e.legend=webix.extend(e.legend,{layout:"x",align:"center",valign:"bottom"}),e.scale||(e.scale={lines:1}),e}function er(e,t,n,i,r,o){for(var a=[],l={},s=e,c=0;s<=n;s++,c++){a[c]={};for(var u=t,h=o;u<=i;u++,h++)s==n&&(l["".concat(r?r+"!":"").concat(C[u]).concat(e,":").concat(C[u]).concat(n)]="data".concat(h),o++),a[c]["data".concat(h)]=this.getValue(s-1,u-1)}return[a,l,o]}function tr(e,t,n,i,r,o){for(var a=[],l={},s=t,c=0;s<=i;s++,c++){a[c]={};for(var u=e,h=o;u<=n;u++,h++)s==i&&(l["".concat(r?r+"!":"").concat(C[t]).concat(u,":").concat(C[i]).concat(u)]="data".concat(h),o++),a[c]["data".concat(h)]=this.getValue(u-1,s-1)}return[a,l,o]}var nr=Object.freeze({init:function aa(p){var r,u=p._table.$view.querySelector(".webix_ss_center");p.views={register:function(e,t,n){this._types[e]||(this._types[e]={render:t,track:n})},move:function(e,t,n){var i=webix.$$(e),r=webix.copy(this._pull[e]);this._pull[e].x=qi(p,i,t,"x"),this._pull[e].y=qi(p,i,n,"y"),p.callEvent("onAction",["move-view",{row:e,newValue:webix.copy(this._pull[e]),value:r}]),Li(p,i,this._pull[e])},add:function(e,t,n,i,r,o){var a=this;r=r||{},"chart"==n&&(r=webix.extend(
r,{type:"line",dataSeries:"columns"}));var l=r.height||300,s=r.width||500,c=webix.ui({id:o||"$ssheet-ui"+webix.uid(),view:"ssheet-ui",container:u,master:p._table.config.id,width:s,height:l});return c.attachEvent("onViewMoveEnd",function(e,t){var n=p._table.getScrollState();a.move(o,e,t+n.y)}),c.attachEvent("onViewResize",function(){var e=a._pull[o],t=webix.copy(e);e.config.height=c.$height,e.config.width=c.$width,p.callEvent("onAction",["resize-view",{row:o,newValue:webix.copy(e),value:t}])}),c.attachEvent("onViewEdit",function(){var e=a._pull[o],t=a._commands[e.type]||e.type;p.callEvent("onCommand",[{id:t,viewid:o,config:e}])}),c.attachEvent("onViewRemove",function(){return a.remove(o)}),o=c.config.id,e=qi(p,c,e,"x"),t=qi(p,c,t,"y"),this._pull[o]={x:e,y:t,type:n,data:i,config:r},this.update(o,i,r,!0),Li(p,c,this._pull[o]),o},remove:function(e){var t=this._pull[e];webix.$$(e).close(),delete this._pull[e],p.callEvent("onAction",["add-view",{row:e,newValue:null,value:t}])},get:function(e){return webix.$$(e).getBody()},getConfig:function(e){return this._pull[e]},update:function(e,t,n,i){var r=i?null:webix.copy(this._pull[e]),o=this._pull[e],a=this._types[o.type];if(t=t||n.data||"",delete(n=n||{}).data,"chart"==o.type){var l=n.type;if(l&&!Xi(l)&&!n.series){var s=n.xAxis&&n.xAxis.range,c=n.legend&&n.legend.range,u=r&&r.config&&r.config.xAxis&&r.config.xAxis.fromData;n.series=Zi(p,t,n.dataSeries,{xAxis:s,legend:c},u)}}var h=webix.$$(e),d=n.height||300,f=n.width||500;h.$width!=f&&h.$height!=d&&(h.define({width:f,height:d}),h.resize()),o.data=t,o.config=n;var g=this.get(e);if(t=Ki(p,o),a.render){var v=webix.copy(o);v.config.width=v.config.height=0,function m(e){var t=function(e){return"datatable"==e.name||"treetable"==e.name},n=e.queryView(t,"self");(n=n?[n]:e.queryView(t,"all")).forEach(function(e){return e.disable()})}(g=a.render(g,v,t))}a.track&&Bi(p,g,a.track,o),p.callEvent("onAction",["add-view",{row:e,newValue:webix.copy(this._pull[e]),value:r}])},highlight:function(e){var t=webix.$$(e),n="webix_ssheet_ui_focused",i=webix.$$(this._activeWin);i&&!i.$destructed&&webix.html.removeCss(i.$view,n),t?(this._activeWin=e,webix.html.addCss(t.$view,n)):delete this._activeWin},_commands:{image:"add-image-top",chart:"add-chart"},_types:{},_pull:{}},p._table.attachEvent("onResize",function(){return Hi(p)}),p._table.attachEvent("onScrollY",function(){return Hi(p)}),p._table.attachEvent("onScrollX",function(){return Hi(p)}),p.attachEvent("onReset",function(){return function e(t){Ti(function(){for(var e in t.views._pull)t.views.remove(e)},t)}(p)}),p.attachEvent("onUndo",function(e,t,n,i){var r="move-view"===e;(r||"resize-view"==e||"add-view"===e)&&function u(e,t,n,i){if(i){var r=i.x,o=i.y,a=i.type,l=i.data,s=i.config;e.views._pull[n]?t?e.views.move(n,r,o):e.views.update(n,l,s):e.views.add(r,o,a,l,s,n);var c=e.$$("chartEditor");c&&c.viewId==n&&c.queryView("form").setValues(s)}else e.views.remove(n)}(p,r,t,i)}),p.attachEvent("onAction",function(e,t){"header-hide"==e?Hi(p):"before-grid-change"==e&&function u(e,t,n,i,r){for(var o=i.views,a=0;a<o.length;a++)if(Wi(o[a][3])){var l=o[a][4].series;l&&l.forEach(function(e){e.range=F(e.range,t,n,r),e.active=F(e.active,t,n,r)});var s=o[a][4].legend&&o[a][4].legend.range;s&&(o[a][4].legend.range=Yi(s).map(function(e){return F(e,t,n,r)}).join(","));var c=o[a][4].xAxis&&o[a][4].xAxis.range;c&&(o[a][4].xAxis.range=F(c,t,n,r)),o[a][3]=Yi(o[a][3]).map(function(e){return F(e,t,n,r)}).join(",")}}(0,t.name,t.inc,t.data,t.start)}),p.attachEvent("onColumnOperation",function(){return Hi(p,!0)}),p.attachEvent("onRowOperation",function(){return Hi(p,!0)}),p.attachEvent("onDataParse",function(e){return function i(t,e){var n=e.views;n&&Ti(function(){n.forEach(function(e){return t.views.add.apply(t.views,e)})},t)}(p,e)}),p.attachEvent("onDataSerialize",function(e,t){return function a(e,t,n){for(var i in t.views=[],e.views._pull){var r=e.views._pull[i],o=[r.x,r.y,r.type,r.data,r.config];n&&n.viewIds&&o.push(i),t.views.push(o)}}(p,e,t)}),p.attachEvent("onCellChange",function(){return ji(p)}),p.attachEvent(
"onMathRefresh",function(){return ji(p)}),p.attachEvent("onDestruct",function(){for(var e in p.views._pull)webix.$$(e).destructor()}),webix.attachEvent("onClick",function(e){var t=webix.$$(e);t&&t.config.externalUI&&(t=webix.$$(t.config.externalUI));var n=t&&(t.queryView("ssheet-ui","self")||t.queryView("ssheet-ui","parent"));if(n){p.views.highlight(n);var i=n.config.id;r&&(p.views.getConfig(i).type==r?n.callEvent("onViewEdit",[]):p.callEvent("onCommand",[{id:"close-ui-editor"}]))}else r||p.views.highlight()}),p.attachEvent("onUIEditStart",function(e,t){p.views.highlight(e),r=t}),p.attachEvent("onUIEditStop",function(e,t){r==t&&webix.delay(function(){r=null})}),p.views.register("chart",function(e,t,n){var i=function y(e,t,n){var i=/<[^>]*>/gi,r=webix.copy(e.config),o=(r=Ji(r)).scale.lines,a=r.scale.color||undefined,l=r.type;Xi(l)&&delete r.series;var s=r.legend,c=!s.fromData&&s.range;if(c){var u="rows"==r.dataSeries;c=Qi(s.range,u,n)}var h={height:24,align:s.align||"center",valign:s.valign||"bottom"};if(h.layout="middle"==h.valign?"y":"x",Xi(l))!function _(e,t,n,i){var r=/<[^>]*>/gi;for(var o in e[0]){t.legend.fromData?(n.template=function(e){var t=e[o];return t||0===t?(t+"").replace(r,""):""},t.value="#".concat(o.replace("0","1"),"#")):(t.legend.range&&(n.template=function(e){var t=e[i[0]];return t||0===t?(t+"").replace(r,""):""}),t.value="#".concat(o,"#"));break}n.template?t.legend=n:delete t.legend,t.pieInnerText&&(t.pieInnerText=t.value)}(t,r,h,c);else if(r.series){h.values=[];var d=r.series;r.series=[];var f=r.xAxis;f.fromData?f.range=c?Object.keys(t[0]).filter(function(e){return-1==c.indexOf(e)})[0]:"data0":f.range&&(f.range=n[f.range]);for(var g=0;g<d.length;g++){var v=d[g].color,m=n[d[g].range];if(m!=f.range){var p={value:"#".concat(m,"#"),label:d[g].label?"#".concat(m,"#"):"",tooltip:{template:d[g].tooltip?"#".concat(m,"#"):""}};if("radar"==l||"line"==l||"spline"==l?(p.line={color:v},p.item={borderColor:v,type:d[g].marker}):p.color=v,"area"!=l&&"splineArea"!=l||(p.alpha=.7),t[0]&&(c||s.fromData)){var w=c?t[0][c[g]]:t[0][m],b=w||0===w?(w+"").replace(i,""):"";h.values.push({text:b,color:v})}r.series.push(p)}}r.xAxis={template:function(e){var t=e[f.range];return t||0===t?(t+"").replace(i,""):""},title:r.xAxis.title,lineColor:a,color:a,lines:o},h.values.length?r.legend=h:delete r.legend}for(var x in r.yAxis=r.yAxis||{},r.yAxis)""===r.yAxis[x]&&delete r.yAxis[x];return r.yAxis=webix.extend(r.yAxis,{lineColor:a,color:a,lines:o,lineShape:r.scale.circle?"arc":"default"}),webix.extend({view:"chart",padding:{left:80}},r,!0)}(t,n,Gi(p,t));return webix.ui(i,e)},function(e,t){e.clearAll(),e.parse(t)}),p.views.register("image",function(e,t,n){var i=webix.extend({css:"webix_ssheet_bgimage",template:'<img src="'.concat(n,'"/>')},t.config||{},!0);return webix.ui(i,e)})},_getDataParts:Yi,_isPie:Xi,_getSeries:Zi,_getParts:Qi,_normalizeConfig:Ji}),ir=webix.i18n.spreadsheet.labels;function rr(t){t.attachEvent("onComponentInit",function(){return function e(l){var s=l.$$("chartEditor"),c=s.queryView("form"),u=c.elements;function h(){if(u["legend.fromData"].getValue()){var e=Xi(u.type.getValue())?v:i;g(u["legend.range"],e())}}function d(e){if(e){var t=u["legend.range"].getValue();m("",t)}var n=Xi(u.type.getValue())?v:i;e=e?n():"",g(u["legend.range"],e)}function f(e){if(e){var t=u["xAxis.range"].getValue();m("",t)}e=e?v():"",g(u["xAxis.range"],e)}function g(e,t){e.blockEvent(),e.setValue(t),e.unblockEvent()}function v(){var e=u.range.getValue(),t=u.dataSeries.getValue(),n=u["legend.range"].getValue(),i="",r=Zi(l,e,t,{legend:n||""});return r.length&&(i=r[0].range),i}function i(){var i=Yi(u.range.getValue()),r="rows"==u.dataSeries.getValue(),o=Yi(u["xAxis.range"].getValue()),a=[];return i.forEach(function(e){if(-1==o.indexOf(e)){var t=z(e,l);if(t){var n=r?R(t[0],t[1],t[2],t[1],t[4]):R(t[0],t[1],t[0],t[3],t[4]);-1==i.indexOf(n)&&a.push(n)}}}),a.join(",")}function m(e,t){var n=u.range.getValue(),i=u["legend.range"].getValue(),r=u["xAxis.range"].getValue(),o=u.dataSeries.getValue(),a=Zi(l,n,o,{legend:i,xAxis:r});t=Yi(t),n=Yi(n).filter(
function(e){return-1==t.indexOf(e)}),e&&(e=Yi(e)).forEach(function(t){var e=a.filter(function(e){return e.range==t});e.length||n.push(t)}),g(u.range,n.join(","))}function p(e){var t=u["legend.align"],n=t.getList();"middle"==e?n.exists("center")&&n.remove("center"):n.exists("center")||n.add({id:"center",value:ir["chart-legend-center"]},1)}function w(e){var t=u["legend.valign"],n=t.getList();"center"==e?n.exists("middle")&&n.remove("middle"):n.exists("middle")||n.add({id:"middle",value:ir["chart-legend-middle"]},1)}function b(e){var t=l.$$("chartTabs").getTabbar();_(),h();var n=u.series,i="radar"==e||"line"==e||"spline"==e;n.hideSubviews("marker",i),n.hideSubviews("label",i||"bar"==e),"area"==e||"bar"==e?u.stacked.show():r(u.stacked),"radar"==e?u["scale.circle"].show():r(u["scale.circle"]),"pie"==e?u["3D"].show():r(u["3D"]),Xi(e)?(o("axis"),u.pieInnerText.show(),t.hideOption("advanced")):(o("axis",!0),r(u.pieInnerText),t.showOption("advanced")),Xi(e)||"radar"==e?o("axisTitle"):o("axisTitle",!0)}function x(e){var t=u.range.getValue(),n=u.series.getValue(),i=u["legend.range"].getValue(),r=u["xAxis.range"].getValue(),o=u.dataSeries.getValue();n=Zi(l,t,o,{series:n,legend:i,xAxis:r},e),u.series.setValue(n)}function _(){var e="rows"==u.dataSeries.getValue(),t=Xi(u.type.getValue());!t&&e||!e&&t?(u["legend.fromData"].define("label",ir["chart-col-legend"]),u["xAxis.fromData"].define("label",ir["chart-row-xAxis"])):(u["legend.fromData"].define("label",ir["chart-row-legend"]),u["xAxis.fromData"].define("label",ir["chart-col-xAxis"])),u["legend.fromData"].refresh(),u["xAxis.fromData"].refresh()}function r(e){e.setValue&&g(e),e.hide()}function o(e,t){c.queryView({batch:e},"all").forEach(function(e){t?e.show():r(e)})}l.attachEvent("onCommand",function(e){if("add-chart"==e.id){var t=e.config,n=t&&t.config||{};s.show(),l.$handleSelection=function(e,t,n,i){var r=webix.UIManager.getFocus();if(s.queryView(function(e){return e==r}))if(r==u.range||r==u["legend.range"]){var o=r.getValue(),a=o.lastIndexOf(",");o=-1==a?"":o.substring(0,a+1),r.setValue(o+n+":"+i)}else r.config.range&&r.setValue(n+":"+i);return!1},c.clear(),l.$$("chartTabs").setValue("common"),(n=Ji(n)).range=t?t.data:l.getSelectedRange(),s.viewId=e.viewid?e.viewid:l.views.add(null,null,"chart",n.range,n),l.callEvent("onUIEditStart",[s.viewId,"chart"]),w(n.legend.align),p(n.legend.valign),b(n.type),c.setValues(function i(e){/stacked|3D/.test(e.type)&&(e.type=e.type.replace(/stacked|3D/,"").toLowerCase());return e}(n)),n.legend.fromData&&d(n.legend.fromData),n.xAxis.fromData&&f(n.xAxis.fromData),x(),c.queryView("accordionitem","all").forEach(function(e){return e.expand()}),u.range.focus()}}),l.attachEvent("onUIEditStart",function(e,t){s.isVisible()&&"chart"!=t&&or(l)}),l.attachEvent("onCommand",function(e){"close-ui-editor"==e.id&&s.isVisible()&&or(l)}),l.attachEvent("onAction",function(e,t){"add-view"!=e||t.newValue||s.isVisible()&&s.viewId==t.row&&or(l)}),c.attachEvent("onChange",function(e,t){var n=this.$eventSource;if(n===u.range||n===u["xAxis.range"]||n===u["legend.range"]){var i=e.split("!"),r=2==i.length?i[0]+"!"+i[1].toUpperCase():e.toUpperCase();e!=r&&g(n,e=r)}switch(n){case u.type:b(e);break;case u.range:case u.dataSeries:this.$eventSource==u.dataSeries&&_(),u["legend.fromData"].getValue()&&h(),u["xAxis.fromData"].getValue()&&g(u["xAxis.range"],v()),x();break;case u["xAxis.fromData"]:f(e),x(t);break;case u["legend.fromData"]:d(e),x();break;case u["legend.align"]:w(e);break;case u["legend.valign"]:p(e);break;case u["xAxis.range"]:u["xAxis.fromData"].getValue()&&g(u["xAxis.fromData"]),m(e,t);break;case u["legend.range"]:u["legend.fromData"].getValue()&&g(u["legend.fromData"]),m(e,t)}var o=function a(e){e.stacked?e.type="stacked"+e.type.charAt(0).toUpperCase()+e.type.substr(1):e["3D"]&&(e.type+="3D");return e}(c.getValues());l.views.update(s.viewId,o.range,o)}),u.series.attachEvent("onRangeChange",m)}(t)});var e=webix.skin.$active,n=e.dataPadding-2,i=e.layoutMargin.form;return{width:440,hidden:!0,id:"chartEditor",css:"ssheet_chart",rows:[{height:e.barHeight,
css:"ssheet_chart_wizard_head",padding:{left:2},cols:[{view:"icon",hotkey:"esc",icon:"webix_ssheet_icon ssi-arrow-left",click:function(){return or(t)}},{type:"header",borderless:!0,template:ir["chart-edit"]}]},{view:"form",complexData:!0,borderless:!0,padding:{top:0},elementsConfig:{labelWidth:180},elements:[{view:"tabview",id:"chartTabs",cells:[{id:"common",borderless:!0,type:"form",paddingX:0,header:ir["chart-common"],rows:[{view:"scrollview",body:{margin:i,rows:[ar("type","chart-type",function r(){return[{id:"line",value:ir["line-chart"]},{id:"spline",value:ir["spline-chart"]},{id:"splineArea",value:ir["splinearea-chart"]},{id:"area",value:ir["area-chart"]},{id:"bar",value:ir["bar-chart"]},{id:"radar",value:ir["radar-chart"]},{id:"pie",value:ir["pie-chart"]},{id:"donut",value:ir["donut-chart"]}]}()),{view:"checkbox",label:ir["stacked-chart"],name:"stacked",hidden:!0},{view:"checkbox",label:ir["chart-pie-3d"],name:"3D",hidden:!0},{view:"text",label:ir["chart-range"],name:"range"},{view:"checkbox",label:ir["chart-col-xAxis"],name:"xAxis.fromData",batch:"axis"},{view:"checkbox",label:ir["chart-pie-text"],name:"pieInnerText",hidden:!0},{view:"checkbox",label:ir["chart-row-legend"],name:"legend.fromData"},{view:"radio",label:ir["chart-data-from"],name:"dataSeries",vertical:!0,options:[{id:"columns",value:ir["chart-columns"]},{id:"rows",value:ir["chart-rows"]}]},{}]}}]},{id:"advanced",borderless:!0,type:"form",paddingX:0,padding:{bottom:0},header:ir["chart-series"],rows:[{view:"ssheet-series",name:"series"}]},{id:"extras",borderless:!0,type:"form",paddingX:0,header:ir["chart-extras"],rows:[{view:"scrollview",body:{view:"accordion",margin:webix.skin.$active.layoutMargin.form,css:"webix_ssheet_accordion",multi:!0,type:"clean",rows:[{header:ir["chart-legend"],body:{margin:i,padding:n,rows:[{view:"text",label:ir["chart-legend-range"],name:"legend.range"},ar("legend.align","chart-legend-align",function o(){return[{id:"left",value:ir["chart-legend-left"]},{id:"center",value:ir["chart-legend-center"]},{id:"right",value:ir["chart-legend-right"]}]}()),ar("legend.valign","chart-legend-valign",function a(){return[{id:"top",value:ir["chart-legend-top"]},{id:"middle",value:ir["chart-legend-middle"]},{id:"bottom",value:ir["chart-legend-bottom"]}]}())]}},{header:ir["chart-scale"],batch:"axis",id:"scale",body:{margin:i,padding:n,rows:[{view:"checkbox",label:ir["chart-lines"],name:"scale.lines",batch:"axis"},{view:"checkbox",label:ir["chart-radar-circle"],name:"scale.circle",hidden:!0},{view:"ssheet-colorpicker",label:ir["chart-scale-color"],name:"scale.color",batch:"axis"}]}},{header:ir["chart-x-axis"],batch:"axis",body:{margin:i,padding:n,rows:[{view:"text",label:ir["chart-xAxis-range"],name:"xAxis.range",range:!0,batch:"axis"},{view:"text",label:ir["chart-xAxis-title"],name:"xAxis.title",batch:"axisTitle"}]}},{header:ir["chart-y-axis"],batch:"axis",body:{margin:i,padding:n,rows:[{view:"text",label:ir["chart-yAxis-title"],name:"yAxis.title",batch:"axisTitle"},{view:"text",label:ir["chart-yAxis-origin"],name:"origin",batch:"axis",attributes:{type:"number"}},{view:"label",label:ir["chart-yAxis-note"],css:"ssheet_note",height:20},{view:"text",label:ir["chart-yAxis-start"],name:"yAxis.start",batch:"axis",attributes:{type:"number"}},{view:"text",label:ir["chart-yAxis-end"],name:"yAxis.end",batch:"axis",attributes:{type:"number"}},{view:"text",label:ir["chart-yAxis-step"],name:"yAxis.step",batch:"axis",attributes:{type:"number"}}]}},{}]}}]}]}]}]}}function or(e){var t=e.$$("chartEditor");e.callEvent("onUIEditStop",[t.viewId,"chart"]),t.viewId=null,e.$handleSelection=null,t.hide()}function ar(e,t,n){return{view:"richselect",name:e,label:ir[t],suggest:{view:"ssheet-form-suggest",data:n}}}function lr(e,t){Fi(function(){e.$handleSelection=null,e.parse(t)})}var sr=Object.freeze({init:function la(r){r.attachEvent("onCommand",function(e,t,n){if("add"==e.id||"del"==e.id){var i=r._table.getSelectArea();!i||t&&n||(t=i.start,n=i.end),t&&n&&w.set(function(){!function y(e,t,n,i){var r=i._table.getSelectArea(),o=i._table.getScrollState(),a=i.serialize({
math:!0,viewIds:!0}),l=webix.copy(a),s={value:a,newValue:l},c=[],u=l.spans;for(var h in u){var d=qt(u[h],e,t,n,0,l.data,c);(d[2]<=0||d[3]<=0)&&u.splice(h,1)}var f=function m(e,t,n){var i=e.group,r="add"==e.id?1:"del"==e.id?-1:0;return r&&("row"==i&&(r+=r*(n.row-t.row)),"column"==i&&(r+=r*(n.column-t.column))),{name:i,inc:r}}(e,t,n);Ti(function(){i.callEvent("onAction",["before-grid-change",{name:f.name,inc:f.inc,data:l,start:t}])},i),"column"==e.group?"add"==e.id?function p(e,t,n,i){var r=n.column-t.column+1;i._mPage.addColumn(t.column-1,r),i.config.columnCount+=r,i.callEvent("onColumnOperation",[e,t,n])}(e,t,n,i):"del"==e.id&&function w(e,t,n,i){var r=n.column-t.column+1;if(i.config.columnCount===r){if(t.column==n.column)return;n.column--,r--}i._mPage.removeColumn(t.column-1,r),i.config.columnCount-=r,i.callEvent("onColumnOperation",[e,t,n])}(e,t,n,i):"row"==e.group&&("add"==e.id?function b(e,t,n,i){var r=n.row-t.row+1;i._mPage.addRow(t.row-1,r),i.config.rowCount+=r,i.callEvent("onRowOperation",[e,t,n])}(e,t,n,i):"del"==e.id&&function x(e,t,n,i){var r=n.row-t.row+1;if(i.config.rowCount===r){if(t.row==n.row)return;n.row--,r--}i._mPage.removeRow(t.row-1,r),i.config.rowCount-=r,i.callEvent("onRowOperation",[e,t,n])}(e,t,n,i));var g=i.serialize({math:!0});if(l.data=g.data,l.ranges=g.ranges,c.forEach(function(e){l.data.push(e)}),i.callEvent("onAction",["grid-change",s]),Ti(function(){lr(i,l),i._table.scrollTo(o.x,o.y)},i),r){var v=i.$$("cells");(r=function _(e,t){var n=t.count(),i=t.config.columns.length;return 1*e.start.row>n?null:1*e.end.row>n?null:1*e.start.column>i?null:1*e.end.column>i?null:e}(r,v))&&v.addSelectArea(r.start,r.end)}}(e,t,n,r)})}}),r.attachEvent("onUndo",function(e,t,n,i){"grid-change"==e&&lr(r,i)})}});function cr(e){e._table._ssEditors={}}function ur(e,t){e._table.editStop(),O(t,e,function(e,t){var n=e._table._ssEditors[t.row];n&&n[t.column]&&(delete n[t.column],e._table.removeCellCss(t.row,t.column,"ss_editor"),Bt(e,t.row,t.column,"ss_editor",!1))})}function hr(e,t,n,i,r){var o=t.dropdown;e.setCellEditor(n,i,o),1===r&&e.setCellEditor(t.row,t.col,{})}var dr,fr,gr,vr,mr,pr=Object.freeze({init:function sa(a){var e=a._table;a.attachEvent("onReset",function(){return cr(a)}),cr(a),e.attachEvent("onBeforeEditStart",function(e){var t=this.getColumnConfig(e.column);if(this._ssEditors[e.row]){var n=this._ssEditors[e.row][e.column];n&&(webix.extend(t,n,!0),webix.extend(t,{row:a.getRow(e.row)},!0),n.options&&("string"==typeof n.options?t.options=ei(a,n.options,{unique:!0,order:!0,empty:!0}):webix.isArray(n.options)&&(t.options=ei(a,n.options,{empty:!0}))))}}),e.attachEvent("onBeforeEditStop",function(e,t,n){if(!n&&t.getFormat){var i=t.getValue(),r=t.getFormat(i);w.set(function(){a.setCellValue(t.row,t.column,i),r?_e(a,t.row,t.column,be(r)):ye(a,t.row,t.column)});var o=a.getSelectedId();o&&o.row==t.row&&o.column==t.column&&(r=De(r=r||"common")?"custom":r,a.callEvent("onCommand",[{id:"toolbar-update",name:"format",value:r}]))}}),e.attachEvent("onAfterEditStop",function(e,t){var n=this.getColumnConfig(t.column);n.editor="text",delete n.popup,delete n.$popup,delete n.row}),a.attachEvent("onUndo",function(e,t,n,i){"dropdown"==e&&a.setCellEditor(t,n,i)}),a.attachEvent("onAction",function(e,t){"dropdown"==e?Bt(a,t.row,t.column,"ss_editor",t.newValue):"before-grid-change"==e&&function h(e,t,n,i,r){var o=i.editors;if(n)for(var a=o.length-1;0<=a;a--){var l=$(o[a],3),s=l[0],c=l[1],u=l[2];if("row"==t&&s>=r.row||"column"==t&&c>=r.column){if("row"==t){if(s<r.row-n){o.splice(a,1);continue}o[a][0]=1*s+n}else if("column"==t){if(c<r.column-n){o.splice(a,1);continue}o[a][1]=1*c+n}u.options=F(u.options,t,n,r)}}}(0,t.name,t.inc,t.data,t.start)})},serialize:function ca(e,t){var n,i,r=e._table._ssEditors,o=[];for(n in r)for(i in r[n])o.push([n,i,r[n][i]]);t.editors=o},load:function ua(e,t){var n=t.editors;if(n)for(var i=0;i<n.length;i++)e.setCellEditor.apply(e,n[i])},clearEditors:ur,isEditor:function ha(e,t,n){var i=e._table._ssEditors;return i[t]&&!!i[t][n]},pasteDropdown:hr});function wr(e,t,n,i,r,o){var a=i;if("object"===g(i)){if(
a=i.math?o.cut?i.math:e._mData.getStore().transposeMath(i.math,o.row,o.column):i.text,i.style&&i.style.props){var l=e.addStyle(i.style.props);e.setStyle(t,n,l)}var s=i.extra;s&&(s.condition&&ln(e,s,t,n,vr),s.dropdown&&hr(e,s,t,n,vr),s.filter&&mr&&ui(e,s,t,n,0,o)),Wt(e,s,t,n,vr,o)}e.setCellValue(t,n,a)}var br=Object.freeze({init:function da(i){if(!1!==i.config.clipboard){webix.clipbuffer.init();var r=i.$$("cells");r.attachEvent("onAfterAreaAdd",function(){return function e(l){var t=l.$$("cells");t.getSelectedId()&&webix.delay(function(){var a=[];t.mapSelection(function(e,t,n,i){e=l._mPage.getValue(t-1,n-1);var r=l.config.clipboardDecimalDelimiter;webix.isUndefined(r)||(e=function o(e,t){return webix.rules.isNumber(e)&&(e=e.toString().replace(".",t)),e}(e,r)),a[i]||(a[i]=[]),a[i].push(e)});var e=webix.csv.stringify(a,t.config.delimiter);document.querySelector(".webix_clipbuffer").focus(),webix.clipbuffer.set(e),webix.UIManager.setFocus(t)})}(i)}),r.attachEvent("onKeyPress",function(e,t){67!==e&&88!==e||!t.ctrlKey&&!t.metaKey||!r.getSelectedId()||(dr=function n(u,e){var h,d,f=[];return e.mapSelection(function(e,t,n){t!=d&&(h=[],f.push(h),d=t);var i=u._mPage.getValue(t-1,n-1,!0);i=i&&"="==i[0]?i:null;var r={text:e=u._mPage.getValue(t-1,n-1),math:i,style:u.getStyle(t,n)},o=u.conditions.get(t,n),a=u.getCellEditor(t,n),l=u.getCellFilter(t,n),s=u._table.getSpan(t,n);if(a||l||o||s){var c={row:t,col:n};o&&(c.condition=o),a&&(c.dropdown=a),l&&(c.filter=l),s&&(c.span=s),r.extra=c}return h.push(r),e}),f}(i,r),fr=document.querySelector(".webix_clipbuffer").value,gr=r.getSelectArea(),(vr=1*(88===e))&&0!==Object.keys(i._table._ssFilters).length&&(mr=function u(e,t,n){for(var i=Object.keys(e),r=Math.min.apply(null,i),o=Math.max.apply(null,i),a=n,l=1,s=r;s<=o;s++)if(e[s]){var c=Object.keys(e[s]);a=Math.min(a,Math.min.apply(null,c)),l=Math.max(l,Math.max.apply(null,c))}return t.start.row<=r&&t.end.row>=o&&t.start.column<=a&&t.end.column>=l}(i._table._ssFilters,gr,i.config.columnCount)))}),i.config.readonly||r.attachEvent("onPaste",function(e){!function a(l,n,e){var t=n.getSelectArea();if(t){var i=t.start,r=e===fr,s=r?dr:webix.csv.parse(e,n.config.delimiter);!r&&l.config.clipboardDecimalDelimiter&&(s=function o(e,t){for(var n=0;n<e.length;n++)for(var i=0;i<e[n].length;i++){var r=e[n][i].toString().replace(t,".");webix.rules.isNumber(r)&&(e[n][i]=r)}return e}(s,l.config.clipboardDecimalDelimiter));var c={id:"move",column:0,row:0,cut:vr};r?(c.column=i.column-gr.start.column,c.row=i.row-gr.start.row):vr=0,w.set(function(){if(mr&&l.removeFilters(),function a(e,t,n){var i=t.row+n.length-1,r=t.column+n[0].length-1;if(i>e.config.rowCount||r>e.config.columnCount){var o={id:"add"};i>e.config.rowCount&&(o.group="row",e.callEvent("onCommand",[o,{row:e.config.rowCount+1},{row:i}])),r>e.config.columnCount&&(o.group="column",e.callEvent("onCommand",[o,{column:e.config.columnCount+1},{column:r}]))}}(l,i,s),1===vr)for(var e=gr.start.row;e<=gr.end.row;e++)for(var t=gr.start.column;t<=gr.end.column;t++)l.setCellValue(e,t,null),l.setStyle(e,t,null);1!=s.length||1!=s[0].length||mr?n.mapCells(i.row,i.column,s.length,null,function(e,t,n,i,r){if(s[i]&&s[i].length>r){var o=s[i][r];wr(l,t,n,o,0,c)}},!0):l.eachSelectedCell(function(e){var t={id:"move",column:c.column+1*e.column-i.column,row:c.row+1*e.row-i.row,cut:vr};wr(l,e.row,e.column,s[0][0],0,t)}),1===vr&&(mr=!(vr=2))}),l.refresh()}}(i,r,e)})}}});function xr(e,t){t?e["_hidden_"+t+"_hash"]={}:(e._hidden_cols_hash={},e._hidden_rows_hash={},e.filterSpreadSheet())}function _r(e,t){return!e._hidden_cols_hash[t]}function yr(e,t,n,i){if(t){var r=function c(e){return webix.isArray(e)?e:[e,e]}(t),o="row"==i?e._hidden_rows_hash:e._hidden_cols_hash;if(o[r[0]]||!webix.isUndefined(n)&&!n){if(o[r[0]]&&(webix.isUndefined(n)||!n)){var a=1<r[0]?1:-1;("row"==i?kr:Sr)({id:"hide",group:i},h({},i,r[0]+a),h({},i,r[1]+a),e)}}else("row"==i?Vr:Er)({id:"hide",group:i},h({},i,r[0]),h({},i,r[1]),e)}else{var l=e.getSelectedId(!0),s={id:!1===n?"show":"hide",group:i};l.length&&e.callEvent("onCommand",[s,l[0],l[l.length-1]])}}function Cr(e,t
){return!e._hidden_rows_hash[t]}function $r(e){"column"==e.group?"show"==e.id?Sr.apply(this,arguments):"hide"==e.id&&Er.apply(this,arguments):"row"==e.group&&("show"==e.id?kr.apply(this,arguments):"hide"==e.id&&Vr.apply(this,arguments))}function Sr(e,t,n,i,r){for(var o=n.column,a=i.$$("cells");o>=t.column;){var l=o;if(r||(l=i._hidden_cols_hash[1*o-1]||i._hidden_cols_hash[1*o+1]||!1),!1!==l){delete i._hidden_cols_hash[l];var s=a.getColumnConfig(l-1||"rowId").header[0];s.css=s.css.replace("webix_ssheet_hide_column",""),a.showColumn(l),t.column=t.column<l?t.column:l,n.column=n.column>l?n.column:l,r||i.callEvent("onColumnOperation",[e,{column:l},{column:l},null])}o--}var c=i._frozenColumns;c&&c>=t.column&&c<=n.column&&(i.freezeColumns(0),i.freezeColumns(c))}function kr(e,t,n,i,r){var o=n.row,a=i.$$("cells"),l=i._frozenRows;for(l&&i.freezeRows(0);o>=t.row;){var s=o;if(r||(s=i._hidden_rows_hash[1*o-1]||i._hidden_rows_hash[1*o+1]||!1),!1!==s){if(delete i._hidden_rows_hash[s],s-1==0){var c=a.getColumnConfig("rowId").header[0];c.css=c.css.replace("webix_ssheet_hide_row",""),a.refreshColumns()}else a.removeCellCss(s-1,"rowId","webix_ssheet_hide_row");r||i.callEvent("onRowOperation",[e,{row:s},{row:s},null])}o--}i.filterSpreadSheet(),l&&i.freezeRows(l)}function Er(e,t,n,i,r){var o=i.$$("cells"),a=n.column;if(i.$handleSelection=null,o.unselect(),n.column<1||t.column<1)delete i._hidden_cols_hash[t.column];else{for(;a>=t.column;){if(-1!=o.getColumnIndex(a)){i._hidden_cols_hash[a]=a;var l=o.getColumnConfig(a-1||"rowId").header[0];l.css=(l.css||"")+" webix_ssheet_hide_column",o.hideColumn(a)}a--}r||i.callEvent("onColumnOperation",[e,t,n,null])}}function Vr(e,t,n,i,r){if(n.row<1||t.row<1)delete i._hidden_rows_hash[t.row];else{var o=i._frozenRows;o&&i.freezeRows(0);for(var a=i.$$("cells"),l=n.row;l>=t.row;){if((i._hidden_rows_hash[l]=l)-1==0){var s=a.getColumnConfig("rowId").header[0];s.css=(s.css||"")+" webix_ssheet_hide_row",a.refreshColumns()}else a.addCellCss(l-1,"rowId","webix_ssheet_hide_row");l--}i.filterSpreadSheet(),o&&i.freezeRows(o),r||i.callEvent("onRowOperation",[e,t,n,null])}}var Ar=Object.freeze({init:function fa(l){l.attachEvent("onCommand",function(e){if("show"==e.id||"hide"==e.id){var t=l._table.getSelectArea();t&&$r(e,webix.copy(t.start),webix.copy(t.end),l)}}),xr(l),l.attachEvent("onUndo",function(e,t,n,i,r){if(!("hide"!=e.id&&"show"!=e.id||"column"!=e.group&&"row"!=e.group)){var o=e.id;r||(o="hide"==o?"show":"hide");var a=t||n;$r({id:o,group:e.group},a.start,a.end,l,!0)}}),l.attachEvent("onHardReset",function(){return xr(l)}),l.attachEvent("onAction",function(e,t){"before-grid-change"==e&&function u(e,t,n,i,r){if(i.table&&i.table.hidden&&i.table.hidden[t]&&i.table.hidden[t].length){"column"===t&&xr(e,"cols"),"row"===t&&xr(e,"rows");var o=r[t],a=o+n;if(a<o){var l=[a,o];o=l[0],a=l[1]}for(var s=o;s<a;s++)for(var c=0;c<i.table.hidden[t].length;c++)i.table.hidden[t][c]>=s&&(i.table.hidden[t][c]=1*i.table.hidden[t][c]+(0<n?1:-1))}}(l,t.name,t.inc,t.data,t.start)})},reset:xr,isColumnVisible:_r,setState:yr,isRowVisible:Cr,serialize:function ga(e,t){var n=[],i=[];for(var r in e._hidden_rows_hash)n.push(r);for(var o in e._hidden_cols_hash)i.push(o);(n.length||i.length)&&(t.table.hidden={}),n.length&&(t.table.hidden.row=n),i.length&&(t.table.hidden.column=i)},load:function va(e,t){if(xr(e),!webix.isUndefined(t.table)&&!webix.isUndefined(t.table.hidden)){var n=t.table.hidden;if(n.row&&n.row.length)for(var i=0;i<n.row.length;i++)Vr({id:"hide",group:"row"},{row:n.row[i]},{row:n.row[i]},e,!0);if(n.column&&n.column.length)for(var r=0;r<n.column.length;r++)Er({id:"hide",group:"column"},{column:n.column[r]},{column:n.column[r]},e,!0)}}});function zr(a,e){var l=this,t=K(l,{row:a,column:e});if(t&&t.props.wrap){var n=l._table.getItem(a),s=n.$height||l._table.config.rowHeight;l._table.eachColumn(function(e,t){var n=K(l,{row:a,column:e});if(n&&n.props&&"wrap"===n.props.wrap){var i=this.getText(a,e),r=t.width,o=l._table.getSpan(a,e);o&&(r=l._table.getSpanNode({row:o[0],column:o[1]}).offsetWidth),(l.getCellEditor(a,e)||l.getCellFilter(a,e)
)&&(r+=20),s=Math.max(s,te(l,i,n.id,r).height)}}),n.$height=s}}var Ir=Object.freeze({init:function ma(o){if(o.config.resizeCell){var e=o.$$("cells");e.define("resizeRow",{headerOnly:!0,size:10}),e.define("resizeColumn",{headerOnly:!0,size:10}),e.define("fixedRowHeight",!1),e.attachEvent("onRowResize",function(e){o.$$("cells").refreshSelectArea(),b(o,"sizes",{row:e,column:0,size:o.$$("cells").getItem(e).$height})}),e.attachEvent("onColumnResize",function(e){o.$$("cells").refreshSelectArea(),b(o,"sizes",{row:0,column:e,size:o.getColumn(e).width})}),o.attachEvent("onUndo",function(e,t,n,i){"c-resize"!=e&&"r-resize"!=e||function r(e,t,n,i){t?(e.$$("cells").getItem(t).$height=i,b(e,"sizes",{row:t,column:0,size:i})):e._table.setColumnWidth(n,i),e._table.refreshSelectArea()}(o,t,n,i)})}o.attachEvent("onDataParse",function(e){!function a(e,t){if(t.sizes){for(var n=0;n<t.sizes.length;n++){var i=t.sizes[n];if(1*i[0]!=0){var r=e.$$("cells").getItem(i[0]);r&&(r.$height=1*i[2])}else{var o=e.getColumn(i[1]);o&&(o.width=1*i[2])}}t.sizes.length&&e.refresh(!0)}}(o,e)}),o.attachEvent("onDataSerialize",function(e){!function d(e,t){for(var n=[],i=e.$$("cells"),r=i.getState().order,o=i.data.order,a=i.config.columnWidth,l=i.config.rowHeight,s=1;s<r.length;s++){var c=i.getColumnConfig(r[s]).width;c&&c!=a&&n.push([0,s,c])}for(var u=0;u<o.length;u++){var h=i.getItem(o[u]).$height;h&&h!=l&&n.push([1*o[u],0,h])}t.sizes=n}(o,e)}),o.attachEvent("onAction",function(e,t){"before-grid-change"==e&&function d(e,t,n,i,r){var o,a=i.sizes,l=[];if(n){for(o=a.length-1;0<=o;o--){var s=$(a[o],3),c=s[0],u=s[1],h=s[2];c&&"row"==t&&c>=r.row||u&&"column"==t&&u>=r.column?(c="row"==t?1*c+n:c,u="column"==t?1*u+n:u,("row"==t&&0<c||"column"==t&&0<u)&&l.push([c,u,h])):l.push(a[o])}i.sizes=l}}(0,t.name,t.inc,t.data,t.start)}),o.attachEvent("onBeforeStyleChange",function(e,t,n,i){!i||"wrap"!==i.props.wrap||n&&n.props.wrap==i.props.wrap||delete o._table.getItem(e).$height}),o.attachEvent("onStyleChange",zr),o.attachEvent("onCellChange",zr)}});var Rr=Object.freeze({init:function pa(o){var a=o._table,e=0;a.attachEvent("onAreaDrag",function(){return e=new Date}),a.attachEvent("onBeforeAreaRemove",function(){if(o.$handleSelection&&new Date-e<500)return!1}),a.attachEvent("onBeforeAreaAdd",function(e){if("rowId"==e.start.column)return!1;var t=a.getEditor();if(!t||t.row==e.start.row&&t.column==e.start.column&&t.row==e.start.row&&t.column==e.start.column||a.editStop(),!o.$handleSelection)return!0;var n=C[e.start.column]+e.start.row,i=C[e.end.column]+e.end.row,r=o.$handleSelection(e.start,e.end,n,i);return!1!==r&&(o.$handleSelection=null,a.removeSelectArea()),r}),webix.event(a.$view,"mousedown",function(e){if(o.$handleSelection)return webix.html.preventEvent(e)})}});function Dr(e,t,n){var i=n.getItem(e)[t];return i!==undefined&&""!==i}var Or={"int":function(r,o){return function(e,t){if(!t[o])return-1;if(!e[o])return 1;var n=parseFloat(e[o])||r*Infinity,i=parseFloat(t[o])||r*Infinity;return(i<n?1:n==i?0:-1)*r}},str:function(r,o){return function(e,t){if(!t[o])return-1;if(!e[o])return 1;var n=e[o].toString().toLowerCase(),i=t[o].toString().toLowerCase();return(i<n?1:n==i?0:-1)*r}}};function Mr(e,t,n){if(t=t||e._table.getSelectArea()){var i=t=D(t,e);t.start.row===t.end.row&&(i=function g(e,t){for(var n=t.config.rowCount,i=t.config.columnCount,r=t._table,o=e.start.row,a=e.end.row,l=e.start.column,s=e.end.column,c=o-1;0<c&&Dr(c,e.start.column,r);c--)o=c;for(var u=a+1;u<n&&Dr(u,e.end.column,r);u++)a=u;for(var h=l-1;0<h&&Dr(e.start.row,h,r);h--)l=h;for(var d=s+1;d<i&&Dr(e.end.row,d,r);d++)s=d;var f={start:{row:o,column:l},end:{row:a,column:s}};return o==e.start.row&&a==e.end.row&&l==e.start.column&&s==e.end.column||t._table.addSelectArea(f.start,f.end),f}(t,e));var r=e.getCellValue(t.start.row,t.start.column,!1),o=isNaN(parseFloat(r))?"str":"int";n=n&&"asc"!==n?-1:1,w.set(function(){return function v(e,t,n,i,r){for(var o=e.start.column;o<=e.end.column;o++){for(var a=[],l=e.start.row;l<=e.end.row;l++)if(r.isRowVisible(l)){var s=r.getCellValue(l,o,!1),c=r.getStyle(l,o),u=r.getCellValue(l,o)
;u=u&&"="==u[0]?u:null;var h=r.conditions.get(l,o);h&&sn("remove",l,o,h,null,r),a.push({value:s,style:c,math:u,row:l,conditions:h})}a.sort(Or[n](i,"value"));for(var d=e.start.row;d<=e.end.row;d++)if(r.isRowVisible(d)){var f=a.shift();if(r.setStyle(d,o,f.style||null),f.conditions&&sn("update",d,o,null,f.conditions,r),f.math){var g=r._mData.getStore().transposeMath(f.math,d-f.row,0);r.setCellValue(d,o,g)}else r.setCellValue(d,o,f.value)}}r.refresh()}(i,t.start.column,o,n,e)})}}var Tr=Object.freeze({init:function wa(t){t.attachEvent("onCommand",function(e){"sort-asc"!==e.id&&"sort-desc"!==e.id||Mr(t,null,e.id.replace("sort-",""))})},sortRange:Mr});function Fr(e,t,n,i){if(-1==t.indexOf("!"))return t;for(var r=Qe(t,e,!0),o=0;o<r.length;o++)if(webix.isArray(r[o])){var a=r[o][0]===n?i:r[o][0];-1!=a.indexOf(" ")&&(a="'".concat(a,"'")),r[o]="".concat(a,"!").concat(r[o][1])}return r.join("")}function Nr(e){return"string"==typeof e&&"="==e[0]}var Pr=Object.freeze({init:function ba(a){a.attachEvent("onSheetRename",function(r,o){a._sheets.forEach(function(e){var t=e.name==a.getActiveSheet();t&&(e.content=a.serialize()),e.content.editors&&e.content.editors.forEach(function(e){var t=e[2].options;if(t)if("string"==typeof t)e[2].options=Fr(a,t,r,o);else for(var n=0;n<t.length;n++){var i=t[n];"string"==typeof i?Nr(i)&&(t[n]=Fr(a,i,r,o)):Nr(i.id)&&(i.id=Fr(a,i.id,r,o))}}),e.content.conditions&&(e.content.conditions.forEach(function(e){Nr(e[3])&&(e[3]=Fr(a,e[3],r,o))}),t&&(a.conditions.clear(),a.conditions.parse(e.content.conditions)))})})}});function Ur(e){var t=!(1<arguments.length&&arguments[1]!==undefined)||arguments[1],n=e.$$("cells"),i=-1!=n.$view.className.indexOf("webix_borderless");"toggle"===t&&(t=!i),!i&&t?(webix.html.addCss(n.$view,"webix_borderless",!0),e.callEvent("onCommand",[{id:"toolbar-update",name:"hide-gridlines",value:!0}]),e.callEvent("onAction",["gridlines-hide",{newValue:!0,value:!1}])):i&&!t&&(webix.html.removeCss(n.$view,"webix_borderless"),e.callEvent("onCommand",[{id:"toolbar-update",name:"hide-gridlines",value:!1}]),e.callEvent("onAction",["gridlines-hide",{newValue:!1,value:!0}]))}var jr=Object.freeze({init:function xa(r){r.attachEvent("onUndo",function(e,t,n,i){"gridlines-hide"==e&&Ur(r,i)})},hideGridlines:Ur,serialize:function _a(e,t){t.table.gridlines=-1!=e.$$("cells").$view.className.indexOf("webix_borderless")?0:1},load:function ya(e,t){var n=!1;webix.isUndefined(t.table)||webix.isUndefined(t.table.gridlines)||(n=!t.table.gridlines),Ur(e,n)}});function Br(e){var t=!(1<arguments.length&&arguments[1]!==undefined)||arguments[1],n=e.$$("cells");"toggle"===t&&(t=n.config.header),n.config.header&&t?(n.config.header=!1,n.isColumnVisible("rowId")&&n.hideColumn("rowId",{},!0,!0),n.refreshColumns(),e.callEvent("onCommand",[{id:"toolbar-update",name:"hide-headers",value:!0}]),e.callEvent("onAction",["header-hide",{newValue:!0,value:!1}])):n.config.header||t||(n.config.header=!0,n.isColumnVisible("rowId")||n.showColumn("rowId",{},!0),n.refreshColumns(),e.callEvent("onCommand",[{id:"toolbar-update",name:"hide-headers",value:!1}]),e.callEvent("onAction",["header-hide",{newValue:!1,value:!0}]))}var Hr=Object.freeze({init:function Ca(r){r.attachEvent("onUndo",function(e,t,n,i){"header-hide"==e&&Br(r,i)})},hideHeaders:Br,serialize:function $a(e,t){t.table.headers=e.$$("cells").config.header?1:0},load:function Sa(e,t){var n=!1;t.table&&!webix.isUndefined(t.table.headers)&&(n=!t.table.headers),Br(e,n)}});function Lr(e,t,n,i){Kr(e,t,n)&&(i||e.callEvent("onAction",["comment",{row:t,column:n,newValue:null,value:e.comments._pull[t][n]}]),delete e.comments._pull[t][n]),e.$$("cells").updateItem(t,n)}function qr(e,t){w.set(function(){O(t,e,function(e,t){Kr(e,t.row,t.column)&&Lr(e,t.row,t.column)}),e.$$("cells").refresh()})}function Wr(e,t,n,i,r){var o=Kr(e,t,n)?e.comments._pull[t][n]:null,a=e.$$("cells");"string"==typeof i&&(i=i.trim()?i:""),e.comments._pull[t]=e.comments._pull[t]?e.comments._pull[t]:{},e.comments._pull[t][n]=i,a.addCellCss(t,n,"ssheet_commented_cell"),r||e.callEvent("onAction",["comment",{row:t,column:n,
newValue:i,value:o}])}function Kr(e,t,n){return e.comments._pull[t]&&e.comments._pull[t][n]?e.comments._pull[t][n]:""}var Gr=Object.freeze({init:function ka(o){o.comments={get:function(e,t){return Kr(o,e,t)},add:function(e,t,n){Wr(o,e,t,n)},remove:function(e,t){Lr(o,e,t)},_activeComment:{},_pull:{}},o.attachEvent("onReset",function(){return function t(e){e.comments._pull={}}(o)}),o.attachEvent("onUndo",function(e,t,n,i){"comment"===e&&function r(e,t,n,i){Kr(e,t,n)&&Lr(e,t,n,!0),i&&Wr(e,t,n,i,!0)}(o,t,n,i)}),o.attachEvent("onAction",function(e,t){"before-grid-change"==e&&function u(e,t,n,i,r){var o=i.comments,a=o.length;if(n)for(;a--;){var l=$(o[a],2),s=l[0],c=l[1];(s&&"row"==t&&s>=r.row||c&&"column"==t&&c>=r.column)&&("row"==t?s<r.row-n?o.splice(a,1):o[a][0]=1*s+n:"column"==t&&(c<r.column-n?o.splice(a,1):o[a][1]=1*c+n))}}(0,t.name,t.inc,t.data,t.start)})},removeCommentsRange:qr,serialize:function Ea(e,t){var n,i,r=[];for(n in e.comments._pull)for(i in e.comments._pull[n])e.comments._pull[n][i]&&r.push([n,i,e.comments._pull[n][i]]);t.comments=r},load:function Va(e,t){var n,i=t.comments;if(i)for(n=0;n<i.length;n++)Wr(e,i[n][0],i[n][1],i[n][2],!0)}});var Yr=Object.freeze({init:function Aa(n){var i=[jr,Hr,Ft,pr,gi,Ar,Gr];n.attachEvent("onDataSerialize",function(e){for(var t=0;t<i.length;t++)i[t].serialize&&i[t].serialize(n,e)}),n.attachEvent("onDataParse",function(e){for(var t=0;t<i.length;t++)i[t].load&&i[t].load(n,e)})}}),Xr=[".xls",".xlt",".xla",".xlsx",".xlsm",".xltx",".xltm",".xlam",".xlsb"];var Zr=Object.freeze({init:function za(t){var i;window.XMLHttpRequest&&(new XMLHttpRequest).upload&&((i=webix.ui({view:"uploader",apiOnly:!0,accept:Xr.join()})).attachEvent("onBeforeFileAdd",webix.bind(function(e){return-1<Xr.indexOf("."+e.type.toLowerCase())&&(t.reset(),t.parse(e.file,"excel")),!1},this)),t._destroy_with_me.push(i)),t.attachEvent("onCommand",function(e){"excel-import"===e.id&&function n(e,t){t?webix.delay(function(){return t.fileDialog()}):e.alert(webix.i18n.spreadsheet.labels["import-not-support"])}(t,i)})}});function Qr(e,t){var n=e._activeSheet,i=function r(a,l,s){var c=webix.html.create("div",{"class":"webix_ssheet_print"});l.xCorrection=1,l.header=l.header||!1,l.trim=!!webix.isUndefined(l.trim)||l.trim,l.sheetnames=!!webix.isUndefined(l.sheetnames)||l.sheetnames;var u=a.$index;return a._sheets.forEach(function(e,t){if(a.$index=u+"_"+t,"all"===l.data||"all"!==l.data&&e.name===s){a.showSheet(e.name);var n="wss_"+a.$index;if(l.sheetnames){var i=webix.html.create("div",{"class":"webix_view webix_ssheet_sheetname"},e.name+":");c.appendChild(i)}a._print=!0;var r=a._table.$customPrint(l,!0);if(delete a._print,r.firstChild&&(r.firstChild.className+=" "+n),c.appendChild(r),"all"==l.data&&t+1<a._sheets.length){var o=webix.html.create("DIV",{"class":"webix_print_pagebreak"});c.appendChild(o)}}}),a.$index=u,c}(e,t,n);webix.html.insertBefore(i,t.docFooter,document.body),window.print(),function o(n,e){webix.html.remove(e),n._sheets.forEach(function(e,t){webix.html.removeStyle(".wss_"+n.$index+"_"+t)})}(e,i),e.showSheet(n)}var Jr=Object.freeze({print:Qr,init:function Ia(t){t.$customPrint=function(e){Qr(t,e)}}});function eo(e){return 3===(e=e.substring(1)).length&&(e+=e),e}function to(e,t){var n=e.split(";"),i={};t&&(i={font:{},alignment:{},border:{}});for(var r=0;r<n.length;r++)n[r]&&(t?no(i,n,r):io(i,n,r));return i}function no(e,t,n){switch(U[n]){case"color":e.font.color={rgb:eo(t[n])};break;case"background":var i=eo(t[n]);i&&"ffffff"!==i.toLowerCase()&&(e.fill={fgColor:{rgb:i}});break;case"text-align":e.alignment.horizontal=t[n];break;case"font-family":e.font.name=t[n].replace(/'|,.*$/g,"");break;case"font-size":e.font.sz=.75*t[n].replace("px","");break;case"font-style":e.font.italic="italic"==t[n];break;case"text-decoration":e.font.underline="underline"==t[n];break;case"font-weight":e.font.bold="bold"==t[n];break;case"vertical-align":e.alignment.vertical="middle"==t[n]?"center":t[n];break;case"wrap":e.alignment.wrapText="wrap"==t[n];break;case"borders":break;case"format":e.format=be(t[n],!0)||"";break;case"border-right":
case"border-bottom":case"border-left":case"border-top":e.border[U[n].split("-")[1]]=ro(t[n],!0)}}function io(e,t,n){switch(U[n]){case"color":e.color=eo(t[n]);break;case"background":e.backgroundColor=eo(t[n]);break;case"text-align":e.textAlign=t[n];break;case"font-family":break;case"font-size":e.fontSize=.75*t[n].replace("px","");break;case"font-style":e.italic="italic"==t[n];break;case"text-decoration":e.underline="underline"==t[n];break;case"font-weight":e.bold="bold"==t[n];break;case"vertical-align":e.vertAlign=t[n];break;case"wrap":e.whiteSpace="nowrap"!=t[n];break;case"borders":case"format":break;case"border-right":case"border-bottom":case"border-left":case"border-top":var i=U[n].split("-")[1];e["border".concat(i[0].toUpperCase()+i.substring(1),"Color")]=ro(t[n])}}function ro(e,t){var n=$(e.split(","),2),i=n[0],r=n[1];return t?{color:{rgb:eo(i)},style:r}:eo(i)}function oo(e){if(!e)return{};for(var t=[],n=0;n<U.length;n++)t.push(e[U[n]]||"");return to(t.join(";"),!0)}var ao=Object.freeze({init:function Ra(a){var o=a._table;a.$exportView=function(e){var t="pdf"==e.export_mode,n="excel"==e.export_mode,i={header:!1,footer:!1,heights:!0,rawValues:!t,filterHTML:!0,spans:!0,styles:!0,math:!t,hidden:n,xCorrection:o.config.header||e.hidden?1:0,ignore:{rowId:!0},conditions:!0};return webix.extend(e,i),n||t?function r(v,m){var p=this,w=arguments,x="excel"==m.export_mode;!0===m.sheets?m.sheets=v._sheets.map(function(e){return e.name}):m.sheets&&m.sheets.length?"string"==typeof m.sheets&&(m.sheets=[m.sheets]):m.sheets=[v._activeSheet],m.dataOnly=!0;for(var y=[],C=v._activeSheet,e=function(n){var e=m.sheets[n],t=e.id||e;v.showSheet(t),m.hidden&&(m.xCorrection=1);var i=e.options?webix.extend(e.options,m):webix.copy(m);t!=C&&(i._hidden=!0),i.name||(i.name=t);var r=!x&&"image"!=i.display,o=v.serialize(),a=yn(o.data,o.spans,0,0),l=$(a,2),s=l[0],c=l[1];if(!x&&(webix.isUndefined(i.textBefore)&&(i.textBefore=i.name),r)){i.ignore=i.ignore||{};for(var u=c+1;u<=v.config.columnCount;u++)i.ignore[u]=!0;var h=i.filter||function(){return!0};i.filter=function(e){return e.id<=s&&h.apply(p,w)}}var d=webix[x?"toExcel":"toPDF"](v._table,i);if(r&&0==d[0].scheme.length)return"continue";if((x||r)&&i.styles){var f=d[0].styles=function b(c,h,d,e,f){c.compactStyles();var g=[],v={},m={},p=function i(e){var t=P;return"excel"==e.export_mode?{font:{sz:.75*t["font-size"].replace("px",""),name:t["font-family"].replace(/'|,.*$/g,"")},alignment:{horizontal:t["text-align"],vertical:"center",wrapText:"nowrap"!=t["white-space"]}}:{fontSize:.75*t["font-size"].replace("px",""),textAlign:t["text-align"],whiteSpace:"nowrap"!=t["white-space"]}}(h);d&&h.docHeader&&(g=g.concat([{0:oo(h.docHeader.css)},{}])),h.header&&g.push({});var t=g.length,n=c.$$("cells"),w=t;return n.eachRow(function(l){if(!(e<l)){var s=0;n.eachColumn(function(e){if(!(f<s)){if(s>=h.xCorrection){var t,n=c.getStyle(l,e),i=s-h.xCorrection;if(g[w]=g[w]||{},n)if(v[n.id])t=webix.copy(v[n.id]);else{for(var r in t=to(n.text,d),p)d?webix.extend(t[r],p[r]):t[r]||(t[r]=p[r]);v[n.id]=webix.copy(t)}else t=webix.copy(p);if(h.conditions){var o=function u(e,t,n,i){var r=gn(e,t,n),o=Qt(e,t,n,r);if(o){if(i[o])return i[o];var a=webix.html.create("div",{"class":o});document.body.appendChild(a);var l=window.getComputedStyle(a),s=l.backgroundColor,c=l.color;return document.body.removeChild(a),i[o]=[s,c],i[o]}}(c,l,e,m);o&&function a(e,t,n){var i=$(t.map(function(e){return webix.color.rgbToHex(e)}),2),r=i[0],o=i[1];n?(e.fill={fgColor:{rgb:r}},e.font.color={rgb:o}):(e.backgroundColor=r,e.color=o)}(t,o,d)}g[w][i]=t,g[w][i].type=it(c,l,e)}s++}},h.hidden),w++}},h.hidden),d&&h.docFooter&&(g=g.concat([{},{0:oo(h.docFooter.css)}])),g}(v,i,x,s,c);r&&function _(e,t,n,i,r){var o=n.header?1:0;if(n.spans)for(var a in r.spans)if(1<r.spans[a][2]){var l=r.spans[a][0]-1+o,s=r.spans[a][1]-1,c=r.spans[a][2];if(e[l]&&e[l][s]){e[l][s].colspan=c;var u=t[0].exportData[l-o];u&&u.splice(s+1,c-1);var h=Object.values(e[l]);h.splice(s+1,c-1),e[l]=h}}for(var d=t[0].exportData,f=0;f<d.length;f++)for(var g=0;g<d[f].length;g++){var v=i.$$("cells"
).config.rowHeight;if(n.heights&&r.sizes.length)for(var m=0;m<r.sizes.length;m++){var p=r.sizes[m][0];if(p&&p==f+1){v=r.sizes[m][2];break}}var w=e[f+o][g],b=w.vertAlign,x=.75*v-w.fontSize;w.paddingTop="top"==b?0:"bottom"==b?x:x/2,w.paddingBottom="bottom"==b?0:"top"==b?x:x/2}}(f,d,i,v,o)}y=y.concat(d),x?(y[n].ranges=[],v.ranges.serialize(t).forEach(function(e){var t=e[1].split("!");y[n].ranges.push({Sheet:e[2]?null:n,Name:e[0],Ref:t[0]+"!"+t[1].replace(/[0-9]+|[A-Z]+/gi,function(e){return"$".concat(e)})})})):m.autowidth&&function g(e,t){var n,i=t.orientation&&"landscape"==t.orientation?"height":"width";n=e.$width?e.$width:e[i],t[i]=Math.max(t[i]||0,n||0)}(i,m)},t=0;t<m.sheets.length;t++)e(t);return v.showSheet(C),delete m.dataOnly,y}(a,e):o},o.$getExportValue=function(e,t,n){var i=a.getCellValue(e,t,n.math),r=n.export_mode,o=n.math&&"="==i[0];return"pdf"!=r&&"csv"!=r||o||n.rawValues?"string"==typeof i&&i.match(/^=(image|sparkline)\(/i)?"":i:gn(a,e,t)}}});function lo(e,t,n){for(var i=webix.copy(e.data),r=[],o=0;o<i.length;o++)for(var a=0;a<i[0].length;a++){var l=o+1,s=a+1;r.push([l,s,i[o][a]])}if(e.data=r,e.spans)for(var c=0;c<e.spans.length;c++)e.spans[c][0]++,e.spans[c][1]++;if(t)for(var u=0;u<t.length;u++)t[u].Sheet===n&&(e.ranges=e.ranges||[],e.ranges.push([t[u].Name.toUpperCase(),t[u].Ref.substring(t[u].Ref.indexOf("!")+1).replace(/\$/g,"")]));if(e.styles&&function d(e){for(var t={},n=[],i=1,r=0;r<e.styles.length;r++){for(var o=[],a=e.styles[r][2],l=void 0,s=0;s<U.length;s++)switch(U[s]){case"color":o[s]=a.font&&a.font.color&&so(a.font.color.rgb)||"";break;case"background":o[s]=a.fill&&a.fill.fgColor&&so(a.fill.fgColor.rgb)||"";break;case"text-align":o[s]=(a.alignment?a.alignment.horizontal:"")||P["text-align"];break;case"font-family":o[s]=a.font&&a.font.name?co(a.font.name):"";break;case"font-size":o[s]=a.font&&a.font.sz&&a.font.sz/.75+"px"||"";break;case"font-style":o[s]=a.font&&a.font.italic?"italic":"";break;case"text-decoration":o[s]=a.font&&a.font.underline?"underline":"";break;case"font-weight":o[s]=a.font&&a.font.bold?"bold":"";break;case"vertical-align":var c=a.alignment&&a.alignment.vertical||"";o[s]=("center"==c?"middle":c)||P["vertical-align"];break;case"wrap":o[s]=a.alignment&&a.alignment.wrapText?"wrap":"nowrap";break;case"borders":case"format":o[s]="";break;case"border-right":case"border-bottom":case"border-left":case"border-top":o[s]=uo(U[s],a)}o=o.join(";"),l=t[o]||"wss"+i;for(var u=0;u<e.data.length;u++)if(e.data[u][0]===e.styles[r][0]+1&&e.data[u][1]===e.styles[r][1]+1){e.data[u][3]=l;break}t[o]||(n.push([l,o]),t[o]=l,i++)}e.styles=n}(e),e.types&&function f(n){n.types.forEach(function(e){for(var t=0;t<n.data.length;t++)if(n.data[t][0]===e[0]+1&&n.data[t][1]===e[1]+1){n.data[t][4]=e[2];break}})}(e),e.hidden&&function g(e){for(var t={row:[],column:[]},n=0;n<e.hidden.length;n++){var i=e.hidden[n];"column"==i[0]?t.column.push(i[1]+1):t.row.push(i[1]+1)}e.table={hidden:t}}(e),e.sizes)for(var h=0;h<e.sizes.length;h++)"column"==e.sizes[h][0]?e.sizes[h]=[0,e.sizes[h][1]+1,e.sizes[h][2]]:e.sizes[h]=[e.sizes[h][1]+1,0,e.sizes[h][2]];return e}function so(e){return 8===(e=e||"000000").length&&(e=e.substring(2)),"#"+e}function co(e){for(var t=P["font-family"],n=0;n<st.length;n++)if(st[n].value==e){t=st[n].id;break}return t}function uo(e,t){if(e=e.replace("border-",""),t.border&&t.border[e]){var n=t.border[e],i=so(n.color.rgb)||"",r=n.style||"";return"".concat(i,",").concat(r)}return""}var ho=Object.freeze({init:function Da(o){o._parseExcel=function(e,t){var n=e.options||{};n.math=o.config.math;for(var i={sheets:[]},r=0;r<e.names.length;r++)n.name=e.names[r],i.sheets.push({name:n.name,content:lo(t.getSheet(e,n),e.ranges,r)});return i},o._parseCsv=function(e,t){e=t.getRecords(e);for(var n=webix.copy(e),i=[],r=0;r<n.length;r++)for(var o=n[r].split(t.cell),a=0;a<o.length;a++){var l=r+1,s=a+1;i.push([l,s,o[a]])}return{data:i}}}});var fo=Object.freeze({init:function Oa(t){t.attachEvent("onCommand",function(e){switch(e.id){case"clear-value":t.clearRange(null,{values:!0});break;case"clear-style":t.clearRange(null,{
styles:!0});break;case"clear-conditional-formats":t.clearRange(null,{conditions:!0});break;case"clear-dropdown-editors":t.clearRange(null,{editors:!0});break;case"clear-all":w.set(function(){t.clearRange(null,null)});break;case"clear-comments":t.clearRange(null,{comments:!0})}})}});function go(e,t,n){if(t)webix.isArray(t)||(t=[t,t]);else{var i=e.$$("cells").getSelectArea();i&&(t=[i.start[n],i.end[n]])}return t}function vo(e,t,n,i){var r={},o={};(i=go(e,i,n))&&(r[n]=i[0],o[n]=i[1],e.callEvent("onCommand",[{id:t,group:n},r,o]))}function mo(t,n,i,r){(i=go(t,i,n))&&w.set(function(){for(var e=i[0];e<=i[1];e++)"auto"!=r?t.$$("cells")["row"==n?"setRowHeight":"setColumnWidth"](e,r):("row"==n?It:zt)(e,t)})}var po=Object.freeze({insertRow:function Ma(e){vo(this,"add","row",e)},deleteRow:function Ta(e){vo(this,"del","row",e)},setRowHeight:function Fa(e,t){mo(this,"row",e,t)},insertColumn:function Na(e){vo(this,"add","column",e)},deleteColumn:function Pa(e){vo(this,"del","column",e)},setColumnWidth:function Ua(e,t){mo(this,"column",e,t)}});var wo=Object.freeze({lockCell:function ja(e,t,n){Mt(this,e,t,n)},isCellLocked:function Ba(e,t){return Tt(this,e,t)}});function bo(e,t,n){var i=e.$$("cells");if("row"==t)for(var r=e.config.columnCount,o=1;o<=r;o++){var a=i.getSpan(n,o);if(a){var l=1*a[0]+a[3]-1;n<l&&xo(e,a,a[2],a[3]-(l-n))}}else for(var s=i.data.order[0],c=i.data.order.length,u=s;u<=c;u++){var h=i.getSpan(u,n);if(h){var d=1*h[1]+h[2]-1;n<d&&xo(e,h,h[2]-(d-n),h[3])}}}function xo(e,t,n,i){e.splitCell(t[0],t[1]),e.combineCells({cell:{row:t[0],column:t[1]},x:n,y:i})}var _o=Object.freeze({freezeColumns:function Ha(e){var t=this.$$("cells");if(webix.isUndefined(e)){var n=this.getSelectedId(!0);e=n.length?n[0].column:0}var i="rowId"==t.config.columns[0].id?1:0,r=i;if(e&&e!=this._frozenColumns){for(var o=e;0<o&&!(r=t.getColumnIndex(o)+1);o--);r||(r=i)}w.set(function(){bo(this,"column",e),t.unselect(),t.define("leftSplit",r),t.refreshColumns(),this.callEvent("onAction",["freeze-column",{value:this._frozenColumns||0,newValue:e}]),this._frozenColumns=e||0},this)},freezeRows:function La(e){var t=this.$$("cells");if(webix.isUndefined(e)){var n=this.getSelectedId(!0);e=n.length?n[0].row:0}var i=0;if(e&&e!=this._frozenRows)for(var r=e;0<r&&!(i=t.getIndexById(r)+1);r--);w.set(function(){bo(this,"row",e),t.unselect(),t.define("topSplit",i),t.refreshColumns(),this.callEvent("onAction",["freeze-row",{value:this._frozenRows,newValue:e}]),this._frozenRows=e||0},this)}});var yo=Object.freeze({hideGridlines:function qa(e){Ur(this,e)}});var Co=Object.freeze({hideHeaders:function Wa(e){Br(this,e)}});var $o=Object.freeze({hideColumn:function Ka(e,t){yr(this,e,t,"column")},isColumnVisible:function Ga(e){return _r(this,e)},hideRow:function Ya(e,t){yr(this,e,t,"row")},isRowVisible:function Xa(e){return Cr(this,e)}});function So(e){return e||0===e?e:""}var ko=Object.freeze({addImage:function Za(e,t,n){this.setCellValue(e,t,function i(e){return'=IMAGE("'.concat(e,'")')}(n)),this.refresh()},addSparkline:function Qa(e,t,n){var i=function r(e){var t="=SPARKLINE(".concat(e.range,',"').concat(e.type,'"');return"bar"===e.type?t+=',"'.concat(e.color,'","').concat(e.negativeColor,'"'):e.color&&(t+=',"'.concat(e.color,'"')),t+")"}(n);this.setCellValue(e,t,i),this.refresh()},getSheetData:function Ja(n){var i=this,r=this._mData.getPage(n);if(r)return{getValue:function(e,t,n){return So(r.getValue(e-1,t-1,n))},getRangeValue:function(e){var t=z(e,i,n);return t?(t[4]==n?r:i._mData.getPage(t[4])).getRange(t[0]-1,t[1]-1,t[2]-1,t[3]-1).map(So):[]}}},registerMathMethod:function el(e,t){if(e=e.toUpperCase(),r(e,t),this.$$("liveEditor")){var n=this.$$("liveEditor").config.suggest,i=webix.$$(n).getList();i.exists(e)||i.add({id:e,value:e})}},recalculate:function tl(){this._mData.getStore().recalculate(),this.callEvent("onMathRefresh",[]),this.refresh()},setPlaceholder:function nl(e,t){"object"==g(e)&&(t=e,e="*"),this._mData.getStore().setPlaceholder(e,t),this.refresh(),this.callEvent("onMathRefresh",[])}});var Eo=Object.freeze({combineCells:function il(e){var t=this;if(!e){
var n=this.getSelectedId(!0);1<n.length&&(e=jt(n))}w.set(function(){e&&Pt(t,e.cell,e.x,e.y)}),this.refresh()},splitCell:function rl(e,t){e&&t?Ut(this,{row:e,column:t}):w.set(function(){this.eachSelectedCell(function(e){Ut(this,e)})},this),this.refresh()},addStyle:function ol(e,t){return Y(this,e,t)},getStyle:function al(e,t){return K(this,{row:e,column:t})},setStyle:function ll(e,t,n){return J(this,{row:e,column:t},n)},setRangeStyle:function sl(e,t){w.set(function(){ee(this,e,t)},this)},clearRange:function cl(e,t){(e||(e=this._table.getSelectArea()))&&(t||(t={styles:!0,values:!0,editors:!0,conditions:!0,comments:!0}),t.styles&&ae(this,e),t.conditions&&an(this,e),t.values&&this.setRangeValue(e,null),t.editors&&(ur(this,e),ri(this,e)),t.comments&&qr(this,e),this.refresh())},compactStyles:function ul(){return le(this)},serialize:function hl(e){var t={};return this.callEvent("onDataSerialize",[t,e]),e&&(e.compactStyles&&(t.styles=se(t)),e.sheets)?function a(t,e,n){Nn(t,t._activeSheet).content=e;var i=webix.copy(t._sheets),r=!n||!1!==n.math,o=n&&n.compactStyles;return i.forEach(function(e){e.name!=t._activeSheet&&(e.content.data=Cn(t,r,e.name),o&&(e.content.styles=se(e.content)),e.content.ranges=t.ranges.serialize(e.name))}),i}(this,t,e):t},showSheet:function dl(e){Fn(this,e)},getActiveSheet:function fl(){return this._activeSheet},addSheet:function gl(e){zn(this,e)},clearSheet:function vl(){this.reset()},renameSheet:function ml(e,t){Dn(this,e,t)},editSheet:function pl(e){In(this,e)},removeSheet:function wl(e){Rn(this,e)},undo:function bl(){Ri(this)},redo:function xl(){Di(this)},sortRange:function _l(e,t){Mr(this,e,t)}});function Vo(e){return e||0===e?e:""}var Ao=Object.freeze({refresh:function yl(e){e?this._table.refreshColumns():this._table.refresh()},eachSelectedCell:function Cl(e){for(var t=this.getSelectedId(!0),n=0;n<t.length;n++)e.call(this,t[n])},getSelectedRange:function $l(e){var t=this._table.getSelectArea();return t?(e&&(e=this.getActiveSheet()),R(t.start.row,t.start.column,t.end.row,t.end.column,e)):""},getSelectedId:function Sl(e){var t=this._table.getSelectArea();if(!e)return t&&t.start.row?t.start:null;var n=[];if(t)for(var i=t.start,r=t.end,o=i.row;o<=r.row;o++)for(var a=i.column;a<=r.column;a++)n.push({row:o,column:a});return n},getCellValue:function kl(e,t,n){return Vo(this._mPage.getValue(e-1,t-1,!1!==n))},setCellValue:function El(t,n,i){var r=this;i=Vo(i);var e,o=this.getCellValue(t,n),a=it(this,t,n);if("date"==a){var l=webix.Date.strToDate(webix.i18n.spreadsheet.formats.parseDateTime),s=isNaN(i)?c(l(i)):i;e=o==s}else"string"==a||""===i||isNaN(i)||o!=i||(e=!0,i*=1);e||o===i||w.set(function(){if(r.callEvent("onBeforeValueChange",[t,n,i,o])){r._mPage.setValue(t-1,n-1,i),r.callEvent("onCellChange",[t,n,i]);var e=it(r,t,n);a!=e&&"string"==e&&"="==i[0]&&1<i.length&&r._mPage.setValue(t-1,n-1,i),r.saveCell(t,n)}})},setRangeValue:function Vl(i,r){w.set(function(){for(var e=D(i,this),t=e.start.row;t<=e.end.row;t++)for(var n=e.start.column;n<=e.end.column;n++)this.setCellValue(t,n,r)},this)},getRow:function Al(t){for(var r=this,o=webix.copy(this._table.getItem(t)),e=function(n){var i=r._mPage.getCell(t-1,n-1);if(i){o[n]=i.value,[["style","$cellCss"],["type","$cellType"],["format","$cellFormat"]].forEach(function(e){var t=i[e[0]];t&&(o[e[1]]||(o[e[1]]={}),o[e[1]][n]=t)});var e=r.getCellValue(t,n,!0);e&&"="==e[0]&&(o["$"+n]=e)}},n=1;n<this.config.columnCount;n++)e(n);return o},getColumn:function zl(e){return this._table.getColumnConfig(e)},reset:function Il(e){var t={data:[]};e&&e.sheets&&(t=Tn(t)),this.parse(t)},_resetTable:function Rl(){fn(this)}});var zo=Object.freeze({saveCell:function Dl(e,t){var n=this.getStyle(e,t);b(this,"data",{row:e,column:t,value:this.getCellValue(e,t),style:n?n.id:""})}});var Io=Object.freeze({setCellEditor:function Ol(e,t,n){var i=this._table._ssEditors[e]=this._table._ssEditors[e]||{},r=i[t]||null;(i[t]=n)&&n.editor?this._table.addCellCss(e,t,"ss_editor"):(delete this._table._ssEditors[e][t],this._table.removeCellCss(e,t,"ss_editor")),this.callEvent("onAction",["dropdown",{row:e,
column:t,value:r,newValue:n}])},getCellEditor:function Ml(e,t){return(this._table._ssEditors[e]||{})[t]||null}});var Ro=Object.freeze({setCellFilter:function Tl(e,t,n){var i=this._table._ssFilters[e]=this._table._ssFilters[e]||{},r=i[t]||null;if(n&&(webix.isArray(n)||"string"==typeof n)&&(n={options:n}),(i[t]=n)&&"object"==g(n)){if(this._table.addCellCss(e,t,"ss_filter"),n.value&&ai(n.value)&&this._table.addCellCss(e,t,"ss_filter_active"),webix.extend(n,{row:e,column:t},!0),n.options=oi(this,e,t,n.options),!n.handler&&n.value&&n.value.condition){var o=n.mode||ci(this,e,t);n.handler=fi(o,n.value)}}else delete this._table._ssFilters[e][t],this._table.removeCellCss(e,t,"ss_filter"),this._table.removeCellCss(e,t,"ss_filter_active");this.callEvent("onAction",["filter",{row:e,column:t,value:r,newValue:n}])},getCellFilter:function Fl(e,t){return(this._table._ssFilters[e]||{})[t]||null},removeFilters:function Nl(){for(var t=this,e=ii(this._table),n=0;n<e.length;n++){var i=e[n],r=i.row,o=i.column;this.setCellFilter(r,o,null)}this._table._ssFilters={},this._table.data.filter(function(e){return t.isRowVisible(e.id)})},filterSpreadSheet:function Pl(){this._table.data.silent(function(){var a=this,l=ii(this._table);this._table.data.filter(function(e){return a.isRowVisible(e.id)});for(var e=function(e){var t=l[e],n=t.row,i=t.column,r=t.handler,o=!1;a._table.data.filter(function(e){if(o||1*e.id<=1*n)return!0;var t=a._mPage.getValue(e.id-1,i-1);return t||""===t?"function"!=typeof r||r(String(t)):o=!0},1,!0)},t=0;t<l.length;t++)e(t)},this),this._table.callEvent("onAfterFilter",[]),this._table.refresh()}});var Do=Object.freeze({confirm:function Ul(e){return webix.confirm({css:"webix_ssheet_confirm",text:e.text,ok:webix.i18n.spreadsheet.labels.ok,cancel:webix.i18n.spreadsheet.labels.cancel})},alert:function jl(e){return webix.alert({css:"webix_ssheet_alert",text:e.text,ok:webix.i18n.spreadsheet.labels.ok})}});var Oo=Object.freeze({resetUndo:function Bl(){Oi(this)},groupUndo:function Hl(e){w.set(e,this)},ignoreUndo:function Ll(e){Ti(e,this)}});var Mo=Object.freeze({setFormat:function ql(e,t,n){_e(this,e,t,n)},changeDecimals:function Wl(e,t,n){Ie(this,n,e,t)}});var To=[{id:"file",submenu:[{id:"sheet",submenu:[{id:"new-sheet"},{id:"copy-sheet"},{id:"remove-sheet"}]},{id:"excel-import"},{id:"excel-export"}]},{id:"edit",submenu:[{id:"add-range"},{id:"add-dropdown"},{id:"add-link"},{id:"lock-cell"},{id:"conditional-format"},{id:"clear",submenu:[{id:"clear-value"},{id:"clear-style"},{id:"clear-conditional-formats"},{id:"clear-dropdown-editors"},{id:"clear-comments"},{$template:"Separator"},{id:"clear-all"}]}]},{id:"insert",submenu:[{id:"image",submenu:[{id:"add-image-cell"},{id:"add-image-top"}]},{id:"graph",submenu:[{id:"add-sparkline"},{id:"add-chart"}]},{id:"add-comment"}]},{id:"data",submenu:[{id:"sort",submenu:[{id:"sort-asc"},{id:"sort-desc"}]},{id:"create-filter"}]},{id:"view",submenu:[{id:"columns",submenu:[{id:"insert-column"},{id:"delete-column"},{id:"show-column"},{id:"hide-column"},{id:"resize-column"}]},{id:"rows",submenu:[{id:"insert-row"},{id:"delete-row"},{id:"show-row"},{id:"hide-row"},{id:"resize-row"}]},{$template:"Separator"},{id:"freeze-columns"},{id:"freeze-rows"},{id:"hide-gridlines"},{id:"hide-headers"}]}],Fo={getMenuData:function(e,t){var n;for(n=0;n<e.length;n++)"string"==typeof e[n]&&(e[n]={id:e[n]}),"resize-column"!=e[n].id&&"resize-row"!=e[n].id||t.resizeCell?(e[n].value||(e[n].value=webix.i18n.spreadsheet.menus[e[n].id]),e[n].submenu&&(e[n].submenu=this.getMenuData(e[n].submenu,t))):(e.splice(n,1),n--);return e}};function No(t){t.attachEvent("onComponentInit",function(){return function e(t){t.$$("menu")&&t.$$("menu").attachEvent("onMenuItemClick",function(e){return function n(e,t){e.callEvent("onMenuItemClick",[t])&&(Po[t]?Po[t](e):e.callEvent("onCommand",[{id:t}]))}(t,e)})}(t)});var e=t.config,n={view:"menu",borderless:!0,css:"webix_ssheet_menu",id:"menu",autowidth:!0,type:{height:40},data:Fo.getMenuData(webix.isArray(e.menu)?e.menu:webix.copy(To),t.config)};return t.callEvent("onViewInit",["menu",n]),n}var Po={
undo:function(e){e.undo()},redo:function(e){e.redo()},"insert-column":function(e){e.insertColumn()},"delete-column":function(e){e.deleteColumn()},"show-column":function(e){e.hideColumn(null,!1)},"hide-column":function(e){e.hideColumn(null,!0)},"resize-column":function(e){e.callEvent("onCommand",[{id:"resize",group:"column",value:webix.i18n.spreadsheet.menus["resize-column"]}])},"insert-row":function(e){e.insertRow()},"delete-row":function(e){e.deleteRow()},"show-row":function(e){e.hideRow(null,!1)},"hide-row":function(e){e.hideRow(null,!0)},"resize-row":function(e){e.callEvent("onCommand",[{id:"resize",group:"row",value:webix.i18n.spreadsheet.menus["resize-row"]}])},"freeze-columns":function(e){e.freezeColumns()},"hide-gridlines":function(e){e.hideGridlines("toggle")},"hide-headers":function(e){e.hideHeaders("toggle")}};var Uo={name:"spreadsheet",_base_index:{count:1},defaults:{spans:!0,liveEditor:!0,rowCount:50,math:!0,columnCount:20,resizeCell:!0,sheetTabWidth:90,conditionStyle:function Kl(){return[{name:Gt("normal"),css:"webix_ssheet_condition_regular"},{name:Gt("neutral"),css:"webix_ssheet_condition_neutral"},{name:Gt("bad"),css:"webix_ssheet_condition_bad"},{name:Gt("good"),css:"webix_ssheet_condition_good"}]}()},$init:function(){var e=this;this.$index=this._base_index.count++,this.$view.className+=" webix_ssheet",this.$ready.unshift(this._sub_init),this.$ready.unshift(me),this.$ready.push(this._set_handlers),this._destroy_with_me=[],this.attachEvent("onDestruct",function(){e._destroy_with_me.forEach(function(e){return e.destructor()})})},$skin:function(){!function n(){var e=webix.skin.$name,t="material"==e||"mini"==e;N.width=webix.skin.$active.inputHeight+2,N.titleHeight="mini"==webix.skin.$name?18:20,P["font-family"]=t?"'Roboto', sans-serif":"'PT Sans', Tahoma","contrast"==e&&(P.background="#393939",P.color="#ffffff")}()},_sub_init:function(){var e=this.config,t=[];!e.readonly&&e.menu&&t.push(No(this)),e.readonly||!1===e.toolbar||t.push(xt(this)),e.subbar&&t.push(e.subbar),!e.readonly&&e.liveEditor&&t.push(xn(this));var n={editable:!e.readonly,liveEditor:e.liveEditor};e.rowHeight&&(n.rowHeight=e.rowHeight),e.columnWidth&&(n.columnWidth=e.columnWidth),e.readonly?t.push(hn(this,n)):t.push({cols:[hn(this,n),rr(this)]});var i=!0===e.bottombar?Vn(this):e.bottombar;i&&t.push(i),En(this),e.readonly||function r(o){o.attachEvent("onComponentInit",function(){return o.$$("context").attachTo(o._table.$view)});var e=webix.i18n.spreadsheet.menus,a={data:[{id:"clear",value:e.clear,submenu:ht()},{id:"lock-cell",value:e["lock-cell"]},{$template:"Separator"},{id:"sort",value:e.sort,submenu:[{id:"sort-asc",value:e["sort-asc"]},{id:"sort-desc",value:e["sort-desc"]}]},{id:"create-filter",value:e["create-filter"]},{$template:"Separator"},{id:"add-range",value:e["add-range"]},{id:"add-link",value:e["add-link"]},{id:"add-comment",value:e["add-comment"]}],column:ct(o),row:ut(o)},t={view:"contextmenu",id:"context",padding:0,submenuConfig:{padding:0,on:{onBeforeShow:function(){this.sizeToContent()}}},data:[],on:{onMenuItemClick:function(e){o.callEvent("onCommand",[this.getMenuItem(e)])},onBeforeShow:function(e){var t,n;if(webix.callEvent("onClick",[]),!(n=o._table.locate(e)))return!1;if(t="",n.header&&"rowId"!==n.column?(St(n.column,o)||$t(n.column,o),t="column"):n.row&&(t="rowId"===n.column?(Et(n.row,o)||yt(n.row,o),"row"):(kt(n.row,n.column,o)||o._table.addSelectArea(n,n),"data")),t){var i=function r(e,t,n){var i={area:t,data:n};return e.callEvent("onContextMenuConfig",[i])?i.data:null}(o,t,a[t]);if(i)return this.clearAll(),this.parse(i),this.sizeToContent(),webix.html.preventEvent(e),!0}return!1}}};o.callEvent("onViewInit",["context",t]);var n=o.ui(t);o._destroy_with_me.push(n)}(this),function o(e){for(var i={},t=e.config.readonly?[Vi]:zi,n=0;n<t.length;n++)i[t[n].action]=new t[n].DialogBox(e);e.attachEvent("onCommand",function(e){var t=i[e.id];t&&t.open(e)}),e.attachEvent("onAction",function(e,t){if("add-view"==e&&!t.newValue){var n=i["add-image-top"];n&&n.viewid==t.row&&n.close()}})}(this),this.rows_setter(t)},_set_handlers:function(){
var e=this;this._table||(this._table=this.$$("cells"),function i(e){for(var t=[sr,un,ce,br,We,Rr,Tr,Ui,Dt,Ar,Ft,Kt,Ir,We,$n,o,ti,Pr,pr,Yr,ot,Zr,gi,Jr,ao,ho,fo,Gr,_,Hr,jr,nr],n=0;n<t.length;n++)t[n].init&&t[n].init(e)}(this),fn(this,this.config.columnCount,this.config.rowCount),vn(this),this._table.attachEvent("onAfterAreaAdd",function(){return e.callEvent("onAfterSelect",[e.getSelectedId(!0)])}),this.callEvent("onComponentInit",[]))},$onLoad:function(e,t){this._set_handlers(),e.excel?e=this._parseExcel(e,t):e.data||"string"!=typeof e||!t.cell&&!t.row||(e=this._parseCsv(e,t)),function i(e,t){if(e._loading_data=!0,!(t=webix.isArray(t)?{sheets:t}:t).sheets&&e._activeSheet){var n=e._activeSheet;On(e,n,Nn(e,n).content=t),Pn(e,t)}else Mn(e,t);e._loading_data=!1}(this,e)}};!function Gl(e){for(var t=[po,wo,_o,yo,Co,$o,ko,Eo,Ao,zo,Io,Ro,Do,Oo,Mo],n=0;n<t.length;n++)webix.extend(e,t[n])}(Uo),webix.protoUI(Uo,webix.AtomDataLoader,webix.IdSpace,webix.ui.layout)});
//# sourceMappingURL=spreadsheet.js.map
