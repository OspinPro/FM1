/*
@license
Webix <%= pkg.productName %> v.<%= pkg.version %>
This software is covered by Webix Trial License.
Usage without proper license is prohibited.
(c) XB Software Ltd.
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).diagram={})}(this,(function(t){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,i)};function i(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}var n=function(){return(n=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},o=function(){},r=function(){function t(t,e){this.webixJet=!0,this.webix=t,this._events=[],this._subs={},this._data={},e&&e.params&&t.extend(this._data,e.params)}return t.prototype.getRoot=function(){return this._root},t.prototype.destructor=function(){this._detachEvents(),this._destroySubs(),this._events=this._container=this.app=this._parent=this._root=null},t.prototype.setParam=function(t,e,i){if(this._data[t]!==e&&(this._data[t]=e,this._segment.update(t,e,0),i))return this.show(null)},t.prototype.getParam=function(t,e){var i=this._data[t];if(void 0!==i||!e)return i;var n=this.getParentView();return n?n.getParam(t,e):void 0},t.prototype.getUrl=function(){return this._segment.suburl()},t.prototype.getUrlString=function(){return this._segment.toString()},t.prototype.getParentView=function(){return this._parent},t.prototype.$$=function(t){if("string"==typeof t){var e=this.getRoot();return e.queryView((function(i){return(i.config.id===t||i.config.localId===t)&&i.$scope===e.$scope}),"self")}return t},t.prototype.on=function(t,e,i){var n=t.attachEvent(e,i);return this._events.push({obj:t,id:n}),n},t.prototype.contains=function(t){for(var e in this._subs){var i=this._subs[e].view;if(i===t||i.contains(t))return!0}return!1},t.prototype.getSubView=function(t){var e=this.getSubViewInfo(t);if(e)return e.subview.view},t.prototype.getSubViewInfo=function(t){var e=this._subs[t||"default"];return e?{subview:e,parent:this}:"_top"===t?(this._subs[t]={url:"",id:null,popup:!0},this.getSubViewInfo(t)):this._parent?this._parent.getSubViewInfo(t):null},t.prototype._detachEvents=function(){for(var t=this._events,e=t.length-1;e>=0;e--)t[e].obj.detachEvent(t[e].id)},t.prototype._destroySubs=function(){for(var t in this._subs){var e=this._subs[t].view;e&&e.destructor()}this._subs={}},t.prototype._init_url_data=function(){var t=this._segment.current();this._data={},this.webix.extend(this._data,t.params,!0)},t.prototype._getDefaultSub=function(){if(this._subs.default)return this._subs.default;for(var t in this._subs){var e=this._subs[t];if(!e.branch&&e.view&&"_top"!==t){var i=e.view._getDefaultSub();if(i)return i}}},t.prototype._routed_view=function(){var t=this.getParentView();if(!t)return!0;var e=t._getDefaultSub();return!(!e&&e!==this)&&t._routed_view()},t}();function s(t){"/"===t[0]&&(t=t.substr(1));for(var e=t.split("/"),i=[],n=0;n<e.length;n++){var o=e[n],r={},s=o.indexOf(":");if(-1===s&&(s=o.indexOf("?")),-1!==s)for(var a=0,l=o.substr(s+1).split(/[\:\?\&]/g);a<l.length;a++){var h=l[a].split("=");r[h[0]]=decodeURIComponent(h[1])}i[n]={page:s>-1?o.substr(0,s):o,params:r,isNew:!0}}return i}function a(t){for(var e=[],i=0,n=t;i<n.length;i++){var o=n[i];e.push("/"+o.page);var r=l(o.params);r&&e.push("?"+r)}return e.join("")}function l(t){var e=[];for(var i in t)"object"!=typeof t[i]&&(e.length&&e.push("&"),e.push(i+"="+encodeURIComponent(t[i])));return e.join("")}var h=function(){function t(t,e){this._next=1,this.route="string"==typeof t?{url:s(t),path:t}:t,this.index=e}return t.prototype.current=function(){return this.route.url[this.index]},t.prototype.next=function(){return this.route.url[this.index+this._next]},t.prototype.suburl=function(){return this.route.url.slice(this.index)},t.prototype.shift=function(e){var i=new t(this.route,this.index+this._next);return i.setParams(i.route.url,e,i.index),i},t.prototype.setParams=function(t,e,i){if(e){var n=t[i].params;for(var o in e)n[o]=e[o]}},t.prototype.refresh=function(){for(var t=this.route.url,e=this.index+1;e<t.length;e++)t[e].isNew=!0},t.prototype.toString=function(){var t=a(this.suburl());return t?t.substr(1):""},t.prototype._join=function(t,e){var i=this.route.url;if(null===t)return i;var n=this.route.url,o=!0;if(i=n.slice(0,this.index+(e?this._next:0)),t){i=i.concat(s(t));for(var r=0;r<i.length;r++)n[r]&&(i[r].view=n[r].view),o&&n[r]&&i[r].page===n[r].page?i[r].isNew=!1:i[r].isNew&&(o=!1)}return i},t.prototype.append=function(t){var e=this._join(t,!0);return this.route.path=a(e),this.route.url=e,this.route.path},t.prototype.show=function(t,e,i){var n=this,r=this._join(t.url,i);return this.setParams(r,t.params,this.index+(i?this._next:0)),new Promise((function(t,i){var s=a(r),l={url:r,redirect:s,confirm:Promise.resolve()},h=e?e.app:null;if(h&&!h.callEvent("app:guard",[l.redirect,e,l]))return void i(new o);l.confirm.catch((function(t){return i(t)})).then((function(){if(null!==l.redirect){if(l.redirect!==s)return h.show(l.redirect),void i(new o);n.route.path=s,n.route.url=r,t()}else i(new o)}))}))},t.prototype.size=function(t){this._next=t},t.prototype.split=function(){var e={url:this.route.url.slice(this.index+1),path:""};return e.url.length&&(e.path=a(e.url)),new t(e,0)},t.prototype.update=function(t,e,i){var n=this.route.url[this.index+(i||0)];if(!n)return this.route.url.push({page:"",params:{}}),this.update(t,e,i);""===t?n.page=e:n.params[t]=e,this.route.path=a(this.route.url)},t}(),u=function(t){function e(e,i){var n=t.call(this,e.webix)||this;return n.app=e,n._children=[],n}return i(e,t),e.prototype.ui=function(t,e){var i=(e=e||{}).container||t.container,n=this.app.createView(t);return this._children.push(n),n.render(i,this._segment,this),"object"!=typeof t||t instanceof r?n:n.getRoot()},e.prototype.show=function(t,e){if(e=e||{},"object"==typeof t){for(var i in t)this.setParam(i,t[i]);t=null}else{if("/"===t.substr(0,1))return this.app.show(t,e);if(0===t.indexOf("./")&&(t=t.substr(2)),0===t.indexOf("../")){var n=this.getParentView();return n?n.show(t.substr(3),e):this.app.show("/"+t.substr(3))}var o=this.getSubViewInfo(e.target);if(o){if(o.parent!==this)return o.parent.show(t,e);if(e.target&&"default"!==e.target)return this._renderFrameLock(e.target,o.subview,{url:t,params:e.params})}else if(t)return this.app.show("/"+t,e)}return this._show(this._segment,{url:t,params:e.params},this)},e.prototype._show=function(t,e,i){var n=this;return t.show(e,i,!0).then((function(){return n._init_url_data(),n._urlChange()})).then((function(){t.route.linkRouter&&(n.app.getRouter().set(t.route.path,{silent:!0}),n.app.callEvent("app:route",[t.route.path]))}))},e.prototype.init=function(t,e){},e.prototype.ready=function(t,e){},e.prototype.config=function(){this.app.webix.message("View:Config is not implemented")},e.prototype.urlChange=function(t,e){},e.prototype.destroy=function(){},e.prototype.destructor=function(){this.destroy(),this._destroyKids(),this._root&&(this._root.destructor(),t.prototype.destructor.call(this))},e.prototype.use=function(t,e){t(this.app,this,e)},e.prototype.refresh=function(){this.getUrl();return this.destroy(),this._destroyKids(),this._destroySubs(),this._detachEvents(),this._container.tagName&&this._root.destructor(),this._segment.refresh(),this._render(this._segment)},e.prototype.render=function(t,e,i){var n=this;"string"==typeof e&&(e=new h(e,0)),this._segment=e,this._parent=i,this._init_url_data();var o="string"==typeof(t=t||document.body)?this.webix.toNode(t):t;return this._container!==o?(this._container=o,this._render(e)):this._urlChange().then((function(){return n.getRoot()}))},e.prototype._render=function(t){var e=this,i=this.config();return i.then?i.then((function(i){return e._render_final(i,t)})):this._render_final(i,t)},e.prototype._render_final=function(t,e){var i,n=this,o=null,r=null,s=!1;if(this._container.tagName?r=this._container:(o=this._container).popup?(r=document.body,s=!0):r=this.webix.$$(o.id),!this.app||!r)return Promise.reject(null);var a=this._segment.current(),l={ui:{}};this.app.copyConfig(t,l.ui,this._subs),this.app.callEvent("app:render",[this,e,l]),l.ui.$scope=this,!o&&a.isNew&&a.view&&a.view.destructor();try{if(o&&!s){var h=r,u=h.getParentView();u&&"multiview"===u.name&&!l.ui.id&&(l.ui.id=h.config.id)}this._root=this.app.webix.ui(l.ui,r);var c=this._root;s&&c.setPosition&&!c.isVisible()&&c.show(),o&&(o.view&&o.view!==this&&o.view!==this.app&&o.view.destructor(),o.id=this._root.config.id,this.getParentView()||!this.app.app?o.view=this:o.view=this.app),a.isNew&&(a.view=this,a.isNew=!1),i=Promise.resolve(this._init(this._root,e)).then((function(){return n._urlChange().then((function(){return n._initUrl=null,n.ready(n._root,e.suburl())}))}))}catch(t){i=Promise.reject(t)}return i.catch((function(t){return n._initError(n,t)}))},e.prototype._init=function(t,e){return this.init(t,e.suburl())},e.prototype._urlChange=function(){var t=this;this.app.callEvent("app:urlchange",[this,this._segment]);var e=[];for(var i in this._subs){var n=this._subs[i],o=this._renderFrameLock(i,n,null);o&&e.push(o)}return Promise.all(e).then((function(){return t.urlChange(t._root,t._segment.suburl())}))},e.prototype._renderFrameLock=function(t,e,i){if(!e.lock){var n=this._renderFrame(t,e,i);n&&(e.lock=n.then((function(){return e.lock=null}),(function(){return e.lock=null})))}return e.lock},e.prototype._renderFrame=function(t,e,i){var n=this;if("default"===t){if(this._segment.next()){var o=i?i.params:null;return e.params&&(o=this.webix.extend(o||{},e.params)),this._createSubView(e,this._segment.shift(o))}e.view&&e.popup&&(e.view.destructor(),e.view=null)}if(null!==i&&(e.url=i.url,e.params&&(i.params=this.webix.extend(i.params||{},e.params))),e.route){if(null!==i)return e.route.show(i,e.view).then((function(){return n._createSubView(e,e.route)}));if(e.branch)return}var r=e.view;if(!r&&e.url){if("string"==typeof e.url)return e.route=new h(e.url,0),i&&e.route.setParams(e.route.route.url,i.params,0),e.params&&e.route.setParams(e.route.route.url,e.params,0),this._createSubView(e,e.route);"function"!=typeof e.url||r instanceof e.url||(r=new(this.app._override(e.url))(this.app,"")),r||(r=e.url)}if(r)return r.render(e,e.route||this._segment,this)},e.prototype._initError=function(t,e){return this.app&&this.app.error("app:error:initview",[e,t]),!0},e.prototype._createSubView=function(t,e){var i=this;return this.app.createFromURL(e.current()).then((function(n){return n.render(t,e,i)}))},e.prototype._destroyKids=function(){for(var t=this._children,e=t.length-1;e>=0;e--)t[e]&&t[e].destructor&&t[e].destructor();this._children=[]},e}(r),c=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n._ui=i.ui,n}return i(e,t),e.prototype.config=function(){return this._ui},e}(u),d=function(){function t(t,e,i){this.path="",this.app=i}return t.prototype.set=function(t,e){this.path=t;var i=this.app;i.app.getRouter().set(i._segment.append(this.path),{silent:!0})},t.prototype.get=function(){return this.path},t}(),p=!0,f=function(t){function e(e){var i=this,n=(e||{}).webix||window.webix;return e=n.extend({name:"App",version:"1.0",start:"/home"},e,!0),(i=t.call(this,n,e)||this).config=e,i.app=i.config.app,i.ready=Promise.resolve(),i._services={},i.webix.extend(i,i.webix.EventSystem),i}return i(e,t),e.prototype.getUrl=function(){return this._subSegment.suburl()},e.prototype.getUrlString=function(){return this._subSegment.toString()},e.prototype.getService=function(t){var e=this._services[t];return"function"==typeof e&&(e=this._services[t]=e(this)),e},e.prototype.setService=function(t,e){this._services[t]=e},e.prototype.destructor=function(){this.getSubView().destructor(),t.prototype.destructor.call(this)},e.prototype.copyConfig=function(t,e,i){if((t instanceof r||"function"==typeof t&&t.prototype instanceof r)&&(t={$subview:t}),void 0!==t.$subview)return this.addSubView(t,e,i);var n=t instanceof Array;for(var o in e=e||(n?[]:{}),t){var s=t[o];if("function"==typeof s&&s.prototype instanceof r&&(s={$subview:s}),!s||"object"!=typeof s||s instanceof this.webix.DataCollection||s instanceof RegExp||s instanceof Map)e[o]=s;else if(s instanceof Date)e[o]=new Date(s);else{var a=this.copyConfig(s,s instanceof Array?[]:{},i);null!==a&&(n?e.push(a):e[o]=a)}}return e},e.prototype.getRouter=function(){return this.$router},e.prototype.clickHandler=function(t,e){if(t&&(e=e||t.target||t.srcElement)&&e.getAttribute){var i=e.getAttribute("trigger");if(i)return this._forView(e,(function(t){return t.app.trigger(i)})),t.cancelBubble=!0,t.preventDefault();var n=e.getAttribute("route");if(n)return this._forView(e,(function(t){return t.show(n)})),t.cancelBubble=!0,t.preventDefault()}var o=e.parentNode;o&&this.clickHandler(t,o)},e.prototype.getRoot=function(){return this.getSubView().getRoot()},e.prototype.refresh=function(){var t=this;return this._subSegment?this.getSubView().refresh().then((function(e){return t.callEvent("app:route",[t.getUrl()]),e})):Promise.resolve(null)},e.prototype.loadView=function(t){var e=this,i=this.config.views,n=null;if(""===t)return Promise.resolve(this._loadError("",new Error("Webix Jet: Empty url segment")));try{i&&"string"==typeof(n="function"==typeof i?i(t):i[t])&&(t=n,n=null),n||("_hidden"===t?n={hidden:!0}:"_blank"===t?n={}:(t=t.replace(/\./g,"/"),n=this.require("jet-views",t)))}catch(e){n=this._loadError(t,e)}return n.then||(n=Promise.resolve(n)),n=n.then((function(t){return t.__esModule?t.default:t})).catch((function(i){return e._loadError(t,i)}))},e.prototype._forView=function(t,e){var i=this.webix.$$(t);i&&e(i.$scope)},e.prototype._loadViewDynamic=function(t){return null},e.prototype.createFromURL=function(t){var e=this;return t.isNew||!t.view?this.loadView(t.page).then((function(i){return e.createView(i,name,t.params)})):Promise.resolve(t.view)},e.prototype._override=function(t){var e=this.config.override;if(e){for(var i=void 0;t;)i=t,t=e.get(t);return i}return t},e.prototype.createView=function(t,i,n){if("function"==typeof(t=this._override(t))){if(t.prototype instanceof e)return new t({app:this,name:i,params:n,router:d});if(t.prototype instanceof r)return new t(this,{name:i,params:n});t=t(this)}return t instanceof r?t:new c(this,{name:i,ui:t})},e.prototype.show=function(t,e){return t&&this.app&&0==t.indexOf("//")?this.app.show(t.substr(1),e):this.render(this._container,t||this.config.start,e)},e.prototype.trigger=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this.apply(t,e)},e.prototype.apply=function(t,e){this.callEvent(t,e)},e.prototype.action=function(t){return this.webix.bind((function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.apply(t,e)}),this)},e.prototype.on=function(t,e){this.attachEvent(t,e)},e.prototype.use=function(t,e){t(this,null,e)},e.prototype.error=function(t,e){if(this.callEvent(t,e),this.callEvent("app:error",e),this.config.debug)for(var i=0;i<e.length;i++)if(console.error(e[i]),e[i]instanceof Error){var n=e[i].message;0===n.indexOf("Module build failed")?(n=n.replace(/\x1b\[[0-9;]*m/g,""),document.body.innerHTML="<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>"+n+"</pre>"):(n+="<br><br>Check console for more details",this.webix.message({type:"error",text:n,expire:-1}))}},e.prototype.render=function(t,e,i){var n=this;this._container="string"==typeof t?this.webix.toNode(t):t||document.body;var o=null;!this.$router?(p&&"tagName"in this._container&&(this.webix.event(document.body,"click",(function(t){return n.clickHandler(t)})),p=!1),"string"==typeof e&&(e=new h(e,0)),this._subSegment=this._first_start(e),this._subSegment.route.linkRouter=!0):o="string"==typeof e?e:this.app?e.split().route.path||this.config.start:e.toString();var r=i?i.params:this.config.params||null,s=this.getSubView(),a=this._subSegment,l=a.show({url:o,params:r},s).then((function(){return n.createFromURL(a.current())})).then((function(e){return e.render(t,a)})).then((function(t){return n.$router.set(a.route.path,{silent:!0}),n.callEvent("app:route",[n.getUrl()]),t}));return this.ready=this.ready.then((function(){return l})),l},e.prototype.getSubView=function(){if(this._subSegment){var t=this._subSegment.current().view;if(t)return t}return new u(this,{})},e.prototype.require=function(t,e){return null},e.prototype._first_start=function(t){var e=this;this._segment=t;if(this.$router=new this.config.router((function(t){return setTimeout((function(){e.show(t).catch((function(t){if(!(t instanceof o))throw t}))}),1)}),this.config,this),this._container===document.body&&!1!==this.config.animation){var i=this._container;this.webix.html.addCss(i,"webixappstart"),setTimeout((function(){e.webix.html.removeCss(i,"webixappstart"),e.webix.html.addCss(i,"webixapp")}),10)}if(t){if(this.app){var n=t.current().view;t.current().view=this,t.next()?(t.refresh(),t=t.split()):t=new h(this.config.start,0),t.current().view=n}}else{var r=this.$router.get();r||(r=this.config.start,this.$router.set(r,{silent:!0})),t=new h(r,0)}return t},e.prototype._loadError=function(t,e){return this.error("app:error:resolve",[e,t]),{template:" "}},e.prototype.addSubView=function(t,e,i){var n=!0!==t.$subview?t.$subview:null,o=t.name||(n?this.webix.uid():"default");return e.id=t.id||"s"+this.webix.uid(),(i[o]={id:e.id,url:n,branch:t.branch,popup:t.popup,params:t.params}).popup?null:e},e}(r),g=function(){function t(t,e){var i=this;this.config=e||{},this._detectPrefix(),this.cb=t,window.onpopstate=function(){return i.cb(i.get())}}return t.prototype.set=function(t,e){var i=this;if(this.config.routes){var n=t.split("?",2);for(var o in this.config.routes)if(this.config.routes[o]===n[0]){t=o+(n.length>1?"?"+n[1]:"");break}}this.get()!==t&&window.history.pushState(null,null,this.prefix+this.sufix+t),e&&e.silent||setTimeout((function(){return i.cb(t)}),1)},t.prototype.get=function(){var t=this._getRaw().replace(this.prefix,"").replace(this.sufix,"");if(t="/"!==t&&"#"!==t?t:"",this.config.routes){var e=t.split("?",2),i=this.config.routes[e[0]];i&&(t=i+(e.length>1?"?"+e[1]:""))}return t},t.prototype._detectPrefix=function(){var t=this.config.routerPrefix;this.sufix="#"+(void 0===t?"!":t),this.prefix=document.location.href.split("#",2)[0]},t.prototype._getRaw=function(){return document.location.href},t}(),v=!1;function w(t){if(!v&&t){v=!0;var e=window;e.Promise||(e.Promise=t.promise);var i=t.version.split(".");10*i[0]+1*i[1]<53&&(t.ui.freeze=function(e){var i=e();return i&&i.then?i.then((function(e){return t.ui.$freeze=!1,t.ui.resize(),e})):(t.ui.$freeze=!1,t.ui.resize()),i});var n=t.ui.baselayout.prototype.addView,o=t.ui.baselayout.prototype.removeView,r={addView:function(t,e){if(this.$scope&&this.$scope.webixJet&&!t.queryView){var i=this.$scope,o={};t=i.app.copyConfig(t,{},o),n.apply(this,[t,e]);var r=function(t){i._renderFrame(t,o[t],null).then((function(){i._subs[t]=o[t]}))};for(var s in o)r(s);return t.id}return n.apply(this,arguments)},removeView:function(){if(o.apply(this,arguments),this.$scope&&this.$scope.webixJet){var e=this.$scope._subs;for(var i in e){var n=e[i];t.$$(n.id)||(n.view.destructor(),delete e[i])}}}};t.extend(t.ui.layout.prototype,r,!0),t.extend(t.ui.baselayout.prototype,r,!0),t.protoUI({name:"jetapp",$init:function(e){this.$app=new this.app(e);var i=t.uid().toString();e.body={id:i},this.$ready.push((function(){this.callEvent("onInit",[this.$app]),this.$app.render({id:i})}))}},t.ui.proxy,t.EventSystem)}}var m=function(t){function e(e){var i;return e.router=e.router||g,w((i=t.call(this,e)||this).webix),i}return i(e,t),e.prototype.require=function(t,e){return require(t+"/"+e)},e}(f),y=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}i(e,t),e.prototype._detectPrefix=function(){this.prefix="",this.sufix=this.config.routerPrefix||""},e.prototype._getRaw=function(){return document.location.pathname+(document.location.search||"")}}(g),function(){function t(t,e){this.path="",this.cb=t}return t.prototype.set=function(t,e){var i=this;this.path=t,e&&e.silent||setTimeout((function(){return i.cb(t)}),1)},t.prototype.get=function(){return this.path},t}());function _(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function x(t,e,i){for(var n in t)_(t,n)&&e.call(i||t,t[n],n,t)}function b(t){t="Warning: "+t,"undefined"!=typeof console&&console.error(t);try{throw new Error(t)}catch(t){}}var k=String.prototype.replace,S=String.prototype.split,C=function(t){var e=t%10;return 11!==t&&1===e?0:2<=e&&e<=4&&!(t>=12&&t<=14)?1:2},L={arabic:function(t){if(t<3)return t;var e=t%100;return e>=3&&e<=10?3:e>=11?4:5},bosnian_serbian:C,chinese:function(){return 0},croatian:C,french:function(t){return t>1?1:0},german:function(t){return 1!==t?1:0},russian:C,lithuanian:function(t){return t%10==1&&t%100!=11?0:t%10>=2&&t%10<=9&&(t%100<11||t%100>19)?1:2},czech:function(t){return 1===t?0:t>=2&&t<=4?1:2},polish:function(t){if(1===t)return 0;var e=t%10;return 2<=e&&e<=4&&(t%100<10||t%100>=20)?1:2},icelandic:function(t){return t%10!=1||t%100==11?1:0},slovenian:function(t){var e=t%100;return 1===e?0:2===e?1:3===e||4===e?2:3}},M={arabic:["ar"],bosnian_serbian:["bs-Latn-BA","bs-Cyrl-BA","srl-RS","sr-RS"],chinese:["id","id-ID","ja","ko","ko-KR","lo","ms","th","th-TH","zh"],croatian:["hr","hr-HR"],german:["fa","da","de","en","es","fi","el","he","hi-IN","hu","hu-HU","it","nl","no","pt","sv","tr"],french:["fr","tl","pt-br"],russian:["ru","ru-RU"],lithuanian:["lt"],czech:["cs","cs-CZ","sk"],polish:["pl"],icelandic:["is"],slovenian:["sl-SL"]};function V(t){var e,i=(e={},x(M,(function(t,i){x(t,(function(t){e[t]=i}))})),e);return i[t]||i[S.call(t,/-/,1)[0]]||i.en}function $(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var I=/\$/g,E=/%\{(.*?)\}/g;function B(t,e,i,n){if("string"!=typeof t)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==e)return t;var o=t,r=n||E,s="number"==typeof e?{smart_count:e}:e;if(null!=s.smart_count&&o){var a=S.call(o,"||||");o=(a[function(t,e){return L[V(t)](e)}(i||"en",s.smart_count)]||a[0]).replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}return o=k.call(o,r,(function(t,e){return _(s,e)&&null!=s[e]?k.call(s[e],I,"$$"):t}))}function H(t){var e=t||{};this.phrases={},this.extend(e.phrases||{}),this.currentLocale=e.locale||"en";var i=e.allowMissing?B:null;this.onMissingKey="function"==typeof e.onMissingKey?e.onMissingKey:i,this.warn=e.warn||b,this.tokenRegex=function(t){var e=t&&t.prefix||"%{",i=t&&t.suffix||"}";if("||||"===e||"||||"===i)throw new RangeError('"||||" token is reserved for pluralization');return new RegExp($(e)+"(.*?)"+$(i),"g")}(e.interpolation)}H.prototype.locale=function(t){return t&&(this.currentLocale=t),this.currentLocale},H.prototype.extend=function(t,e){x(t,(function(t,i){var n=e?e+"."+i:i;"object"==typeof t?this.extend(t,n):this.phrases[n]=t}),this)},H.prototype.unset=function(t,e){"string"==typeof t?delete this.phrases[t]:x(t,(function(t,i){var n=e?e+"."+i:i;"object"==typeof t?this.unset(t,n):delete this.phrases[n]}),this)},H.prototype.clear=function(){this.phrases={}},H.prototype.replace=function(t){this.clear(),this.extend(t)},H.prototype.t=function(t,e){var i,n,o=null==e?{}:e;if("string"==typeof this.phrases[t])i=this.phrases[t];else if("string"==typeof o._)i=o._;else if(this.onMissingKey){n=(0,this.onMissingKey)(t,o,this.currentLocale,this.tokenRegex)}else this.warn('Missing translation for key: "'+t+'"'),n=t;return"string"==typeof i&&(n=B(i,o,this.currentLocale,this.tokenRegex)),n},H.prototype.has=function(t){return _(this.phrases,t)},H.transformPhrase=function(t,e,i){return B(t,e,i)};var T=H;var A=window.webix;A&&w(A);var P=function(t,e,i){var n=(i=i||{}).storage,o=n?n.get("lang")||"en":i.lang||"en";function r(e,r,s){r.__esModule&&(r=r.default);var l={phrases:r};i.polyglot&&t.webix.extend(l,i.polyglot);var h=a.polyglot=new T(l);if(h.locale(e),a._=t.webix.bind(h.t,h),o=e,n&&n.put("lang",o),i.webix){var u=i.webix[e];u&&t.webix.i18n.setLocale(u)}return s?Promise.resolve():t.refresh()}function s(e,n){if(!1!==i.path){var o=(i.path?i.path+"/":"")+e;r(e,t.require("jet-locales",o),n)}}var a={getLang:function(){return o},setLang:s,setLangData:r,_:null,polyglot:null};t.setService("locale",a),s(o,!0)},j=window;j.Promise||(j.Promise=j.webix.promise);var z=1;function D(t,e,i){Object.defineProperty(e,i,{get:function(){return t[i]},set:function(e){return t[i]=e}})}function N(t,e){e=e||{};var i={},n={},o=function(t,e){var o=z++;return i[o]={mask:t,handler:e},e("*"===t?n:n[t],void 0,t),o},r=[],s=!1,a=function(t,e,n,o){if(s)r.push([t,e,n,o]);else for(var a=Object.keys(i),l=0;l<a.length;l++){var h=i[a[l]];h&&("*"!==h.mask&&h.mask!==t||h.handler(n,e,t,o))}};return Object.defineProperty(n,"$changes",{value:{attachEvent:o,detachEvent:function(t){delete i[t]}},enumerable:!1,configurable:!1}),Object.defineProperty(n,"$observe",{value:o,enumerable:!1,configurable:!1}),Object.defineProperty(n,"$batch",{value:function(t){if("function"!=typeof t){var e=t;t=function(){for(var t in e)n[t]=e[t]}}for(s=!0,t(n),s=!1;r.length;){var i=r.shift();a.apply(this,i)}},enumerable:!1,configurable:!1}),Object.defineProperty(n,"$extend",{value:function(t,i){for(var o in i=i||e,t)if(t.hasOwnProperty(o)){var r=t[o];i.nested&&"object"==typeof r&&r?n[o]=N(r,i):R(n,r,o,a)}},enumerable:!1,configurable:!1}),n.$extend(t,e),n}function R(t,e,i,n){Object.defineProperty(t,i,{get:function(){return e},set:function(t){if(null===e||null===t?e!==t:e.valueOf()!=t.valueOf()){var o=e;e=t,n(i,o,t,null)}},enumerable:!0,configurable:!1})}var F={block:{angle:0,lineStyle:"solid",textAlign:"center",textVAlign:"center",lineWidth:1,fontStyle:"normal",fontWeight:400,fillOpacity:0},line:{lineWidth:1,lineStyle:"solid"},arrow:{lineWidth:1,fillOpacity:0},org:{lineColor:"#2d9bf0",backgroundColor:"#fff"}},G={material:{block:{fontColor:"#475466",fontSize:14,fontFamily:"Roboto",backgroundColor:"#F4F5F9",altBackgroundColor:"#CCD7E6",lineColor:"#CCD7E6"},line:{lineColor:"#CCD7E6"},arrow:{lineColor:"#CCD7E6",backgroundColor:"#FFF"}},mini:{block:{fontColor:"#475466",fontSize:12,fontFamily:"Roboto",backgroundColor:"#F4F5F9",altBackgroundColor:"#CCD7E6",lineColor:"#CCD7E6"},line:{lineColor:"#CCD7E6"},arrow:{lineColor:"#CCD7E6",backgroundColor:"#FFF"}},flat:{block:{fontColor:"#475466",fontSize:15,fontFamily:"PT Sans",lineColor:"#bbdefb",backgroundColor:"#e3f2fd",altBackgroundColor:"#bbdefb"},line:{lineColor:"#bbdefb"},arrow:{lineColor:"#bbdefb",backgroundColor:"#FFF"}},compact:{block:{fontColor:"#475466",fontSize:13,fontFamily:"PT Sans",backgroundColor:"#e3f2fd",altBackgroundColor:"#bbdefb",lineColor:"#bbdefb"},line:{lineColor:"#bbdefb"},arrow:{lineColor:"#bbdefb",backgroundColor:"#FFF"}},contrast:{block:{fontColor:"#fff",fontSize:15,fontFamily:"PT Sans",lineColor:"#ccd7e6",backgroundColor:"#393939",altBackgroundColor:"#ccd7e6"},line:{lineColor:"#ccd7e6"},arrow:{lineColor:"#CCD7E6",backgroundColor:"#393939"},org:{backgroundColor:"#393939"}}},O=["Arial","Verdana","Helvetica","Tahoma","Trebuchet MS","Times New Roman","Georgia","Garamond","Courier New","Lucida Console","Monaco","Comic Sans MS"],U=function(){function t(t){this.app=t;var e=this._style=webix.copy(F),i=G[webix.skin.$name];for(var n in e)i[n]&&webix.extend(e[n],i[n],!0);this._fonts=(-1==O.indexOf(e.block.fontFamily)?[e.block.fontFamily]:[]).concat(O),this._arrows=["","angle","triangle","triangle-fill"],this._reservedType={templateSvg:1,templateTextStart:1,templateStart:1,templateTextEnd:1,templateEnd:1},this._reservedLink={templateArrow:1,templateLine:1,templateLink:1,templateShadow:1,shadow:1}}return t.prototype.connect=function(t){this._type=t.type,this._linkType=t.linkType,this._view=t,this._dtype={type:webix.copy(this._type),linkType:webix.copy(this._linkType)}},t.prototype.setType=function(t,e){var i=this._dtype,n={};for(var o in t)this._reservedType[o]||(n[o]=t[o]);var r={};for(var o in e)this._reservedLink[o]||(r[o]=e[o]);webix.extend(n,i.type),webix.extend(r,i.linkType),this._view.type=this._type=n,this._view.linkType=this._linkType=r},t.prototype.getType=function(){return this._type},t.prototype.getLinkType=function(){return this._linkType},t.prototype.getDefaults=function(){return this._style},t.prototype.getCommonValues=function(){return n(n({},this.getLinkValues()),this.getBlockValues())},t.prototype.getBlockValues=function(t){var e=this;t=t||{};var i=["height","width"],n=this._style.block;t.id&&(i=(i=i.concat(["x","y","id","value"])).concat(Object.keys(n)));var o={};if(t.type){var r=this.extractTypeValues(t.type);webix.extend(o,r)}return i.forEach((function(i){var r=t[i];r||0===r||(r=o[i]),void 0===r&&void 0===(r=n[i])&&(r=e._type[i]),o[i]=r})),"Roboto"==o.fontFamily&&500==o.fontWeight&&(o.fontWeight="bold"),o},t.prototype.getLinkValues=function(t){var e=this;t=t||{};var i=["arrowSize","arrow","mode","backgroundColor"],n=this._style.line;t.id&&(i=i.concat(Object.keys(n)));var o={};i.forEach((function(i){var r=t[i];void 0===r&&void 0===(r=n[i])&&(r=e._linkType[i]),o[i]=r}));var r=o.arrow;return r&&o.backgroundColor&&-1!=this._arrows.indexOf(r+"-fill")?r+="-fill":r&&"triangle"!=r&&(r="angle"),o.arrow=r,o},t.prototype.getFontFamilies=function(){return this._fonts},t.prototype.getArrows=function(){return this._arrows},t.prototype.extractTypeValues=function(t){var e=this.app.getService("local").shapes().getItem(t);if(e){var i=webix.copy(e);return delete i.id,delete i.name,delete i.svg,delete i.group,i}return this._style[t]||{}},t}(),Z=function(){function t(t){this.app=t,this.index=-1,this.state=[],this.$ready=!1}return t.prototype.connect=function(t,e){this._master=t,this._local=e,this.$ready=!0,this.track()},t.prototype.track=function(){this.$ready&&(this.index=-1,this.state=[],this.push("init",this.app.getValues()))},t.prototype.reset=function(){if(!(this.state.length<2)){this.$ready=!1,this.index=0;var t=this.state[this.index];this.state=[t],this.app.setValues({item:webix.copy(t.item),linkItem:webix.copy(t.linkItem),data:this.copy(t.data),links:this.copy(t.links),shapes:t.shapes}),this.$ready=!0,this.app.callEvent("UndoChange")}},t.prototype.copy=function(t){return t.map((function(t){return webix.copy(t)}))},t.prototype.parse=function(t,e){for(var i=0;i<e.length;i++){var n=e[i];t.pull[n.id]||t.order.push(n.id),t.pull[n.id]=n}t.refresh()},t.prototype.undo=function(){if(this.hasUndo()){this.$inProgress=!0;var t=this.state[this.index];if(this.index--,t.data&&t.data.length&&this.parse(this._local.data(),this.copy(t.data)),t.links&&t.links.length&&this.parse(this._local.links().data,this.copy(t.links)),"common"==t.mode)this._master.UpdateCommonValue(t.prev,t.target);else if("autoplace"!=t.mode){var e=t.link?this._local.links().data:this._local.data();"update"==t.mode?this.parse(e,[webix.copy(t.prev)]):"add"==t.mode?e.remove(t.id):"remove"==t.mode&&e.add(webix.copy(t.prev))}this.$inProgress=!1,this.app.callEvent("UndoChange")}},t.prototype.redo=function(){if(this.hasRedo()){this.$inProgress=!0,this.index++;var t=this.state[this.index];if("common"==t.mode)this._master.UpdateCommonValue(t.value,t.target);else if("autoplace"==t.mode)this._master.Autoplace();else{var e=t.link?"Link":"Block";"update"==t.mode?this._local["update"+e](t.id,webix.copy(t.value)):"add"==t.mode?this._local["add"+e](webix.copy(t.value)):"remove"==t.mode&&this._local["remove"+e](t.id)}this.$inProgress=!1,this.app.callEvent("UndoChange")}},t.prototype.push=function(t,e,i,n){if(!this.$inProgress&&this.$ready){var o=this.state[this.index];"autoplace"==t&&"autoplace"==o.mode||(this.hasRedo()&&this.state.splice(this.index+1,this.state.length-(this.index+1)),this.index++,this.state[this.index]=webix.extend(e,{id:i,link:n,mode:t}),this.app.callEvent("UndoChange"))}},t.prototype.hasUndo=function(){return this.index>0},t.prototype.hasRedo=function(){return this.index+1<this.state.length},t}(),W={block:{circle:'<svg width="100%" height="100%" viewBox="0 0 42 42" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M21 41C32.0457 41 41 32.0457 41 21C41 9.9543 32.0457 1 21 1C9.9543 1 1 9.9543 1 21C1 32.0457 9.9543 41 21 41Z"  stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n',dot:'<svg width="100%" height="100%" viewBox="0 0 42 42" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M21 41C32.0457 41 41 32.0457 41 21C41 9.9543 32.0457 1 21 1C9.9543 1 1 9.9543 1 21C1 32.0457 9.9543 41 21 41Z"  stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M21 33C27.6274 33 33 27.6274 33 21C33 14.3726 27.6274 9 21 9C14.3726 9 9 14.3726 9 21C9 27.6274 14.3726 33 21 33Z" class="webix_diagram_shape_alt"/>\n</svg>\n',head:'<svg width="100%" height="100%" viewBox="0 0 40 53" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M1.00742 1.26718L39.0947 26.5L1.00742 51.7328L10.3731 26.6751L10.4385 26.5L10.3731 26.3249L1.00742 1.26718Z" />\n</svg>\n',heptagon:'<svg width="100%" height="100%" viewBox="0 0 42 42" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M12.0992 41H29.9009L41 26.7242L37.0388 8.92249L21 1L4.96124 8.92249L1 26.7242L12.0992 41Z"  />\n</svg>\n',join:'<svg width="100%" height="100%" viewBox="0 0 75 8" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M71 0H4C1.79086 0 0 1.79086 0 4C0 6.20914 1.79086 8 4 8H71C73.2091 8 75 6.20914 75 4C75 1.79086 73.2091 0 71 0Z"/>\n</svg>\n',junction:'<svg width="100%" height="100%" viewBox="0 0 42 42" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M21 41C32.0457 41 41 32.0457 41 21C41 9.9543 32.0457 1 21 1C9.9543 1 1 9.9543 1 21C1 32.0457 9.9543 41 21 41Z"   stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M7 7L35 35"  stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M35 7L7 35"  stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n',octagon:'<svg width="100%" height="100%" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M39.5 28.0772L28.0767 39.5H11.9233L0.5 28.0767V11.9228L11.9228 0.5H28.0772L39.5 11.9228V28.0772Z"  />\n</svg>\n',pentagon:'<svg width="100%" height="100%" viewBox="0 0 40 39" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M19.7971 0.568597L19.7975 0.568277C19.9158 0.477665 20.0806 0.476569 20.2022 0.569023C20.2022 0.569054 20.2023 0.569086 20.2023 0.569118L39.3666 15.2091C39.3669 15.2093 39.3672 15.2095 39.3674 15.2097C39.4804 15.2971 39.5272 15.4458 39.4842 15.5829C39.4839 15.5836 39.4837 15.5843 39.4835 15.585L32.1637 37.6042C32.1187 37.7394 31.9903 37.8322 31.8465 37.8322H8.15531C8.00942 37.8322 7.88332 37.7406 7.83824 37.6048L7.83816 37.6045L0.516771 15.5803C0.516738 15.5802 0.51669 15.5801 0.516658 15.58C0.472654 15.4468 0.517787 15.2972 0.63151 15.2094C0.631684 15.2093 0.631858 15.2091 0.632032 15.209L19.7971 0.568597Z"  />\n</svg>\n',plus:'<svg width="100%" height="100%" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M21.9956 17.5044V18.0044H22.4956H39.5V21.9956H22.4956H21.9956V22.4956V39.5H18.0044V22.4956V21.9956H17.5044H0.5V18.0044H17.5044H18.0044V17.5044V0.5H21.9956V17.5044Z"  />\n</svg>\n',rtriangle:'<svg width="100%" height="100%" viewBox="0 0 42 42" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M1 41L41.5 41L0.999998 1L1 41Z"   stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n',star:'<svg width="100%" height="100%" viewBox="0 0 40 37" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M20 1.61804L24.0148 13.9742L24.127 14.3197H24.4903H37.4823L26.9715 21.9562L26.6776 22.1697L26.7899 22.5152L30.8046 34.8713L20.2939 27.2348L20 27.0213L19.7061 27.2348L9.19535 34.8713L13.2101 22.5152L13.3224 22.1697L13.0285 21.9562L2.51771 14.3197H15.5097H15.873L15.9852 13.9742L20 1.61804Z"  />\n</svg>\n',tail:'<svg width="100%" height="100%" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M26.1987 39.5L0.923247 39.5L13.6518 19.9915L13.8326 19.7144L13.6483 19.4397L0.937714 0.499998L26.2029 0.5L39.3963 19.7223L26.1987 39.5Z" />\n</svg>\n',trapezoid:'<svg width="100%" height="100%" viewBox="0 0 82 42" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M81 41L70.3333 0.999999L11.6667 0.999994L1 41L81 41Z"   stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n',triangle:'<svg width="100%" height="100%" viewBox="0 0 42 42" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M41 41L21 0.999998L1 41L41 41Z"   stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n'},flow:{action:'<svg width="100%" height="100%" viewBox="0 0 92 42" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t<path fill-rule="evenodd" clip-rule="evenodd" d="M79.75 1H12.25C6.0175 1 1 9.92 1 21C1 32.08 6.0175 41 12.25 41H79.75C85.9825 41 91 32.08 91 21C91 9.92 85.9825 1 79.75 1Z"  stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n',collate:'<svg width="100%" height="100%" viewBox="0 0 42 42" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M1 1L21 21L41 1H1Z"   stroke-linecap="round" stroke-linejoin="round"/>\n<path fill-rule="evenodd" clip-rule="evenodd" d="M41 41L21 21L1 41H41Z"   stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n',connector:'<svg width="100%" height="100%" viewBox="0 0 42 42" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M1 1H21L41 21L21 41H1V1Z"   stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n',data:'<svg width="100%" height="100%" viewBox="0 0 90 40" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M8.022 39.0474C4.64748 39.0474 0.978516 30.8836 0.978516 19.9998C0.978516 9.11596 4.64748 0.952148 8.022 0.952148H81.9786C78.4569 0.952148 74.9351 9.11596 74.9351 19.9998C74.9351 30.8836 78.4569 39.0474 81.9786 39.0474H8.022Z"  stroke-linecap="round" stroke-linejoin="round"/>\n<path fill-rule="evenodd" clip-rule="evenodd" d="M81.979 39.0474C78.4573 39.0474 74.9355 30.8836 74.9355 19.9998C74.9355 9.11596 78.4573 0.952148 81.979 0.952148C85.5008 0.952148 89.0225 9.11596 89.0225 19.9998C89.0225 30.8836 85.5008 39.0474 81.979 39.0474Z"  stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n',database:'<svg width="100%" height="100%" viewBox="0 0 72 42" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M1 6C1 8.5 16.4 11 36 11C55.6 11 71 8.5 71 6V36C71 38.5 55.6 41 36 41C16.4 41 1 38.5 1 36V6Z"   stroke-linecap="round" stroke-linejoin="round"/>\n<path fill-rule="evenodd" clip-rule="evenodd" d="M71 6C71 8.5 55.6 11 36 11C16.4 11 1 8.5 1 6C1 3.5 16.4 1 36 1C55.6 1 71 3.5 71 6Z"   stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n',decision:'<svg width="100%" height="100%" viewBox="0 0 42 42" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M21 1L1 21L21 41L41 21L21 1Z"  stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n',display:'<svg width="100%" height="100%" viewBox="0 0 92 42" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M19 41L1 21L19 1H70.0005C82 1 91 9.572 91 21C91 32.428 82 41 70.0005 41H19Z"   stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n',document:'<svg width="100%" height="100%" viewBox="0 0 92 42" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M1 1H91V37.7199C46 22.7124 46 53.1524 1 35.0587V1Z"  stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n',input:'<svg width="100%" height="100%" viewBox="0 0 92 42" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M1 15.1178L91 1V41H1V15.1178Z"  stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n',internal:'<svg width="100%" height="100%" viewBox="0 0 92 42" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M1 1H91V41H1V1Z"   stroke-linecap="round" stroke-linejoin="round"/>\n<path fill-rule="evenodd" clip-rule="evenodd" d="M13 1V41V1Z" />\n<path d="M13 1V41"  stroke-linecap="round" stroke-linejoin="round"/>\n<path fill-rule="evenodd" clip-rule="evenodd" d="M1 11.6665H91H1Z" />\n<path d="M1 11.6665H91"  stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n',looplimit:'<svg width="100%" height="100%" viewBox="0 0 92 42" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M0.999998 11.6667L13 1L79 1.00001L91 11.6667L91 41L0.999993 41L0.999998 11.6667Z"   stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n',multidoc:'<svg width="100%" height="100%" viewBox="0 0 92 42" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M4.10352 1H91.0001V33.6129C47.5518 20.2848 47.5518 47.3191 4.10352 31.2497V1Z"   stroke-linecap="round" stroke-linejoin="round"/>\n<path fill-rule="evenodd" clip-rule="evenodd" d="M2.55078 3.23682H89.4473V35.8498C45.9991 22.5216 45.9991 49.5559 2.55078 33.4865V3.23682Z"   stroke-linecap="round" stroke-linejoin="round"/>\n<path fill-rule="evenodd" clip-rule="evenodd" d="M1 5.47363H87.8966V38.0866C44.4483 24.7584 44.4483 51.7927 1 35.7234V5.47363Z"   stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n',note:'<svg width="100%" height="100%" viewBox="0 0 32 42" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M31 14.8096L20.6428 1H2.5C1.669 1 1 1.76468 1 2.71403V39.286C1 40.2353 1.669 41 2.5 41H29.5C30.331 41 31 40.2353 31 39.286V14.8096Z"  stroke-linecap="round" stroke-linejoin="round"/>\n<path fill-rule="evenodd" clip-rule="evenodd" d="M20.6426 1L30.9998 14.8096H22.1426C21.3116 14.8096 20.6426 14.0449 20.6426 13.0955V1Z"  stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n',operation:'<svg width="100%" height="100%" viewBox="0 0 82 42" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M1 1L11.6667 41H70.3333L81 1H1Z"   stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n',or:'<svg width="100%" height="100%" viewBox="0 0 42 42" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M21 41C32.0457 41 41 32.0457 41 21C41 9.9543 32.0457 1 21 1C9.9543 1 1 9.9543 1 21C1 32.0457 9.9543 41 21 41Z"   stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M21 1V41"  stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M41 21H1"  stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n',output:'<svg width="100%" height="100%" viewBox="0 0 92 42" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M1 41L13 1H91L79 41H1Z"   stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n',preparation:'<svg width="100%" height="100%" viewBox="0 0 62 32" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M9 31L1 16L9 1H53L61 16L53 31H9Z"   stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n',process:'<svg width="100%" height="100%" viewBox="0 0 92 42" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M1 1H91V41H1V1Z"  stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n',sort:'<svg width="100%" height="100%" viewBox="0 0 42 42" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M21 1L1 21L21 41L41 21L21 1Z"   stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M1 21H41"  stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n',start:'<svg width="100%" height="100%" viewBox="0 0 92 42" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M79.75 1H12.25C6.0175 1 1 9.92 1 21C1 32.08 6.0175 41 12.25 41H79.75C85.9825 41 91 32.08 91 21C91 9.92 85.9825 1 79.75 1Z"  stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n',storage:'<svg width="100%" height="100%" viewBox="0 0 92 42" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M23.8 41C11.8 41 1 32.428 1 21C1 9.572 11.8 1 23.8 1H91C77 14.3333 77 27.6667 91 41H23.8Z"  stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n',subroutine:'<svg width="100%" height="100%" viewBox="0 0 92 42" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M1 1H91V41H1V1Z"  stroke-linecap="round" stroke-linejoin="round"/>\n<path fill-rule="evenodd" clip-rule="evenodd" d="M13 1V41V1ZM79 1V41V1Z" fill="#EBEDF0"/>\n<path d="M79 1V41M13 1V41V1Z"  stroke-linecap="round" stroke-linejoin="round"/>\n</svg>\n'}};function q(t,e,i){return"left"==e?[t[0]-i,t[1]]:"top"==e?[t[0],t[1]-i]:"bottom"==e?[t[0],t[1]+i]:"right"==e?[t[0]+i,t[1]]:void 0}function X(t,e,i,n,o){var r,s=o&&e.source==o.id?o:t.getItem(e.source),a=o&&e.target==o.id?o:t.getItem(e.target);if(!(i&&"center"!=i||n&&"center"!=n))return function(t,e,i,n){var o=K(t,e,"center"),r=K(t,i,"center");if("direct"==(n=n||t.linkType.mode)||o[1]==r[1])return[[o[0],o[1]],[r[0],r[1]]];var s=Math.floor((r[1]-o[1])/2);return[[o[0],o[1]],[o[0],o[1]+s],[r[0],o[1]+s],[r[0],r[1]]]}(t,s,a,e.mode);var l=K(t,s,i),h=K(t,a,n);if(l[1]==h[1]&&function(t,e){return"top"!=t&&"bottom"!=t&&"top"!=e&&"bottom"!=e}(i,n))return[l,h];if(l[0]==h[0]&&function(t,e){return"left"!=t&&"right"!=t&&"left"!=e&&"right"!=e}(i,n))return[l,h];var u=[l];"center"!=i&&u.push(l=q(l,i,t.type.listMarginX/2));var c=[h];return"center"!=n&&c.unshift(h=q(h,n,t.type.listMarginX/2)),l[0]!=h[0]&&l[1]!=h[1]&&(u.length>1&&u[0][1]==u[1][1]&&(h=(r=[l,h])[0],l=r[1]),u.push([l[0],h[1]])),u.concat(c)}function K(t,e,i,n){var o=function(t,e){var i=t.getShape(e.type||t.type.type)||{};return{width:1*e.width||i.width||t.type.width,height:1*e.height||i.height||t.type.height}}(t,e);return n=n||0,"center"==i?[e.x+o.width/2,e.y+o.height/2]:"left"==i?[e.x-n,e.y+o.height/2]:"top"==i?[e.x+o.width/2,e.y-n]:"bottom"==i?[e.x+o.width/2,e.y+o.height+n]:"right"==i?[e.x+o.width+n,e.y+o.height/2]:void 0}var Y={fontColor:function(t){return"color:"+t+";"},fontSize:function(t){return"font-size:"+t+"px;"},fontFamily:function(t){return"font-family:"+t+";"},fontWeight:function(t){return"font-weight:"+t+";"},fontStyle:function(t){return"font-style:"+t+";"},textAlign:function(t){var e="center";return"left"==t?e="flex-start":"right"==t&&(e="flex-end"),"justify-content:"+e+";text-align:"+t+";"},textVAlign:function(t){var e="center";return"top"==t?e="flex-start":"bottom"==t&&(e="flex-end"),"align-items:"+e+";"},angle:function(t){return"transform:rotate("+t+"deg);transform-origin:50% 50%;"},fillOpacity:function(t,e){return e?"fill-opacity:"+t+";":"opacity:"+t+";"},lineWidth:function(t,e){return e?"stroke-width:"+t+";":"border-width:"+t+"px;"},lineColor:function(t,e){return e?"stroke:"+t+";":"border-color:"+t+";"},lineStyle:function(t,e){var i=t;return e?("dotted"==t?i="2,2":"dashed"==t?i="4,4":webix.isArray(t)&&(i=t.join(",")),"stroke-dasharray:"+i+";"):"border-style:"+i+";"},backgroundColor:function(t,e){return e?"fill:"+t+";":"background:"+t+";"},altBackgroundColor:function(t){return"fill:"+t+";"}},J={text:["fontColor","fontFamily","fontSize","fontWeight","fontStyle","textAlign","textVAlign"],block:["angle","fillOpacity","lineWidth","lineColor","lineStyle","backgroundColor"],alt:["altBackgroundColor"],line:["lineWidth","lineColor","lineStyle"],arrow:["fillOpacity","lineWidth","lineColor","backgroundColor"]};function Q(t){return t.charAt(0).toUpperCase()+t.substring(1)}function tt(t,e,i){var n="block"!=e;"svg"==e&&(e="block");var o=J[e]||[];i=i||{};for(var r="",s=0;s<o.length;s++){var a=t[o[s]];webix.isUndefined(a)&&(a=i[o[s]]),webix.isUndefined(a)||null===a||(r+=Y[o[s]](a,n))}return r}var et=function(){function t(t,e){this.app=t,this._extraShapes=this.app.config?this.app.config.shapes:e}return t.prototype.connect=function(t,e){this._view=t,this._history=e,this._data=t.data,this._links=t.getLinks()},t.prototype.data=function(){return this._data},t.prototype.links=function(){return this._links},t.prototype.shapes=function(){var t=this;if(this._shapes)return this._shapes;this._shapes=new webix.DataCollection({});var e=[];for(var i in W)for(var n in W[i])e.push({id:n,name:Q(n),svg:W[i][n],group:i});return this._shapes.parse(e),webix.isArray(this._extraShapes)&&this._extraShapes.forEach((function(e){if(!e.id||!t._shapes.getItem(e.id))return e.group=e.group||"Extra",t._shapes.add(e);t._shapes.updateItem(e.id,e)})),this._shapes},t.prototype.addLinkToHistory=function(t,e,i){i[t.id]||(i[t.id]=!0,e.links.push(webix.copy(t)))},t.prototype.updateCustomLinks=function(t,e,i){var n=this,o=!1;return this._links.find((function(e){return e.source==t||e.target==t})).forEach((function(t){webix.isArray(t.line)&&(n.addLinkToHistory(t,e,i),t.line=X(n._view,t,t.from,t.to),o=!0)})),o},t.prototype.shiftData=function(t,e,i){var n=this,o=this._data.getItem(t),r=Math.min(0,o.x),s=Math.min(0,o.y);if(r<0||s<0)return e.data=this._data.serialize(),this._data.each((function(t){t.x-=r,t.y-=s}),this,!0),this._links.data.each((function(t){webix.isArray(t.line)&&(n.addLinkToHistory(t,e,i),t.line=t.line.map((function(t){return[(t=webix.isArray(t)?t:t.split(","))[0]-r,t[1]-s]})))}),this,!0),!0},t.prototype.addBlock=function(t){var e={value:webix.copy(t),prev:null,links:[]},i=this._data.add(t);return this._history.push("add",e,i),e.value.id=i,this.shiftData(i,e,{})&&this._view.render(),i},t.prototype.addLink=function(t){var e={value:webix.copy(t),prev:null},i=this._links.add(t);return this._history.push("add",e,i,!0),e.value.id=i,i},t.prototype.removeBlock=function(t){var e=this,i={value:null,prev:webix.copy(this._data.getItem(t)),links:[]};this._view.$blockRender=!0,this._links.find((function(e){return e.source==t||e.target==t})).forEach((function(t){i.links.push(webix.copy(t)),e._links.remove(t.id)})),this._view.$blockRender=!1,this._data.remove(t),this._history.push("remove",i,t)},t.prototype.removeLink=function(t){var e={value:null,prev:webix.copy(this._links.getItem(t))};this._links.remove(t),this._history.push("remove",e,t,!0)},t.prototype.updateBlock=function(t,e){var i={value:webix.copy(e),prev:webix.copy(this._data.getItem(t)),links:[]};this._data.updateItem(t,e),this._history.push("update",i,t);var n={},o=this.updateCustomLinks(t,i,n);this.shiftData(t,i,n)&&(o=!0),o&&this._view.render()},t.prototype.updateLink=function(t,e){e.mode&&(e.line=e.from=e.to=void 0);var i={value:webix.copy(e),prev:webix.copy(this._links.getItem(t))};this._links.updateItem(t,e),this._history.push("update",i,t,!0)},t}();var it={start:function(t,e){t._auto_scroll_delay=webix.delay(it.autoScroll,t,[e,webix.html.pos(e)],250)},reset:function(t,e){t._auto_scroll_delay&&(t._auto_scroll_delay=window.clearTimeout(t._auto_scroll_delay)),e&&t.snode&&(t.snode.style.minWidth="",t.snode.style.minHeight="",t.from.callEvent("onAfterAutoScroll",[]))},autoScroll:function(t,e){var i=-1!==this.direction.indexOf("y"),n=-1!==this.direction.indexOf("x"),o=webix.html.offset(this.from.$view),r=!1;i&&it.autoYScroll.call(this,e,o,this.senseY)&&(r=!0),n&&it.autoXScroll.call(this,e,o,this.senseX)&&(r=!0),r&&(!function(t,e){if(webix.DragControl.active){var i=webix.DragControl.getNode();e=webix.copy(e),webix.DragControl.$dragPos(e,t),i.style.top=e.y+webix.DragControl.top+"px",i.style.left=e.x+webix.DragControl.left+"px"}}(t,e),this._auto_scroll_delay=webix.delay(it.autoScroll,this,[t,e],100))},autoYScroll:function(t,e,i){var n=this.from.getScrollState();return t.y<e.y+i?it.autoScrollTo.call(this,n.x,n.y-i/2,"y"):t.y>e.y+e.height-i&&it.autoScrollTo.call(this,n.x,n.y+i/2,"y")},autoXScroll:function(t,e,i){var n=this.from.getScrollState();return t.x<e.x+i?it.autoScrollTo.call(this,n.x-i/2,n.y,"x"):t.x>e.x+e.width-i&&it.autoScrollTo.call(this,n.x+i/2,n.y,"x")},autoScrollTo:function(t,e,i){this.snode&&(this.snode.style.minWidth=(this.from.$width+Math.ceil(t))/this.zoom+"px",this.snode.style.minHeight=(this.from.$height+Math.ceil(e))/this.zoom+"px"),this.from.scrollTo(t,e),this.from.callEvent("onAfterAutoScroll",[]);var n=this.from.getScrollState();return Math.abs(("x"===i?t:e)-n[i])<1}};function nt(t,e){var i=t.config;return{x:e.x+(i.paddingX||i.padding),y:e.y+(i.paddingY||i.padding)}}var ot={$longTouchLimit:!0,$dragCreate:function(t,e){var i=this.locateEvent(e);if(i){var n=this.getContext();this.master.HideContext();var o=void 0;return(o=e.target.getAttribute("webix_resizer"))?(n.submode={},n.mode="resize",o.split(",").forEach((function(t){return n.submode[t]=!0})),rt[n.mode].$dragCreate.call(this,t,e,i)):(o=e.target.getAttribute("webix_connector"))?(n.mode="links",n.submode=o,rt[n.mode].$dragCreate.call(this,t,e,i)):(n.mode="move",rt[n.mode].$dragCreate.call(this,t,e,i))}return!1},$dragDestroy:function(t,e){var i=this.getContext();return i.from===this&&(i.from=this.view),rt[i.mode].dragScroll&&it.reset(i,!0),rt[i.mode].$dragDestroy&&rt[i.mode].$dragDestroy.call(this,t,e),i.$render||this.view.render(),webix.html.remove(e),!1},$dragIn:function(t,e,i){var n=this.getContext();return!!rt[n.mode]&&(rt[n.mode].dragScroll&&(it.reset(n),it.start(n,i)),!rt[n.mode].$dragIn||rt[n.mode].$dragIn.call(this,t,e,i))},$dragPos:function(t){var e=this.getContext();return rt[e.mode].$dragPos.call(this,t)},$dragOut:function(t,e,i,n){var o=this.getContext();return rt[o.mode].$dragOut?rt[o.mode].$dragOut.call(this,t,e,i,n):null},$drop:function(t,e,i){var n=this.getContext();return!!rt[n.mode]&&(rt[n.mode].$drop?rt[n.mode].$drop.call(this,t,e,i):void 0)},locateEvent:function(t,e){return webix.env.touch&&e&&(t=document.elementFromPoint(e.x,e.y),e.target=t),webix.html.locate(t,"webix_dg_id")},getEventContext:function(t){if(webix.env.touch){if(t.changedTouches&&(!t.touches||!t.touches[0])){var e=t.changedTouches[0];return{x:e.pageX,y:e.pageY}}return t.time?t:webix.env.mouse.context(t)}return{x:t.clientX,y:t.clientY}},getContext:function(){return webix.DragControl.getContext()},getNode:function(){return webix.DragControl.getNode()}},rt={add:{$drop:function(t,e,i){var n=this.getContext(),o=this.getNode(),r=this.view.getScrollState(),s=this.State.gridStep,a=nt(this.view,webix.html.offset(e)),l=this.master.app.getService("locale")._;if(!this.master.app.callEvent("diagram:beforedrop",[n,i]))return!1;var h=this.view.config.zoom,u={x:Math.round((parseInt(o.style.left)-a.x+r.x)/s/h)*s,y:Math.round((parseInt(o.style.top)-a.y+r.y)/s/h)*s};"default"!=n.start&&(u.type=n.start),"text"!=u.type||u.value||(u.value=l("Text")),n.$render=!0;var c=this.Local.addBlock(u);this.view.select(c)}},move:{dragScroll:{direction:"xy",senseX:100,senseY:100},$dragCreate:function(t,e,i){var n=this.getContext(),o=this.view.getItem(i),r=this.view.getItemNode(i),s=this.view.getScrollState(),a=this.getEventContext(e);if(webix.extend(n,{id:i,from:this.view,snode:t.querySelector(".webix_scroll_cont"),node:r,scroll:s,zoom:this.view.config.zoom,l:o.x,t:o.y,w:parseInt(r.style.width),h:parseInt(r.style.height),x:a.x,y:a.y},!0),rt[n.mode].dragScroll&&webix.extend(n,rt[n.mode].dragScroll),!this.master.app.callEvent("diagram:beforedrag",[n,e]))return!1;var l=r.cloneNode(!0);return l.className+=" webix_drag_zone",webix.html.addCss(t,"webix_de_mode_"+n.mode,!0),r.style.visibility="hidden",t.style.cursor="move",t.querySelector(".webix_diagram_shapes").appendChild(l),l},$dragPos:function(t){var e=this.getContext(),i=e.l,n=e.t,o=e.w,r=e.h,s=e.x,a=e.y,l=e.scroll,h=e.zoom,u=e.id,c=this.view.getScrollState(),d=this.State.gridStep;t.x=Math.round((i+(t.x-s-l.x+c.x)/h)/d)*d,t.y=Math.round((n+(t.y-a-l.y+c.y)/h)/d)*d;var p={id:u,x:t.x,y:t.y,width:o,height:r};this.master.Action({name:"sync-links",id:u,item:p})},$drop:function(t,e,i){var n=this.getContext(),o=this.getNode();if(!this.master.app.callEvent("diagram:beforedrop",[n,i]))return!1;var r=parseInt(o.style.left),s=parseInt(o.style.top);n.$render=!0,this.Local.updateBlock(n.id,{x:r,y:s}),this.view.select(n.id)},$dragDestroy:function(t){var e=this.getContext();webix.html.removeCss(t,"webix_de_mode_"+e.mode),e.node.style.visibility="",t.style.cursor=""}},links:{dragScroll:{direction:"xy",senseX:100,senseY:100},$dragCreate:function(t,e,i){var n=this.getContext(),o=this.view.getItem(i),r=this.view.getItemNode(i),s=nt(this.view,webix.html.offset(t));if(webix.extend(n,{id:i,from:this.view,node:r,startNode:e.target,offset:s,zoom:this.view.config.zoom,start:K(this.view,o,n.submode,4)},!0),rt[n.mode].dragScroll&&webix.extend(n,rt[n.mode].dragScroll),!this.master.app.callEvent("diagram:beforedrag",[n,e]))return!1;webix.html.addCss(n.startNode,"webix_de_selected_dot",!0);var a=webix.html.create("div",{visibility:"hidden"});return document.body.appendChild(a),a},$dragIn:function(t,e,i){var n=this.getContext(),o=this.getEventContext(i),r=this.locateEvent(i,o);if(!r)return!1;var s=this.view.getItemNode(r);return r!=n.target&&(webix.html.addCss(s,"webix_de_connect_end",!0),n.target=r),s},$dragPos:function(t){var e=this.getContext(),i=this.view.getScrollState(),n=e.offset,o=e.zoom;e.end=[(t.x-n.x+i.x)/o,(t.y-n.y+i.y)/o],this.master.Action({name:"temp-link",start:e.start,end:e.end})},$dragOut:function(t,e,i,n){var o=this.getContext(),r=this.getEventContext(n),s=this.locateEvent(n,r);if(o.target&&s!=o.target){var a=this.view.getItemNode(o.target);webix.html.removeCss(a,"webix_de_connect_end"),o.target=null}return null},$drop:function(t,e,i){var n=this.getContext(),o=this.getEventContext(i),r=n.id,s=this.locateEvent(i,o);if(!s||r==s)return!1;if(n.targetId=s,!this.master.app.callEvent("diagram:beforedrop",[n,i]))return!1;var a=webix.env.touch?o.target:i.target,l=n.submode,h=a.getAttribute("webix_connector")||"center",u={source:r,target:s};"center"!=l||"center"!=h?(u.to=h,u.from=l,u.line=X(this.view,u,l,h)):u.mode="direct",n.$render=!0;var c=this.Local.addLink(u);this.master.SelectLink(c)},$dragDestroy:function(){var t=this.getContext();webix.html.removeCss(t.startNode,"webix_de_selected_dot"),this.master.Action({name:"temp-link"})}},resize:{$dragCreate:function(t,e,i){var n=this.getContext(),o=this.view.getItem(i),r=this.view.getItemNode(i),s=this.view.getScrollState(),a=this.getEventContext(e);if(webix.extend(n,{id:i,from:this.view,node:r,startNode:e.target,selectNode:r.querySelector(".webix_de_selection_layer"),scroll:s,zoom:this.view.config.zoom,l:o.x,t:o.y,w:parseInt(r.style.width),h:parseInt(r.style.height),x:a.x,y:a.y},!0),!this.master.app.callEvent("diagram:beforedrag",[n,e]))return!1;webix.html.addCss(n.startNode,"webix_de_selected_dot",!0),webix.html.addCss(t,"webix_de_mode_"+n.mode,!0);var l=n.submode;t.style.cursor=l.top&&l.left||l.bottom&&l.right?"nwse-resize":"nesw-resize";var h=webix.html.create("div",{visibility:"hidden"});return document.body.appendChild(h),h},$dragPos:function(t){var e=this.getContext(),i=e.x,n=e.y,o=e.scroll,r=e.zoom,s=e.node,a=e.selectNode,l=e.id,h=this.view.getScrollState(),u=this.State.gridStep,c=Math.round((t.x-i-o.x+h.x)/r/u)*u,d=Math.round((t.y-n-o.y+h.y)/r/u)*u;if(c!=e.dx||d!=e.dy){var p=e.l,f=e.t,g=e.w,v=e.h;e.dx=c,e.dy=d;var w=this.master.app.config,m=w.minItemWidth,y=w.minItemHeight;e.submode.left?(s.style.left=Math.min(p+c,p+g-m)+"px",s.style.width=Math.max(g-c,m)+"px"):s.style.width=Math.max(g+c,m)+"px",a.style.width=parseInt(s.style.width)+10+"px",e.submode.top?(s.style.top=Math.min(f+d,f+v-y)+"px",s.style.height=Math.max(v-d,y)+"px"):s.style.height=Math.max(v+d,y)+"px",a.style.height=parseInt(s.style.height)+10+"px";var _={id:l,x:parseInt(s.style.left),y:parseInt(s.style.top),width:parseInt(s.style.width),height:parseInt(s.style.height)};this.master.Action({name:"sync-links",id:l,item:_})}},$drop:function(t,e,i){var n=this.getContext(),o=n.node;if(!this.master.app.callEvent("diagram:beforedrop",[n,i]))return!1;var r={x:parseInt(o.style.left),y:parseInt(o.style.top),width:parseInt(o.style.width),height:parseInt(o.style.height)};r.x==n.l&&delete r.x,r.y==n.t&&delete r.y,r.width==n.w&&delete r.width,r.height==n.h&&delete r.height,Object.keys(r).length&&(n.$render=!0,this.Local.updateBlock(n.id,r))},$dragDestroy:function(t){var e=this.getContext();webix.html.removeCss(e.startNode,"webix_de_selected_dot"),webix.html.removeCss(t,"webix_de_mode_"+e.mode),t.style.cursor=""}}};var st,at=function(t,e){return t(e={exports:{}},e.exports),e.exports}((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var i,n,o,r=function(){function t(t,e,i){this._tbounds=[0,0],t?(this.nodes=[e],t.collectSubNodes(e,this.nodes),this.hash=t.hash,this.root(e,i)):(this.nodes=[],this.hash={})}return t.prototype.copy=function(){var e=this,i=new t;return i.nodes=this.nodes.map((function(t){return{id:t.id,w:t.w,h:t.h,x:t.x,y:t.y,kids:[],links:[],isn:t.isn,iss:t.iss}})),i.hash={},i.nodes.forEach((function(t){i.hash[t.id]=t})),i.nodes.forEach((function(t){t.kids=e.hash[t.id].kids.map((function(t){return i.hash[t.id]})),t.links=e.hash[t.id].links.map((function(t){return i.hash[t.id]}))})),i._tbounds=[].concat(this._tbounds),i._ybounds=[].concat(this._ybounds),i._bounds=this._bounds?this._bounds.map((function(t){return[].concat(t)})):[],i.routes=this.routes,i._root=this._root?i.hash[this._root.id]:null,i},t.prototype.collectSubNodes=function(t,e){for(var i=0;i<t.kids.length;i++){var n=t.kids[i];e.push(n),n.kids&&this.collectSubNodes(n,e)}},t.prototype.getLevelBounds=function(){return this._bounds},t.prototype.getBounds=function(t,e,i){var n;return[(n=i?this._tbounds:this._bounds[t])[0]?n[0]-e/2:0,n[1]?n[1]+e/2:0]},t.prototype.addEdge=function(t,e){var i=this.hash[t],n=this.hash[e];i.links.push(n),n.links.push(i)},t.prototype.importNodes=function(t){var e=this;t.forEach((function(t){e.hash[t.id]=t,e.nodes.push(t)}))},t.prototype.split=function(e){var i=this,n=[];if(this.nodes=this.nodes.filter((function(t){return!e(t)||(delete i.hash[t.id],n.push(t),!1)})),!n.length)return null;var o=new t;return o.importNodes(n),o},t.prototype.addNode=function(t){t.kids=[],t.links=[],this._root||(this._root=t),this.hash[t.id]=t,this.nodes.push(t)},t.prototype.getNode=function(t){return this.hash[t]},t.prototype.getRoot=function(){return this._root},t.prototype.getLevels=function(){return this._deep},t.prototype.clean=function(){this.nodes.forEach((function(t){if(t.links.length>1){var e=[];t.links=t.links.filter((function(i){return-1===e.indexOf(i)&&t!==i&&(e.push(i),!0)}))}}))},t.prototype.getNodes=function(){return this.nodes},t.prototype.getBox=function(){return[this._tbounds,this._ybounds]},t.prototype.setGlobalBox=function(){var t,e,i,n;this.nodes.length&&(t=i=1/0,e=n=-1/0,this.nodes.forEach((function(o){var r=o.x-o.w/2,s=o.x+o.w/2,a=o.y-o.h/2,l=o.y+o.h/2;r<t&&(t=r),a<i&&(i=a),s>e&&(e=s),l>n&&(n=l)})),this._tbounds=[t,e],this._ybounds=[i,n])},t.prototype.translate=function(t){if(this.nodes.forEach((function(e){e.x+=t.x,e.y+=t.y})),this._tbounds[0]+=t.x,this._tbounds[1]+=t.x,this._bounds)for(var e=0;e<this._bounds.length;e++)this._bounds[e][0]+=t.x,this._bounds[e][1]+=t.x;this._ybounds&&(this._ybounds[0]+=t.y,this._ybounds[1]+=t.y)},t.prototype.rotate=function(t){var e=t.x,i=t.y;this.nodes.forEach((function(t){var n=t.x*i-t.y*e,o=t.x*e+t.y*i;t.x=n,t.y=o}));var n=this._tbounds,o=n[0],r=n[1],s=this._ybounds,a=s[0],l=s[1];this._tbounds=[o*i-a*e,r*i-l*e].sort(),this._ybounds=[o*e+a*i,r*e+l*i].sort()},t.prototype.setBox=function(){var t=this._deep[this._deep.length-1],e=-1/0;t.forEach((function(t){var i=t.y+t.h/2;i>e&&(e=i)})),this._ybounds=[this._root.y-this._root.h/2,e]},t.prototype.mirror=function(){this.nodes.forEach((function(t){t.x=-t.x}));for(var t=0;t<this._bounds.length;t++){var e=this._bounds[t],i=e[0],n=e[1];this._bounds[t]=[-n,-i]}var o=this._tbounds,r=o[0],s=o[1];this._tbounds=[-s,-r]},t.prototype.nonLeaves=function(t){return t.kids.filter((function(t){return t.kids.length>0}))},t.prototype.toTree=function(t){return t&&this.hash[t.id]||(t=this._detectRoot()),this.nodes.forEach((function(t){return t.kids=[]})),this.setKids(t),t},t.prototype.root=function(t,e){this._deep=[[t]];var i=Math.round((e&&e.rotate?t.h:t.w)/2);this._tbounds=[-i,i],this._bounds=[[-i,i]],this._leaves=[],this._root=t,this._setLevels(t,1),this._width=1;for(var n=0;n<this._deep.length;n++){var o=this._deep[n].length;o>this._width&&(this._width=o)}},t.prototype.setKids=function(t){var e=this;t.links.forEach((function(i){i.kids.length||(t.kids.push(i),e.setKids(i))}))},t.prototype._detectRoot=function(){var t={},e=this.nodes,i=[];do{i.forEach((function(e){return t[e]=1})),i=[],e=e.filter((function(e){var n=e.links.map((function(e){return t[e.id]?0:1})).reduce((function(t,e){return t+e}),0)>1;return n||i.push(e.id),n}))}while(e.length>2&&i.length);return e[0]||this.nodes[0]},t.prototype._setLevels=function(t,e){for(var i=t.kids,n=0;n<i.length;n++){var o=i[n],r=this._deep[e];r?r.push(o):(this._deep[e]=[o],this._bounds[e]=[0,0]),o.kids.length?this._setLevels(o,e+1):this._leaves.push(o)}},t.prototype.getIString=function(){for(var t=[],e=0;e<this._leaves.length;e++)this._leaves[e].isn=0,this._leaves[e].iss="";for(e=this._deep.length-2;e>=0;e--){for(var i=this._deep[e].filter((function(t){return t.kids.length>0})),n=0;n<i.length;n++)for(var o=i[n],r=0;r<o.kids.length;r++)o.iss=o.kids.map((function(t){return t.isn})).sort().join(",");i.sort((function(t,e){return t.iss>e.iss?1:-1})),t.push(i.map((function(t){return t.iss})).join("|"));var s=i[0].iss,a=1;for(n=0;n<i.length;n++)s!==i[n].iss&&(s=i[n].iss,a++),i[n].isn=a}return t.join(";")},t}();(n=e.LineMode||(e.LineMode={}))[n.Direct=1]="Direct",n[n.Edges=2]="Edges",n[n.Child=3]="Child",n[n.Sibling=4]="Sibling",(o=e.Direction||(e.Direction={}))[o.Top=1]="Top",o[o.Bottom=2]="Bottom",o[o.Right=3]="Right",o[o.Left=4]="Left";var s=((i={})[e.Direction.Bottom]={x:0,y:1},i[e.Direction.Top]={x:0,y:-1},i[e.Direction.Right]={x:1,y:0},i[e.Direction.Left]={x:-1,y:0},i),a=function(){function t(t,e){var i=this;this._config=t,this._conns=[],this._connMap=new Map,this._shapes=[],this._shapesMap=new Map,e&&(e.forEach((function(t){return i.addShape(t.id,t.x-t.w/2,t.y-t.h/2,t.x+t.w/2,t.y+t.h/2)})),e.forEach((function(e){e.links.forEach((function(n){return i.addConnector("",e.id,n.id,t.mode)}))})))}return t.prototype.addShape=function(t,e,i,n,o){var r={cx:e+(n-e)/2,cy:i+(o-i)/2,x1:e,y1:i,x2:n,y2:o,id:t};this._shapesMap.set(t,r),this._shapes.push(r)},t.prototype.addConnector=function(t,e,i,n){var o={id:t,from:e,to:i,mode:n,line:[]};this._conns.push(o),this._connMap.set(t,o)},t.prototype.finalize=function(t){for(var e=0;e<this._conns.length;e++)this._conns[e].line.length||this.drawLine(this._conns[e],t);return this._conns},t.prototype.drawLine=function(t,i){var n=this._shapesMap.get(t.from),o=this._shapesMap.get(t.to),r=i===e.Direction.Top||i===e.Direction.Bottom,s=t.mode||this._config.mode,a=this._config.padding||8;switch(s){case e.LineMode.Direct:t.line=[[n.cx,n.cy],[o.cx,o.cy]];break;case e.LineMode.Edges:if(r?n.cy===o.cy:n.cx===o.cx)t.line=[[n.cx,n.cy],[o.cx,o.cy]];else if(r){var l=Math.floor((o.cy-n.cy)/2);t.line=[[n.cx,n.cy],[n.cx,n.cy+l],[o.cx,n.cy+l],[o.cx,o.cy]]}else{var h=Math.floor((o.cx-n.cx)/2);t.line=[[n.cx,n.cy],[n.cx+h,n.cy],[n.cx+h,o.cy],[o.cx,o.cy]]}break;case e.LineMode.Sibling:if(r){var u=Math.min(n.x1,o.x1)+a;t.line=[[n.cx+a,n.cy],[u,n.cy],[u,o.cy],[o.cx+a,o.cy]]}else t.line=[[n.cx,n.cy],[o.cx,o.cy]];break;case e.LineMode.Child:if(r){u=Math.min(n.x1,o.x1)+a;t.line=[[n.cx,n.cy],[u,n.cy],[u,o.cy],[o.cx+a,o.cy]]}else t.line=[[n.cx,n.cy],[o.cx,o.cy]]}},t}(),l=function(){function t(){}return t.prototype.layout=function(t,i){t.root(t.toTree(t.hash[i.root])),i.levelPadding=i.levelPadding||this._getStep(t.getNodes())+i.itemPadding,i.dir=i.dir||e.Direction.Bottom,i.rotate=i.dir===e.Direction.Right||i.dir===e.Direction.Left;var n=s[i.dir];this._layout(t,i),t.setBox(),i.dir!==e.Direction.Bottom&&t.rotate(n);var o=t.getBox();return t.translate({x:-1*o[0][0],y:-1*o[1][0]}),t.setBox(),t},t.prototype._layout=function(t,e){var i=this,n=t.getRoot();if(n.x=n.y=0,1==t.getLevels().length)return t._symmetry=!0,"0";var o=n.kids.map((function(i){return new r(t,i,e)})),s={};o.forEach((function(t){var n=i._layout(t,e);s[n]?s[n].push(t):s[n]=[t]}));for(var a=Object.keys(s).sort((function(t,e){var i=s[t][0],n=s[e][0],o=i._width,r=n._width;if(o>r)return-1;if(o<r)return 1;var a=i.getLevels().length,l=n.getLevels().length;return a>l?-1:a<l||t<e?1:-1})),l=0,h=0,u=0;u<a.length;u++)s[a[u]].length%2==1&&(l++,h=u);var c=!1,d=!1;1==l?(s[a[h]][0]._symmetry&&(d=!0),c=!0,0!==h&&(a.unshift(a[h]),a.splice(h+1,1))):0===l&&(d=!0);return t._symmetry=d,this._layout_place(t,s,a,c,e),t.getIString()},t.prototype._layout_place=function(t,e,i,n,o){for(var r={x:0,y:o.levelPadding},s=!0,a=0;a<i.length;a++){e[i[a]].forEach((function(e){if(n){n=!1,e.translate(r);for(var i=0,a=0,l=e.getLevelBounds(),h=0;h<l.length;h++){var u=l[h],c=u[0],d=u[1];t._bounds[h+1]=[c,d],c<i&&(i=c),d>a&&(a=d)}t._tbounds=[i,a]}else{var p=s?1:0,f=s?0:1;s&&e.mirror();var g=void 0,v=void 0;v=g=999999*(s?-1:1);for(var w=o.itemPadding,m=0;m<e._bounds.length;m++){var y=t.getBounds(m+1,w,o.wide)[p]-e.getBounds(m,w,o.wide)[f];(s&&y>v||!s&&y<v)&&(v=y)}e.translate({x:v,y:r.y});for(var _=0;_<t._bounds.length;_++){var x=void 0;x=0==_||_>e._bounds.length?t._bounds[_][p]:t._bounds[_][p]=e._bounds[_-1][p],(s&&x>g||!s&&x<g)&&(g=x)}t._tbounds[p]=g,s=!s}}))}},t.prototype._getStep=function(t){var e=0;return t.forEach((function(t){e=Math.max(e,t.w,t.h)})),e},t}(),h=function(){function t(){}return t.prototype.layout=function(t,e){var i=t.getRoot(),n={minSpaceBetweenGen:e.levelPadding||20,minSpaceBetweenSibling:e.itemPadding||5,minAngleBetweenSibling:-1},o=d(t,i,e,n,n.minSpaceBetweenGen,[],0,!0),r=o.subAngle,s=o.count,a=o.firstGenOffset,l=o.maxRadius,h=o.genOffset;n.minAngleBetweenSibling=c(n.minSpaceBetweenSibling,n.minSpaceBetweenGen+a);var v=n.minSpaceBetweenGen;r+s*n.minAngleBetweenSibling>360?v=f(r+n.minAngleBetweenSibling*s,l)/(2*Math.PI)-h.reduce((function(t,e){return t+e}),0)-n.minSpaceBetweenGen*(h.length-1):n.minSpaceBetweenSibling=f((360-r)/s,o.maxRadius);var w=-v;return n.minAngleBetweenSibling=(360-d(t,i,e,n,v).subAngle)/s,function t(e,i,n,o,r,s,a,l,h){var d,f,v,w=i.kids;h&&(i.x=0,i.y=0);var m,y=0;if(w.length){f=v=l;for(var _=0;_<w.length;_++)d=w[_],y=Math.max(y,g(d));y=y/2+g(i)/2;for(_=0;_<w.length;_++){d=w[_];var x=h?0+y:o.minSpaceBetweenGen+y;v=t(e,d,n,o,r+x,s-x,a-x,v,!1)}if(!h)m=u(b=(f+v)/2,r,s,a),i.x=m.x,i.y=m.y}else{var b=c(p(g(i),r),r)+o.minAngleBetweenSibling;m=u(l+b/2,r,s,a),i.x=m.x,i.y=m.y,v=l+b}return v}(t,i,e,n,v,w,w,0,!0),t.translate({x:1e3,y:1e3}),t},t}();function u(t,e,i,n){var o,r={x:i+e,y:n};if(0===t)o=r;else{var s=t,a=s<=180;a||(s=360-s);var l=(180-s)/2,h=90-l,u=2*e*Math.sin(Math.PI*s/180/2),c=u*Math.sin(Math.PI*h/180),d=u*Math.sin(Math.PI*l/180);o={x:r.x+(a?d:-d),y:r.y+c}}return o}function c(t,e){return Math.ceil(t/e*180/Math.PI)}function d(t,e,i,n,o,r,s,a){r||(r=[]);var l=e.kids,h=0,u=0,f=0;if(l.length){for(var v=void 0,w=0,m=0;m<l.length;m++)v=l[m],w=Math.max(w,g(v));w=w/2+g(e)/2;for(m=0;m<l.length;m++){var y=d(t,v=l[m],i,n,a?o+w:o+n.minSpaceBetweenGen+w,r,s?s+1:1,!1),_=y.subAngle,x=y.count,b=y.maxRadius;h+=_,u+=x,f=Math.max(f,b)}return r[s-1]||r.push(w),{subAngle:h,count:u,maxRadius:f,firstGenOffset:w,genOffset:r}}return{subAngle:c(p(g(e),o),o),count:1,maxRadius:o}}function p(t,e){return 2*e*Math.asin(t/(2*e))}function f(t,e){return e*Math.PI*t/180}function g(t){var e=t.w,i=t.h;return Math.ceil(Math.sqrt(e*e+i*i))}var v=[1,2,4,8,0,16,32,64,128],w=function(){function t(){this._map={}}return t.prototype.getRoute=function(t,e){var i=this._map[t];return i&&i.map[e]||null},t.prototype.addRoute=function(t,e,i,n){this.addPath(t,e,i,n),this.addPath(e,t,-i,-n)},t.prototype.hasRoute=function(t,e,i){var n=this._map[t];return!!n&&(n.dir&this._code(e,i))>0},t.prototype.isAligned=function(t){return!!this._map[t]},t.prototype.isAxisAligned=function(t,e,i){var n=this._map[t];if(!n)return null;for(var o in n.map){var r=n.map[o];if(e&&r.dy||i&&r.dx)return!1}return!0},t.prototype.addPath=function(t,e,i,n,o){var r=this._map[t];r||(r=this._map[t]={map:{},dir:0}),r.map[e]={dx:i,dy:n,points:o},r.dir=r.dir|this._code(i,n)},t.prototype._code=function(t,e){return v[Math.sign(t)+1+3*(Math.sign(e)+1)]},t}();function m(t,e){var i=new r;return i.importNodes(t),{g:i,root:e}}var y=function(){function t(){}return t.prototype.layout=function(t,e){if(t.routes=new w,!e.full){var i=_(t,e);return e.preserveLocation||b(i.n,i.size),S(i.mx,i.n,i.n,i.size),i.n,t.setGlobalBox(),t}var n=function(t){var e=t.getNodes();if(e.length<3)return[{g:t}];for(var i=e[0],n=[],o=e.length+1;o!=e.length;)o=e.length,e=e.filter((function(e){if(1==e.links.length){var i=t.hash[e.links[0].id];return i&&(i.links=i.links.filter((function(t){return t.id!=e.id}))),n.push(e),!1}return!0}));if(e.length<2)return n.filter((function(t){return t.links.length>0})).forEach((function(t){t.links[0].links.push(t)})),t.root(t.toTree(i)),[{g:t}];var r={};n.forEach((function(t){return r[t.id]=t}));var s=n.filter((function(t){return!r[t.links[0].id]})).map((function(t){return[t]}));n.forEach((function(t){var e=r[t.links[0].id];e&&e.links.push(t)}));var a=s.map((function(t){for(var e,i=0;e=t[i++];){var n=e.links.length;if(n>1)for(var o=1;o<n;o++){var r=e.links[o];t.push(r)}}var s=t[0].links.splice(0,1)[0].id;return m(t,s)}));return[m(e,null)].concat(a)}(t);if(1==n.length&&null!==n[0].root)return(new l).layout(n[0].g,e);(t=n[0].g).routes=new w;var o=_(t,e);return e.preserveLocation||b(o.n,o.size),S(o.mx,o.n,o.n,o.size),e.full&&(!function(t,e,i,n){i.length,i.forEach((function(t){return t.iss=""}));var o=[].concat(i).filter((function(t){return t.links.length>=3})).sort((function(t,e){return t.links.length>e.links.length?-1:t.links.length==e.links.length?0:1}));if(o.map((function(t){var e=[];t.links.forEach((function(i){var n=Math.atan2(i.x-t.x,i.y-t.y)+Math.PI;var o=Math.ceil(n/(2*C))*2*C;var r=Math.floor(n/(2*C))*2*C;e.push([i,o,Math.abs(n-o)]);e.push([i,r,Math.abs(n-r)])}));e.sort((function(t,e){return t[2]>e[2]?1:-1}));return[t,e]})).forEach((function(e){var i=e[0],o=e[1],r=i.x,s=i.y;i.x=Math.round(i.x/n)*n,i.y=Math.round(i.y/n)*n;for(var a=0;a<o.length;a++){var l=o[a],h=l[0];if(!t.getRoute(i.id,h.id)){var u=M(i,h,l[1],n,r,s),c=u[0],d=u[1],p=u[2],f=u[3];t.hasRoute(i.id,p,f)||t.isAligned(h.id)||(h.x+=c,h.y+=d,t.addRoute(i.id,h.id,p,f))}}})),S(e,i,i.filter((function(e){return!t.isAligned(e.id)})),n),o.forEach((function(e){t.isAligned(e.id)||(e.x=Math.round(e.x/n)*n,e.y=Math.round(e.y/n)*n),e.links.forEach((function(i){2==i.links.length&&L(e,i,t,n)}))})),0===o.length){var r=i[0],s=i[0].links[0];s.x=Math.round(s.x/n)*n,s.y=Math.round(s.y/n)*n,L(r,s,t,n)}}(t.routes,o.mx,o.n,o.size),t=function(t,e,i,n,o){var r=t.getNodes().length;return i.forEach((function(i){var s=i.g,a=i.root,h={root:s.getNodes()[0].id,itemPadding:n.itemPadding,levelPadding:n.levelPadding};(new l).layout(s,h);var u=function(t,e,i,n,o,r,s){return e.map((function(e){if(!e[2]&&!e[3]&&i.routes.hasRoute(o,e[0],e[1]))return null;var a=n.copy(),l=i.copy(),h=a.getRoot(),u=l.hash[o];a.rotate({x:-e[0],y:e[1]});var c=a.getBox(),d=c[0][1]-c[0][0],p=c[1][1]-c[1][0];!function(t,e,i,n,o,r,s,a){var l,h,u,c,d,p,f=e.x+(a[2]||a[0])*s,g=e.y+(a[3]||a[1])*s;if(E(t,f-s/2,f+s/2,g-s/2,g+s/2))return void I(t,f-s/2*a[0],g-s/2*a[1],i,n,a,s);if((a[0]?i:n)/s-1<=0)return;var v=.45*s;a[0]?(u=f+s/2*a[0],c=u+i*a[0],p=(d=g-n/2-v-r)+n+2*v):(c=(u=f-i/2-v-o)+i+2*v,d=g+s/2*a[1],p=d+n*a[1]);d>p&&(d=(l=[p,d])[0],p=l[1]);u>c&&(u=(h=[c,u])[0],c=h[1]);E(t,u,c,d,p)&&I(t,f,g,i,n,a,s)}(l,u,d,p,h.x-c[0][0]-d/2,h.y-c[1][0]-p/2,r,e),function(t,e,i,n,o,r){var s=i.x+o*(r[0]||r[2])-n.x,a=i.y+o*(r[1]||r[3])-n.y;e.translate({x:s,y:a}),t.importNodes(e.getNodes())}(l,a,u,h,r,e);var f=function(t,e){for(var i,n=e.length,o=0,r=0;r<n;r++){i=0,0;for(var s=e[r],a=t[s.isn],l=0;l<n;l++)if(s.isn!=l){var h=e[l],u=a[h.isn],c=.5/(u*u),d=s.x-h.x,p=s.y-h.y,f=Math.sqrt(Math.pow(d,2)+Math.pow(p,2));f&&(i+=c*(d-u*d/f),i+=c*(p-u*p/f))}o+=Math.sqrt(Math.pow(i,2)+Math.pow(0,2))}return o}(t,l.getNodes().slice(0,s));return{g:l,s:f,dir:e}})).reduce((function(t,e){return!t||e&&e.s<t.s?e:t}))}(e,$,t,s,a,o,r);if(u){t=u.g;var c=s.getRoot().id;return u.dir[2]||u.dir[3]||t.routes.addRoute(a,s.getRoot().id,u.dir[0],u.dir[1]),t.hash[a].links.push(t.hash[c]),void t.hash[c].links.push(t.hash[a])}console.log("Can't position sub tree")})),t}(t,o.mx,n.slice(1).sort(B),e,o.size)),t.setGlobalBox(),t},t}();function _(t,e){var i=t.getNodes(),n=0,o=0;return i.forEach((function(t,e){t.isn=e,n=Math.max(n,t.w,t.h),o+=t.w+t.h})),e.itemPadding=e.itemPadding||Math.round(o/(2*i.length)),n+=e.itemPadding,{n:i,mx:function(t){for(var e=[],i=t.getNodes(),n=0;n<i.length;n++){var o=e[n]=[];o[i[n].isn]=0,x(i[n],o,n,1)}return e}(t),size:n}}function x(t,e,i,n){for(var o=[t],r=[];o.length;){for(var s=0;s<o.length;s++)for(var a=o[s],l=0;l<a.links.length;l++){var h=a.links[l],u=h.isn;u==i||e[u]||(e[u]=n,r.push(h))}n++,o=r,r=[]}}function b(t,e){var i=2*Math.PI/t.length,n=0,o=5*e;t.forEach((function(t,e){t.x=Math.round(Math.cos(n)*o),t.y=Math.round(Math.sin(n)*o),n+=i}))}function k(t,e,i,n){for(var o,r,s=0,a=0,l=0,h=0,u=e.length,c=i.length,d=0;d<c;d++){o=0,r=0;for(var p=i[d],f=t[p.isn],g=0;g<u;g++)if(p.isn!=g){var v=.5/((M=f[(L=e[g]).isn])*M),w=p.x-L.x,m=p.y-L.y;(V=Math.sqrt(Math.pow(w,2)+Math.pow(m,2)))&&(o+=v*(w-n*M*w/V),r+=v*(m-n*M*m/V))}var y=Math.sqrt(Math.pow(o,2)+Math.pow(r,2));y>a&&(s=p.isn,a=y,l=o,h=r)}var _,x=0,b=0,k=0,S=e[s],C=t[s];for(g=0;g<u;g++)if(s!=g){v=.5/((M=C[(L=e[g]).isn])*M);var L,M,V,$=(w=S.x-L.x)*w,I=(m=S.y-L.y)*m;(V=Math.sqrt(Math.pow($+I,3)))&&(x+=v*(1-n*M*I/V),b+=v*n*M*m*w/V,k+=v*(1-n*M*$/V))}return[s,a,_=(-l/x+b*h/(k*x))/(1+b*b/(k*x)),(-h-b*_)/k]}function S(t,e,i,n){for(var o=0;o++<100;){var r=k(t,e,i,n),s=r[0],a=r[1],l=r[2],h=r[3];if(a<10)break;e[s].x+=l,e[s].y+=h}}var C=Math.PI/4;function L(t,e,i,n){for(;;){var o=e.links[0];if(o==t&&(o=e.links[1]),t=e,(e=o).links.length>2)break;for(var r=Math.atan2(e.x-t.x,e.y-t.y)+Math.PI,s=2*Math.ceil(r/(2*C))*C,a=2*Math.floor(r/(2*C))*C,l=Math.abs(r-s)<Math.abs(r-a)?[s,a]:[a,s],h=0;h<l.length;h++){var u=M(t,e,l[h],n,t.x,t.y),c=u[0],d=u[1],p=u[2],f=u[3];if(!i.hasRoute(t.id,p,f)){if(i.isAligned(e.id))return;e.x+=c,e.y+=d,i.addRoute(t.id,e.id,p,f);break}}}}function M(t,e,i,n,o,r){return i<=C||i>7*C?[t.x-e.x,V(t.y,e.y,r,n),0,-1]:i<=3*C&&i>C?[V(t.x,e.x,o,n),t.y-e.y,-1,0]:i<=5*C&&i>3*C?[t.x-e.x,V(t.y,e.y,r,n),0,1]:[V(t.x,e.x,o,n),t.y-e.y,1,0]}function V(t,e,i,n){var o=Math.sign(i-e);return t-e-(Math.round((i-e)/n)||o)*n}var $=[[0,1,0,0],[1,0,0,0],[-1,0,0,0],[0,-1,0,0]].concat([[0,1,-1,1],[-1,0,-1,1],[0,1,1,1],[1,0,1,1],[1,0,1,-1],[0,-1,1,-1],[-1,0,-1,-1],[0,-1,-1,-1]]);function I(t,e,i,n,o,r,s){t.getNodes().forEach((function(t){r[1]?Math.sign(t.y-i)==r[1]&&(t.y+=(o+s/2)*r[1]):r[0]&&Math.sign(t.x-e)==r[0]&&(t.x+=(n+s/2)*r[0])}))}function E(t,e,i,n,o){for(var r=t.getNodes(),s=0;s<r.length;s++){var a=r[s];if(a.x>=e&&a.x<=i&&a.y>=n&&a.y<=o)return!0}return!1}function B(t,e){var i=t.g.getNodes().length,n=e.g.getNodes().length;return i>n?-1:i===n?0:1}e.Graph=r,e.Hola=y,e.RadialTree=h,e.Router=a,e.SymmetricTree=l,e.compose=function(t,e){if(t.length<2)return t[0]||null;var i=t[0].getBox(),n=e.padding,o=t.reduce((function(t,o){var r=o.getBox();return o.translate({x:i[0][1]-r[0][0]+n,y:i[1][0]-r[1][0]}),t.importNodes(o.getNodes()),n+=e.padding+r[0][1]-r[0][0],t}));return t.length&&o.setGlobalBox(),o},e.decompose=function(t){for(var e=[],i=function(){var i={},n=t.getNodes();if(!n.length)return{value:e};!function t(e,i){i[e.id]=1,e.links.forEach((function(e){i[e.id]||t(e,i)}))}(n[0],i);var o=t.split((function(t){return!i[t.id]}));if(e.push(t),!o)return{value:e};t=o};;){var n=i();if("object"==typeof n)return n.value}}})),lt=(st=at)&&st.__esModule&&Object.prototype.hasOwnProperty.call(st,"default")?st.default:st;at.LineMode,at.Direction,at.Graph,at.Hola,at.RadialTree,at.Router,at.SymmetricTree,at.compose,at.decompose;webix.protoUI({name:"diagram",defaults:{zoom:1,scroll:"auto",autoplace:!0,treePadding:120,padding:20},$init:function(t){var e=this;this._html=document.createElement("DIV"),this.$view.className+=" webix_diagram",this._destroy_with_me=[],this.data.provideApi(this,!0),this.serialize=this._serialize,this._initLinks(t.links),this._initShapes(t.shapes),t.scheme=this._setScheme(t.scheme),this._dataobj=this.$view.querySelector(".webix_scroll_cont"),this._dataobj.innerHTML='\n\t\t\t<div class="webix_diagram_shapes" style="position:absolute;"></div>\n\t\t\t<svg class="webix_diagram_links" width="100%" height="100%" style="overflow:visible"></svg>',this._links_layer=this._dataobj.querySelector(".webix_diagram_links"),this._shapes_layer=this._dataobj.querySelector(".webix_diagram_shapes"),this.$blockRender=!0,webix.promise.all([this.data.waitData,this._links.waitData]).then((function(){e.$blockRender=!1,e.data.callEvent("onStoreUpdated",[])})),this.data.attachEvent("onStoreUpdated",(function(){return e.render()})),this.types||(this.types={default:this.type},this.type.name="default"),this.type=webix.clone(this.type),this.linkType=webix.clone(this.linkType),this.$ready.push(this._afterInit)},_id:"webix_dg_id",on_click:{webix_diagram_item:function(t){if(this.config.select){var e=this.locate(t);return"multiselect"==this.config.select||this.config.multiselect?this.select(e,!1,t.ctrlKey||t.metaKey||"touch"==this.config.multiselect,t.shiftKey):this.select(e),!1}}},on_context:{},on_dblclick:{},_line_modes:{direct:1,edges:2,child:3,sibling:4},_afterInit:function(){var t=this.config;this._dataobj.style.position="relative",this._dataobj.style.margin=(t.paddingY||t.padding)+"px "+(t.paddingX||t.padding)+"px",this.attachEvent("onDestruct",(function(){this._dataobj=this._html=this._htmlmap=this._links_layer=this._shapes_layer=null,this._shapes=this._links=this._links_map=null;for(var t=0;t<this._destroy_with_me.length;t++)this._destroy_with_me[t].destructor()}))},getItemNode:function(t){if(this._htmlmap)return this._htmlmap[t];this._htmlmap={};for(var e=this._shapes_layer.childNodes,i=0;i<e.length;i++){var n=e[i].getAttribute(this._id);n&&(this._htmlmap[n]=e[i])}return this.getItemNode(t)},locate:function(t){return webix.html.locate(t,this._id)},_toHTMLObject:function(t){return this._html.innerHTML=this._toHTMLItem(t),this._html.firstChild},$getSize:function(t,e){var i=this.config;return i.autowidth&&(t=this._dataobj.offsetWidth+(i.paddingX||i.padding)+(this._dataobj.offsetHeight>e&&!i.autoheight?webix.env.scrollSize:0)),i.autoheight&&(e=this._dataobj.offsetHeight+2*(i.paddingY||i.padding)+(this._dataobj.offsetWidth>t&&!i.autowidth?webix.env.scrollSize:0)),webix.ui.baseview.prototype.$getSize.call(this,t,e)},$setSize:function(t,e){webix.ui.baseview.prototype.$setSize.call(this,t,e)&&this.render()},_set_dataobj_size:function(t){var e=this.config;this._dataobj.style.width=t[0][1]+(e.paddingX||e.padding)+"px";var i=t[1][1];this.config.autoheight||(i=e.zoom>1?i+(e.paddingY||e.padding):i*e.zoom),this._dataobj.style.height=i+"px",this._dataobj.style.transform="scale("+e.zoom+")"},linkItem_setter:function(t){this.linkType_setter(t)},linkType_setter:function(t){if(t&&"object"==typeof t)for(var e in t)0===e.indexOf("template")?this.linkType[e]=webix.template(t[e]):this.linkType[e]=t[e]},_link_id:"webix_dg_link_id",_arrow_id:"webix_dg_arrow_id",_shadow_id:"webix_dg_shadow_id",getLinkItemNode:function(t,e){var i;if(this._links_map||(this._links_map={}),this._links_map[t])i=this._links_map[t];else{var n=this._links_layer;(i=this._links_map[t]={link:n.querySelector("["+this._link_id+'="'+t+'"]'),arrow:n.querySelector("["+this._arrow_id+'="'+t+'"]')}).shadow=this.linkType.shadow?n.querySelector("["+this._shadow_id+'="'+t+'"]'):null}return e?i[e]:i},linkType:{css:"",mode:"edges",shadow:!1,arrow:!1,arrowCss:"",arrowSize:6,classname:function(t,e,i){var n="css"==i?"webix_diagram_link":"webix_diagram_arrow";e[i]&&(n+=" "+e[i]),t[i="$"+i]&&("object"==typeof t[i]&&(t[i]=webix.html.createCss(t[i])),n+=" "+t[i]);var o=this.getLinks().data.getMark(t.id,"$css");return o&&(n+=o),n},getStyle:function(t,e,i){return tt(t,e,i)},templateLine:function(t){if(!t.line||!t.line.length)return"";var e=t.diff||0,i=t.line.map((function(t){return webix.isArray(t)?[Math.ceil(t[0]+e),Math.ceil(t[1]+e)].join(","):t})).join(" ");return"<"+(t.type||"polyline")+" "+(t.attrs||"")+' points="'+i+'" '+(t.css?'class="'+t.css+'" ':"")+" "+(t.style?'style="'+t.style+'"':"")+"/>"},templateShadow:function(t,e,i){webix.isArray(t.line)&&(i=t.line);var n=this.getLinks().data.getMark(t.id,"$css")||"",o={line:i,diff:e.shadow/2,attrs:this._shadow_id+'="'+t.id+'"',css:"webix_diagram_link_shadow"+n,style:"stroke-width:"+((t.lineWidth||1)+e.shadow)+";"};return e.templateLine.call(this,o,e)},templateLink:function(t,e,i){webix.isArray(t.line)&&(i=t.line);var n={line:i,attrs:this._link_id+'="'+t.id+'"',css:e.classname.call(this,t,e,"css"),style:e.getStyle.call(this,t,"line",e)};return e.templateLine.call(this,n,e)},templateArrow:function(t,e,i){webix.isArray(t.arrow)&&(i=t.arrow);var n={line:i,attrs:this._arrow_id+'="'+t.id+'"',css:e.classname.call(this,t,e,"arrowCss"),style:e.getStyle.call(this,t,"arrow",e)};return"triangle"==(webix.isUndefined(t.arrow)?e.arrow:t.arrow)&&(n.type="polygon"),e.templateLine.call(this,n,e)}},autoPlace:function(t){this.config.autoplace||(this._links.data.each((function(t){delete t.line,webix.isArray(t.arrow)&&(t.arrow=!0)})),this._renderGraph(!0,t))},template_setter:function(t){this.type.template=webix.template(t)},customize:function(t){webix.type(this,t)},item_setter:function(t){return this.type_setter(t)},type_setter:function(t){return this.types[t]?(this.type=webix.clone(this.types[t]),this.type.css&&(this.$view.className+=" "+this.type.css)):this.customize(t),this.type.on_click&&webix.extend(this.on_click,this.type.on_click),t},type:{width:100,height:45,margin:20,marginX:0,marginY:0,listMarginX:20,classname:function(t,e){var i="webix_diagram_item";t.$css&&("object"==typeof t.$css&&(t.$css=webix.html.createCss(t.$css)),i+=" "+t.$css);var n=t.type||e.type;n?this.getShape(n)?i+=" webix_diagram_item_shape  webix_diagram_item_shape_"+n:i+=" webix_diagram_item_"+n:i+=" webix_diagram_item_def",e.css&&("function"==typeof e.css?i+=" "+e.css.call(this,t,e):i+=" "+e.css);var o=this.data.getMark(t.id,"$css");return o&&(i+=o),i},getStyle:function(t,e,i){return tt(t,e,this.getShape(t.type||i.type))},template:function(t){return t.value||""},templateSvg:function(t,e){var i,n=this.getShape(t.type||e.type),o="";return n&&(o=n.svg,(i=e.getStyle.call(this,t,"svg",e))&&(o=o.replace(/(<svg)/i,"$1 style='"+i+"'")),(i=e.getStyle.call(this,t,"alt",e))&&(o=o.replace(/(class="webix_diagram_shape_alt")/gi,"$1 style='"+i+"'"))),o},templateTextStart:function(t,e){return"<div class='webix_diagram_text' style='"+e.getStyle.call(this,t,"text",e)+"'><span class='webix_diagram_text_inner'>"},templateStart:function(t,e){var i=this._getItemSize(t,!0),n=t.$list?e.listMarginX:0,o="width:"+i.width+"px;height:"+i.height+"px;";return o+="top:"+1*t.y+"px;left:"+(1*t.x+n)+"px;",this.getShape(t.type||e.type)||(o+=e.getStyle.call(this,t,"block",e)),'<div webix_dg_id="'+t.id+'" class="'+e.classname.call(this,t,e)+'" style="'+o+'">'+e.templateSvg.call(this,t,e)+e.templateTextStart.call(this,t,e)},templateTextEnd:webix.template("</span></div>"),templateEnd:webix.template("{common.templateTextEnd()}</div>")},_initLinks:function(t){var e=this;t&&t.getItem?this._links=t:(this._links=new webix.DataCollection({scheme:this._setScheme()}),this._destroy_with_me.push(this._links),t&&"string"==typeof t?this._links.load(t,this.config.datatype):this._links.parse(t||[],this.config.datatype)),this._links.data.attachEvent("onStoreUpdated",(function(){return e.render()}))},getLinks:function(){return this._links},_toHTMLItem:function(t){return this.callEvent("onItemRender",[t]),this.type.templateStart.call(this,t,this.type)+this.type.template.call(this,t,this.type)+this.type.templateEnd.call(this,t,this.type)},render:function(t,e,i){if(this.isVisible(this.config.id)&&!this.$blockRender){if("update"==i){var n=this.getItemNode(t),o=this._htmlmap[t]=this._toHTMLObject(e);return webix.html.insertBefore(o,n),webix.html.remove(n),!0}return this._renderGraph(),!0}},_renderGraph:function(t,e){var i={full:!0,root:e||this.config.root,preserveLocation:!t&&!this.config.autoplace,itemPadding:this.type.marginX||this.type.margin};if(this.callEvent("onBeforeRender",[this.data])){this._htmlmap=this._links_map=null;var n=this._buildGraph(i);n.clean();var o=this._layoutGraph(n,i);this._showGraph(o[0],o[1],i);var r=o[0].getNodes().length?o[0].getBox():[[0,0],[0,0]];this._set_dataobj_size(r),this.callEvent("onAfterRender",[])}},_getItemSize:function(t,e){var i=this.type.width;e&&t.$list&&(i-=this.type.listMarginX);var n=this.getShape(t.type||this.type.type)||{};return{width:1*t.width||n.width||i,height:1*t.height||n.height||this.type.height}},_calcItemSize:function(t){var e=this.getShape(t.type||this.type.type)||{},i=this._getItemSize(t);i.width==i.height&&"auto"==i.width&&(webix.isUndefined(e.height)||"auto"==e.height?"auto"!=this.type.height?t.height=i.height=this.type.height:t.height=i.height=this.type.__proto__.height:t.height=i.height=e.height);var n="auto"==i.width?"width":"auto"==i.height?"height":null;if(n){var o=webix.html.create("DIV",{class:"webix_view webix_diagram_measure_size "+this.type.classname.call(this,t,this.type),style:"visibility:hidden;position:absolute;top:0px;left:0px;width:"+i.width+"px;height:"+i.height+"px"});o.style[n]="auto",document.body.appendChild(o);var r=this.type.template.call(this,t,this.type);o.innerHTML=r?this.type.templateTextStart.call(this,t,this.type)+r+this.type.templateTextEnd.call(this,t,this.type):this.type.templateSvg.call(this,t,this.type),t[n]=i[n]=o["width"==n?"offsetWidth":"offsetHeight"]+1,webix.html.remove(o)}return i},_buildGraph:function(t){var e=this,i=new lt.Graph,n=0;return this.data.each((function(o){var r=e._calcItemSize(o),s={id:String(o.id),w:r.width,h:r.height};n=Math.max(n,r.width,r.height),t.preserveLocation&&webix.extend(s,{x:1*o.x+s.w/2,y:1*o.y+s.h/2}),i.addNode(s),delete o.$list})),t.levelPadding=n+(this.type.marginY||this.type.margin),this._links.data.each((function(t){i.hash[t.source]&&i.hash[t.target]&&i.addEdge(t.source,t.target)})),i},_layoutGraph:function(t,e){var i,n=this;if(e.preserveLocation)(i=t).setGlobalBox();else{var o=new lt.Hola(e);i=lt.compose(lt.decompose(t).map((function(t){return t=o.layout(t,e),e.full||t.setGlobalBox(),t})),{padding:this.config.treePadding})}if(!i)return[t,[]];if(!e.preserveLocation){var r=i.getBox();i.translate({x:-r[0][0],y:-r[1][0]})}var s=new lt.Router({mode:1==this._line_modes[this.linkType.mode]?1:2,padding:this.type.listMarginX/2});return i.nodes.forEach((function(t){return s.addShape(String(t.id),t.x-t.w/2,t.y-t.h/2,t.x+t.w/2,t.y+t.h/2)})),this._links.data.each((function(t){i.hash[t.source]&&i.hash[t.target]&&(s.addConnector(String(t.id),String(t.source),String(t.target),n._line_modes[t.mode]),4==n._line_modes[t.mode]?(n.data.getItem(t.source).$list=!0,n.data.getItem(t.target).$list=!0):3==n._line_modes[t.mode]&&(n.data.getItem(t.target).$list=!0))})),[i,s.finalize(lt.Direction.Bottom)]},_showGraph:function(t,e,i){var n=this,o="";this.data.each((function(e){if(!i.preserveLocation){var r=t.getNode(e.id);e.x=r.x-r.w/2,e.y=r.y-r.h/2}o+=n._toHTMLItem(e)})),this._shapes_layer.innerHTML=o,o="",e.forEach((function(t){var e=n._links.getItem(t.id);n.linkType.shadow&&(o+=n.linkType.templateShadow.call(n,e,n.linkType,t.line)),o+=n.linkType.templateLink.call(n,e,n.linkType,t.line)})),e.forEach((function(t){var e=n._links.getItem(t.id);if(webix.isUndefined(e.arrow)?n.linkType.arrow:e.arrow){var i={correction:1,width:0,height:0,mode:null},r=t.line;webix.isArray(e.line)&&e.line.length>1&&(i.correction=0,r=e.line.map((function(t){return webix.isArray(t)?t:t.split(",").map((function(t){return 1*t}))})));var s=r.length,a=r[--s],l=r[--s];if(i.correction){var h=n.getItem(e.target);for(webix.extend(i,n._getItemSize(h,!0),!0);l&&!n._check_point(l,h,i);)a=l,l=r[--s]}i.x=a[0],i.y=a[1],l?l[0]==a[0]?(i.mode="height",i.k=l[1]<a[1]?-1:1):l[1]==a[1]?(i.mode="width",i.k=l[0]<a[0]?-1:1):(i.mode="direct",i.x0=l[0],i.y0=l[1]):i.mode=null,o+=n.linkType.templateArrow.call(n,e,n.linkType,i.mode&&n._get_arrow(e,i))}})),this._links_layer.innerHTML=o},_check_point:function(t,e,i){return t[0]<e.x||t[0]>e.x+i.width||t[1]<e.y||t[1]>e.y+i.height},_get_arrow:function(t,e){var i=t.arrowSize||this.linkType.arrowSize,n=Math.ceil(i/Math.sqrt(3));if("height"==e.mode)return e.y+=e.correction*e.k*e[e.mode]/2,[[e.x-n,e.y+e.k*i],[e.x,e.y],[e.x+n,e.y+e.k*i]];if("width"==e.mode)return e.x+=e.correction*e.k*e[e.mode]/2,[[e.x+e.k*i,e.y-n],[e.x,e.y],[e.x+e.k*i,e.y+n]];if("direct"==e.mode){var o,r,s,a,l,h,u,c,d,p,f,g=void 0,v=void 0;return r=e.height/2,o=(a=Math.abs(e.x-e.x0)/(Math.abs(e.y-e.y0)||1))*r,g=e.x+o*(e.x<e.x0?1:-1),v=e.y+r*(e.y<e.y0?1:-1),l=-n,h=(d=e.y0<e.y?-1:1)*i,u=n,c=d*i,s=Math.atan(a),p=d*(e.x<e.x0?1:-1),f=d*(e.x<e.x0?-1:1),g<e.x-e.width/2?(g=e.x-e.width/2,v=e.y+d*e.width/2*Math.tan(Math.PI/2-s)):g>e.x+e.width/2?(g=e.x+e.width/2,v=e.y+d*e.width/2*Math.tan(Math.PI/2-s)):(v+=e.y<e.y0?1:-1,g+=(e.x<e.x0?1:-1)*a),[[g+l*Math.cos(s)+p*h*Math.sin(s),v+h*Math.cos(s)+f*l*Math.sin(s)],[g,v],[g+u*Math.cos(s)+p*c*Math.sin(s),v+c*Math.cos(s)+f*u*Math.sin(s)]]}},_initShapes:function(t){this.$scope&&this.$scope.app?this._shapes=this.$scope.app.getService("local").shapes():(this._shapes=new et({},t).shapes(),this._destroy_with_me.push(this._shapes))},addShape:function(t,e){return this.getShape(t)?null:(e.id=t,e.name=t,this._shapes.add(e))},setShape:function(t,e){this.getShape(t)&&this._shapes.updateItem(t,e)},getShape:function(t){return this._shapes.getItem(t)},getShapes:function(){return this._shapes},_serialize:function(t){return t?{data:this.data.serialize(),shapes:this._shapes.serialize(),links:this._links.serialize(),item:webix.copy(this.type),linkItem:webix.copy(this.linkType)}:this.data.serialize()},$onLoad:function(t){return t.data&&(this._shapes.parse(t.shapes||[]),this._links.parse(t.links||[]),webix.extend(this.type,t.item,!0),webix.extend(this.linkType,t.linkItem,!0)),!1},_exportScheme:function(t){return delete(t=webix.copy(t)).$list,t},_setScheme:function(t){return t||(t={}),t.$serialize=t.$serialize||this._exportScheme,t.$export=t.$export||this._exportScheme,t}},webix.AutoTooltip,webix.DataMarks,webix.SelectionModel,webix.MouseEvents,webix.Scrollable,webix.DataLoader,webix.ui.baseview,webix.EventSystem),webix.protoUI({name:"diagram-icon-toggle",$cssName:"icon",defaults:{icons:["dgi-shape-square-plus","dgi-ray-start-arrow"]},$prepareValue:function(t){var e=this.config.icon=this.config.icons[t?1:0],i=this.$view.querySelector(".webix_icon");return i&&(i.className="webix_icon "+e),t},toggle:function(t){this.setValue(!this.getValue(),t)}},webix.ui.icon);var ht=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;return{view:"window",head:!1,autofit:!1,body:{padding:4,margin:4,cols:[{view:"icon",batch:"all",icon:"dgi-content-copy",click:function(){return t.CallAction("clone")}},{view:"diagram-icon-toggle",batch:"all",localId:"mode",click:function(){return t.ToggleMode()}},{view:"icon",icon:"wxi-trash",click:function(){return t.CallAction("remove")}}]}}},e.prototype.init=function(t){this.Window=t},e.prototype.CallAction=function(t,e){var i={name:t,value:e};this.app.callEvent("context:action",[i])},e.prototype.Show=function(t,e,i,n){var o;if(this.Window.getBody().showBatch(e?"none":"all"),e)if(i.e){var r=webix.html.offset(i.view);o={x:(o=webix.html.pos(i.e)).x-r.x+i.scroll.x+16,y:o.y-r.y+i.scroll.y+4}}else{var s=i.node.points,a=2==s.length?1:s.length-1;o={x:s[a].x*n+i.px-8-this.Window.$width,y:s[a].y*n+i.py+4}}else this.$$("mode").setValue(i.value,"auto"),o={x:(t.x-5)*n+i.px,y:(t.y-5)*n+i.py-8-this.Window.$height};this.Window.show(o)},e.prototype.Hide=function(){this.Window.hide()},e.prototype.ToggleMode=function(){var t=this.$$("mode");t.toggle(),this.CallAction("mode",t.getValue())},e}(u),ut=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;this.State=this.app.getState(),this._=this.app.getService("locale")._;var e=webix.skin.$active,i={view:"diagram",css:"webix_de_diagram"+(webix.env.touch?" webix_de_touch_diagram":""),padding:e.inputHeight+34,autoplace:!1,select:!0,data:this.app.config.data,links:this.app.config.links,shapes:this.app.config.shapes,scheme:this.app.config.scheme,type:{template:function(e,i){return t.TemplateValue(e,i)},templateTextEnd:function(e,i){return t.TemplateSelection(e,i)}},linkType:{shadow:2},on:{onAfterSelect:function(e){t.State.selected={id:e}}},onClick:{webix_window:function(){return!1},webix_c_scroll_x:function(){return!1},webix_c_scroll_y:function(){return!1},webix_diagram:function(e,i){i||(t.State.selected=null)},webix_diagram_link:function(e){var i=webix.html.locate(e,"webix_dg_link_id");return t.SelectLink(i,e),!1},webix_diagram_arrow:function(e){var i=webix.html.locate(e,"webix_dg_arrow_id");return t.SelectLink(i,e),!1},webix_diagram_link_shadow:function(e){var i=webix.html.locate(e,"webix_dg_shadow_id");return t.SelectLink(i,e),!1}}};return this.app.config.type&&webix.extend(i.type,this.app.config.type),i},e.prototype.init=function(t){var e=this;this.View=t;var i=this.app.config,n=i.minItemWidth,o=i.minItemHeight;this.UpdateCommonValue({width:Math.max(n,t.type.width),height:Math.max(o,t.type.height)},"type",!0),this.app.getService("styles").connect(t),this.History=this.app.getService("history"),this.Local=this.app.getService("local"),this.Local.connect(t,this.History),this.History.connect(this,this.Local),this.on(t,"onAfterUnSelect",(function(e){t.removeCss(e,"webix_de_connect_start")})),this.on(t,"onAfterRender",(function(){return e.AfterRender()})),this.on(this.app,"toolbar:autoplace",(function(){return e.Autoplace()})),this.Context=this.ui(ht,{container:t.$view}),this.on(this.app,"context:action",(function(t){return e.Action(t)})),this.on(this.State.$changes,"selected",(function(t){return e.TrackSelection(t)})),this.on(this.app,"form:update",(function(t,i,n){return e.ApplyChanges(t,i,n)})),this.on(this.app,"form:swap",(function(){return e.SwapLinkDirection(e.State.selected.id)})),this.on(this.State.$changes,"zoom",(function(t,i){return e.Zoom(t,i)})),this.on(this.State.$changes,"gridStep",(function(t){return e.DrawGrid(t)})),this.on(this.app,"toolbar:preview",(function(t){return e.DrawGrid(e.State.gridStep,t)})),this._scroll_handler=webix.event(this.View.$view,"scroll",(function(){e.SetGridBgPosition()})),this.InitTempLink(),function(t,e){var i=webix.copy(ot);i.view=e,i.master=t,i.State=t.app.getState(),i.Local=t.Local,webix.DragControl.addDrag(e.$view,i),webix.DragControl.addDrop(e.$view,i,!0)}(this,t),this.AddHotkeys()},e.prototype.destroy=function(){this._scroll_handler=webix.eventRemove(this._scroll_handler)},e.prototype.AfterRender=function(){var t=this.State.selected;if(t){var e=this.GetItem(t.id,t.link);if(!e)return this.State.selected=null;this.ShowContext(e,t.link),this.app.callEvent("diagram:syncform",[e])}else this.app.callEvent("values:defaults",[])},e.prototype.ShowContext=function(t,e,i){if(!t){var n=this.State.selected;if(!n)return;e=n.link,t=this.GetItem(n.id,e)}var o=this.GetContextConfig(t,e,i);this.Context.Show(t,e,o,this.State.zoom)},e.prototype.GetContextConfig=function(t,e,i){var n=this.View.config,o={e:i,px:n.paddingX||n.padding||0,py:n.paddingY||n.padding||0};return e?o.e?(o.view=this.View.$view,o.scroll=this.View.getScrollState()):o.node=this.View.getLinkItemNode(t.id,"link"):o.value=this.View.data.getMark(t.id,"webix_de_connect_start"),o},e.prototype.HideContext=function(){this.Context.Hide()},e.prototype.TemplateSelection=function(t,e){var i=this.View.getShape(t.type||e.type)||{};return'</span></div>\n\t\t<div class="webix_de_selection_layer" style="'+("width:"+((1*t.width||i.width||e.width)+10)+"px;height:"+((1*t.height||i.height||e.height)+10)+"px;")+'">\n\t\t\t<div webix_resizer="top,left" class="webix_de_resize webix_de_top_left"></div>\n\t\t\t<div webix_connector="left" class="webix_de_connect webix_de_left"></div>\n\t\t\t<div webix_resizer="bottom,left" class="webix_de_resize webix_de_bottom_left"></div>\n\t\t\t<div webix_connector="top" class="webix_de_connect webix_de_top"></div>\n\t\t\t<div webix_connector="center" class="webix_de_connect webix_de_center"></div>\n\t\t\t<div webix_connector="bottom" class="webix_de_connect webix_de_bottom"></div>\n\t\t\t<div webix_resizer="top,right" class="webix_de_resize webix_de_top_right"></div>\n\t\t\t<div webix_connector="right" class="webix_de_connect webix_de_right"></div>\n\t\t\t<div webix_resizer="bottom,right" class="webix_de_resize webix_de_bottom_right"></div>\n\t\t</div>'},e.prototype.GridTemplate=function(t,e){var i=t<3?.2:.5;return'<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%"><pattern id="webixDiagramPattern"  width="'+t+'" height="'+t+'" patternUnits="userSpaceOnUse"><circle cx="0" cy="0" r="'+i+'" fill="'+(e=e||"contrast"==webix.skin.$name?"#777":"#c4c4c4")+'" /><circle cx="'+t+'" cy="0" r="'+i+'" fill="'+e+'" /><circle cx="0" cy="'+t+'" r="'+i+'" fill="'+e+'" /><circle cx="'+t+'" cy="'+t+'" r="'+i+'" fill="'+e+'" /></pattern><rect x="0" y="0" width="100%" height="100%" fill="url(#webixDiagramPattern)" /></svg>'},e.prototype.TemplateValue=function(t,e){var i=this.app.config,n=i.template||(i.type?i.type.template:null);return n?n.call(this,t,e):t.value||""},e.prototype.InitTempLink=function(){var t=this.TempLink=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttributeNS(null,"width","100%"),t.setAttributeNS(null,"height","100%"),t.classList.add("webix_de_temp_line"),t.innerHTML="<polyline points='' />",this.View.$view.querySelector(".webix_scroll_cont").appendChild(t)},e.prototype.TrackSelection=function(t){if(t){var e=t.id,i=t.link,n=this.GetItem(e,i);i?this.View.unselectAll():this.UnselectLink(),this.ShowContext(n,i,t.e),this.app.callEvent("diagram:select",[n,i])}else this.View.unselectAll(),this.UnselectLink(),this.HideContext(),this.app.callEvent("diagram:select",[])},e.prototype.SelectLink=function(t,e){var i=this.SelectedLink;if(t&&t!=i){this.UnselectLink(),this.SelectedLink=t;var n=this.View.getLinkItemNode(t);n.link&&n.link.classList.add("webix_selected"),n.arrow&&n.arrow.classList.add("webix_selected"),n.shadow&&n.shadow.classList.add("webix_selected"),this.View.getLinks().data.addMark(t,"webix_selected",!0,!0,!0),this.State.selected={id:t,e:e,link:!0}}},e.prototype.UnselectLink=function(){var t=this.SelectedLink;if(t){var e=this.View.getLinks();if(e.exists(t)){var i=this.View.getLinkItemNode(t);i.link&&i.link.classList.remove("webix_selected"),i.arrow&&i.arrow.classList.remove("webix_selected"),i.shadow&&i.shadow.classList.remove("webix_selected"),e.data.removeMark(t,"webix_selected",!0,!0)}this.SelectedLink=null}},e.prototype.Action=function(t){var e=this;if("clone"==t.name){var i=this.State.selected.id,n=this.CloneBlock(i);this.View.select(n)}else if("remove"==t.name){if(this.State.selected){var o=this.State.selected;i=o.id;(r=o.link)?this.Local.removeLink(i):this.Local.removeBlock(i)}}else if("mode"==t.name){i=this.State.selected.id;t.value?this.View.addCss(i,"webix_de_connect_start"):this.View.removeCss(i,"webix_de_connect_start")}else if("temp-link"==t.name){var r=this.TempLink.firstChild;if(t.start){var s=t.start.join(",")+" "+t.end.join(",");r.setAttribute("points",s)}else r.setAttribute("points","")}else if("sync-links"==t.name){this.View.getLinks().find((function(e){return e.source==t.id||e.target==t.id})).forEach((function(i){var n=X(e.View,i,i.from,i.to,t.item),o=e.View.getLinkItemNode(i.id);if(o.link&&o.link.setAttribute("points",n.map((function(t){return[Math.ceil(t[0]),Math.ceil(t[1])].join(",")})).join(" ")),o.shadow&&o.shadow.classList.contains("webix_selected")){var r=e.View.linkType.shadow/2;o.shadow.setAttribute("points",n.map((function(t){return[Math.ceil(t[0]+r),Math.ceil(t[1]+r)].join(",")})).join(" "))}o.arrow&&webix.html.remove(o.arrow)}))}else if("copy"==t.name){var a=this.State.selected;a&&!a.link?this.CopyId=a.id:this.CopyId=null}else"paste"==t.name?this.CopyId&&this.GetItem(this.CopyId)&&this.CloneBlock(this.CopyId):"undo"==t.name?this.History.undo():"redo"==t.name&&this.History.redo()},e.prototype.CloneBlock=function(t){var e=webix.copy(this.View.getItem(t));return delete e.id,e.x=e.x+this.View.type.width+20,e.y=e.y+this.View.type.height+20,this.Local.addBlock(e)},e.prototype.Autoplace=function(){var t={data:this.Local.data().serialize(),links:this.Local.links().serialize()};this.View.autoPlace(),this.History.push("autoplace",t)},e.prototype.UpdateCommonValue=function(t,e,i){var n={value:webix.copy(t),prev:{},target:e};for(var o in t)n.prev[o]=this.View[e][o],this.View[e][o]=t[o];i||this.History.push("common",n),this.View.render()},e.prototype.SwapLinkDirection=function(t){var e=this.View.getLinks().getItem(t),i=e.source,n=e.target;this.Local.updateLink(t,{source:n,target:i})},e.prototype.DrawGrid=function(t,e){if(e)this.View.$view.style.backgroundImage="none";else{var i=this.GridTemplate(t);this.View.$view.style.backgroundImage="url('data:image/svg+xml;UTF8,"+encodeURIComponent(i)+"')",this.SetGridBgPosition()}},e.prototype.SetGridBgPosition=function(){var t=this.State.gridStep,e=this.View.config,i=this.View.getScrollState(),n=i.x,o=i.y,r=-n+(e.paddingX||e.padding)%t,s=-o+(e.paddingY||e.padding)%t;this.View.$view.style.backgroundPosition=r+"px "+s+"px"},e.prototype.Zoom=function(t){this.View.$view.className=this.View.$view.className.replace(/ webix_de_scale_\d+/,""),webix.html.addCss(this.View.$view,"webix_de_scale_"+this.GetScaleCssSuffix(t)),this.View.config.zoom=t,this.View.render()},e.prototype.GetScaleCssSuffix=function(t){return t<=.3?"03":t<=.5?"05":t<.9?"07":Math.round(t)},e.prototype.GetItem=function(t,e){return(e?this.View.getLinks():this.View).getItem(t)},e.prototype.ApplyChanges=function(t,e,i){var n,o=parseFloat(e);e=isNaN(o)?e:o;var r=((n={})[t]=e,n),s=this.State.selected;s?s.link?this.Local.updateLink(s.id,r):this.Local.updateBlock(s.id,r):this.UpdateCommonValue(r,i)},e.prototype.AddHotkeys=function(){for(var t=this,e=this.GetHotkeyData(),i=function(i){var o;n.on({attachEvent:function(t,e){return webix.UIManager.addHotKey(t,e,o),{key:t,handler:e}},detachEvent:function(t){var e=t.key,i=t.handler;return webix.UIManager.removeHotKey(e,i,o)}},e[i].key,(function(n,o){t.CheckHotkeyView(n)&&(t.Action({name:e[i].action}),webix.html.preventEvent(o))}))},n=this,o=0;o<e.length;++o)i(o)},e.prototype.GetHotkeyData=function(){if(!this._hotkeys){var t=webix.env.isMac?"COMMAND":"CTRL";this._hotkeys=[{key:"DELETE",action:"remove"},{key:"BACKSPACE",action:"remove"},{key:t+"+C",action:"copy"},{key:t+"+V",action:"paste"},{key:t+"+Z",action:"undo"},{key:t+"+SHIFT+Z",action:"redo"},{key:t+"+Y",action:"redo"}]}return this._hotkeys},e.prototype.CheckHotkeyView=function(t){return t==this.View||t==this.Context.getRoot()},e}(u);webix.protoUI({name:"diagram-counter",$cssName:"counter webix_de_control_counter",$init:function(){var t=this;this.attachEvent("onAfterRender",(function(){t.$setValue(t.config.value),t.getInputNode().readOnly=!0,webix.event(t.$view.firstChild,"keydown",(function(t){return webix.html.preventEvent(t)}))}))},$setValue:function(t){this.getInputNode().value=parseInt(100*t,10)+"%"},shift:function(t,e){var i=this.config.value,n=this.config.numbers,o=n.indexOf(i)+t;this.setValue(n[o]||i,e)}},webix.ui.counter),webix.protoUI({name:"diagram-toggle",$cssName:"toggle webix_de_toggle",$prepareValue:function(t){return t&&1!==t&&!0!==t?t===this.config.onValue?1:0:t},getValue:function(){return this.config.value?this.config.onValue:this.config.offValue},toggle:function(t){this.setValue(!this.config.value,t)}},webix.ui.toggle);var ct=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){this.State=this.app.getState(),this._=this.app.getService("locale")._;var t=webix.skin.$active.layoutPadding.space,e=webix.skin.$active.layoutMargin.form;return{view:"toolbar",localId:"toolbar",padding:t,elements:[{width:430,margin:e,cols:this.LeftGroupConfig()},{},{margin:e,cols:this.CenterGroupConfig()},{},{margin:e,width:430,cols:this.RightGroupConfig()}]}},e.prototype.init=function(){var t=this;this.History=this.app.getService("history"),this.on(this.app,"UndoChange",(function(){t.$$("undo").define("disabled",!t.History.hasUndo()),t.$$("redo").define("disabled",!t.History.hasRedo()),t.$$("reset").define("disabled",t.History.state.length<2)})),this.SetValues()},e.prototype.LeftGroupConfig=function(){var t=this,e=this.State,i=this._,n=webix.skin.$active;return[{view:"button",label:i("Reset"),localId:"reset",autowidth:!0,click:function(){return t.History.reset()}},{view:"icon",icon:"dgi-undo",localId:"undo",click:function(){return t.History.undo()}},{view:"icon",icon:"dgi-redo",localId:"redo",click:function(){return t.History.redo()}},{view:"diagram-counter",name:"zoom",width:108,numbers:this.GetZoomNumbers(),on:{onChange:function(t,i,n){"user"==n&&(e.zoom=t)}}},{view:"diagram-grid",css:"webix_de_control_grid",width:80,name:"grid",min:1,format:this.GridStepFormat(),inputLabel:"<span class='webix_icon dgi-grid'></span>",on:{onChange:function(t,i,n){"user"==n&&(e.gridStep=t)}}},{view:"diagram-toggle",name:"preview",css:"webix_de_control_preview",offLabel:"<span class='webix_icon dgi-preview'></span>",onLabel:"<span class='webix_icon dgi-preview-off'></span>",onValue:1,offValue:0,width:n.inputHeight-2,on:{onChange:function(e){return t.app.callEvent("toolbar:preview",[e])}}}]},e.prototype.CenterGroupConfig=function(){var t=this;return[{view:"button",label:(0,this._)("Autoplace"),css:"webix_primary",autowidth:!0,align:"center",click:function(){return t.app.callEvent("toolbar:autoplace",[])}}]},e.prototype.RightGroupConfig=function(){return[{},{view:"button",label:(0,this._)("Apply"),css:"webix_primary",autowidth:!0,align:"right",click:this.app.config.save}]},e.prototype.SetValues=function(){var t=this.State;this.$$("toolbar").setValues({zoom:t.zoom,grid:t.gridStep})},e.prototype.GridStepFormat=function(){return{edit:function(t){return parseInt(t,10)||1},parse:function(t){return parseInt(t,10)||1}}},e.prototype.GetZoomNumbers=function(){return[.25,.5,.75,.9,1,1.1,1.25,1.5,1.75,2,3,4]},e}(u),dt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;this._=this.app.getService("locale")._,this.State=this.app.getState(),this.Shapes=this.app.getService("local").shapes();var e=this.webix.skin.$active;this.headerH=e.inputHeight-2*e.inputPadding;var i=[{id:"default",name:"Default",svg:"<div class='webix_diagram_item_def' style='height:100%;width:100%'></div>",group:"common"},{id:"org",name:"Organization",svg:"<div class='webix_diagram_item_org' style='height:100%;width:100%'></div>",group:"common"},{id:"text",name:"Text",svg:"<div class='webix_de_item_text'><span>"+Q(this._("Text"))+"</span></div>",group:"common"}],n={view:"scrollview",scroll:"auto",width:240,body:{margin:0,css:"webix_de_accordion",multi:!0,rows:[]}},o=[];return this.Shapes.data.each((function(t){-1===o.indexOf(t.group)&&o.push(t.group)})),n.body.rows.push(this.GetPanelConfig(i,"common")),o.forEach((function(e){var i=t.Shapes.find((function(t){return t.group==e}));n.body.rows.push(t.GetPanelConfig(i,e))})),n},e.prototype.init=function(){var t=this;this.AdjustDragPos(),this.on(this.Shapes.data,"onStoreUpdated",(function(){return t.refresh()}))},e.prototype.AdjustDragPos=function(){this.getRoot().queryView("dataview","all").forEach((function(t){t.$dragPos=function(t){var e=webix.DragControl.getNode().firstChild,i=webix.html.offset(e);t.x=t.x-Math.round(i.width/2),t.y=t.y-Math.round(i.height/2)}}))},e.prototype.GetPanelConfig=function(t,e){return{header:this._(Q(e)),headerHeight:this.headerH,headerAltHeight:this.headerH,css:"webix_de_panel",body:this.GetDataviewConfig(t,e)}},e.prototype.GetDataviewConfig=function(t,e){var i=this;return{view:"dataview",localId:e+"View",css:"webix_de_shapes",autoheight:!0,template:function(t,e){return i.TemplateSvg(t,e)},tooltip:function(t){return t.name?i._(t.name):""},xCount:2,type:{width:120,css:"webix_diagram_item_shape"},data:t,drag:"source",on:{onBeforeDrag:function(t){return t.mode="add",t.html=i.CreateDnDShape(t),!0}}}},e.prototype.TemplateSvg=function(t,e){var i,n="";return n=t.svg,(i=tt(t,"svg",e))&&(n=n.replace(/(<svg)/i,"$1 style='"+i+"'")),(i=tt(t,"alt",e))&&(n=n.replace(/(class="webix_diagram_shape_alt")/gi,"$1 style='"+i+"'")),n},e.prototype.CreateDnDShape=function(t){var e=t.from.getItem(t.start),i=this.app.getService("styles").getBlockValues();return'<div class="webix_diagram_item webix_diagram_item_shape" style="width:'+i.width+"px;height:"+i.height+'px;">\n\t\t\t\t'+this.TemplateSvg(e)+"\n\t\t\t</div>"},e}(u);webix.protoUI({name:"diagram-grid",$cssName:"text webix_diagram_control_text",$init:function(){var t=this;this._inputSpacing=webix.skin.$active.inputSpacing,this.attachEvent("onAfterRender",(function(){t.getInputNode().min=t.config.min}))},defaults:{min:0,icon:!0,type:"number"},$prepareValue:function(t){return Math.abs(parseFloat(t||0))},$renderIcon:function(t){var e=t.aheight-2*t.inputPadding,i=(e-18)/2-1,n=this._inputSpacing/2,o="";return t.inputLabel&&(o+="<span style='right:"+n+"px;height:"+(e-i)+"px;' class='webix_de_input_label'><span>"+t.inputLabel+"</span></span>"),o}},webix.ui.text),webix.protoUI({name:"diagram-text",$allowsClear:!1,$init:function(){this.attachEvent("onBlur",this._applyChanges),this.attachEvent("onEnter",this._applyChanges)},_applyChanges:function(){var t=this.getValue();1*t<this.config.min&&(t=this.config.min,this.getInputNode().value=t),this.setValue(t,"user")}},webix.ui["diagram-grid"]);var pt={"triangle-fill":"<svg width='35' height='10' viewBox='0 0 35 10' fill='none' xmlns='http://www.w3.org/2000/svg'>\n<path d='M35 5L24.9632 9.33013L24.9632 0.669873L35 5Z' fill='#94A1B3'/><path d='M0 5L32.5746 5' stroke='#94A1B3'/></svg>",angle:"<svg width='36' height='8' viewBox='0 0 36 8' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M35.3536 4.35356C35.5488 4.15829 35.5488 3.84171 35.3536 3.64645L32.1716 0.464469C31.9763 0.269207 31.6597 0.269206 31.4645 0.464469C31.2692 0.659731 31.2692 0.976313 31.4645 1.17158L34.2929 4L31.4645 6.82843C31.2692 7.02369 31.2692 7.34027 31.4645 7.53554C31.6597 7.7308 31.9763 7.7308 32.1716 7.53554L35.3536 4.35356ZM-4.09794e-08 4.5L35 4.5L35 3.5L4.09794e-08 3.5L-4.09794e-08 4.5Z' fill='#94A1B3'/></svg>",triangle:"<svg width='35' height='10' viewBox='0 0 35 10' fill='none' xmlns='http://www.w3.org/2000/svg'>\n<path d='M0 5L32.5746 5' stroke='#94A1B3'/><path d='M35 5L24.9632 9.33013L24.9632 0.669873L35 5Z' class='webix_diagram_arrow_icon' fill='#fff'  stroke='#94A1B3' /></svg>",solid:"<svg width='74' height='8' viewBox='0 0 90 8' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M0 4.857117L80 4.857117' stroke='#94A1B3'/></svg>",dashed:"<svg width='74' height='8' viewBox='0 0 90 8' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M0 4.857117L80 4.857117' stroke='#94A1B3' stroke-dasharray='4,4'/></svg>",dotted:"<svg width='74' height='8' viewBox='0 0 90 8' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M0 4.857117L80 4.857117' stroke='#94A1B3' stroke-dasharray='2,2'/></svg>"},ft=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){return this._=this.app.getService("locale")._,this.Styles=this.app.getService("styles"),this.MarginX=6,{width:300,cells:[{localId:"common",view:"form",scroll:!0,elementsConfig:{on:{onChange:this.ChangeHandler}},elements:this.GetCommonConfig()},{localId:"block",view:"form",scroll:!0,elementsConfig:{on:{onChange:this.ChangeHandler}},elements:this.GetBlockConfig()},{localId:"link",view:"form",scroll:!0,elementsConfig:{on:{onChange:this.ChangeHandler}},elements:this.GetLinkConfig()}]}},e.prototype.init=function(){var t=this;this.Mode="common",this.ShowForm("common"),this.SetCommonValues(),this.on(this.app,"diagram:syncform",(function(e){var i="link"==t.Mode?t.Styles.getLinkValues(e):t.Styles.getBlockValues(e);t.Form.setValues(i,!0)})),this.on(this.app,"diagram:select",(function(e,i){e?(t.Mode=i?"link":"block",t.ShowForm(t.Mode),i?t.SetLinkValues(e):t.SetBlockValues(e)):(t.Mode="common",t.ShowForm("common"),t.SetCommonValues())})),this.on(this.app,"values:defaults",(function(){t.SetCommonValues()}))},e.prototype.ShowForm=function(t){this.Form=this.$$(t),this.Form.show(null,!1)},e.prototype.ChangeHandler=function(t,e,i){"user"==i&&this.$scope.UpdateValue(this.config.name,t,e)},e.prototype.SetCommonValues=function(){var t=this.Form;this.ShowBatch(t,"common"),t.setValues(this.Styles.getCommonValues())},e.prototype.SetBlockValues=function(t){var e=this.Form;"text"!=t.type?this.ShowBatch(e,"shape"):this.ShowBatch(e,"block"),e.setValues(this.Styles.getBlockValues(t))},e.prototype.SetLinkValues=function(t){var e=this.Form;this.ShowBatch(e,"link"),e.setValues(this.Styles.getLinkValues(t))},e.prototype.GetCommonConfig=function(){var t=this._,e=this.MarginX,i=this.app.config,n=i.minItemWidth,o=i.minItemHeight;return[{rows:[{label:t("Default block size"),view:"label",css:"webix_de_sublabel"},{margin:e,cols:[{view:"diagram-text",inputLabel:"W",min:n,name:"width"},{view:"diagram-text",inputLabel:"H",min:o,name:"height"}]}]},this.GetLinkArrowConfig(!0),this.GetLinkModeConfig(!0),{}]},e.prototype.GetBlockConfig=function(){var t=this._,e=this.MarginX,i=this.app.config,n=i.minItemWidth,o=i.minItemHeight,r=webix.skin.$active;return[{rows:[{label:t("Block settings"),view:"label",css:"webix_de_sublabel"},{margin:e,cols:[{view:"diagram-text",inputLabel:"W",min:n,name:"width"},{view:"diagram-text",inputLabel:"H",min:o,name:"height"}]},{margin:e,cols:[{view:"diagram-text",inputLabel:"X",name:"x"},{view:"diagram-text",inputLabel:"Y",name:"y"}]},{margin:e,cols:[{view:"diagram-text",inputLabel:"<span class='webix_de_degree'>&deg;</span>",name:"angle",format:this.AngleFormat()},{}]}]},{rows:[{label:t("Content"),view:"label",css:"webix_de_sublabel"},{view:"textarea",name:"value",height:1.5*r.inputHeight}]},{batch:"shape",rows:[{label:t("Fill"),view:"label",css:"webix_de_sublabel"},{view:"colorpicker",name:"backgroundColor",suggest:{padding:0,type:"colorselect",body:{button:!0}}}]},{batch:"shape",rows:[{label:t("Border style"),view:"label",css:"webix_de_sublabel"},this.GetLineConfig()]},{rows:[{label:t("Font"),view:"label",css:"webix_de_sublabel"},{margin:r.layoutMargin.form,rows:[{margin:e,cols:[{view:"colorpicker",name:"fontColor",suggest:{padding:0,type:"colorselect",body:{button:!0}}},{view:"diagram-toggle",name:"fontWeight",label:"<span class='webix_icon dgi-format-bold'></span>",onValue:"bold",offValue:"normal",width:r.inputHeight-2},{view:"diagram-toggle",name:"fontStyle",label:"<span class='webix_icon dgi-format-italic'></span>",onValue:"italic",offValue:"normal",width:r.inputHeight-2}]},{margin:e,cols:[{view:"combo",name:"fontFamily",css:"webix_diagram_editor_select",options:this.GetFontFamilyOptions()},{view:"combo",name:"fontSize",width:80,css:"webix_diagram_editor_select",options:this.GetFontSizeOptions()}]},{margin:r.layoutMargin.form,cols:[{view:"segmented",name:"textAlign",optionWidth:r.inputHeight-2*r.inputPadding,value:"edges",css:"webix_de_segmented",options:[{id:"left",value:this.IconTemplate("dgi-format-align-left")},{id:"center",value:this.IconTemplate("dgi-format-align-center")},{id:"right",value:this.IconTemplate("dgi-format-align-right")}]},{view:"segmented",name:"textVAlign",optionWidth:r.inputHeight-2*r.inputPadding,value:"edges",css:"webix_de_segmented webix_diagram_right_align",options:[{id:"top",value:this.IconTemplate("dgi-format-vertical-align-top")},{id:"center",value:this.IconTemplate("dgi-format-vertical-align-center")},{id:"bottom",value:this.IconTemplate("dgi-format-vertical-align-bottom")}]}]}]}]},{}]},e.prototype.GetLinkConfig=function(){var t=this._;return[this.GetLinkArrowConfig(),this.GetLinkModeConfig(),{rows:[{label:t("Line style"),view:"label",css:"webix_de_sublabel"},this.GetLineConfig()]},{}]},e.prototype.GetLinkModeConfig=function(t){var e=this._,i=webix.skin.$active;return{rows:[{label:e(t?"Default link mode":"Link mode"),view:"label",css:"webix_de_sublabel"},{cols:[{view:"segmented",name:"mode",optionWidth:i.inputHeight-2*i.inputPadding,value:"edges",css:"webix_de_segmented",options:[{id:"edges",value:this.IconTemplate("dgi-subdirectory-arrow-right")},{id:"direct",value:this.IconTemplate("dgi-arrow-bottom-right")}]},{}]}]}},e.prototype.GetLinkArrowConfig=function(t){var e=this,i=this._,n=this.MarginX,o=webix.skin.$active;return{rows:[{label:i(t?"Default link arrow":"Link arrow"),view:"label",css:"webix_de_sublabel"},{margin:n,cols:[{view:"richselect",name:"arrow",optionWidth:o.inputHeight-2*o.inputPadding,placeholder:this.NoneTemplate(),css:"webix_diagram_editor_select",options:this.GetArrowOptions()},{view:"button",batch:"link",width:o.inputHeight,label:"<span class='webix_icon dgi-swap-vertical'></span>",css:"webix_de_icon_button",click:function(){return e.app.callEvent("form:swap",[])}},{view:"diagram-text",icon:!1,name:"arrowSize",width:60,value:6}]}]}},e.prototype.GetLineConfig=function(){return{margin:this.MarginX,cols:[{view:"colorpicker",name:"lineColor",css:"webix_de_colorpicker",width:webix.skin.$active.inputHeight,suggest:{padding:0,type:"colorselect",body:{button:!0}}},{view:"richselect",name:"lineStyle",css:"webix_diagram_editor_select",options:[{id:"solid",value:this.SelectOptionTemplate("solid")},{id:"dashed",value:this.SelectOptionTemplate("dashed")},{id:"dotted",value:this.SelectOptionTemplate("dotted")}]},{view:"diagram-text",icon:!1,name:"lineWidth",width:60,value:6}]}},e.prototype.GetFontSizeOptions=function(){return[11,12,13,14,15,16,18,20].map((function(t){return{id:t}}))},e.prototype.GetArrowOptions=function(){var t=this;return this.Styles.getArrows().map((function(e){return e?{id:e,value:t.SelectOptionTemplate(e)}:{$empty:!0,value:t.NoneTemplate()}}))},e.prototype.GetFontFamilyOptions=function(){return this.Styles.getFontFamilies().map((function(t){return{id:t,value:"<span style='font-family: "+t+"'>"+t+"</span>"}}))},e.prototype.IconTemplate=function(t){return"<span class='webix_icon "+t+"'></span>"},e.prototype.NoneTemplate=function(){return"<span class='webix_diagram_option_none'>"+this._("None")+"</span>"},e.prototype.SelectOptionTemplate=function(t){return pt[t]},e.prototype.AngleFormat=function(){return{edit:function(t){return t%360+""},parse:function(t){return t%360+""}}},e.prototype.ShowBatch=function(t,e){var i=this;t.getChildViews&&t.getChildViews().forEach((function(t){t.config.batch&&(e==t.config.batch?t.show():t.hide()),i.ShowBatch(t,e)}))},e.prototype.UpdateValue=function(t){var e=this.Form.elements,i=null,n=e[t].getValue();"common"==this.Mode&&(i="width"==t||"height"==t?"type":"linkType"),("arrow"==t||"lineColor"==t&&"link"==this.Mode&&e.arrow.getValue().includes("-fill"))&&(n=this.ApplyArrow(t,n,i)),"fontWeight"!=t&&"fontFamily"!=t||(n=this.ApplyFontWeight(t,n)),this.app.callEvent("form:update",[t,n,i])},e.prototype.ApplyFontWeight=function(t,e){var i=this.Form.elements;if("fontWeight"==t&&"bold"==e&&"Roboto"==i.fontFamily.getValue())e=500;else if("fontFamily"==t){var n=i.fontWeight.getValue();"500"!=n&&"bold"!=n||(n="Roboto"==e?500:"bold",this.app.callEvent("form:update",["fontWeight",n]))}return e},e.prototype.ApplyArrow=function(t,e,i){if("arrow"==t){var n=null;e.includes("-fill")?(e=e.replace(/-fill/,""),n=i?this.Styles.getDefaults().line.lineColor:this.Form.elements.lineColor.getValue()):"none"==e&&(e=!1),this.app.callEvent("form:update",["backgroundColor",n,i])}else this.app.callEvent("form:update",["backgroundColor",e]);return e},e}(u),gt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){return{rows:[ct,{localId:"editor",type:"wide",padding:{top:4},cols:[dt,ut,{$subview:ft,name:"form"}]}]}},e.prototype.init=function(){var t=this;this.on(this.app,"toolbar:preview",(function(e){var i=t.$$("editor").getChildViews();e?(i[0].hide(),i[2].hide()):(i[0].show(),i[2].show())}))},e}(u),vt={JetView:u};vt.editor=gt,vt.form=ft,vt.shapes=dt,vt.toolbar=ct,vt["windows/context"]=ht,vt.workspace=ut;var wt=function(t){function e(e){var i=this,o=N({selected:null,zoom:1,gridStep:10});e=e||{};var r={router:y,version:"8.4.5",debug:!0,start:"/editor",params:{state:o},minItemWidth:30,minItemHeight:30};(i=t.call(this,n(n({},r),e))||this).use(P,i.config.locale||{lang:"en",webix:{en:"en-US"}});var s=function(t){return i.config.override&&i.config.override.get(t)||t};return i.setService("styles",new(s(U))(i)),i.setService("history",new(s(Z))(i)),i.setService("local",new(s(et))(i)),i}return i(e,t),e.prototype.require=function(t,e){return"jet-views"===t?vt[e]:"jet-locales"===t?yt[e]:null},e.prototype.getState=function(){return this.config.params.state},e.prototype._prepareLinks=function(t){t=t||[];for(var e=0;e<t.length;e++){var i=t[e];!webix.isArray(i.line)||i.from&&i.to||delete i.line,"child"!=i.mode&&"sibling"!=i.mode||delete i.mode}return t},e.prototype.setValues=function(t){this.getService("styles").setType(t.item,t.linkItem),this.callEvent("values:defaults",[]);var e=this.getService("local");e.shapes().clearAll(),e.shapes().parse(t.shapes||[]),e.links().clearAll(),e.links().parse(this._prepareLinks(t.links)),e.data().clearAll(),e.data().importData(t.data),this.getService("history").track()},e.prototype.getValues=function(){var t=this.getService("local"),e=this.getService("styles");return{data:t.data().serialize(),links:t.links().serialize(),shapes:t.shapes().serialize(),linkItem:e.getLinkValues(),item:e.getBlockValues()}},e}(m);webix.protoUI({name:"diagram-editor",app:wt,defaults:{borderless:!0},$init:function(){var t=this;this.name="diagram-editor",this.$view.className+=" webix_diagram_editor";var e=this.$app.getState();for(var i in e)D(e,this.config,i);this.$app.attachEvent("diagram:beforedrag",(function(e,i){return t.callEvent("onBeforeDrag",[e,i])})),this.$app.attachEvent("diagram:beforedrop",(function(e,i){return t.callEvent("onBeforeDrop",[e,i])}))},getState:function(){return this.$app.getState()},getService:function(t){return this.$app.getService(t)},setValues:function(t){return this.$app.setValues(t)},getValues:function(){return this.$app.getValues()}},webix.ui.jetapp);var mt={Styles:U},yt={en:{"Link arrow":"Link arrow","Default link arrow":"Default link arrow","Link mode":"Link mode","Default link mode":"Default link mode",Fill:"Fill",Size:"Size","Block settings":"Block settings","Default block size":"Default block size",Font:"Font","Line style":"Line style","Border style":"Border style",Content:"Content",None:"None",Reset:"Reset",Autoplace:"Autoplace",Apply:"Apply",Block:"Block",Flow:"Flow",Common:"Common",Extra:"Extra",Circle:"Circle",Dot:"Dot",Head:"Head",Heptagon:"Heptagon",Join:"Join",Junction:"Junction",Octagon:"Octagon",Pentagon:"Pentagon",Plus:"Plus",Rtriangle:"Right triangle",Star:"Star",Tail:"Tail",Trapezoid:"Trapezoid",Triangle:"Triangle",Action:"Action",Collate:"Collate",Connector:"Connector",Data:"Data",Database:"Database",Decision:"Decision",Display:"Display",Document:"Document",Input:"Input",Internal:"Internal",Looplimit:"Loop limit",Multidoc:"Multiple documents",Note:"Note",Operation:"Operation",Or:"Or",Output:"Output",Preparation:"Preparation",Process:"Process",Sort:"Sort",Start:"Start",Storage:"Storage",Subroutine:"Subroutine",Default:"Default",Organization:"Organization",Text:"Text"}};t.App=wt,t.locales=yt,t.services=mt,t.views=vt,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=diagram.min.js.map
